{"version":3,"file":"x-intersection-observer.cjs","names":["MH","_interopRequireWildcard","require","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_defineProperty","_toPropertyKey","value","enumerable","configurable","writable","_toPrimitive","Symbol","toPrimitive","TypeError","String","Number","XIntersectionObserver","constructor","callback","observeOptions","observedTargets","newWeakSet","targetsToSkip","intersectionHandler","entries","selectedEntries","entry","targetOf","deleteKey","push","lengthOf","observer","newIntersectionObserver","root","rootMargin","thresholds","observe","targets","target","add","observeLater","unobserve","disconnect","takeRecords","exports"],"sources":["../../../src/ts/modules/x-intersection-observer.ts"],"sourcesContent":["/**\n * @module Modules/XIntersectionObserver\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nexport type XIntersectionObserverCallback = (\n  entries: IntersectionObserverEntry[],\n  observer: XIntersectionObserver,\n) => void;\n\n/**\n * {@link XIntersectionObserver} is an extension of\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver | IntersectionObserver}\n * with added capabilities:\n * - can skip the initial callback that happens shortly after setting up via\n *   {@link observeLater}\n */\nexport class XIntersectionObserver {\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/root | IntersectionObserver:root}.\n   */\n  readonly root!: Element | Document | null;\n\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/rootMargin | IntersectionObserver:rootMargin}.\n   */\n  readonly rootMargin!: string;\n\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/thresholds | IntersectionObserver:thresholds}.\n   */\n  readonly thresholds!: number[];\n\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/observe | IntersectionObserver:observe} except it accepts multiple\n   * targets.\n   */\n  readonly observe: (...targets: Element[]) => void;\n\n  /**\n   * Like {@link observe} but it ignores the initial almost immediate callback\n   * and only calls the callback on a subsequent intersection change.\n   */\n  readonly observeLater: (...targets: Element[]) => void;\n\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/unobserve | IntersectionObserver:unobserve} except it accepts multiple\n   * targets.\n   */\n  readonly unobserve: (...targets: Element[]) => void;\n\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/disconnect | IntersectionObserver:disconnect}.\n   */\n  readonly disconnect: () => void;\n\n  /**\n   * Like `IntersectionObserver.takeRecords`.\n   */\n  readonly takeRecords: () => void;\n\n  constructor(\n    callback: XIntersectionObserverCallback,\n    observeOptions?: IntersectionObserverInit,\n  ) {\n    let observedTargets = MH.newWeakSet<Element>();\n    const targetsToSkip = MH.newWeakSet<Element>();\n\n    const intersectionHandler = (entries: IntersectionObserverEntry[]) => {\n      const selectedEntries = [];\n\n      for (const entry of entries) {\n        if (targetsToSkip.has(MH.targetOf(entry))) {\n          MH.deleteKey(targetsToSkip, MH.targetOf(entry));\n          continue;\n        }\n\n        selectedEntries.push(entry);\n      }\n\n      if (MH.lengthOf(selectedEntries)) {\n        callback(selectedEntries, this);\n      }\n    };\n\n    const observer = MH.newIntersectionObserver(\n      intersectionHandler,\n      observeOptions,\n    );\n\n    MH.defineProperty(this, \"root\", { get: () => observer.root });\n    MH.defineProperty(this, \"rootMargin\", {\n      get: () => observer.rootMargin,\n    });\n    MH.defineProperty(this, \"thresholds\", {\n      get: () => observer.thresholds,\n    });\n\n    this.observe = (...targets) => {\n      for (const target of targets) {\n        observedTargets.add(target);\n        observer.observe(target);\n      }\n    };\n\n    this.observeLater = (...targets) => {\n      for (const target of targets) {\n        // Only skip them if not already observed, otherwise the initial\n        // (almost) immediate callback won't happen anyway.\n        if (observedTargets.has(target)) {\n          continue;\n        }\n\n        targetsToSkip.add(target);\n        this.observe(target);\n      }\n    };\n\n    this.unobserve = (...targets) => {\n      for (const target of targets) {\n        MH.deleteKey(observedTargets, target);\n        observer.unobserve(target);\n      }\n    };\n\n    this.disconnect = () => {\n      observedTargets = MH.newWeakSet();\n      observer.disconnect();\n    };\n\n    this.takeRecords = () => observer.takeRecords();\n  }\n}\n"],"mappings":"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","ignoreList":[]}