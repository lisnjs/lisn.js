<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="assets/js/lisn.link.js" charset="utf-8"></script>
    <script src="assets/js/lisn-settings.js" charset="utf-8"></script>
    <link
      rel="stylesheet"
      href="assets/lisn/css/lisn.css"
      type="text/css"
      media="screen"
      charset="utf-8"
    />
    <style>
      #box {
        width: 200px;
        height: 200px;
        background: blue;
        margin: 30px 0;
      }
    </style>
  </head>
  <body>
    <div>
      <p>Tween towards right side of the screen</p>
      <button type="button" data-tween="spring">Start</button>
      <button type="button" data-tween="linear">Linear</button>
      <button type="button" data-tween="quadratic">Quadratic</button>
      <button type="button" data-tween="cubic">Cubic</button>
    </div>

    <div>
      <p>
        Tween towards middle of the screen, then update at 25% progress towards
        right side of the screen
      </p>
      <button type="button" data-tween="spring" data-update-at-progress="25">
        Spring
      </button>
      <button type="button" data-tween="spring" data-update-at-progress="25">
        Linear
      </button>
      <button type="button" data-tween="spring" data-update-at-progress="25">
        Quadratic
      </button>
      <button type="button" data-tween="spring" data-update-at-progress="25">
        Cubic
      </button>
    </div>

    <div>
      <p>
        Tween towards middle of the screen, then update at 50% progress towards
        right side of the screen
      </p>
      <button type="button" data-tween="spring" data-update-at-progress="50">
        Spring
      </button>
      <button type="button" data-tween="spring" data-update-at-progress="50">
        Linear
      </button>
      <button type="button" data-tween="spring" data-update-at-progress="50">
        Quadratic
      </button>
      <button type="button" data-tween="spring" data-update-at-progress="50">
        Cubic
      </button>
    </div>

    <div>
      <p>
        Tween towards middle of the screen, then update at 75% progress towards
        right side of the screen
      </p>
      <button type="button" data-tween="spring" data-update-at-progress="75">
        Spring
      </button>
      <button type="button" data-tween="spring" data-update-at-progress="75">
        Linear
      </button>
      <button type="button" data-tween="spring" data-update-at-progress="75">
        Quadratic
      </button>
      <button type="button" data-tween="spring" data-update-at-progress="75">
        Cubic
      </button>
    </div>

    <div id="box"></div>

    <script>
      const box = document.getElementById("box");
      let currentTween;

      async function tweenBox(tween, updateAtProgress = 0) {
        const thisTween = Symbol();
        currentTween = thisTween;

        const finalTarget = 100; // 100%
        let state = null,
          target = finalTarget / 2,
          lag = 1500,
          current = 0;
        i = 0;

        for await (const {
          sinceLast: deltaTime,
        } of LISN.utils.animationFrameGenerator()) {
          if (!deltaTime) {
            continue;
          }

          if (Math.round(current - target) === 0) {
            break;
          }

          if (currentTween !== thisTween) {
            break; // another one was started
          }

          if (i > (lag * 2) / deltaTime) {
            console.error(`tweener ${tween} is not converging`);
            break;
          }

          if (current / (finalTarget / 2) > updateAtProgress / 100) {
            target = finalTarget;
          }

          ({ current, state } = LISN.utils.TWEENERS[tween]({
            current,
            target,
            lag,
            deltaTime,
            state,
          }));

          box.style.setProperty(
            "transform",
            // progress % of the viewport width - box width
            `translateX(calc(0.98vw * ${current} - 100%))`,
          );

          i++;
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        for (const button of document.querySelectorAll("button[data-tween]")) {
          const tween = button.dataset.tween;
          const updateAtProgress =
            Number.parseInt(button.dataset.updateAtProgress) || 0;
          button.addEventListener("click", () =>
            tweenBox(tween, updateAtProgress),
          );
        }
      });
    </script>
  </body>
</html>
