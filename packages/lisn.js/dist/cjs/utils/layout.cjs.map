{"version":3,"file":"layout.cjs","names":["MH","_interopRequireWildcard","require","_errors","_settings","_math","_validation","_bitSpaces","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","isValidDevice","device","ORDERED_DEVICES","exports","isValidAspectRatio","aspectRatio","ORDERED_ASPECTR","isValidDeviceList","isValidForType","S_DEVICES","isValidAspectRatioList","aspectR","S_ASPECTRS_CAMEL","getOtherDevices","getOtherLayouts","getOtherAspectRatios","getLayoutBitmask","options","layoutBitmask","getBitmaskFromSpec","devices","aspectRatios","bitmask","ORDERED_DEVICE_NAMES","sortedKeysByVal","settings","deviceBreakpoints","ORDERED_ASPECTR_NAMES","aspectRatioBreakpoints","bitSpaces","newBitSpaces","createBitSpace","NUM_LAYOUTS","lengthOf","LAYOUT_RANGE_REGEX","RegExp","getLayoutsFromBitmask","keyName","bitSpace","layouts","bit","start","end","value","name","nameOf","push","spec","oppositeBitmask","err","isInstanceOf","LisnUsageError","isEmpty","singleKeyName","slice","isString","rangeMatch","match","groups","bugError","minLayout","layoutA","maxLayout","layoutB","undefined","usageError","bitmaskFor","validateStrList","lt"],"sources":["../../../src/ts/utils/layout.ts"],"sourcesContent":["/**\n * @module Utils\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { LisnUsageError } from \"@lisn/globals/errors\";\nimport { settings } from \"@lisn/globals/settings\";\n\nimport {\n  DeviceSpec,\n  Device,\n  AspectRatioSpec,\n  AspectRatio,\n} from \"@lisn/globals/types\";\n\nimport { sortedKeysByVal } from \"@lisn/utils/math\";\nimport { validateStrList } from \"@lisn/utils/validation\";\n\nimport {\n  BitSpace,\n  newBitSpaces,\n  createBitSpace,\n} from \"@lisn/modules/bit-spaces\";\n\n/**\n * Returns true if the given string is a valid device name.\n *\n * @category Validation\n */\nexport const isValidDevice = (device: string): device is Device =>\n  ORDERED_DEVICES.has(device);\n\n/**\n * Returns true if the given string is a valid aspect ratio name.\n *\n * @category Validation\n */\nexport const isValidAspectRatio = (\n  aspectRatio: string,\n): aspectRatio is AspectRatio => ORDERED_ASPECTR.has(aspectRatio);\n\n/**\n * Returns true if the given string is a valid device specification (including\n * `\"min <Device>\"`, etc).\n *\n * Returns false for \"\", although if you passed \"\" in\n * {@link Watchers/LayoutWatcher.OnLayoutOptions | OnLayoutOptions} it would\n * accept it as specifying _all_ devices.\n *\n * @category Validation\n */\nexport const isValidDeviceList = (\n  device: string | string[],\n): device is DeviceSpec | Device[] =>\n  isValidForType(S_DEVICES, device, ORDERED_DEVICES);\n\n/**\n * Returns true if the given string is a valid aspect ratio specification\n * (including `\"min <AspectRatio>\"`, etc).\n *\n * Returns false for \"\", although if you passed \"\" in\n * {@link Watchers/LayoutWatcher.OnLayoutOptions | OnLayoutOptions} it would\n * accept it as specifying _all_ aspect ratios.\n *\n * @category Validation\n */\nexport const isValidAspectRatioList = (\n  aspectR: string | string[],\n): aspectR is AspectRatioSpec | AspectRatio[] =>\n  isValidForType(S_ASPECTRS_CAMEL, aspectR, ORDERED_ASPECTR);\n\n/**\n * Returns a list of {@link Device}s that are not covered by the given device\n * specification. See\n * {@link Watchers/LayoutWatcher.OnLayoutOptions | OnLayoutOptions} for accepted\n * formats.\n *\n * Returns an empty for \"\" or for a specification that includes all devices.\n *\n * @category Layout\n */\nexport const getOtherDevices = (device: DeviceSpec | Device[]): Device[] =>\n  getOtherLayouts(S_DEVICES, device, ORDERED_DEVICES);\n\n/**\n * Returns a list of {@link AspectRatio}s that are not covered by the given\n * aspect ratio specification. See\n * {@link Watchers/LayoutWatcher.OnLayoutOptions | OnLayoutOptions} for accepted\n * formats.\n *\n * Returns an empty for \"\" or for a specification that includes all aspect\n * ratios.\n *\n * @category Layout\n */\nexport const getOtherAspectRatios = (\n  aspectR: AspectRatioSpec | AspectRatio[],\n): AspectRatio[] => getOtherLayouts(S_ASPECTRS_CAMEL, aspectR, ORDERED_ASPECTR);\n\n/**\n * @ignore\n * @internal\n */\nexport const getLayoutBitmask = (options?: {\n  devices?: DeviceSpec | Device[];\n  aspectRatios?: AspectRatioSpec | AspectRatio[];\n}): number => {\n  let layoutBitmask =\n    getBitmaskFromSpec(S_DEVICES, options?.devices, ORDERED_DEVICES) |\n    getBitmaskFromSpec(\n      S_ASPECTRS_CAMEL,\n      options?.aspectRatios,\n      ORDERED_ASPECTR,\n    );\n\n  if (!layoutBitmask) {\n    layoutBitmask = ORDERED_DEVICES.bitmask | ORDERED_ASPECTR.bitmask; // default: all\n  }\n\n  return layoutBitmask;\n};\n\n// In ascending order by width.\nconst ORDERED_DEVICE_NAMES = sortedKeysByVal(settings.deviceBreakpoints);\nconst ORDERED_ASPECTR_NAMES = sortedKeysByVal(settings.aspectRatioBreakpoints);\n\nconst bitSpaces = newBitSpaces();\n\n/**\n * @ignore\n * @internal\n */\nexport const ORDERED_DEVICES = createBitSpace(\n  bitSpaces,\n  ...ORDERED_DEVICE_NAMES,\n);\n\n/**\n * @ignore\n * @internal\n */\nexport const ORDERED_ASPECTR = createBitSpace(\n  bitSpaces,\n  ...ORDERED_ASPECTR_NAMES,\n);\n\n/**\n * @ignore\n * @internal\n */\nexport const NUM_LAYOUTS =\n  MH.lengthOf(ORDERED_DEVICE_NAMES) + MH.lengthOf(ORDERED_ASPECTR_NAMES);\n\n// --------------------\n\nconst S_DEVICES = \"devices\";\nconst S_ASPECTRS_CAMEL = \"aspectRatios\";\n\nconst LAYOUT_RANGE_REGEX = RegExp(\n  \"^ *(\" +\n    \"(?<layoutA>[a-z-]+) +to +(?<layoutB>[a-z-]+)|\" +\n    \"min +(?<minLayout>[a-z-]+)|\" +\n    \"max +(?<maxLayout>[a-z-]+)\" +\n    \") *$\",\n);\n\nconst getLayoutsFromBitmask = <T extends Device | AspectRatio>(\n  keyName: string,\n  bitmask: number,\n  bitSpace: BitSpace<T>,\n): T[] => {\n  const layouts: T[] = [];\n  for (let bit = bitSpace.start; bit <= bitSpace.end; bit++) {\n    const value = 1 << bit;\n    if (bitmask & value) {\n      const name = bitSpace.nameOf(value);\n      if (name) {\n        layouts.push(name);\n      }\n    }\n  }\n\n  return layouts;\n};\n\nconst getOtherLayouts = <T extends Device | AspectRatio>(\n  keyName: string,\n  spec: string | string[],\n  bitSpace: BitSpace<T>,\n): T[] => {\n  const bitmask = getBitmaskFromSpec(keyName, spec, bitSpace);\n  if (!bitmask) {\n    return [];\n  }\n\n  const oppositeBitmask = bitSpace.bitmask & ~bitmask;\n  return getLayoutsFromBitmask(keyName, oppositeBitmask, bitSpace);\n};\n\nconst isValidForType = <T extends Device | AspectRatio>(\n  keyName: string,\n  spec: string | string[],\n  bitSpace: BitSpace<T>,\n): boolean => {\n  try {\n    const bitmask = getBitmaskFromSpec(keyName, spec, bitSpace);\n    return bitmask !== 0;\n  } catch (err) {\n    if (MH.isInstanceOf(err, LisnUsageError)) {\n      return false;\n    }\n    throw err;\n  }\n};\n\nconst getBitmaskFromSpec = <T extends Device | AspectRatio>(\n  keyName: string,\n  spec: string | string[] | undefined | null,\n  bitSpace: BitSpace<T>,\n): number => {\n  if (MH.isEmpty(spec)) {\n    return 0;\n  }\n  const singleKeyName = keyName.slice(0, -1);\n\n  if (MH.isString(spec)) {\n    const rangeMatch = spec.match(LAYOUT_RANGE_REGEX);\n    if (rangeMatch) {\n      /* istanbul ignore next */ // shouldn't happen\n      if (!rangeMatch.groups) {\n        throw MH.bugError(\"Layout regex has no named groups\");\n      }\n\n      const minLayout =\n        rangeMatch.groups.layoutA || rangeMatch.groups.minLayout;\n      const maxLayout =\n        rangeMatch.groups.layoutB || rangeMatch.groups.maxLayout;\n\n      if (minLayout !== undefined && !bitSpace.has(minLayout)) {\n        throw MH.usageError(`Unknown ${singleKeyName} '${minLayout}'`);\n      }\n\n      if (maxLayout !== undefined && !bitSpace.has(maxLayout)) {\n        throw MH.usageError(`Unknown ${singleKeyName} '${maxLayout}'`);\n      }\n\n      return bitSpace.bitmaskFor(minLayout, maxLayout);\n    }\n  }\n\n  let bitmask = 0;\n  const layouts = validateStrList(keyName, spec, bitSpace.has);\n  if (layouts) {\n    for (const lt of layouts) {\n      bitmask |= bitSpace.bit[lt];\n    }\n  }\n\n  return bitmask;\n};\n"],"mappings":"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","ignoreList":[]}