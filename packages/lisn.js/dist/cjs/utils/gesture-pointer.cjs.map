{"version":3,"file":"gesture-pointer.cjs","names":["MC","_interopRequireWildcard","require","MH","_directions","_event","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","getPointerGestureFragment","events","options","isIterableObject","isCancelled","supports","getBrowserSupport","pointerEventClass","_pointer","PointerEvent","MouseEvent","pointerUpType","S_POINTERUP","S_MOUSEUP","filteredEvents","filter","event","eType","type","S_POINTERCANCEL","S_CLICK","isInstanceOf","buttons","isTouchPointerEvent","numEvents","lengthOf","firstEvent","lastEvent","getPointerType","deltaX","clientX","deltaY","clientY","direction","getVectorDirection","angleDiffThreshold","S_NONE","device","S_POINTER","intent","S_DRAG","deltaZ","exports"],"sources":["../../../src/ts/utils/gesture-pointer.ts"],"sourcesContent":["/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { getVectorDirection } from \"@lisn/utils/directions\";\nimport { getBrowserSupport } from \"@lisn/utils/event\";\nimport { GestureFragment } from \"@lisn/utils/gesture\";\n\n/**\n * Returns a {@link GestureFragment} for the given events. If the browser\n * supports Pointer events, then only \"pointermove\" events will be considered.\n * Otherwise, only \"mousemove\" events will be considered.\n *\n * If there are less than 2 such events in the given list of events, returns\n * `false`.\n *\n * If the gesture is to be considered terminated, e.g. because there is\n * \"pointercancel\" in the list or buttons other than the primary are pressed,\n * returns `null`.\n *\n * Pointer gestures always require the primary button to be pressed and the\n * resulting intent is always \"drag\", and `deltaZ` is always 1.\n *\n * @param {} [options.angleDiffThreshold] See {@link getVectorDirection}\n *\n * @return {} `false` if there are less than 2 \"pointermove\"/\"mousemove\" events\n * in the list, `null` if the gesture is terminated, otherwise a\n * {@link GestureFragment}.\n *\n * @category Gestures\n */\nexport const getPointerGestureFragment = (\n  events: Event | readonly Event[],\n  options?: {\n    angleDiffThreshold?: number;\n  },\n): GestureFragment | null | false => {\n  if (!MH.isIterableObject(events)) {\n    events = [events];\n  }\n\n  let isCancelled = false;\n  const supports = getBrowserSupport();\n\n  // If the browser supports pointer events, then only take those; otherwise\n  // take the mouse events\n  const pointerEventClass = supports._pointer ? PointerEvent : MouseEvent;\n  const pointerUpType = supports._pointer ? MC.S_POINTERUP : MC.S_MOUSEUP;\n\n  const filteredEvents: MouseEvent[] = MH.filter(\n    events,\n    (event): event is MouseEvent => {\n      const eType = event.type;\n      isCancelled = isCancelled || eType === MC.S_POINTERCANCEL;\n      if (eType !== MC.S_CLICK && MH.isInstanceOf(event, pointerEventClass)) {\n        // Only events where the primary button is pressed (unless it's a\n        // pointerup event, in which case no buttons should be pressed) are\n        // considered, otherwise consider it terminated\n        isCancelled =\n          isCancelled ||\n          (eType === pointerUpType && event.buttons !== 0) ||\n          (eType !== pointerUpType && event.buttons !== 1);\n        // we don't handle touch pointer events\n        return !MH.isTouchPointerEvent(event);\n      }\n      return false;\n    },\n  );\n\n  const numEvents = MH.lengthOf(filteredEvents);\n  if (numEvents < 2) {\n    return false; // no enough events\n  }\n\n  if (isCancelled) {\n    return null; // terminated\n  }\n\n  const firstEvent = filteredEvents[0];\n  const lastEvent = filteredEvents[numEvents - 1];\n  if (MH.getPointerType(firstEvent) !== MH.getPointerType(lastEvent)) {\n    return null; // different devices, consider it terminated\n  }\n\n  const deltaX = lastEvent.clientX - firstEvent.clientX;\n  const deltaY = lastEvent.clientY - firstEvent.clientY;\n  const direction = getVectorDirection(\n    [deltaX, deltaY],\n    options?.angleDiffThreshold,\n  );\n\n  return direction === MC.S_NONE\n    ? false\n    : {\n        device: MC.S_POINTER,\n        direction,\n        intent: MC.S_DRAG,\n        deltaX,\n        deltaY,\n        deltaZ: 1,\n      };\n};\n"],"mappings":"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","ignoreList":[]}