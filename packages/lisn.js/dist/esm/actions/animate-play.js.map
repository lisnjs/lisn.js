{"version":3,"file":"animate-play.js","names":["MC","iterateAnimations","resetCssAnimationsNow","hasClass","addClassesNow","removeClassesNow","registerAction","AnimatePlay","register","element","constructor","_defineProperty","_play","_pause","_toggle","getMethods","animate","PAUSE","do","undo","S_TOGGLE","AnimatePause","PLAY","TOGGLE","action","isInitial","animation","isPaused","playState","play","pause","PREFIX_ANIMATE_PAUSE"],"sources":["../../../src/ts/actions/animate-play.ts"],"sourcesContent":["/**\n * @module Actions\n *\n * @categoryDescription Animation\n * {@link AnimatePlay} and {@link AnimatePause} resume or pause all animations\n * on the given element. They work with CSS or Web Animations.\n *\n * {@link Actions.Animate | Animate} plays or reverses all animations on the\n * given element. It works with CSS or Web Animations.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\n\nimport {\n  iterateAnimations,\n  resetCssAnimationsNow,\n} from \"@lisn/utils/animations\";\nimport {\n  hasClass,\n  addClassesNow,\n  removeClassesNow,\n} from \"@lisn/utils/css-alter\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\n/**\n * Resumes or pauses all animations on the given element.\n *\n * It works with CSS or Web Animations.\n *\n * **IMPORTANT:** When constructed, it resets and pauses the animations as a\n * form of initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"animate-play\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <button id=\"btn\">Play/pause</button>\n * <div data-lisn-on-click=\"@animate-play +target=#btn\"></div>\n * ```\n *\n * @category Animation\n */\nexport class AnimatePlay implements Action {\n  /**\n   * Resumes the animations without resetting them.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Pauses the animations without resetting them.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Resumes the animations if paused, otherwise pauses them.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"animate-play\", (element) => new AnimatePlay(element));\n  }\n\n  constructor(element: Element) {\n    const { _play, _pause, _toggle } = getMethods(element);\n\n    // initial state is 0% and paused\n    animate(element, PAUSE, true);\n\n    this.do = _play;\n    this.undo = _pause;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n/**\n * Pauses or resumes all animations on the given element.\n *\n * It works with CSS or Web Animations.\n *\n * **IMPORTANT:** When constructed, it plays the animations as a form of\n * initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"animate-pause\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <button id=\"btn\">Play/pause</button>\n * <div data-lisn-on-click=\"@animate-pause +target=#btn\"></div>\n * ```\n *\n * @category Animation\n */\nexport class AnimatePause implements Action {\n  /**\n   * Pauses the animations without resetting them.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Resumes the animations without resetting them.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Resumes the animations if paused, otherwise pauses them.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"animate-pause\", (element) => new AnimatePause(element));\n  }\n\n  constructor(element: Element) {\n    const { _play, _pause, _toggle } = getMethods(element);\n\n    // Initial state is playing\n    _play();\n\n    this.do = _pause;\n    this.undo = _play;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n// --------------------\n\ntype AnimateAction = typeof PLAY | typeof PAUSE | typeof TOGGLE;\n\nconst PLAY = 0;\nconst PAUSE = 1;\nconst TOGGLE = 2;\n\nconst getMethods = (element: Element) => {\n  return {\n    _play: () => animate(element, PLAY),\n    _pause: () => animate(element, PAUSE),\n    _toggle: () => animate(element, TOGGLE),\n  };\n};\n\nconst animate = (\n  element: Element,\n  action: AnimateAction,\n  isInitial = false,\n) => {\n  return iterateAnimations(\n    element,\n    /* istanbul ignore next */ // jsdom doesn't support Web Animations\n    (animation) => {\n      const isPaused = animation.playState === \"paused\";\n      if (action === PLAY || (isPaused && action === TOGGLE)) {\n        animation.play();\n      } else {\n        animation.pause();\n      }\n    },\n    (element) => {\n      if (isInitial) {\n        resetCssAnimationsNow(element);\n      }\n\n      const isPaused = hasClass(element, MC.PREFIX_ANIMATE_PAUSE);\n      if (action === PLAY || (isPaused && action === TOGGLE)) {\n        removeClassesNow(element, MC.PREFIX_ANIMATE_PAUSE);\n      } else {\n        addClassesNow(element, MC.PREFIX_ANIMATE_PAUSE);\n      }\n    },\n    isInitial,\n  );\n};\n"],"mappings":"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","ignoreList":[]}