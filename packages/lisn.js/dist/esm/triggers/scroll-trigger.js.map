{"version":3,"file":"scroll-trigger.js","names":["MC","MH","getOppositeXYDirections","isValidXYDirection","waitForReferenceElement","validateStrList","validateNumber","ScrollWatcher","registerTrigger","Trigger","ScrollTrigger","register","S_SCROLL","element","args","actions","config","assign","directions","newConfigValidator","constructor","once","S_UP","S_DOWN","S_LEFT","S_RIGHT","_defineProperty","getConfig","copyObject","lengthOf","watcher","reuse","scrollable","threshold","oppositeDirections","onScroll","run","reverse","key","value","_ref","isLiteralString","undefined"],"sources":["../../../src/ts/triggers/scroll-trigger.ts"],"sourcesContent":["/**\n * @module Triggers\n *\n * @categoryDescription Scroll\n * {@link ScrollTrigger} allows you to run actions when the user scrolls a\n * target element (or the main scrollable element) in a given direction, and\n * undo those actions when they scroll in the opposite direction.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  XYDirection,\n  CommaSeparatedStr,\n  ScrollTarget,\n} from \"@lisn/globals/types\";\n\nimport {\n  getOppositeXYDirections,\n  isValidXYDirection,\n} from \"@lisn/utils/directions\";\nimport { waitForReferenceElement } from \"@lisn/utils/dom-search\";\nimport { validateStrList, validateNumber } from \"@lisn/utils/validation\";\n\nimport { Action } from \"@lisn/actions/action\";\n\nimport { ScrollWatcher } from \"@lisn/watchers/scroll-watcher\";\n\nimport {\n  registerTrigger,\n  Trigger,\n  TriggerConfig,\n} from \"@lisn/triggers/trigger\";\n\nimport { WidgetConfigValidatorFunc } from \"@lisn/widgets/widget\";\n\n/**\n * {@link ScrollTrigger} allows you to run actions when the user scrolls a\n * target element (or the main scrollable element) in a given direction, and\n * undo those actions when they scroll in the opposite direction.\n *\n * -------\n *\n * To use with auto-widgets (HTML API), see {@link registerTrigger} for the\n * specification.\n *\n * - Arguments (optional): One or more (comma-separated) scroll directions.\n *   Note that if you do not specify any directions, then the trigger will just\n *   run once, on any scroll.\n * - Additional trigger options:\n *   - `scrollable`: A string element specification.\n *      See {@link Utils.getReferenceElement | getReferenceElement}.\n *   - `threshold`: A number.\n *\n * @example\n * Show the element when the user scrolls the page up, hide when scrolling\n * down. User scrolling left or right not trigger the action. See\n * {@link getOppositeXYDirections}:\n *\n * ```html\n * <div data-lisn-on-scroll=\"up @show\"></div>\n * ```\n *\n * @example\n * As above, but using a CSS class instead of data attribute:\n *\n * ```html\n * <div class=\"lisn-on-scroll--up@show\"></div>\n * ```\n *\n * @example\n * Show the element 1000ms after the first time the user scrolls the page up:\n *\n * ```html\n * <div data-lisn-on-scroll=\"up @show +once +delay=1000\"></div>\n * ```\n *\n * @example\n * Add class `scrolled` the first time the user scrolls the page in any\n * direction (note that the `once` option is implied here), and show the\n * element 1000ms after each time the user scrolls the page up, hide it as soon\n * as they scroll down:\n *\n * ```html\n * <div data-lisn-on-scroll=\"@add-class=scrolled ;\n *                           up @show +do-delay=1000\"\n * ></div>\n * ```\n *\n * @example\n * When the user scrolls up or down the closest ancestor with class `section`,\n * then add classes `c1` and `c2` and enable trigger `my-trigger` defined on\n * this same element; undo all of that when scrolling right or left:\n *\n * ```html\n * <div class=\"section\">\n *   <div data-lisn-on-scroll=\"up,down @add-class=c1,c2 @enable=my-trigger +scrollable=this.section\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n *   ></div>\n *</div>\n * ```\n *\n * @example\n * As above, but using `data-lisn-ref` attribute instead of class selector.\n *\n * ```html\n * <div data-lisn-ref=\"section\">\n *   <div data-lisn-on-scroll=\"up,down @add-class=c1,c2 @enable=my-trigger +scrollable=this-section\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n *   ></div>\n *</div>\n * ```\n *\n * @category Scroll\n */\nexport class ScrollTrigger extends Trigger {\n  readonly getConfig: () => ScrollTriggerConfig;\n\n  static register() {\n    registerTrigger(\n      MC.S_SCROLL,\n      (element, args, actions, config) => {\n        return new ScrollTrigger(\n          element,\n          actions,\n          MH.assign(config, {\n            directions: validateStrList(\"directions\", args, isValidXYDirection),\n          }),\n        );\n      },\n      newConfigValidator,\n    );\n  }\n\n  /**\n   * If no actions are supplied, nothing is done.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the config is invalid.\n   */\n  constructor(\n    element: Element,\n    actions: Action[],\n    config?: ScrollTriggerConfig,\n  ) {\n    config = config ?? {};\n\n    let directions = config.directions;\n    if (!directions) {\n      config.once = true;\n      directions = [MC.S_UP, MC.S_DOWN, MC.S_LEFT, MC.S_RIGHT];\n    }\n\n    super(element, actions, config);\n    this.getConfig = () => MH.copyObject(config);\n\n    if (!MH.lengthOf(actions)) {\n      return;\n    }\n\n    const watcher = ScrollWatcher.reuse();\n    const scrollable = config.scrollable;\n    const threshold = config.threshold;\n\n    const oppositeDirections = directions\n      ? getOppositeXYDirections(directions)\n      : [];\n\n    watcher.onScroll(this.run, {\n      directions,\n      scrollable,\n      threshold,\n    });\n\n    if (MH.lengthOf(oppositeDirections)) {\n      watcher.onScroll(this.reverse, {\n        directions: oppositeDirections,\n        scrollable,\n        threshold,\n      });\n    }\n  }\n}\n\n/**\n * @category Scroll\n * @interface\n */\nexport type ScrollTriggerConfig = TriggerConfig & {\n  /**\n   * The {@link XYDirection}s to use as the trigger.\n   * See also {@link Watchers/ScrollWatcher.OnScrollOptions | OnScrollOptions}\n   *\n   * Actions will be \"done\" when the scroll direction is one of the given ones\n   * and \"undone\" when it's the opposite direction. E.g. for \"up\" the opposite\n   * is \"down\".\n   */\n  directions?: CommaSeparatedStr<XYDirection> | XYDirection[];\n\n  /**\n   * The scrolling element target to use for the ScrollWatcher.\n   * See {@link Watchers/ScrollWatcher.OnScrollOptions | OnScrollOptions}\n   *\n   * @defaultValue {@link ScrollWatcher} default, the main scrolling element\n   */\n  scrollable?: ScrollTarget;\n\n  /**\n   * The scroll threshold to pass to the {@link ScrollWatcher}.\n   * See also {@link Watchers/ScrollWatcher.OnScrollOptions | OnScrollOptions}\n   *\n   * @defaultValue {@link ScrollWatcher} default\n   */\n  threshold?: number;\n};\n\n// --------------------\n\nconst newConfigValidator: WidgetConfigValidatorFunc<\n  Omit<ScrollTriggerConfig, \"directions\">\n> = (element) => {\n  return {\n    scrollable: (key, value) =>\n      (MH.isLiteralString(value)\n        ? waitForReferenceElement(value, element)\n        : null) ?? undefined,\n    threshold: validateNumber,\n  };\n};\n"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAO,KAAKA,EAAE;AACd,OAAO,KAAKC,EAAE;AAQd,SACEC,uBAAuB,EACvBC,kBAAkB;AAEpB,SAASC,uBAAuB;AAChC,SAASC,eAAe,EAAEC,cAAc;AAIxC,SAASC,aAAa;AAEtB,SACEC,eAAe,EACfC,OAAO;AAMT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,aAAa,SAASD,OAAO,CAAC;EAGzC,OAAOE,QAAQA,CAAA,EAAG;IAChBH,eAAe,CACbR,EAAE,CAACY,QAAQ,EACX,CAACC,OAAO,EAAEC,IAAI,EAAEC,OAAO,EAAEC,MAAM,KAAK;MAClC,OAAO,IAAIN,aAAa,CACtBG,OAAO,EACPE,OAAO,EACPd,EAAE,CAACgB,MAAM,CAACD,MAAM,EAAE;QAChBE,UAAU,EAAEb,eAAe,CAAC,YAAY,EAAES,IAAI,EAAEX,kBAAkB;MACpE,CAAC,CACH,CAAC;IACH,CAAC,EACDgB,kBACF,CAAC;EACH;;EAEA;AACF;AACA;AACA;AACA;AACA;EACEC,WAAWA,CACTP,OAAgB,EAChBE,OAAiB,EACjBC,MAA4B,EAC5B;IACAA,MAAM,GAAGA,MAAM,aAANA,MAAM,cAANA,MAAM,GAAI,CAAC,CAAC;IAErB,IAAIE,UAAU,GAAGF,MAAM,CAACE,UAAU;IAClC,IAAI,CAACA,UAAU,EAAE;MACfF,MAAM,CAACK,IAAI,GAAG,IAAI;MAClBH,UAAU,GAAG,CAAClB,EAAE,CAACsB,IAAI,EAAEtB,EAAE,CAACuB,MAAM,EAAEvB,EAAE,CAACwB,MAAM,EAAExB,EAAE,CAACyB,OAAO,CAAC;IAC1D;IAEA,KAAK,CAACZ,OAAO,EAAEE,OAAO,EAAEC,MAAM,CAAC;IAACU,eAAA;IAChC,IAAI,CAACC,SAAS,GAAG,MAAM1B,EAAE,CAAC2B,UAAU,CAACZ,MAAM,CAAC;IAE5C,IAAI,CAACf,EAAE,CAAC4B,QAAQ,CAACd,OAAO,CAAC,EAAE;MACzB;IACF;IAEA,MAAMe,OAAO,GAAGvB,aAAa,CAACwB,KAAK,CAAC,CAAC;IACrC,MAAMC,UAAU,GAAGhB,MAAM,CAACgB,UAAU;IACpC,MAAMC,SAAS,GAAGjB,MAAM,CAACiB,SAAS;IAElC,MAAMC,kBAAkB,GAAGhB,UAAU,GACjChB,uBAAuB,CAACgB,UAAU,CAAC,GACnC,EAAE;IAENY,OAAO,CAACK,QAAQ,CAAC,IAAI,CAACC,GAAG,EAAE;MACzBlB,UAAU;MACVc,UAAU;MACVC;IACF,CAAC,CAAC;IAEF,IAAIhC,EAAE,CAAC4B,QAAQ,CAACK,kBAAkB,CAAC,EAAE;MACnCJ,OAAO,CAACK,QAAQ,CAAC,IAAI,CAACE,OAAO,EAAE;QAC7BnB,UAAU,EAAEgB,kBAAkB;QAC9BF,UAAU;QACVC;MACF,CAAC,CAAC;IACJ;EACF;AACF;;AAEA;AACA;AACA;AACA;;AA6BA;;AAEA,MAAMd,kBAEL,GAAIN,OAAO,IAAK;EACf,OAAO;IACLmB,UAAU,EAAEA,CAACM,GAAG,EAAEC,KAAK;MAAA,IAAAC,IAAA;MAAA,QAAAA,IAAA,GACpBvC,EAAE,CAACwC,eAAe,CAACF,KAAK,CAAC,GACtBnC,uBAAuB,CAACmC,KAAK,EAAE1B,OAAO,CAAC,GACvC,IAAI,cAAA2B,IAAA,cAAAA,IAAA,GAAKE,SAAS;IAAA;IACxBT,SAAS,EAAE3B;EACb,CAAC;AACH,CAAC","ignoreList":[]}