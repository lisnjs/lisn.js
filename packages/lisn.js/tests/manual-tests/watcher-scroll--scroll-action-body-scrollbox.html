<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <script src="assets/js/lisn.link.js" charset="utf-8"></script>
    <script src="assets/js/lisn-settings.js" charset="utf-8"></script>
    <link
      rel="stylesheet"
      href="assets/lisn/css/lisn.css"
      type="text/css"
      media="screen"
      charset="utf-8"
    />
    <style type="text/css" media="screen">
      html {
        overflow: hidden;
      }

      body {
        margin-top: 50px;
        margin-left: 50px;
        width: 90vw;
        height: 90vh;
        overflow: scroll;
      }

      .section {
        width: 200vw;
        padding: 50vh 10vw;
        border: 2px solid purple;
      }

      .align-right {
        margin-left: auto;
      }

      button {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="section">
      <button
        onclick="watcherScroll('right', {amount: 100, asFractionOf: 'visible'})"
      >
        Scroll right 1 screen
      </button>
      <button
        class="align-right"
        onclick="watcherScroll('left', {amount: 100, asFractionOf: 'visible'})"
      >
        Scroll left 1 screen
      </button>
      <button onclick="watcherScroll('right', {amount: 100})">
        Scroll right 100px
      </button>
      <button onclick="watcherScroll('left', {amount: 100})">
        Scroll left 100px
      </button>
      <button
        onclick="watcherScroll('down', {amount: 100, asFractionOf: 'visible'})"
      >
        Scroll down 1 screen
      </button>
      <button
        onclick="setTimeout(() => watcherScrollTo({top: 0, left: 0}, {userCanInterrupt: true}), 1000)"
      >
        Scroll to top after 1s (user-interruptible)
      </button>
    </div>

    <div id="foo" class="section">
      <button onclick="watcherScrollTo('#bar')">
        Scroll to third section using selector
      </button>
      <button onclick="watcherScrollTo(document.getElementById('bar'))">
        Scroll to third section using element
      </button>
      <button
        onclick="watcherScroll('up', {amount: 100, asFractionOf: 'visible'})"
      >
        Scroll up 1 screen
      </button>
      <button
        onclick="watcherScroll('down', {amount: 10, asFractionOf: 'content'})"
      >
        Scroll down 10% of content
      </button>
      <button
        onclick="watcherScroll('up', {amount: 10, asFractionOf: 'visible'})"
      >
        Scroll up 10% of viewport
      </button>
      <button
        onclick="watcherScroll('down', {amount: 10, asFractionOf: 'content', duration: 4000})"
      >
        Scroll down 10% of content slowly
      </button>
      <button
        onclick="watcherScroll('down', {amount: 10, asFractionOf: 'content', duration: 4000, weCanInterrupt: true})"
      >
        Scroll down 10% of content slowly (interruptible)
      </button>
      <button
        onclick="watcherScroll('down', {amount: 10, asFractionOf: 'content', duration: 4000, userCanInterrupt: true})"
      >
        Scroll down 10% of content slowly (user-interruptible)
      </button>
    </div>

    <div id="bar" class="section">
      <button onclick="watcherScrollTo('#foo')">
        Scroll to second section using selector
      </button>
      <button onclick="watcherScrollTo(document.getElementById('foo'))">
        Scroll to second section using element
      </button>
      <button
        onclick="watcherScroll('down', {weCanInterrupt: true, amount: 100, asFractionOf: 'visible'}); setTimeout(() => watcherScrollTo('#foo'), 100)"
      >
        Scroll down (interruptible), then to second section
      </button>
      <button
        onclick="watcherScroll('down', {amount: 100, asFractionOf: 'visible'}); setTimeout(() => watcherScrollTo('#foo'), 100)"
      >
        Scroll down, then fail to scroll to second section
      </button>
      <button onclick="watcherScrollTo({left: 100, top: 200})">
        Scroll to 100,200
      </button>
    </div>

    <script charset="utf-8">
      const logger = new LISN.debug.Logger({ name: "test" });
      const watcher = LISN.watchers.ScrollWatcher.reuse();

      function watcherScrollTo(...args) {
        const start = Date.now();
        watcher.scrollTo(...args).then((a) => logScroll(start, a));
      }

      function watcherScroll(...args) {
        const start = Date.now();
        watcher.scroll(...args).then((a) => logScroll(start, a));
      }

      function logScroll(start, action) {
        const result = (coords) =>
          JSON.stringify({ time: (Date.now() - start) / 1000, ...coords });

        if (!action) {
          logger.log("watcherScroll not initiated");
          return;
        }

        action
          .waitFor()
          .then((x) => logger.log(result(x)))
          .catch((x) => logger.error(result(x)));
      }
    </script>
  </body>
</html>
