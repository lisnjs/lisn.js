{"version":3,"file":"lisn.debug.js","sources":["../../lisn.js/src/ts/globals/minification-constants.ts","../../lisn.js/src/ts/globals/errors.ts","../../lisn.js/src/ts/globals/minification-helpers.ts","../../lisn.js/src/ts/globals/settings.ts","../../lisn.js/src/ts/utils/math.ts","../../lisn.js/src/ts/utils/misc.ts","../../lisn.js/src/ts/utils/text.ts","../../lisn.js/src/ts/utils/validation.ts","../../lisn.js/src/ts/modules/bit-spaces.ts","../../lisn.js/src/ts/utils/dom.ts","../../lisn.js/src/ts/utils/tasks.ts","../../lisn.js/src/ts/debug/local-console.ts","../../lisn.js/src/ts/modules/x-map.ts","../../lisn.js/src/ts/debug/remote-console.ts","../../lisn.js/src/ts/debug/console.ts","../../lisn.js/src/ts/debug/logger.ts","../../lisn.js/src/ts/debug/debug.ts","../../lisn.js/src/ts/modules/callback.ts","../../lisn.js/src/ts/utils/log.ts","../../lisn.js/src/ts/utils/dom-optimize.ts","../../lisn.js/src/ts/utils/dom-query.ts","../../lisn.js/src/ts/utils/css-alter.ts","../../lisn.js/src/ts/utils/dom-alter.ts","../../lisn.js/src/ts/utils/dom-events.ts","../../lisn.js/src/ts/watchers/dom-watcher.ts","../../lisn.js/src/ts/utils/directions.ts","../../lisn.js/src/ts/utils/event.ts","../../lisn.js/src/ts/utils/gesture.ts","../../lisn.js/src/ts/utils/gesture-key.ts","../../lisn.js/src/ts/utils/gesture-pointer.ts","../../lisn.js/src/ts/utils/gesture-touch.ts","../../lisn.js/src/ts/utils/normalize-wheel.ts","../../lisn.js/src/ts/utils/gesture-wheel.ts","../../lisn.js/src/ts/watchers/gesture-watcher.ts","../../lisn.js/src/ts/utils/layout.ts","../../lisn.js/src/ts/utils/animations.ts","../../lisn.js/src/ts/utils/scroll.ts","../../lisn.js/src/ts/utils/overlays.ts","../../lisn.js/src/ts/utils/size.ts","../../lisn.js/src/ts/modules/x-resize-observer.ts","../../lisn.js/src/ts/watchers/size-watcher.ts","../../lisn.js/src/ts/watchers/layout-watcher.ts","../../lisn.js/src/ts/utils/pointer.ts","../../lisn.js/src/ts/watchers/pointer-watcher.ts","../../lisn.js/src/ts/watchers/scroll-watcher.ts","../../lisn.js/src/ts/utils/views.ts","../../lisn.js/src/ts/modules/x-intersection-observer.ts","../../lisn.js/src/ts/watchers/view-watcher.ts","../../lisn.js/src/ts/watchers/index.ts","../../lisn.js/src/ts/bundle-essentials.ts","../../lisn.js/src/ts/widgets/widget.ts","../../lisn.js/src/ts/actions/action.ts","../../lisn.js/src/ts/actions/add-class.ts","../../lisn.js/src/ts/actions/animate.ts","../../lisn.js/src/ts/actions/animate-play.ts","../../lisn.js/src/ts/actions/display.ts","../../lisn.js/src/ts/utils/dom-search.ts","../../lisn.js/src/ts/triggers/trigger.ts","../../lisn.js/src/ts/actions/trigger.ts","../../lisn.js/src/ts/actions/scroll-to.ts","../../lisn.js/src/ts/actions/set-attribute.ts","../../lisn.js/src/ts/actions/show.ts","../../lisn.js/src/ts/utils/position.ts","../../lisn.js/src/ts/widgets/openable.ts","../../lisn.js/src/ts/actions/open.ts","../../lisn.js/src/ts/widgets/pager.ts","../../lisn.js/src/ts/actions/pager.ts","../../lisn.js/src/ts/actions/index.ts","../../lisn.js/src/ts/triggers/check-trigger.ts","../../lisn.js/src/ts/triggers/pointer-trigger.ts","../../lisn.js/src/ts/triggers/layout-trigger.ts","../../lisn.js/src/ts/triggers/load-trigger.ts","../../lisn.js/src/ts/triggers/scroll-trigger.ts","../../lisn.js/src/ts/triggers/view-trigger.ts","../../lisn.js/src/ts/triggers/index.ts","../../lisn.js/src/ts/bundle-slim.ts","../../lisn.js/src/ts/widgets/auto-hide.ts","../../lisn.js/src/ts/widgets/page-loader.ts","../../lisn.js/src/ts/widgets/same-height.ts","../../lisn.js/src/ts/utils/browser.ts","../../lisn.js/src/ts/widgets/scrollbar.ts","../../lisn.js/src/ts/widgets/scroll-to-top.ts","../../lisn.js/src/ts/widgets/sortable.ts","../../lisn.js/src/ts/widgets/track-gesture.ts","../../lisn.js/src/ts/widgets/track-scroll.ts","../../lisn.js/src/ts/widgets/track-size.ts","../../lisn.js/src/ts/widgets/track-view.ts","../../lisn.js/src/ts/widgets/index.ts","../../lisn.js/src/ts/bundle.ts","../../lisn.js/src/ts/debug/index.ts","../../lisn.js/src/ts/utils/index.ts","../../lisn.js/src/ts/modules/index.ts","../../lisn.js/src/ts/bundle-debug.ts"],"sourcesContent":["/**\n * For minification optimization.\n *\n * @module\n * @ignore\n * @internal\n */\n\nexport const PREFIX = \"lisn\";\nexport const LOG_PREFIX = \"[LISN.js]\";\n\nexport const OBJECT = Object;\nexport const SYMBOL = Symbol;\nexport const ARRAY = Array;\nexport const STRING = String;\nexport const FUNCTION = Function;\nexport const MATH = Math;\nexport const NUMBER = Number;\nexport const PROMISE = Promise;\n\nexport const PI = MATH.PI;\nexport const INFINITY = Infinity;\n\nexport const S_ABSOLUTE = \"absolute\";\nexport const S_FIXED = \"fixed\";\nexport const S_STICKY = \"sticky\";\n\nexport const S_WIDTH = \"width\";\nexport const S_HEIGHT = \"height\";\n\nexport const S_TOP = \"top\";\nexport const S_BOTTOM = \"bottom\";\n\nexport const S_UP = \"up\";\nexport const S_DOWN = \"down\";\n\nexport const S_LEFT = \"left\";\nexport const S_RIGHT = \"right\";\n\nexport const S_AT = \"at\";\nexport const S_ABOVE = \"above\";\nexport const S_BELOW = \"below\";\n\nexport const S_IN = \"in\";\nexport const S_OUT = \"out\";\n\nexport const S_NONE = \"none\";\nexport const S_AMBIGUOUS = \"ambiguous\";\n\nexport const S_ADDED = \"added\";\nexport const S_REMOVED = \"removed\";\nexport const S_ATTRIBUTE = \"attribute\";\n\nexport const S_KEY = \"key\";\nexport const S_MOUSE = \"mouse\";\nexport const S_POINTER = \"pointer\";\nexport const S_TOUCH = \"touch\";\nexport const S_WHEEL = \"wheel\";\nexport const S_CLICK = \"click\";\nexport const S_HOVER = \"hover\";\nexport const S_PRESS = \"press\";\n\nexport const S_SCROLL = \"scroll\";\nexport const S_ZOOM = \"zoom\";\nexport const S_DRAG = \"drag\";\nexport const S_UNKNOWN = \"unknown\";\n\nexport const S_SCROLL_TOP = `${S_SCROLL}Top`;\nexport const S_SCROLL_LEFT = `${S_SCROLL}Left`;\n\nexport const S_SCROLL_WIDTH = `${S_SCROLL}Width`;\nexport const S_SCROLL_HEIGHT = `${S_SCROLL}Height`;\n\nexport const S_CLIENT_WIDTH = \"clientWidth\";\nexport const S_CLIENT_HEIGHT = \"clientHeight\";\n\nexport const S_SCROLL_TOP_FRACTION = `${S_SCROLL}TopFraction`;\nexport const S_SCROLL_LEFT_FRACTION = `${S_SCROLL}LeftFraction`;\n\nexport const S_HORIZONTAL = \"horizontal\";\nexport const S_VERTICAL = \"vertical\";\nexport const S_SKIP_INITIAL = \"skipInitial\";\nexport const S_DEBOUNCE_WINDOW = \"debounceWindow\";\nexport const S_TOGGLE = \"toggle\";\n\nexport const S_CANCEL = \"cancel\";\n\nexport const S_KEYDOWN = `${S_KEY}${S_DOWN}`;\n\nexport const S_MOUSEUP = `${S_MOUSE}${S_UP}`;\nexport const S_MOUSEDOWN = `${S_MOUSE}${S_DOWN}`;\nexport const S_MOUSEMOVE = `${S_MOUSE}move`;\n\nexport const S_POINTERUP = `${S_POINTER}${S_UP}`;\nexport const S_POINTERDOWN = `${S_POINTER}${S_DOWN}`;\nexport const S_POINTERENTER = `${S_POINTER}enter`;\nexport const S_POINTERLEAVE = `${S_POINTER}leave`;\nexport const S_POINTERMOVE = `${S_POINTER}move`;\nexport const S_POINTERCANCEL = `${S_POINTER}${S_CANCEL}`;\n\nexport const S_TOUCHSTART = `${S_TOUCH}start`;\nexport const S_TOUCHEND = `${S_TOUCH}end`;\nexport const S_TOUCHMOVE = `${S_TOUCH}move`;\nexport const S_TOUCHCANCEL = `${S_TOUCH}${S_CANCEL}`;\n\nexport const S_DRAGSTART = `${S_DRAG}start`;\nexport const S_DRAGEND = `${S_DRAG}end`;\nexport const S_DRAGENTER = `${S_DRAG}enter`;\nexport const S_DRAGOVER = `${S_DRAG}over`;\nexport const S_DRAGLEAVE = `${S_DRAG}leave`;\nexport const S_DROP = \"drop\";\n\nexport const S_SELECTSTART = \"selectstart\";\n\nexport const S_ATTRIBUTES = \"attributes\";\nexport const S_CHILD_LIST = \"childList\";\n\nexport const S_REVERSE = \"reverse\";\nexport const S_DRAGGABLE = \"draggable\";\nexport const S_DISABLED = \"disabled\";\n\nexport const S_ARROW = \"arrow\";\n\nexport const S_ROLE = \"role\";\n\nexport const ARIA_PREFIX = \"aria-\";\nexport const S_ARIA_CONTROLS = ARIA_PREFIX + \"controls\";\n\nexport const PREFIX_WRAPPER = `${PREFIX}-wrapper`;\nexport const PREFIX_INLINE_WRAPPER = `${PREFIX_WRAPPER}-inline`;\nexport const PREFIX_TRANSITION = `${PREFIX}-transition`;\nexport const PREFIX_TRANSITION_DISABLE = `${PREFIX_TRANSITION}__disable`;\nexport const PREFIX_HIDE = `${PREFIX}-hide`;\nexport const PREFIX_SHOW = `${PREFIX}-show`;\nexport const PREFIX_DISPLAY = `${PREFIX}-display`;\nexport const PREFIX_UNDISPLAY = `${PREFIX}-undisplay`;\nexport const PREFIX_PLACE = `${PREFIX}-place`;\nexport const PREFIX_ORIENTATION = `${PREFIX}-orientation`;\nexport const PREFIX_POSITION = `${PREFIX}-position`;\nexport const PREFIX_GHOST = `${PREFIX}-ghost`;\nexport const PREFIX_BORDER_SIZE = `${PREFIX}-border-size`;\nexport const PREFIX_NO_SELECT = `${PREFIX}-no-select`;\nexport const PREFIX_NO_TOUCH_ACTION = `${PREFIX}-no-touch-action`;\nexport const PREFIX_NO_WRAP = `${PREFIX}-no-wrap`;\n\nexport const S_ANIMATE = \"animate\";\nexport const ANIMATE_PREFIX = `${PREFIX}-${S_ANIMATE}__`;\nexport const PREFIX_ANIMATE_DISABLE = `${ANIMATE_PREFIX}disable`;\nexport const PREFIX_ANIMATE_PAUSE = `${ANIMATE_PREFIX}pause`;\nexport const PREFIX_ANIMATE_REVERSE = `${ANIMATE_PREFIX}${S_REVERSE}`;\nexport const PREFIX_ANIMATE_INFINITE = `${ANIMATE_PREFIX}infinite`;\n","/**\n * @module Errors\n */\n\nimport { LOG_PREFIX } from \"@lisn/globals/minification-constants\";\n\n/**\n * Base error type emitted by LISN.\n */\nexport abstract class LisnError extends Error {}\n\n/**\n * Error type emitted for invalid input or incorrect usage of a function.\n */\nexport class LisnUsageError extends LisnError {\n  constructor(message = \"\") {\n    super(`${LOG_PREFIX} Incorrect usage: ${message}`);\n    this.name = \"LisnUsageError\";\n  }\n}\n\n/**\n * Error type emitted if an assertion is wrong => report bug.\n */\nexport class LisnBugError extends LisnError {\n  constructor(message = \"\") {\n    super(`${LOG_PREFIX} Please report a bug: ${message}`);\n    this.name = \"LisnBugError\";\n  }\n}\n","/**\n * For minification optimization\n *\n * @module\n * @ignore\n * @internal\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\n\nimport {\n  BoundingRect,\n  IterableObject,\n  Constructor,\n  InstanceType,\n  MapBase,\n  SetBase,\n  Spread,\n} from \"@lisn/globals/types\";\n\nimport { LisnUsageError, LisnBugError } from \"@lisn/globals/errors\";\n\n// credit: underscore.js\nexport const root =\n  (typeof self === \"object\" && self.self === self && self) ||\n  (typeof global == \"object\" && global.global === global && global) ||\n  Function(\"return this\")() ||\n  {};\n\nexport const userAgent =\n  typeof navigator === \"undefined\" ? \"\" : navigator.userAgent;\n\nexport const kebabToCamelCase = (str: string) =>\n  str.replace(/-./g, (m) => toUpperCase(m.charAt(1)));\n\nexport const camelToKebabCase = (str: string) =>\n  str\n    .replace(/[A-Z][a-z]/g, (m) => \"-\" + toLowerCase(m))\n    .replace(/[A-Z]+/, (m) => \"-\" + toLowerCase(m));\n\nexport const prefixName = (name: string) => `${MC.PREFIX}-${name}`;\n\nexport const prefixCssVar = (name: string) => \"--\" + prefixName(name);\n\nexport const prefixCssJsVar = (name: string) => prefixCssVar(\"js--\" + name);\n\nexport const prefixData = (name: string) => `data-${camelToKebabCase(name)}`;\n\nexport const prefixLisnData = (name: string) => prefixData(prefixName(name));\n\nexport const toLowerCase = (s: string) => s.toLowerCase();\n\nexport const toUpperCase = (s: string) => s.toUpperCase();\n\nexport const timeNow = Date.now.bind(Date);\n\nexport const timeSince = (startTime: number) => timeNow() - startTime;\n\nexport const hasDOM = () => typeof document !== \"undefined\";\n\nexport const getWindow = () => window;\n\nexport const getDoc = () => document;\n\nexport const getDocElement = () => getDoc().documentElement;\n\nexport const getDocScrollingElement = () =>\n  getDoc().scrollingElement as HTMLElement | null;\n\nexport const getBody = () => getDoc().body;\n\nexport const getReadyState = () => getDoc().readyState;\n\nexport const getPointerType = (event: Event) =>\n  isPointerEvent(event)\n    ? event.pointerType\n    : isMouseEvent(event)\n      ? \"mouse\"\n      : null;\n\nexport const onAnimationFrame = (callback: FrameRequestCallback) =>\n  requestAnimationFrame(callback);\n\nexport const createElement = (\n  tagName: string,\n  options?: ElementCreationOptions,\n) => getDoc().createElement(tagName, options);\n\nexport const createButton = (label = \"\", tag = \"button\") => {\n  const btn = createElement(tag);\n  setTabIndex(btn);\n  setAttr(btn, MC.S_ROLE, \"button\");\n  setAttr(btn, MC.ARIA_PREFIX + \"label\", label);\n  return btn;\n};\n\nexport const isNullish = (v: unknown): v is null | undefined =>\n  v === undefined || v === null;\n\nexport const isEmpty = (v: unknown): v is null | undefined | \"\" =>\n  isNullish(v) || v === \"\";\n\nexport const isIterableObject = (v: unknown): v is IterableObject<unknown> =>\n  isNonPrimitive(v) && MC.SYMBOL.iterator in v;\n\nexport const isArray = (v: unknown) => isInstanceOf(v, MC.ARRAY);\n\nexport const isObject = (v: unknown) => isInstanceOf(v, MC.OBJECT);\n\nexport const isNonPrimitive = (v: unknown): v is object =>\n  v !== null && typeOf(v) === \"object\";\n\n// only primitive number\nexport const isNumber = (v: unknown): v is number => typeOf(v) === \"number\";\n\n/* eslint-disable-next-line @typescript-eslint/no-wrapper-object-types */\nexport const isString = (v: unknown): v is string | String =>\n  typeOf(v) === \"string\" || isInstanceOf(v, MC.STRING);\n\nexport const isLiteralString = (v: unknown): v is string =>\n  typeOf(v) === \"string\";\n\nexport const isBoolean = (v: unknown): v is boolean => typeOf(v) === \"boolean\";\n\n/* eslint-disable-next-line @typescript-eslint/no-unsafe-function-type */\nexport const isFunction = (v: unknown): v is Function =>\n  typeOf(v) === \"function\" || isInstanceOf(v, MC.FUNCTION);\n\nexport const isDoc = (target: unknown): target is Document =>\n  target === getDoc();\n\nexport const isMouseEvent = (event: Event): event is MouseEvent =>\n  isInstanceOf(event, MouseEvent);\n\nexport const isPointerEvent = (event: Event): event is PointerEvent =>\n  typeof PointerEvent !== \"undefined\" && isInstanceOf(event, PointerEvent);\n\nexport const isTouchPointerEvent = (event: Event): event is PointerEvent =>\n  isPointerEvent(event) && getPointerType(event) === MC.S_TOUCH;\n\nexport const isWheelEvent = (event: Event): event is WheelEvent =>\n  isInstanceOf(event, WheelEvent);\n\nexport const isKeyboardEvent = (event: Event): event is KeyboardEvent =>\n  isInstanceOf(event, KeyboardEvent);\n\nexport const isTouchEvent = (event: Event): event is TouchEvent =>\n  typeof TouchEvent !== \"undefined\" && isInstanceOf(event, TouchEvent);\n\nexport const isNode = (target: unknown) => isInstanceOf(target, Node);\n\nexport const isElement = (target: unknown) => isInstanceOf(target, Element);\n\nexport const isHTMLElement = (target: unknown) =>\n  isInstanceOf(target, HTMLElement);\n\nexport const isNodeBAfterA = (nodeA: Node, nodeB: Node) =>\n  (nodeA.compareDocumentPosition(nodeB) & Node.DOCUMENT_POSITION_FOLLOWING) !==\n  0;\n\nexport const strReplace = (\n  s: string,\n  match: string | RegExp,\n  replacement: string,\n) => s.replace(match, replacement);\n\nexport const setTimer = root.setTimeout.bind(root);\n\nexport const clearTimer = root.clearTimeout.bind(root);\n\nexport const getBoundingClientRect = (element: Element) =>\n  element.getBoundingClientRect();\n\n// Copy size properties explicitly to another object so they can be used with\n// the spread operator (DOMRect/DOMRectReadOnly's properties are not enumerable)\nexport const copyBoundingRectProps = (rect: BoundingRect): BoundingRect => {\n  return {\n    x: rect.x,\n    left: rect.left,\n    right: rect.right,\n    [MC.S_WIDTH]: rect[MC.S_WIDTH],\n    y: rect.y,\n    top: rect.top,\n    bottom: rect.bottom,\n    [MC.S_HEIGHT]: rect[MC.S_HEIGHT],\n  };\n};\n\nexport const querySelector = (root: Element | Document, selector: string) =>\n  root.querySelector(selector);\n\nexport const querySelectorAll = (root: Element | Document, selector: string) =>\n  root.querySelectorAll(selector);\n\nexport const docQuerySelector = (selector: string) =>\n  querySelector(getDoc(), selector);\n\nexport const docQuerySelectorAll = (selector: string) =>\n  querySelectorAll(getDoc(), selector);\n\nexport const getElementById = (id: string) => getDoc().getElementById(id);\n\nexport const getAttr = (element: Element, name: string) =>\n  element.getAttribute(name);\n\nexport const setAttr = (element: Element, name: string, value = \"true\") =>\n  element.setAttribute(name, value);\n\nexport const unsetAttr = (element: Element, name: string) =>\n  element.setAttribute(name, \"false\");\n\nexport const delAttr = (element: Element, name: string) =>\n  element.removeAttribute(name);\n\nexport const includes = (\n  arr: readonly unknown[] | string,\n  v: unknown,\n  startAt?: number,\n) => (arr.indexOf as (v: unknown, startAt?: number) => number)(v, startAt) >= 0;\n\nexport const every = <\n  A extends readonly unknown[],\n  C extends ArrayCallbackFn<A[number]>,\n>(\n  array: A,\n  predicate: C,\n) => array.every(predicate);\n\nexport const some = <\n  A extends readonly unknown[],\n  C extends ArrayCallbackFn<A[number]>,\n>(\n  array: A,\n  predicate: C,\n) => array.some(predicate);\n\nexport const filter = <\n  A extends readonly unknown[],\n  T extends A[number],\n  C extends ArrayCallbackFn<A[number]> | FilterFnTypeP<A[number], T>,\n>(\n  array: A,\n  filterFn: C,\n) => array.filter(filterFn) as FilteredType<C, A[number], T>[];\n\nexport const filterBlank = <A extends readonly unknown[]>(\n  array: A | null | undefined,\n) => {\n  const result = array\n    ? filter(array, (v): v is NonNullable<A[number]> => !isEmpty(v))\n    : undefined;\n\n  return lengthOf(result) ? result : undefined;\n};\n\nexport const sizeOf = (obj: { size: number } | null | undefined) =>\n  obj?.size ?? 0;\n\nexport const lengthOf = (obj: { length: number } | null | undefined) =>\n  obj?.length ?? 0;\n\nexport const lastOf = <A extends readonly unknown[]>(a: A | null | undefined) =>\n  a?.slice(-1)[0] as LastElement<A>;\n\nexport const firstOf = <A extends readonly unknown[]>(\n  a: A | null | undefined,\n) => a?.slice(0, 1)[0] as FirstElement<A>;\n\nexport const tagName = (element: Element) => element.tagName;\n\nexport const hasTagName = (element: Element, tag: string) =>\n  toLowerCase(tagName(element)) === toLowerCase(tag);\n\nexport const preventDefault = (event: Event) => event.preventDefault();\n\nexport const arrayFrom = MC.ARRAY.from.bind(MC.ARRAY);\n\nexport const keysOf = <T extends Record<string | symbol, unknown>>(\n  obj: T,\n): Array<keyof T & string> => MC.OBJECT.keys(obj);\n\nexport const defineProperty = MC.OBJECT.defineProperty.bind(MC.OBJECT);\n\n// use it in place of object spread\nexport const merge = <A extends readonly (object | null | undefined)[]>(\n  ...a: [...A]\n) => {\n  return MC.OBJECT.assign({}, ...a) as Spread<A>;\n};\n\nexport const copyObject = <T extends object | undefined>(obj: T) => merge(obj);\n\nexport const promiseResolve = MC.PROMISE.resolve.bind(MC.PROMISE);\n\nexport const promiseAll = MC.PROMISE.all.bind(MC.PROMISE);\n\nexport const assign = MC.OBJECT.assign.bind(MC.OBJECT);\n\nexport const freezeObj = MC.OBJECT.freeze.bind(MC.OBJECT);\n\nexport const hasOwnProp = (o: object, prop: string | symbol) =>\n  MC.OBJECT.prototype.hasOwnProperty.call(o, prop);\n\nexport const preventExtensions = MC.OBJECT.preventExtensions.bind(MC.OBJECT);\n\nexport const stringify = JSON.stringify.bind(JSON);\n\nexport const floor = MC.MATH.floor.bind(MC.MATH);\n\nexport const ceil = MC.MATH.ceil.bind(MC.MATH);\n\nexport const log2 = MC.MATH.log2.bind(MC.MATH);\n\nexport const sqrt = MC.MATH.sqrt.bind(MC.MATH);\n\nexport const max = MC.MATH.max.bind(MC.MATH);\n\nexport const min = MC.MATH.min.bind(MC.MATH);\n\nexport const abs = MC.MATH.abs.bind(MC.MATH);\n\nexport const round = MC.MATH.round.bind(MC.MATH);\n\nexport const pow = MC.MATH.pow.bind(MC.MATH);\n\nexport const exp = MC.MATH.exp.bind(MC.MATH);\n\nexport const parseFloat = MC.NUMBER.parseFloat.bind(MC.NUMBER);\n\nexport const isNaN = MC.NUMBER.isNaN.bind(MC.NUMBER);\n\nexport const isInstanceOf = <C extends Constructor<unknown>>(\n  value: unknown,\n  Class: C,\n): value is InstanceType<C> => value instanceof Class;\n\nexport const constructorOf = (obj: object) => obj.constructor;\n\nexport const typeOf = (obj: unknown) => typeof obj;\n\nexport const typeOrClassOf = (obj: unknown) =>\n  isObject(obj) ? constructorOf(obj)?.name : typeOf(obj);\n\nexport const parentOf = (element: Element | undefined | null) =>\n  element?.parentElement ?? null;\n\nexport const childrenOf = (element: Element | undefined | null) =>\n  element?.children || [];\n\nexport const targetOf = <O extends { target?: unknown } | null | undefined>(\n  obj: O,\n) =>\n  obj?.target as O extends { target: infer T }\n    ? T\n    : O extends { target?: infer T }\n      ? T | undefined\n      : undefined;\n\nexport const currentTargetOf = <\n  O extends { currentTarget?: unknown } | null | undefined,\n>(\n  obj: O,\n) =>\n  obj?.currentTarget as O extends { currentTarget: infer T }\n    ? T\n    : O extends { currentTarget?: infer T }\n      ? T | undefined\n      : undefined;\n\nexport const classList = <T extends Element | null | undefined>(element: T) =>\n  element?.classList as T extends Element ? DOMTokenList : undefined;\n\nconst S_TABINDEX = \"tabindex\";\nexport const getTabIndex = (element: Element) => getAttr(element, S_TABINDEX);\n\nexport const setTabIndex = (element: Element, index = \"0\") =>\n  setAttr(element, S_TABINDEX, index);\n\nexport const unsetTabIndex = (element: Element) => delAttr(element, S_TABINDEX);\n\nexport const remove = (obj: { remove: () => void } | null | undefined) =>\n  obj?.remove();\n\nexport const deleteObjKey = <O extends object>(obj: O, key: keyof O) =>\n  delete obj[key];\n\nexport const deleteKey = <K, V>(\n  map: MapBase<K, V> | SetBase<K> | null | undefined,\n  key: K,\n) => map?.delete(key);\n\nexport const elScrollTo = (\n  element: Element,\n  coords: { top?: number; left?: number },\n  behavior: ScrollBehavior = \"instant\",\n) => element.scrollTo(merge({ behavior }, coords));\n\nexport const elScrollBy = (\n  element: Element,\n  coords: { top?: number; left?: number },\n  behavior: ScrollBehavior = \"instant\",\n) => element.scrollBy(merge({ behavior }, coords));\n\nexport const newPromise = <T>(\n  executor: (\n    resolve: (value: T) => void,\n    /* eslint-disable-next-line @typescript-eslint/no-explicit-any */\n    reject: (reason?: any) => void,\n  ) => void,\n) => new Promise(executor);\n\nexport const newMap = <K, V>(entries?: readonly (readonly [K, V])[] | null) =>\n  new Map(entries);\n\nexport const newWeakMap = <K extends WeakKey, V>(\n  entries?: readonly (readonly [K, V])[] | null,\n) => new WeakMap(entries);\n\nexport const newSet = <T>(values?: readonly T[] | null) => new Set(values);\n\nexport const newWeakSet = <T extends WeakKey>(values?: readonly T[] | null) =>\n  new WeakSet(values);\n\nexport const newIntersectionObserver = (\n  callback: IntersectionObserverCallback,\n  options?: IntersectionObserverInit,\n) => new IntersectionObserver(callback, options);\n\nexport const newResizeObserver = (callback: ResizeObserverCallback) =>\n  typeof ResizeObserver === \"undefined\" ? null : new ResizeObserver(callback);\n\nexport const newMutationObserver = (callback: MutationCallback) =>\n  new MutationObserver(callback);\n\nexport const usageError = (msg: string) => new LisnUsageError(msg);\n\nexport const bugError = (msg: string) => new LisnBugError(msg);\n\nexport const illegalConstructorError = (useWhat: string) =>\n  usageError(`Illegal constructor. Use ${useWhat}.`);\n\nconst CONSOLE = console;\nexport const consoleDebug = CONSOLE.debug.bind(CONSOLE);\n\nexport const consoleLog = CONSOLE.log.bind(CONSOLE);\n\nexport const consoleInfo = CONSOLE.info.bind(CONSOLE);\n\nexport const consoleWarn = CONSOLE.warn.bind(CONSOLE);\n\nexport const consoleError = CONSOLE.error.bind(CONSOLE);\n\n// --------------------\n\ntype FirstElement<T extends readonly unknown[]> = T extends readonly [\n  infer Head,\n  ...infer Last__ignored,\n]\n  ? Head\n  : T[number] | undefined;\n\ntype LastElement<T extends readonly unknown[]> = T extends readonly [\n  ...infer Head__ignored,\n  infer Last,\n]\n  ? Last\n  : T[number] | undefined;\n\ntype ArrayCallbackFn<V> = (\n  value: V,\n  index: number,\n  array: readonly V[],\n) => unknown;\ntype FilterFnTypeP<V, T extends V> = (\n  value: V,\n  index: number,\n  array: readonly V[],\n) => value is T;\ntype FilteredType<\n  C extends ArrayCallbackFn<V> | FilterFnTypeP<V, T>,\n  V,\n  T extends V,\n> = C extends FilterFnTypeP<V, infer T> ? T : V;\n","/**\n * @module Settings\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\n/**\n * LISN's settings.\n * @readonly\n *\n * If you wish to modify them, then you need to do so immediately after loading\n * LISN before you instantiate any watchers, etc. For example:\n *\n * ```html\n * <!doctype html>\n * <html>\n *   <head>\n *     <meta charset=\"UTF-8\" />\n *     <meta name=\"viewport\" content=\"width=device-width\" />\n *     <script src=\"lisn.js\" charset=\"utf-8\"></script>\n *     <script charset=\"utf-8\">\n *       // modify LISN settings, for example:\n *       LISN.settings.deviceBreakpoints.desktop = 1024;\n *     </script>\n *   </head>\n *   <body>\n *   </body>\n * </html>\n * ```\n */\nexport const settings = MH.preventExtensions({\n  /**\n   * A unique selector (preferably `#some-id`) for the element that holds the\n   * main page content, if other than `document.body`.\n   *\n   * E.g. if your main content is inside a custom scrollable container, rather\n   * than directly in `document.body`, then pass a selector for it here.\n   *\n   * The element must be scrollable, i.e. have a fixed size and `overflow: scroll`.\n   *\n   * **IMPORTANT:** You must set this before initializing any watchers, widgets,\n   * etc. If you are using the HTML API, then you must set this before the\n   * document `readyState` becomes interactive.\n   *\n   * @defaultValue null // document.scrollingElement\n   * @category Generic\n   */\n  mainScrollableElementSelector: null as string | null,\n\n  /**\n   * This setting allows us to automatically wrap certain elements or groups of\n   * elements into a single `div` or `span` element to allow for more reliable\n   * or efficient working of certain features. In particular:\n   *\n   * 1. View tracking using relative offsets and a scrolling root **requires wrapping**\n   *\n   * When using view position tracking with a percentage offset specification\n   * (e.g. `top: 50%`) _and_ a custom root element that is scrollable_ (and\n   * obviously has a size smaller than the content), you **MUST** enable\n   * content wrapping, otherwise the trigger offset elements cannot be\n   * positioned relative to the scrolling _content size_.\n   *\n   * 2. Scroll tracking\n   *\n   * When using scroll tracking, including scrollbars, on a scrolling element\n   * (that obviously has a size smaller than the content), it's recommended for\n   * the content of the scrollable element to be wrapped in a single `div`\n   * container, to allow for more efficient and reliable detection of changes\n   * in the _scrollable content_ size.\n   *\n   * If content wrapping is disabled, when scroll tracking is used on a given\n   * element (other than the root of the document), each of the immediate\n   * children of the scrollable element have their sizes tracked, which could\n   * lead to more resource usage.\n   *\n   * 3. Scrollbars on custom elements\n   *\n   * When you setup a {@link Widgets.Scrollbar} widget for a custom\n   * scrollable element that may not be the main scrollable (and therefore\n   * won't take up the full viewport all the time), then to be able to position\n   * to scrollbar relative to the scrollable element, its content needs to be\n   * wrapped.\n   *\n   * If this setting is OFF, then the scrollbars on custom elements have to\n   * rely on position sticky which doesn't have as wide browser support as the\n   * default option.\n   *\n   * 4. Animating on viewport enter/leave\n   *\n   * For elements that have transforms applied as part of an animation or\n   * transition, if you wish to run or reverse the animation when the element\n   * enters or leaves the viewport, then the transform can interfere with the\n   * viewport tracking. For example, if undoing the animation as soon as the\n   * element leaves the viewport makes it enter it again (because it's moved),\n   * then this will result in a glitch.\n   *\n   * If content wrapping is disabled, then to get around such issues, a dummy\n   * element is positioned on top of the actual element and is the one tracked\n   * across the viewport instead. Either approach could cause issues depending\n   * on your CSS, so it's your choice which one is applied.\n   *\n   * ----------\n   *\n   * **IMPORTANT:** Certain widgets always require wrapping of elements or their\n   * children. This setting only applies in cases where wrapping is optional.\n   * If you can, it's recommended to leave this setting ON. You can still try to\n   * disable wrapping on a per-element basis by setting `data-lisn-no-wrap`\n   * attribute on it. Alternatively, if the elements that need wrapping are\n   * already wrapped in an element with a class `lisn-wrapper`, this will be\n   * used as the wrapper.\n   *\n   * @defaultValue true\n   * @category Generic\n   */\n  contentWrappingAllowed: true,\n  // [TODO v2] rename this setting\n\n  /**\n   * The timeout in milliseconds for waiting for the `document.readyState` to\n   * become `complete`. The timer begins _once the `readyState` becomes\n   * `interactive`_.\n   *\n   * The page will be considered \"ready\" either when the `readyState` becomes\n   * `complete` or this many milliseconds after it becomes `interactive`,\n   * whichever is first.\n   *\n   * Set to 0 or a negative number to disable timeout.\n   *\n   * @defaultValue 2000 // i.e. 2s\n   * @category Generic\n   */\n  pageLoadTimeout: 2000,\n\n  /**\n   * This enables LISN's HTML API. Then the page will be parsed (and watched\n   * for dynamically added elements at any time) for any elements matching a\n   * widget selector. Any element that has a matching CSS class or data\n   * attribute will be setup according to the relevant widget, which may wrap,\n   * clone or add attributes to the element.\n   *\n   * This is enabled by default for bundles, and disabled otherwise.\n   *\n   * **IMPORTANT:** You must set this before the document `readyState` becomes\n   * interactive.\n   *\n   * @defaultValue `false` in general, but `true` in browser bundles\n   * @category Widgets\n   */\n  autoWidgets: false,\n\n  /**\n   * Default setting for\n   * {@link Widgets.ScrollbarConfig.hideNative | ScrollbarConfig.hideNative}.\n   *\n   * @defaultValue true\n   * @category Widgets/Scrollbar\n   */\n  scrollbarHideNative: true,\n\n  /**\n   * Default setting for\n   * {@link Widgets.ScrollbarConfig.onMobile | ScrollbarConfig.onMobile}.\n   *\n   * @defaultValue false\n   * @category Widgets/Scrollbar\n   */\n  scrollbarOnMobile: false,\n\n  /**\n   * Default setting for\n   * {@link Widgets.ScrollbarConfig.positionH | ScrollbarConfig.positionH}.\n   *\n   * @defaultValue \"bottom\"\n   * @category Widgets/Scrollbar\n   */\n  scrollbarPositionH: \"bottom\",\n\n  /**\n   * Default setting for\n   * {@link Widgets.ScrollbarConfig.positionV | ScrollbarConfig.positionV}.\n   *\n   * @defaultValue \"right\"\n   * @category Widgets/Scrollbar\n   */\n  scrollbarPositionV: \"right\",\n\n  /**\n   * Default setting for\n   * {@link Widgets.ScrollbarConfig.autoHide | ScrollbarConfig.autoHide}.\n   *\n   * @defaultValue -1\n   * @category Widgets/Scrollbar\n   */\n  scrollbarAutoHide: -1,\n\n  /**\n   * Default setting for\n   * {@link Widgets.ScrollbarConfig.clickScroll | ScrollbarConfig.clickScroll}.\n   *\n   * @defaultValue true\n   * @category Widgets/Scrollbar\n   */\n  scrollbarClickScroll: true,\n\n  /**\n   * Default setting for\n   * {@link Widgets.ScrollbarConfig.dragScroll | ScrollbarConfig.dragScroll}.\n   *\n   * @defaultValue true\n   * @category Widgets/Scrollbar\n   */\n  scrollbarDragScroll: true,\n\n  /**\n   * Default setting for\n   * {@link Widgets.ScrollbarConfig.useHandle | ScrollbarConfig.useHandle}.\n   *\n   * @defaultValue false\n   * @category Widgets/Scrollbar\n   */\n  scrollbarUseHandle: false,\n\n  /**\n   * Default setting for\n   * {@link Widgets.SameHeightConfig.diffTolerance | SameHeightConfig.diffTolerance}.\n   *\n   * @defaultValue 15\n   * @category Widgets/SameHeight\n   */\n  sameHeightDiffTolerance: 15,\n\n  /**\n   * Default setting for\n   * {@link Widgets.SameHeightConfig.resizeThreshold | SameHeightConfig.resizeThreshold}.\n   *\n   * @defaultValue 5\n   * @category Widgets/SameHeight\n   */\n  sameHeightResizeThreshold: 5,\n\n  /**\n   * Default setting for\n   * {@link Widgets.SameHeightConfig.debounceWindow | SameHeightConfig.debounceWindow}.\n   *\n   * @defaultValue 100\n   * @category Widgets/SameHeight\n   */\n  sameHeightDebounceWindow: 100,\n\n  /**\n   * Default setting for\n   * {@link Widgets.SameHeightConfig.minGap | SameHeightConfig.minGap}.\n   *\n   * @defaultValue 30\n   * @category Widgets/SameHeight\n   */\n  sameHeightMinGap: 30,\n\n  /**\n   * Default setting for\n   * {@link Widgets.SameHeightConfig.maxFreeR | SameHeightConfig.maxFreeR}.\n   *\n   * @defaultValue 0.4\n   * @category Widgets/SameHeight\n   */\n  sameHeightMaxFreeR: 0.4,\n\n  /**\n   * Default setting for\n   * {@link Widgets.SameHeightConfig.maxWidthR | SameHeightConfig.maxWidthR}.\n   *\n   * @defaultValue 1.7\n   * @category Widgets/SameHeight\n   */\n  sameHeightMaxWidthR: 1.7,\n\n  /**\n   * Set custom device breakpoints as width in pixels.\n   *\n   * The value of each sets its lower limit, i.e. it specifies a device whose\n   * width is larger than the given value (and up to the next larger one).\n   *\n   * If you specify only some of the below devices, then the other ones will\n   * keep their default breakpoint values.\n   *\n   * Adding device types, other than the ones listed below is not supported.\n   *\n   * @category Device layouts\n   */\n  deviceBreakpoints: {\n    /**\n     * This should be left as 0 as it's the catch-all for anything narrower\n     * than \"mobile-wide\".\n     *\n     * @defaultValue 0\n     */\n    mobile: 0,\n\n    /**\n     * Anything wider than the given value is \"mobile-wide\", up to the value of\n     * \"tablet\".\n     *\n     * @defaultValue 576\n     */\n    \"mobile-wide\": 576,\n\n    /**\n     * Anything wider than the given value is \"tablet\", up to the value of\n     * \"desktop\".\n     *\n     * @defaultValue 768\n     */\n    tablet: 768, // tablet is anything above this (up to desktop)\n\n    /**\n     * Anything wider than the given value is \"desktop\".\n     *\n     * @defaultValue 992\n     */\n    desktop: 992, // desktop is anything above this\n  },\n\n  /**\n   * Set custom aspect ratio breakpoints (as ratio of width to height).\n   *\n   * The value of each sets its lower limit, i.e. it specifies an aspect ratio\n   * that is wider than the given value (and up to the next wider one).\n   *\n   * If you specify only some of the below aspect ratios, then the other ones\n   * will keep their default breakpoint values.\n   *\n   * Adding aspect ratio types, other than the ones listed below is not\n   * supported.\n   *\n   * @category Device layouts\n   */\n  aspectRatioBreakpoints: {\n    /**\n     * This should be left as 0 as it's the catch-all for anything with\n     * a narrower aspect ratio than \"tall\".\n     *\n     * @defaultValue 0\n     */\n    \"very-tall\": 0, // very tall is up to 9:16\n\n    /**\n     * Anything with a wider aspect ratio than the given value is \"tall\", up to\n     * the value of \"square\".\n     *\n     * @defaultValue 9 / 16\n     */\n    tall: 9 / 16, // tall is between 9:16 and 3:4\n\n    /**\n     * Anything with a wider aspect ratio than the given value is \"square\", up\n     * to the value of \"wide\".\n     *\n     * @defaultValue 3 / 4\n     */\n    square: 3 / 4, // square is between 3:4 and 4:3\n\n    /**\n     * Anything with a wider aspect ratio than the given value is \"wide\", up to\n     * the value of \"very-wide\".\n     *\n     * @defaultValue 4 / 3\n     */\n    wide: 4 / 3, // wide is between 4:3 and 16:9\n\n    /**\n     * Anything with a wider aspect ratio than the given value is \"very-wide\".\n     *\n     * @defaultValue 16 / 9\n     */\n    \"very-wide\": 16 / 9, // very wide is above 16:9\n  },\n\n  /**\n   * The CSS class that enables light theme.\n   *\n   * **IMPORTANT:** If you change this, you should also change the\n   * `$light-theme-cls` variable in the SCSS configuration, or otherwise add the\n   * following to your CSS:\n   *\n   * :root,\n   * .custom-light-theme-cls {\n   *   --lisn-color-fg: some-dark-color;\n   *   --lisn-color-fg-t: some-dark-color-with-transparency;\n   *   --lisn-color-bg: some-light-color;\n   *   --lisn-color-bg-t: some-light-color-with-transparency;\n   * }\n   */\n  lightThemeClassName: \"light-theme\",\n\n  /**\n   * The CSS class that enables dark theme.\n   *\n   * **IMPORTANT:** If you change this, you should also change the\n   * `$dark-theme-cls` variable in the SCSS configuration, or otherwise add the\n   * following to your CSS:\n   *\n   * .custom-dark-theme-cls {\n   *   --lisn-color-fg: some-light-color;\n   *   --lisn-color-fg-t: some-light-color-with-transparency;\n   *   --lisn-color-bg: some-dark-color;\n   *   --lisn-color-bg-t: some-dark-color-with-transparency;\n   * }\n   */\n  darkThemeClassName: \"dark-theme\",\n\n  /**\n   * Used to determine the effective delta in pixels for gestures triggered by\n   * some key (arrows) and wheel events (where the browser reports the delta\n   * mode to be LINE).\n   *\n   * Value is in pixels.\n   *\n   * @defaultValue 40\n   * @category Gestures\n   */\n  deltaLineHeight: 40,\n\n  /**\n   * Used to determine the effective delta in pixels for gestures triggered by\n   * some wheel events (where the browser reports the delta mode to be PAGE).\n   *\n   * Value is in pixels.\n   *\n   * @defaultValue 1600\n   * @category Gestures\n   */\n  deltaPageWidth: 1600,\n\n  /**\n   * Used to determine the effective delta in pixels for gestures triggered by\n   * some key (PageUp/PageDown/Space) and wheel events (where the browser\n   * reports the delta mode to be PAGE).\n   *\n   * Value is in pixels.\n   *\n   * @defaultValue 800\n   * @category Gestures\n   */\n  deltaPageHeight: 800,\n\n  /**\n   * Controls the debugging verbosity level. Values from 0 (none) to 10 (insane)\n   * are recognized.\n   *\n   * **Note:** Logging is not available in bundles except in the \"debug\" bundle.\n   *\n   * @defaultValue `0` except in the \"debug\" bundle where it defaults to 10\n   * @category Logging\n   */\n  verbosityLevel: 0,\n\n  /**\n   * The URL of the remote logger to connect to. LISN uses\n   * {@link https://socket.io/docs/v4/client-api/ | socket.io-client}\n   * to talk to the client and emits messages on the following namespaces:\n   *\n   * - `console.debug`\n   * - `console.log`\n   * - `console.info`\n   * - `console.warn`\n   * - `console.error`\n   *\n   * There is a simple logging server that ships with LISN, see the source\n   * code repository.\n   *\n   * You can always explicitly disable remote logging on a given page by\n   * setting `disableRemoteLog=1` query parameter in the URL.\n   *\n   * **Note:** Logging is not available in bundles (except in the `debug` bundle).\n   *\n   * @defaultValue null\n   * @category Logging\n   */\n  remoteLoggerURL: null as string | null,\n\n  /**\n   * Enable remote logging only on mobile devices.\n   *\n   * You can always disable remote logging for any page by setting\n   * `disableRemoteLog=1` URL query parameter.\n   *\n   * **Note:** Logging is not available in bundles (except in the `debug` bundle).\n   *\n   * @defaultValue false\n   * @category Logging\n   */\n  remoteLoggerOnMobileOnly: false,\n});\n\n// --------------------\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { Point, Vector, AtLeastOne } from \"@lisn/globals/types\";\n\n/**\n * Round a number to the given decimal precision.\n *\n * @category Math\n */\nexport const roundNumTo = (value: number, numDecimal = 0) => {\n  const multiplicationFactor = MH.pow(10, numDecimal);\n  return MH.round(value * multiplicationFactor) / multiplicationFactor;\n};\n\n/**\n * Returns true if the given value is a valid _finite_ number.\n *\n * @category Validation\n */\nexport const isValidNum = (value: unknown): value is number =>\n  MH.isNumber(value) && MC.NUMBER.isFinite(value);\n\n/**\n * If the given value is a valid _finite_ number, it is returned, otherwise\n * the default is returned.\n *\n * @category Math\n */\nexport const toNum = <D extends number | false | null = 0>(\n  value: unknown,\n  defaultValue: D | 0 = 0,\n): number | D => {\n  const numValue = MH.isLiteralString(value) ? MH.parseFloat(value) : value;\n\n  // parseFloat will strip trailing non-numeric characters, so we check that\n  // the parsed number is equal to the string, if it was a string, using loose\n  // equality, in order to make sure the entire string was a number.\n  return isValidNum(numValue) && numValue == value ? numValue : defaultValue;\n};\n\n/**\n * If the given value is a valid _finite integer_ number, it is returned,\n * otherwise the default is returned.\n *\n * @category Math\n */\nexport const toInt = <D extends number | false | null = 0>(\n  value: unknown,\n  defaultValue: D | 0 = 0,\n): number | D => {\n  let numValue = toNum(value, null);\n  numValue = numValue === null ? numValue : MH.floor(numValue);\n\n  // Ensure that the parsed int equaled the original by loose equality.\n  return isValidNum(numValue) && numValue == value ? numValue : defaultValue;\n};\n\n/**\n * If the given value is a valid non-negative _finite_ number, it is returned,\n * otherwise the default is returned.\n *\n * @category Math\n */\nexport const toNonNegNum = <D extends number | false | null = 0>(\n  value: unknown,\n  defaultValue: D | 0 = 0,\n): number | D => {\n  const numValue = toNum(value, null);\n  return numValue !== null && numValue >= 0 ? numValue : defaultValue;\n};\n\n/**\n * If the given value is a valid positive number, it is returned, otherwise the\n * default is returned.\n *\n * @category Math\n */\nexport const toPosNum = <D extends number | false | null = 0>(\n  value: unknown,\n  defaultValue: D | 0 = 0,\n): number | D => {\n  const numValue = toNum(value, null);\n  return numValue !== null && numValue > 0 ? numValue : defaultValue;\n};\n\n/**\n * Returns the given number bound by min and/or max value.\n *\n * If the value is not a valid number, then `defaultValue` is returned if given\n * (_including if it is null_), otherwise `limits.min` if given and not null,\n * otherwise `limits.max` if given and not null, or finally 0.\n *\n * If the value is outside the bounds, then:\n * - if `defaultValue` is given, `defaultValue` is returned (_including if it\n *   is null_)\n * - otherwise, the min or the max value (whichever one is violated) is\n *   returned\n *\n * @category Math\n */\nexport const toNumWithBounds = <D extends number | false | null = number>(\n  value: unknown,\n  limits: AtLeastOne<{ min: number | null; max: number | null }>,\n  defaultValue?: D,\n): number | D => {\n  const isDefaultGiven = defaultValue !== undefined;\n  const numValue = toNum(value, null);\n  const min = limits?.min ?? null;\n  const max = limits?.max ?? null;\n\n  let result: number | D;\n  if (!isValidNum(numValue)) {\n    result = isDefaultGiven ? defaultValue : (min ?? max ?? 0);\n  } else if (min !== null && numValue < min) {\n    result = isDefaultGiven ? defaultValue : min;\n  } else if (max !== null && numValue > max) {\n    result = isDefaultGiven ? defaultValue : max;\n  } else {\n    result = numValue;\n  }\n\n  return result;\n};\n\n/**\n * Returns the largest absolute value among the given ones.\n *\n * The result is always positive.\n *\n * @category Math\n */\nexport const maxAbs = (...values: number[]) =>\n  MH.max(...values.map((v) => MH.abs(v)));\n\n/**\n * Returns the smallest absolute value among the given ones.\n *\n * The result is always positive.\n *\n * @category Math\n */\nexport const minAbs = (...values: number[]) =>\n  MH.min(...values.map((v) => MH.abs(v)));\n\n/**\n * Returns the value with the largest absolute value among the given ones.\n *\n * The result can be negative.\n *\n * @category Math\n */\nexport const havingMaxAbs = (...values: number[]): number =>\n  MH.lengthOf(values)\n    ? values.sort((a, b) => MH.abs(b) - MH.abs(a))[0]\n    : -MC.INFINITY;\n\n/**\n * Returns the value with the smallest absolute value among the given ones.\n *\n * The result can be negative.\n *\n * @category Math\n */\nexport const havingMinAbs = (...values: number[]) =>\n  MH.lengthOf(values)\n    ? values.sort((a, b) => MH.abs(a) - MH.abs(b))[0]\n    : MC.INFINITY;\n\n/**\n * Returns the angle (in radians) that the vector defined by the given x, y\n * makes with the positive horizontal axis.\n *\n * The angle returned is in the range -PI to PI, not including -PI.\n *\n * @category Math\n */\nexport const hAngle = (x: number, y: number) =>\n  normalizeAngle(MC.MATH.atan2(y, x)); // ensure that -PI is transformed to +PI\n\n/**\n * Normalizes the given angle (in radians) so that it's in the range -PI to PI,\n * not including -PI.\n *\n * @category Math\n */\nexport const normalizeAngle = (a: number) => {\n  // ensure it's positive in the range 0 to 2 PI\n  while (a < 0 || a > MC.PI * 2) {\n    a += (a < 0 ? 1 : -1) * MC.PI * 2;\n  }\n\n  // then, if > PI, offset by - 2PI\n  return a > MC.PI ? a - MC.PI * 2 : a;\n};\n\n/**\n * Converts the given angle in degrees to radians.\n *\n * @category Math\n */\nexport const degToRad = (a: number) => (a * MC.PI) / 180;\n\n/**\n * Converts the given angle in radians to degrees.\n *\n * @category Math\n */\nexport const radToDeg = (a: number) => (a * 180) / MC.PI;\n\n/**\n * Returns true if the given vectors point in the same direction.\n *\n * @param angleDiffThreshold\n *                  Sets the threshold in degrees when comparing the angles of\n *                  two vectors. E.g. for 5 degrees threshold, directions\n *                  whose vectors are within 5 degrees of each other are\n *                  considered parallel.\n *                  It doesn't make sense for this value to be < 0 or >= 90\n *                  degrees. If it is, it's forced to be positive (absolute)\n *                  and <= 89.99.\n *\n * @category Math\n */\nexport const areParallel = (vA: Vector, vB: Vector, angleDiffThreshold = 0) => {\n  const angleA = hAngle(vA[0], vA[1]);\n  const angleB = hAngle(vB[0], vB[1]);\n  angleDiffThreshold = MH.min(89.99, MH.abs(angleDiffThreshold));\n\n  return (\n    MH.abs(normalizeAngle(angleA - angleB)) <= degToRad(angleDiffThreshold)\n  );\n};\n\n/**\n * Returns true if the given vectors point in the opposite direction.\n *\n * @param angleDiffThreshold\n *                  Sets the threshold in degrees when comparing the angles of\n *                  two vectors. E.g. for 5 degrees threshold, directions\n *                  whose vectors are within 175-185 degrees of each other are\n *                  considered antiparallel.\n *                  It doesn't make sense for this value to be < 0 or >= 90\n *                  degrees. If it is, it's forced to be positive (absolute)\n *                  and <= 89.99.\n *\n * @category Math\n */\nexport const areAntiParallel = (\n  vA: Vector,\n  vB: Vector,\n  angleDiffThreshold = 0,\n) => areParallel(vA, [-vB[0], -vB[1]], angleDiffThreshold);\n\n/**\n * Returns the distance between two points on the screen.\n *\n * @category Math\n */\nexport const distanceBetween = (ptA: Point, ptB: Point) =>\n  MH.sqrt(MH.pow(ptA[0] - ptB[0], 2) + MH.pow(ptA[1] - ptB[1], 2));\n\n/**\n * Returns the two roots of the quadratic equation with coefficients\n * `a`, `b` & `c`, i.e. `a * x^2 + b * x + c = 0`\n *\n * The roots may be `NaN` if the quadratic has no real solutions.\n *\n * @category Math\n */\nexport const quadraticRoots = (a: number, b: number, c: number) => {\n  const z = MH.sqrt(b * b - 4 * a * c);\n  return [(-b + z) / (2 * a), (-b - z) / (2 * a)];\n};\n\n/**\n * Returns the value that an \"easing\" quadratic function would have at the\n * given x.\n *\n * @see https://easings.net/#easeInOutQuad\n *\n * @param x Must be between 0 and 1.\n *\n * @returns The current y-axis value between 0 and 1.\n *\n * @category Math\n */\nexport const easeInOutQuad = (x: number) =>\n  x < 0.5 ? 2 * x * x : 1 - MH.pow(-2 * x + 2, 2) / 2;\n\n/**\n * Returns the new position and velocity for a critically damped user-driven\n * spring state toward a current target position.\n *\n * @param [settings.lTarget]       Target final position.\n * @param [settings.dt]            Time step in milliseconds since the last call.\n *                                 Must be small for the returned values to be\n *                                 meaningful.\n * @param [settings.lag]           Lag in milliseconds (how long it should take\n *                                 for it to reach the final position). Must be\n *                                 positive.\n * @param [settings.l = 0]         Current position (starting or one returned by\n *                                 previous call).\n * @param [settings.v = 0]         Current velocity (returned by previous call).\n * @param [settings.precision = 2] Number of decimal places to round position to\n *                                 in order to determine when it's \"done\".\n * @returns Updated position and velocity\n *\n * @since v1.2.0\n *\n * @category Math\n */\nexport const criticallyDamped = (settings: {\n  lTarget: number;\n  dt: number;\n  lag: number;\n  l?: number;\n  v?: number;\n  precision?: number;\n}) => {\n  const { lTarget, precision = 2 } = settings;\n  const lag = toNumWithBounds(settings.lag, { min: 1 }) / 1000; // to seconds\n\n  // Since the position only approaches asymptotically the target it never truly\n  // reaches it exactly we need an approximation to calculate w0. N determines\n  // how far away from the target position we are after `lag` milliseconds.\n  const N = 7;\n  const w0 = N / lag;\n\n  let { l = 0, v = 0, dt } = settings;\n  dt /= 1000; // to seconds\n\n  if (roundNumTo(l - lTarget, precision) === 0) {\n    // we're done\n    l = lTarget;\n    v = 0;\n  } else if (dt > 0) {\n    const A = l - lTarget;\n    const B = v + w0 * A;\n    const e = MH.exp(-w0 * dt);\n\n    l = lTarget + (A + B * dt) * e;\n    v = (B - w0 * (A + B * dt)) * e;\n  }\n\n  return { l, v };\n};\n\n/**\n * Returns an array of object's keys sorted by the numeric value they hold.\n *\n * @category Math\n */\nexport const sortedKeysByVal = <T extends Record<string, number>>(\n  obj: T,\n  descending = false,\n): Array<keyof T> => {\n  if (descending) {\n    return MH.keysOf(obj).sort((x: keyof T, y: keyof T) => obj[y] - obj[x]);\n  }\n\n  return MH.keysOf(obj).sort((x: keyof T, y: keyof T) => obj[x] - obj[y]);\n};\n\n/**\n * Returns the key in the given object which holds the largest numeric value.\n *\n * If the object is empty, returns `undefined`.\n *\n * @category Math\n */\nexport const keyWithMaxVal = (\n  obj: Record<string, number>,\n): string | undefined => {\n  return MH.lastOf(sortedKeysByVal(obj));\n};\n\n/**\n * Returns the key in the given object which holds the smallest numeric value.\n *\n * If the object is empty, returns `undefined`.\n *\n * @category Math\n */\nexport const keyWithMinVal = (\n  obj: Record<string, number>,\n): string | undefined => {\n  return MH.firstOf(sortedKeysByVal(obj));\n};\n\n/**\n * Takes two integers and returns a bitmask that covers all values between\n * 1 << start and 1 << end, _including the starting and ending one_.\n *\n * If pStart > pEnd, they are reversed.\n *\n * getBitmask(start, start) always returns 1 << start\n * getBitmask(start, end) always returns same as getBitmask(end, start)\n *\n * @category Math\n */\nexport const getBitmask = (start: number, end: number): number =>\n  start > end\n    ? getBitmask(end, start)\n    : (~0 >>> (32 - end - 1 + start)) << start;\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { roundNumTo } from \"@lisn/utils/math\";\n\nexport const copyExistingKeys = <T extends object>(fromObj: T, toObj: T) => {\n  for (const key in toObj) {\n    if (!MH.hasOwnProp(toObj, key)) {\n      continue;\n    }\n\n    if (key in fromObj) {\n      if (MH.isNonPrimitive(fromObj[key]) && MH.isNonPrimitive(toObj[key])) {\n        copyExistingKeys(fromObj[key], toObj[key]);\n      } else {\n        toObj[key] = fromObj[key];\n      }\n    }\n  }\n};\n\n// Omits the keys in object keysToRm from obj. This is to avoid hardcording the\n// key names as a string so as to allow minifier to mangle them, and to avoid\n// using object spread.\nexport const omitKeys = <\n  O extends object,\n  R extends { [K in keyof O]?: unknown },\n>(\n  obj: O,\n  keysToRm: R,\n): Omit<O, keyof R> => {\n  const res: Partial<O> = {};\n  let key: keyof O;\n\n  for (key in obj) {\n    if (!(key in keysToRm)) {\n      res[key] = obj[key];\n    }\n  }\n\n  return res as Omit<O, keyof R>;\n};\n\n// Returns true if the two objects are equal. If values are numeric, it will\n// round to the given number of decimal places.\nexport const compareValuesIn = <T extends object>(\n  objA: T,\n  objB: T,\n  roundTo = 3,\n) => {\n  for (const key in objA) {\n    if (!MH.hasOwnProp(objA, key)) {\n      continue;\n    }\n\n    const valA = objA[key];\n    const valB = objB[key];\n\n    if (MH.isNonPrimitive(valA) && MH.isNonPrimitive(valB)) {\n      if (!compareValuesIn(valA, valB)) {\n        return false;\n      }\n    } else if (MH.isNumber(valA) && MH.isNumber(valB)) {\n      if (roundNumTo(valA, roundTo) !== roundNumTo(valB, roundTo)) {\n        return false;\n      }\n    } else if (valA !== valB) {\n      return false;\n    }\n  }\n  return true;\n};\n\nexport const keyExists = <T extends object>(\n  obj: T,\n  key: string | number | symbol,\n): key is keyof T => MH.isNonPrimitive(obj) && key in obj;\n\nexport const toArrayIfSingle = <T>(value?: T | T[] | null | undefined): T[] =>\n  MH.isArray(value) ? value : !MH.isNullish(value) ? [value] : [];\n\nexport const toBoolean = (value: unknown) =>\n  value === true || value === \"true\" || value === \"\"\n    ? true\n    : MH.isNullish(value) || value === false || value === \"false\"\n      ? false\n      : null;\n\n/**\n * @deprecated\n */\nexport const toBool = toBoolean;\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { Size, StrRecord } from \"@lisn/globals/types\";\n\n/**\n * Formats an object as a string. It supports more meaningful formatting as\n * string for certain types rather than using the default string\n * representation.\n *\n * **NOTE:** This is not intended for serialization of data that needs to be\n * de-serialized. Only for debugging output.\n *\n * @param value    The value to format as string.\n * @param [maxLen] Maximum length of the returned string. If not given or\n *                 is <= 0, the string is not truncated. Otherwise, if the\n *                 result is longer than maxLen, it is truncated to\n *                 `maxLen - 3` and added a suffix of \"...\".\n *                 Note that if `maxLen` is > 0 but <= 3, the result is\n *                 always \"...\"\n *\n * @category Text\n */\nexport const formatAsString = (value: unknown, maxLen?: number) => {\n  const result = maybeConvertToString(value, false);\n\n  if (!MH.isNullish(maxLen) && maxLen > 0 && MH.lengthOf(result) > maxLen) {\n    return result.slice(0, MH.max(0, maxLen - 3)) + \"...\";\n  }\n\n  return result;\n};\n\n/**\n * Join an array of values as string using separator. It uses\n * {@link formatAsString} rather than the default string representation as\n * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join | Array:join} would.\n *\n * @param separator The separator to use to delimit each argument.\n * @param args      Objects or values to convert to string and join.\n *\n * @category Text\n */\nexport const joinAsString = (separator: string, ...args: unknown[]) =>\n  args.map((a) => formatAsString(a)).join(separator);\n\n/**\n * Similar to\n * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/split | String.prototype.split}\n * except that\n * 1. `limit` is interpreted as the maximum number of splits, and the\n *   returned array contains `limit + 1` entries. Also if `limit` is given and\n *   the number of substrings is greater than the limit, all the remaining\n *   substrings are present in the final substring.\n * 2. If input is an empty string (or containing only whitespace), returns an\n *    empty array.\n *\n * @example\n * ```javascript\n * splitOn('foo, bar, baz', RegExp(',\\\\s*'), 0); // -> ['foo, bar, baz']\n * splitOn('foo, bar, baz', RegExp(',\\\\s*'), 1); // -> ['foo', 'bar, baz']\n * splitOn('foo, bar, baz', RegExp(',\\\\s*'), 2); // -> ['foo', 'bar', 'baz']\n * splitOn('foo, bar, baz', RegExp(',\\\\s*'), 3); // -> ['foo', 'bar', 'baz']\n * ```\n *\n * @param trim  If true, entries will be trimmed for whitespace after splitting.\n *\n * @param limit If not given or < 0, the string will be split on every\n *              occurrence of `separator`. Otherwise, it will be split on\n *              the first `limit` number of occurrences of `separator`.\n *\n * @category Text\n */\nexport const splitOn = (\n  input: string,\n  separator: string | RegExp,\n  trim?: boolean,\n  limit?: number,\n) => {\n  if (!input.trim()) {\n    return [];\n  }\n\n  limit ??= -1;\n\n  const output: string[] = [];\n  const addEntry = (s: string) => output.push(trim ? s.trim() : s);\n\n  while (limit--) {\n    let matchIndex = -1,\n      matchLength = 0;\n    if (MH.isLiteralString(separator)) {\n      matchIndex = input.indexOf(separator);\n      matchLength = MH.lengthOf(separator);\n    } else {\n      const match = separator.exec(input);\n      matchIndex = match?.index ?? -1;\n      matchLength = match ? MH.lengthOf(match[0]) : 0;\n    }\n\n    if (matchIndex < 0) {\n      break;\n    }\n\n    addEntry(input.slice(0, matchIndex));\n    input = input.slice(matchIndex + matchLength);\n  }\n\n  addEntry(input);\n  return output;\n};\n\n/**\n * Converts a kebab-cased-string to camelCase.\n * The result is undefined if the input string is not formatted in\n * kebab-case.\n *\n * @category Text\n */\nexport const kebabToCamelCase = MH.kebabToCamelCase;\n\n/**\n * Converts a camelCasedString to kebab-case.\n * The result is undefined if the input string is not formatted in\n * camelCase.\n *\n * @category Text\n */\nexport const camelToKebabCase = MH.camelToKebabCase;\n\n/**\n * Generates a random string of a fixed length.\n *\n * **IMPORTANT:** This is _not_ suitable for cryptographic applications.\n *\n * @param nChars The length of the returned stirng.\n *\n * @category Text\n */\nexport const randId = (nChars = 8) => {\n  const segment = () =>\n    MH.floor(100000 + MC.MATH.random() * 900000).toString(36);\n\n  let s = \"\";\n  while (MH.lengthOf(s) < nChars) {\n    s += segment();\n  }\n  return s.slice(0, nChars);\n};\n\n/**\n * Returns an array of numeric margins in pixels from the given margin string.\n * The string should contain margins in either pixels or percentage; other\n * units are not supported.\n *\n * Percentage values are converted to pixels relative to the given\n * `absoluteSize`: left/right margins relative to the width, and top/bottom\n * margins relative to the height.\n *\n * Note that for the margin property, percentages are always relative to the\n * WIDTH of the parent, so you should pass the parent width as both the width\n * and the height keys in `absoluteSize`. But for IntersectionObserver's\n * `rootMargin`, top/bottom margin is relative to the height of the root, so\n * pass the actual root size.\n *\n * @returns [topMarginInPx, rightMarginInPx, bottomMarginInPx, leftMarginInPx]\n *\n * @category Text\n */\nexport const toMargins = (value: string, absoluteSize: Size) => {\n  const toPxValue = (strValue: string | undefined, index: number) => {\n    let margin = MH.parseFloat(strValue ?? \"\") || 0;\n\n    if (strValue === margin + \"%\") {\n      margin *=\n        index % 2 ? absoluteSize[MC.S_HEIGHT] : absoluteSize[MC.S_WIDTH];\n    }\n\n    return margin;\n  };\n\n  const parts = splitOn(value, \" \", true);\n  const margins: [number, number, number, number] = [\n    // top\n    toPxValue(parts[0], 0),\n    // right\n    toPxValue(parts[1] ?? parts[0], 1),\n    // bottom\n    toPxValue(parts[2] ?? parts[0], 2),\n    // left\n    toPxValue(parts[3] ?? parts[1] ?? parts[0], 3),\n  ];\n\n  return margins;\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const objToStrKey = (obj: StrRecord): string =>\n  MH.stringify(flattenForSorting(obj));\n\n// --------------------\n\nconst flattenForSorting = (obj: StrRecord): unknown[] => {\n  const array = MH.isArray(obj)\n    ? obj\n    : MH.keysOf(obj)\n        .sort()\n        .map((k) => obj[k]);\n\n  return array.map((value) => {\n    if (\n      MH.isArray(value) ||\n      (MH.isNonPrimitive(value) && MH.constructorOf(value) === MC.OBJECT)\n    ) {\n      return flattenForSorting(value);\n    }\n    return value;\n  });\n};\n\nconst stringifyReplacer = (key: string, value: unknown) =>\n  key ? maybeConvertToString(value, true) : value;\n\nconst maybeConvertToString = <B extends boolean, V>(\n  value: V,\n  nested: B,\n): B extends false ? string : string | V => {\n  let result: string | V = \"\";\n\n  if (MH.isElement(value)) {\n    const classStr = MH.classList(value).toString().trim();\n\n    result = value.id\n      ? \"#\" + value.id\n      : `<${MH.tagName(value)}${classStr ? ' class=\"' + classStr + '\"' : \"\"}>`;\n\n    //\n  } else if (MH.isInstanceOf(value, Error)) {\n    /* istanbul ignore else */\n    if (\"stack\" in value && MH.isString(value.stack)) {\n      result = value.stack;\n    } else {\n      result = `Error: ${value.message}`;\n    }\n\n    //\n  } else if (MH.isArray(value)) {\n    result =\n      \"[\" +\n      value\n        .map((v) =>\n          MH.isString(v) ? MH.stringify(v) : maybeConvertToString(v, false),\n        )\n        .join(\",\") +\n      \"]\";\n\n    //\n  } else if (MH.isIterableObject(value)) {\n    result =\n      MH.typeOrClassOf(value) +\n      \"(\" +\n      maybeConvertToString(MH.arrayFrom(value), false) +\n      \")\";\n\n    //\n  } else if (MH.isNonPrimitive(value)) {\n    result = nested ? value : MH.stringify(value, stringifyReplacer);\n\n    //\n  } else {\n    // primitive\n    result = nested ? value : MC.STRING(value);\n  }\n\n  return result as B extends false ? string : string | V;\n};\n","/**\n * @module Utils\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { LisnUsageError } from \"@lisn/globals/errors\";\n\nimport { CommaSeparatedStr } from \"@lisn/globals/types\";\n\nimport { toNum } from \"@lisn/utils/math\";\nimport { toBoolean } from \"@lisn/utils/misc\";\nimport { splitOn } from \"@lisn/utils/text\";\n\n/**\n * Returns true if the input is a string array or comma-separated string, whose\n * elements are valid according to the `validator` function.\n *\n * @param allowEmpty If `false`, then input without any entries is\n * considered _invalid_.\n *\n * @category Validation\n */\nexport const isValidStrList = <T extends string = string>(\n  value: unknown,\n  checkFn: (value: string) => value is T,\n  allowEmpty = true,\n): value is CommaSeparatedStr<T> | T[] => {\n  try {\n    const res = validateStrList(\"\", value, checkFn);\n    return allowEmpty || !MH.isNullish(res);\n  } catch (err) {\n    if (MH.isInstanceOf(err, LisnUsageError)) {\n      return false;\n    }\n    throw err;\n  }\n};\n\n/**\n * Returns an array of strings from the given list while validating each one\n * using the `checkFn` function.\n *\n * If it returns without throwing, the input is necessarily valid.\n * If the result is an empty array, it will return `null`.\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *                If the input is not a string or array of strings, or if any\n *                entries do not pass `checkFn`.\n *\n * @param key Used in the error message thrown\n *\n * @returns `undefined` if the input contains no non-empty values (after\n * trimming whitespace on left/right from each), otherwise a non-empty array of\n * values.\n *\n * @category Validation\n */\nexport const validateStrList = <T extends string = string>(\n  key: string,\n  value: unknown,\n  checkFn?: (value: string) => value is T,\n): T[] | undefined =>\n  MH.filterBlank(\n    toArray(value)?.map((v) =>\n      _validateString(key, v, checkFn, \"a string or a string array\"),\n    ),\n  );\n\n/**\n * Returns an array of numbers from the given list.\n *\n * If it returns without throwing, the input is necessarily valid.\n * If the result is an empty array, it will return `null`.\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *                If the input is not a number or array of numbers. Numerical\n *                strings are accepted.\n *\n * @param key Used in the error message thrown\n *\n * @returns `undefined` if the input contains no non-empty values (after\n * trimming whitespace on left/right from each), otherwise a non-empty array of\n * values.\n *\n * @category Validation\n */\nexport const validateNumList = (\n  key: string,\n  value: unknown,\n): number[] | undefined =>\n  MH.filterBlank(\n    toArray(value)?.map((v) =>\n      _validateNumber(key, v, \"a number or a number array\"),\n    ),\n  );\n\n/**\n * Returns a number corresponding to the supplied value, ensuring the supplied\n * value is a valid number or a string containing only a number.\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *                If the value is invalid.\n *\n * @returns `undefined` if the input is nullish.\n *\n * @category Validation\n */\nexport const validateNumber = (key: string, value: unknown) =>\n  _validateNumber(key, value);\n\n/**\n * Returns a boolean corresponding to the given value as follows:\n *\n * - `null` and `undefined` result in `undefined`\n * - `false` and `\"false\"` result in `false`\n * - `\"\"`, `true` and `\"true\"` result in `true`\n * - other values throw an error error\n *\n * Note that an empty string is treated as `true`.\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *                If the value is not a valid boolean or boolean string.\n *\n * @returns `undefined` if the input is nullish.\n *\n * @category Validation\n */\nexport const validateBoolean = (key: string, value: unknown) =>\n  _validateBoolean(key, value);\n\n/**\n * Returns a valid string from the supplied value, ensuring the supplied value\n * is a string that conforms to the given `checkFn`.\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *                If the value is invalid.\n *\n * @param checkFn If given and the supplied value is a string, then it is\n *                called with the value as a single argument. It must return\n *                true if the value is valid and false otherwise. If it is not\n *                given, then any literal string is accepted.\n *\n * @returns `undefined` if the input is nullish.\n *\n * @category Validation\n */\nexport const validateString = <T extends string = string>(\n  key: string,\n  value: unknown,\n  checkFn?: (value: string) => value is T,\n) => _validateString(key, value, checkFn);\n\n/**\n * Like {@link validateString} except it requires input to be given and\n * non-empty.\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *                If the value is invalid or empty.\n *\n * @category Validation\n */\nexport const validateStringRequired = <T extends string = string>(\n  key: string,\n  value: unknown,\n  checkFn?: (value: string) => value is T,\n): T => {\n  const result = _validateString(key, value, checkFn);\n\n  if (MH.isEmpty(result)) {\n    throw MH.usageError(`'${key}' is required`);\n  }\n\n  return result;\n};\n\n/**\n * Returns a valid boolean or a string from the supplied value, ensuring the\n * supplied value is either a boolean or boolean string (see\n * {@link validateBoolean}), or a string that conforms to the given `checkFn`.\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *                If the value is invalid.\n *\n * @param stringCheckFn If given and the supplied value is a string _other than\n *                      a boolean string_, then it is called with the value as\n *                      a single argument. It must return true if the value is\n *                      valid and false otherwise. If it is not given, then any\n *                      literal string is accepted.\n *\n * @category Validation\n */\nexport const validateBooleanOrString = <T extends string = string>(\n  key: string,\n  value: unknown,\n  stringCheckFn?: (value: string) => value is T,\n) => _validateBooleanOrString(key, value, stringCheckFn);\n\n// --------------------\n\nconst toArray = (value: unknown): unknown[] | undefined => {\n  let result: unknown[] | null;\n  if (MH.isArray(value)) {\n    result = value;\n  } else if (MH.isIterableObject(value)) {\n    result = MH.arrayFrom(value);\n  } else if (MH.isLiteralString(value)) {\n    result = splitOn(value, \",\");\n  } else if (!MH.isNullish(value)) {\n    result = [value];\n  } else {\n    result = null;\n  }\n\n  return result\n    ? MH.filterBlank(result.map((v) => (MH.isLiteralString(v) ? v.trim() : v)))\n    : undefined;\n};\n\nconst _validateNumber = (\n  key: string,\n  value: unknown,\n  typeDescription?: string,\n) => {\n  if (MH.isNullish(value)) {\n    return;\n  }\n\n  const numVal = toNum(value, null);\n  if (numVal === null) {\n    throw MH.usageError(`'${key}' must be ${typeDescription ?? \"a number\"}`);\n  }\n\n  return numVal;\n};\n\nconst _validateBoolean = (\n  key: string,\n  value: unknown,\n  typeDescription?: string,\n) => {\n  if (MH.isNullish(value)) {\n    return;\n  }\n\n  const boolVal = toBoolean(value);\n  if (boolVal === null) {\n    throw MH.usageError(\n      `'${key}' must be ${typeDescription ?? '\"true\" or \"false\"'}`,\n    );\n  }\n\n  return boolVal;\n};\n\nconst _validateString = <T extends string = string>(\n  key: string,\n  value: unknown,\n  checkFn?: (value: string) => value is T,\n  typeDescription?: string,\n): (typeof checkFn extends null | undefined ? string : T) | undefined => {\n  if (MH.isNullish(value)) {\n    return;\n  }\n\n  if (!MH.isLiteralString(value)) {\n    throw MH.usageError(`'${key}' must be ${typeDescription ?? \"a string\"}`);\n  } else if (checkFn && !checkFn(value)) {\n    throw MH.usageError(`Invalid value for '${key}'`);\n  }\n\n  return value as typeof checkFn extends null | undefined ? string : T;\n};\n\nconst _validateBooleanOrString = <T extends string = string>(\n  key: string,\n  value: unknown,\n  stringCheckFn?: (value: string) => value is T,\n  typeDescription?: string,\n) => {\n  if (MH.isNullish(value)) {\n    return;\n  }\n\n  const boolVal = toBoolean(value);\n  if (boolVal !== null) {\n    return boolVal;\n  }\n\n  if (!MH.isLiteralString(value)) {\n    throw MH.usageError(\n      `'${key}' must be ${typeDescription ?? \"a boolean or string\"}`,\n    );\n  }\n\n  return _validateString(key, value, stringCheckFn);\n};\n","/**\n * @module Modules/BitSpaces\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { getBitmask } from \"@lisn/utils/math\";\n\nexport type BitPropName = string;\n\n/**\n * A union of all property names in the space.\n */\nexport type BitSpaceKey<S> = S extends BitSpace<infer T> ? T : never;\n\n/**\n * {@link BitSpace} represents a single set of mutually exclusive (or\n * orthogonal) properties.\n *\n * Each property has a numeric value equal to 1 bit-shifted by a certain number\n * of bits.\n *\n * Created using {@link BitSpaces.create}\n *\n * @interface\n */\nexport type BitSpace<T extends BitPropName> = {\n  /**\n   * The starting bit of the space. It's 0 for the first space created in a\n   * given set of {@link BitSpaces}.\n   */\n  start: number;\n\n  /**\n   * The ending bit of the space. It's always equal to\n   * start + (# of properties in space) - 1\n   */\n  end: number;\n\n  /**\n   * A bitmask of all values in the space.\n   */\n  bitmask: number;\n\n  /**\n   * Returns true if the given name is one of the properties in the space.\n   * It is case-sensitive.\n   */\n  has: (p: string) => p is T;\n\n  /**\n   * Takes the names of two properties within the space and returns a bitmask\n   * that covers all values between them _including the starting and ending\n   * one_.*\n   *\n   * If pStart > pEnd, they are reversed.\n   *\n   * * The numeric values of the properties are guaranteed to be in the same\n   *   order, increasing in value, as the keys passed to the `BitSpaces.create`,\n   *   function.\n   *\n   * @param pStart The name of the property that holds the start value.\n   *               If null the bitmask will cover from the lowest property.\n   * @param pEnd   The name of the property that holds the end cut-off value\n   *               for the bitmask. The bitmask with _not_ include pEnd's\n   *               value.\n   *               If null the bitmask will cover to the highest property,\n   *               _including_.\n   *\n   * @returns Returns a non-0 bitmask containing all values in the space between\n   *          the given ones.\n   *          Returns 0 if one or both of the given properties do not exist in\n   *          the space.\n   */\n  bitmaskFor: (pStart?: T | null, pEnd?: T | null) => number;\n\n  /**\n   * Returns the name of the property with the given value, or null if the\n   * value does not correspond to one of the space properties.\n   */\n  nameOf: (val: number) => T | null;\n\n  /**\n   * Holds properties whose numeric values are non-overlapping binary values,\n   * suitable for bitmasking.\n   *\n   * The given properties are set under the \"bit\" key in the object and hold\n   * the numeric value.\n   *\n   * @example\n   * ```javascript\n   * const space = new BitSpaces().create(\"up\", \"down\", \"left\", \"right\");\n   *\n   * // {\n   * //     bit: {\n   * //         up:    1, // at bit 0, i.e. 1 << 0\n   * //         down:  2, // at bit 1, i.e. 1 << 1\n   * //         left:  4, // at bit 2, i.e. 1 << 2\n   * //         right: 8, // at bit 3, i.e. 1 << 3\n   * //     },\n   * //     start:      0,\n   * //     end:        3,\n   * //     bitmask:    15, // 1 << 0 | 1 << 1 | 1 << 2 | 1 << 3\n   * //     has:        (p) => p === \"up\" || p === \"down\" || p === \"left\" || p === \"right\",\n   * //     bitmaskFor: (pStart, pEnd) => ...\n   * //     nameOf:     (v) => v === 1 ? \"up\" : v === 2 ? \"down\" : v === 4 ...\n   * // }\n   *\n   * space.bitmaskFor(); // => space.bitmask (15)\n   * space.bitmaskFor(\"left\"); // => space.bit.left | space.bit.right (12)\n   * space.bitmaskFor(null, \"down\"); // => space.bit.up | space.bit.down (3)\n   * ```\n   */\n  bit: {\n    [key in T]: number;\n  };\n};\n\n/**\n * {@link BitSpaces} represents one or more related {@link BitSpace}s whose bit\n * values will not overlap.\n */\nexport class BitSpaces {\n  /**\n   * Creates and returns a new BitSpace that is bit shifted to the left as\n   * many bits as the ending bit of the previous space created by this\n   * instances, so that each new space created is non-overlapping with previous\n   * ones.\n   *\n   * The numeric values of the properties are guaranteed to be in the same\n   * order, increasing in value, as the keys passed to the function.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the number of bits in the space will exceed 32.\n   *\n   * @example\n   * ```javascript\n   * const spaces = new BitSpaces();\n   * const spaceA = spaces.create(\"up\", \"down\");\n   *\n   * // spaces.nBits   => 2\n   * // spaces.bitmask => 3\n   * //\n   * // spaceA:\n   * // {\n   * //     bit: {\n   * //         up:     1, // at bit 0, i.e. 1 << 0\n   * //         down:   2, // at bit 1, i.e. 1 << 1\n   * //     },\n   * //     start:      0,\n   * //     end:        1,\n   * //     bitmask:    3, // 1 << 0 | 1 << 1\n   * //     has:        (p) => p === \"up\" || p === \"down\",\n   * //     bitmaskFor: (pStart, pEnd) => ...\n   * //     nameOf:     (v) => v === 1 ? \"up\" : v === 2 ? \"down\" : null\n   * // }\n   *\n   * const spaceB = spaces.create(\"left\", \"right\");\n   *\n   * // spaces.nBits   => 4\n   * // spaces.bitmask => 15\n   * //\n   * // spaceB:\n   * // {\n   * //     bit: {\n   * //         left:   4, // at bit 2, i.e. 1 << 2\n   * //         right:  8, // at bit 3, i.e. 1 << 3\n   * //     },\n   * //     start:      2,\n   * //     end:        3,\n   * //     bitmask:    12, // 1 << 2 | 1 << 3\n   * //     has:        (p) => p === \"left\" || p === \"right\",\n   * //     bitmaskFor: (pStart, pEnd) => ...\n   * //     nameOf:     (v) => v === 4 ? \"left\" : v === 8 ? \"right\" : null\n   * // }\n   *\n   * ```\n   */\n  readonly create: <T extends BitPropName>(\n    ...propNames: readonly T[]\n  ) => BitSpace<T>;\n\n  /**\n   * Returns the number of bits all created spaces span, i.e. the end bit of\n   * the one + 1.\n   */\n  readonly nBits!: number;\n\n  /**\n   * Returns a bitmask containing all values in all created spaces.\n   */\n  readonly bitmask!: number;\n\n  constructor() {\n    const counter = newCounter();\n\n    this.create = (...propNames) => newBitSpace(counter, propNames);\n    MH.defineProperty(this, \"nBits\", { get: () => counter._nBits });\n    MH.defineProperty(this, \"bitmask\", { get: () => counter._bitmask });\n  }\n}\n\n/**\n * For minification optimization\n *\n * @ignore\n * @internal\n */\nexport const newBitSpaces = () => new BitSpaces();\n\n/**\n * For minification optimization\n *\n * @ignore\n * @internal\n */\nexport const createBitSpace = <T extends BitPropName>(\n  spaces: BitSpaces,\n  ...propNames: readonly T[]\n): BitSpace<T> => spaces.create(...propNames);\n\n// ----------------------------------------\n\ntype BitCounter = {\n  _nBits: number;\n  _bitmask: number;\n};\n\nconst newCounter = (): BitCounter => ({\n  _nBits: 0,\n  _bitmask: 0,\n});\n\nconst newBitSpace = <T extends BitPropName>(\n  counter: BitCounter,\n  propNames: readonly T[],\n): BitSpace<T> => {\n  const start = counter._nBits;\n  const end = start + MH.lengthOf(propNames) - 1;\n  if (end >= 31) {\n    throw MH.usageError(\"BitSpaces overflow\");\n  }\n\n  const bitmask = getBitmask(start, end);\n  const space: BitSpace<T> = {\n    bit: {},\n    start,\n    end,\n    bitmask,\n\n    has: (p) =>\n      MH.isString(p) &&\n      p in space.bit &&\n      MH.isNumber((space.bit as Record<string, unknown>)[p]),\n\n    bitmaskFor: (pStart, pEnd) => {\n      if (\n        (!MH.isEmpty(pStart) && !space.has(pStart)) ||\n        (!MH.isEmpty(pEnd) && !space.has(pEnd))\n      ) {\n        return 0;\n      }\n\n      const thisStart = !MH.isEmpty(pStart)\n        ? MH.log2(space.bit[pStart])\n        : start;\n      const thisEnd = !MH.isEmpty(pEnd) ? MH.log2(space.bit[pEnd]) : end;\n\n      return getBitmask(thisStart, thisEnd);\n    },\n\n    nameOf: (val) => propNames[MH.log2(val) - start] ?? null,\n  } as BitSpace<T>;\n\n  for (const name of propNames) {\n    MH.defineProperty(space.bit, name, {\n      value: 1 << counter._nBits++,\n      enumerable: true,\n    });\n  }\n\n  counter._bitmask |= bitmask;\n\n  return space;\n};\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\n\nimport { MutationCategory } from \"@lisn/globals/types\";\n\nimport { isValidStrList } from \"@lisn/utils/validation\";\n\nimport { newBitSpaces, createBitSpace } from \"@lisn/modules/bit-spaces\";\n\n/**\n * Returns true if the given string is a valid category.\n *\n * @category Validation\n */\nexport const isValidMutationCategory = (\n  category: string,\n): category is MutationCategory => DOM_CATEGORIES_SPACE.has(category);\n\n/**\n * Returns true if the given string or array is a list of valid categories.\n *\n * @category Validation\n */\nexport const isValidMutationCategoryList = (categories: string | string[]) =>\n  isValidStrList(categories, isValidMutationCategory, false);\n\n/**\n * @ignore\n * @internal\n */\nexport const DOM_CATEGORIES_SPACE = createBitSpace<MutationCategory>(\n  newBitSpaces(),\n  MC.S_ADDED,\n  MC.S_REMOVED,\n  MC.S_ATTRIBUTE,\n);\n","/**\n * @module Utils\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\n/**\n * @category Tasks\n */\nexport type SchedulerPostTaskOptions = {\n  delay?: number;\n  priority?: TaskPriority;\n  signal?: AbortSignal;\n};\n\n/**\n * @category Tasks\n */\nexport type Scheduler = {\n  postTask<T, P extends readonly unknown[] | []>(\n    callback: (...params: P) => T,\n    options?: SchedulerPostTaskOptions,\n    ...args: P\n  ): Promise<T>;\n};\n\n/**\n * @category Tasks\n */\nexport type TaskPriority = \"user-blocking\" | \"user-visible\" | \"background\";\n\n/* eslint-disable-next-line no-var */\ndeclare var scheduler: Scheduler;\n\n/**\n * Schedules a task with high priority to be executed as soon as possible.\n *\n * It uses {@link https://developer.mozilla.org/en-US/docs/Web/API/Scheduler/postTask | Scheduler:postTask}\n * if available, otherwise falls back to\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel | MessageChannel}.\n *\n * @category Tasks\n */\nexport const scheduleHighPriorityTask = (task: () => void) => {\n  if (typeof scheduler !== \"undefined\") {\n    scheduler.postTask(task, {\n      priority: \"user-blocking\",\n    });\n  } else {\n    // Fallback to MessageChannel\n    const channel = new MessageChannel();\n    channel.port1.onmessage = () => {\n      channel.port1.close();\n      task();\n    };\n    channel.port2.postMessage(\"\");\n  }\n};\n\n/**\n * Returns a wrapper around the given handler that is debounced by the given\n * debounce window.\n *\n * @category Tasks\n */\nexport const getDebouncedHandler = <Args extends unknown[]>(\n  debounceWindow: number,\n  handler: (...args: Args) => void,\n) => {\n  if (!debounceWindow) {\n    return handler;\n  }\n\n  let timer: ReturnType<typeof setTimeout> | null = null;\n  let lastArgs: Args;\n\n  return (...args: Args) => {\n    lastArgs = args;\n\n    if (timer === null) {\n      timer = MH.setTimer(async () => {\n        await handler(...lastArgs);\n        timer = null;\n      }, debounceWindow);\n    }\n  };\n};\n\n/**\n * Returns a promise that resolves at least the given number of delay (in\n * milliseconds) later. Uses `setTimeout`.\n *\n * @category Tasks\n */\nexport const waitForDelay = (delay?: number) =>\n  MH.newPromise<void>((resolve) => {\n    MH.setTimer(resolve, delay);\n  });\n","/**\n * @module Debugging\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { LogFunction } from \"@lisn/globals/types\";\n\nimport { joinAsString } from \"@lisn/utils/text\";\n\nimport { LevelName, ConsoleInterface } from \"@lisn/debug/types\";\n\n/**\n * Logs to the local browser console. On iOS devices it uses `console.info` for\n * all levels because of a bug in WebKit whereby other log levels don't show in\n * some remote debuggers. Also, iOS console only supports a single argument, so\n * it joins the given arguments as a single string.\n *\n * @category Logging\n */\nexport class LocalConsole implements ConsoleInterface {\n  readonly debug: LogFunction;\n  readonly log: LogFunction;\n  readonly info: LogFunction;\n  readonly warn: LogFunction;\n  readonly error: LogFunction;\n\n  constructor() {\n    this.debug = isiOS ? iOSlog : isJest ? jestLog.debug : MH.consoleDebug;\n    this.log = isiOS ? iOSlog : isJest ? jestLog.log : MH.consoleLog;\n    this.info = isiOS ? iOSlog : isJest ? jestLog.info : MH.consoleInfo;\n    this.warn = isiOS ? iOSlog : isJest ? jestLog.warn : MH.consoleWarn;\n    this.error = isiOS ? iOSlog : isJest ? jestLog.error : MH.consoleError;\n  }\n}\n\n// ------------------------------\n\nconst isiOS = MH.includes(MH.userAgent, \"iPhone OS\");\nconst iOSlog: LogFunction = (...args) =>\n  MH.consoleInfo(joinAsString(\" \", ...args));\n\nconst isJest = MH.includes(MH.userAgent, \" jsdom/\");\nconst jestLog: Record<LevelName, LogFunction> = {\n  debug: (...args) => MH.consoleDebug(joinAsString(\" \", ...args)),\n  log: (...args) => MH.consoleLog(joinAsString(\" \", ...args)),\n  info: (...args) => MH.consoleInfo(joinAsString(\" \", ...args)),\n  warn: (...args) => MH.consoleWarn(joinAsString(\" \", ...args)),\n  error: (...args) => MH.consoleError(joinAsString(\" \", ...args)),\n};\n","/**\n * @module Modules/XMap\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { MapBase } from \"@lisn/globals/types\";\n\nexport type DefaultValueGetter<K, V> = (key: K) => V;\nexport type IteratorCallback<K, V> = (\n  value: V,\n  key: K,\n  map: XMap<K, V>,\n) => void;\n\n/**\n * For minification optimization\n *\n * @ignore\n * @internal\n */\nexport const newXMap = <K, V>(getDefaultV: DefaultValueGetter<K, V>) =>\n  new XMap(getDefaultV);\n\n/**\n * For minification optimization. Exposed through {@link XMap.newXMapGetter}.\n *\n * @ignore\n * @internal\n */\nexport const newXMapGetter =\n  <K, V>(getDefaultV: DefaultValueGetter<K, V>) =>\n  () =>\n    newXMap(getDefaultV);\n\n/**\n * For minification optimization\n *\n * @ignore\n * @internal\n */\nexport const newXWeakMap = <K extends WeakKey, V>(\n  getDefaultV: DefaultValueGetter<K, V>,\n) => new XWeakMap(getDefaultV);\n\n/**\n * For minification optimization. Exposed through {@link XMap.newXWeakMapGetter}.\n *\n * @ignore\n * @internal\n */\nexport const newXWeakMapGetter =\n  <K extends WeakKey, V>(getDefaultV: DefaultValueGetter<K, V>) =>\n  () =>\n    newXWeakMap(getDefaultV);\n\nexport abstract class XMapBase<K, V> {\n  /**\n   * Returns the value at the given key in the {@link XMap} or {@link XWeakMap}.\n   */\n  readonly get: (key: K) => V | undefined;\n\n  /**\n   * Like {@link get} except that if the key is not found in the map, then it\n   * will set and return a default value by calling `getDefaultV` passed to the\n   * constructor.\n   */\n  readonly sGet: (key: K) => V;\n\n  /**\n   * Sets a value at the given key in the {@link XMap} or {@link XWeakMap}.\n   */\n  readonly set: (key: K, value: V) => void;\n\n  /**\n   * Deletes a value at the given key in the {@link XMap} or {@link XWeakMap}.\n   */\n  readonly delete: (key: K) => void;\n\n  /**\n   * Deletes empty keys in the {@link XMap} or {@link XWeakMap} starting at the\n   * final nested path and checking the level above after deletion.\n   *\n   * A key is considered empty if it's value is undefined or it's an empty Map,\n   * Set, Array, etc (anything with size or length property equal to 0).\n   */\n  readonly prune: (sk: K, ...rest: unknown[]) => void;\n\n  /**\n   * Returns true if the {@link XMap} or {@link XWeakMap} contains the given key.\n   */\n  readonly has: (key: K) => boolean;\n\n  protected constructor(\n    root: MapBase<K, V>,\n    getDefaultV: DefaultValueGetter<K, V>,\n  ) {\n    this.get = (key) => root.get(key);\n    this.set = (key, value) => root.set(key, value);\n    this.delete = (key) => MH.deleteKey(root, key);\n    this.has = (key) => root.has(key);\n\n    this.sGet = (key) => {\n      let result = root.get(key);\n      if (result === undefined) {\n        result = getDefaultV(key);\n        root.set(key, result);\n      }\n      return result;\n    };\n\n    this.prune = (sk, ...rest) => {\n      const value = root.get(sk);\n      if (value instanceof XMapBase && MH.lengthOf(rest)) {\n        value.prune(rest[0], ...rest.slice(1));\n      }\n\n      if (\n        value === undefined ||\n        (MH.isIterableObject(value) &&\n          !(\n            (\"size\" in value && value.size) ||\n            (\"length\" in value && value.length)\n          ))\n      ) {\n        MH.deleteKey(root, sk);\n      }\n    };\n  }\n}\n\n/**\n * {@link XMap} is like\n * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map | Map},\n * except that it supports automatically creating missing entries with\n * {@link sGet} according to a default value getter function.\n *\n * @typeParam K The type of the keys the map holds.\n * @typeParam V The type of the values the map holds.\n */\nexport class XMap<K, V> extends XMapBase<K, V> implements Iterable<[K, V]> {\n  /**\n   * Returns the number of entries in the {@link XMap}.\n   */\n  readonly size!: number;\n\n  /**\n   * Deletes all entries in the {@link XMap}.\n   */\n  readonly clear: () => void;\n\n  /**\n   * Returns an iterator over the {@link XMap} entries.\n   */\n  readonly entries: () => MapIterator<[K, V]>;\n\n  /**\n   * Returns an iterator over the {@link XMap} keys.\n   */\n  readonly keys: () => MapIterator<K>;\n\n  /**\n   * Returns an iterator over the {@link XMap} values.\n   */\n  readonly values: () => MapIterator<V>;\n\n  readonly [Symbol.iterator]!: () => IterableIterator<[K, V]>;\n\n  /**\n   * Returns a function that when called returns a new {@link XMap}.\n   *\n   * You can pass this to the constructor of an {@link XMap} or an\n   * {@link XWeakMap}, whose values are {@link XMap}s.\n   */\n  static readonly newXMapGetter = newXMapGetter;\n\n  /**\n   * @param getDefaultV This function is called each time {@link sGet} is\n   *                    called with a non-existent key and must return a value\n   *                    that is then set for that key and returned.\n   */\n  constructor(getDefaultV: DefaultValueGetter<K, V>) {\n    const root = MH.newMap<K, V>();\n    super(root, getDefaultV);\n\n    MH.defineProperty(this, \"size\", { get: () => root.size });\n    this.clear = () => root.clear();\n    this.entries = () => root.entries();\n    this.keys = () => root.keys();\n    this.values = () => root.values();\n    this[MC.SYMBOL.iterator] = () => root[MC.SYMBOL.iterator]();\n  }\n}\n\n/**\n * {@link XWeakMap} is like\n * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap | WeakMap},\n * except that it supports automatically creating missing entries with\n * with {@link sGet} according to a default value getter function.\n *\n * @typeParam K The type of the keys the map holds.\n * @typeParam V The type of the values the map holds.\n */\nexport class XWeakMap<K extends WeakKey, V> extends XMapBase<K, V> {\n  /**\n   * Returns a function that when called returns a new {@link XWeakMap}.\n   *\n   * You can pass this to the constructor of an {@link XMap} or an\n   * {@link XWeakMap}, whose values are {@link XWeakMap}s.\n   */\n  static readonly newXWeakMapGetter = newXWeakMapGetter;\n\n  /**\n   * @param getDefaultV This function is called each time {@link sGet} is\n   *                    called with a non-existent key and must return a value\n   *                    that is then set for that key and returned.\n   */\n  constructor(getDefaultV: DefaultValueGetter<K, V>) {\n    const root = MH.newWeakMap<K, V>();\n    super(root, getDefaultV);\n  }\n}\n","/**\n * @module Debugging\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { LogFunction } from \"@lisn/globals/types\";\n\nimport { joinAsString } from \"@lisn/utils/text\";\n\nimport { newXMap } from \"@lisn/modules/x-map\";\n\nimport { ConsoleInterface } from \"@lisn/debug/types\";\n\n/* ******************************\n * Remote console\n * *******************************/\n\n/**\n * Connects to a remote {@link https://socket.io/ | socket.io} server and logs\n * messages to it.\n *\n * In the root of the Git repository, there is a simple example server that\n * listens for these messages and logs them to the local console.\n *\n * @category Logging\n */\nexport class RemoteConsole implements ConsoleInterface {\n  /**\n   * Emits a message with ID `console.debug`.\n   */\n  readonly debug: LogFunction;\n\n  /**\n   * Emits a message with ID `console.log`.\n   */\n  readonly log: LogFunction;\n\n  /**\n   * Emits a message with ID `console.info`.\n   */\n  readonly info: LogFunction;\n\n  /**\n   * Emits a message with ID `console.warn`.\n   */\n  readonly warn: LogFunction;\n\n  /**\n   * Emits a message with ID `console.error`.\n   */\n  readonly error: LogFunction;\n\n  /**\n   * Disconnects and destroys the {@link RemoteConsole}. Cannot be undone.\n   */\n  readonly destroy: () => void;\n\n  /**\n   * Returns true if the client has been disconnected for more than\n   * the connect timeout.\n   */\n  readonly hasFailed: () => boolean;\n\n  /**\n   * Creates a new {@link RemoteConsole} and attempts to connect to the logger\n   * at the given URL.\n   *\n   * @param url                     The URL of the remote logger.\n   * @param [connectTimeout = 1500] The timeout in ms for a connection\n   *                                to be considered failed.\n   */\n  constructor(url: string, connectTimeout = DEFAULT_TIMEOUT) {\n    let hasFailed = false; // initially\n    let isClosed = false;\n\n    // Because socket.io module is optional we need to import it dynamically,\n    // which is always async. So to avoid Console and Logger also needing to be\n    // async, we queue messages sent to a RemoteConsole here and try to import\n    // socket.io here.\n    let tmpQueue: Array<[string, unknown[]]> = [];\n    let sendLog = (level: string, args: unknown[]) => {\n      tmpQueue.push([level, args]);\n    };\n    let destroy = () => {};\n\n    this.hasFailed = () => hasFailed;\n    this.debug = (...args) => sendLog(\"debug\", args);\n    this.log = (...args) => sendLog(\"log\", args);\n    this.info = (...args) => sendLog(\"info\", args);\n    this.warn = (...args) => sendLog(\"warn\", args);\n    this.error = (...args) => sendLog(\"error\", args);\n    this.destroy = () => destroy();\n\n    const cleanup = () => {\n      hasFailed = true;\n      sendLog = (level__ignored: string, args__ignored: unknown[]) => {};\n      tmpQueue = [];\n\n      const instance = instances.get(url)?.get(connectTimeout);\n      if (instance === this) {\n        MH.deleteKey(instances.get(url), connectTimeout);\n        instances.prune(url);\n      }\n    };\n\n    (async () => {\n      let socket: typeof import(\"socket.io-client\");\n      const moduleName = \"socket.io-client\"; // suppress Vite static analysis\n      try {\n        socket = await import(/* webpackIgnore: true */ moduleName);\n      } catch (e__ignored) {\n        // module doesn't exist\n        cleanup();\n        return;\n      }\n\n      const ioClient = socket.io(url);\n\n      // if not connected within connectTimeout initially, set as failed\n      let disconnectTimer = MH.setTimer(() => {\n        hasFailed = true;\n      }, connectTimeout);\n\n      ioClient.on(\"disconnect\", () => {\n        // if not re-connected within connectTimeout, set as failed\n        MH.clearTimer(disconnectTimer);\n        if (!isClosed) {\n          disconnectTimer = MH.setTimer(() => {\n            hasFailed = true;\n          }, connectTimeout);\n        }\n      });\n\n      ioClient.on(\"connect\", () => {\n        MH.clearTimer(disconnectTimer);\n        hasFailed = false;\n      });\n\n      // Now we can send directly to the client\n      sendLog = (level: string, args: unknown[]) => {\n        if (!hasFailed) {\n          ioClient.emit(`console.${level}`, joinAsString(\" \", ...args));\n        }\n      };\n\n      destroy = () => {\n        isClosed = true; // do not wait for re-connect\n        ioClient.disconnect();\n        cleanup();\n      };\n\n      // Flush the queue\n      let entry: [string, unknown[]] | undefined;\n      while ((entry = tmpQueue.shift())) {\n        sendLog(entry[0], entry[1]);\n      }\n    })();\n  }\n\n  /**\n   * Returns an existing {@link RemoteConsole} for the given URL and timeout or\n   * creates a new one.\n   *\n   * If a new one is created, it will be saved for later reuse.\n   *\n   * @param url              The URL of the remote logger.\n   * @param [connectTimeout] The timeout in ms for a remote connection to\n   *                         be considered failed. Default is 1500.\n   */\n  static reuse(url: string, connectTimeout = DEFAULT_TIMEOUT) {\n    let rConsole = instances.get(url)?.get(connectTimeout);\n    if (!rConsole) {\n      rConsole = new RemoteConsole(url, connectTimeout);\n      instances.sGet(url).set(connectTimeout, rConsole);\n    }\n\n    return rConsole;\n  }\n}\n\nconst instances = newXMap<string, Map<number, RemoteConsole>>(() =>\n  MH.newMap(),\n);\n\nconst DEFAULT_TIMEOUT = 1500;\n","/**\n * @module Debugging\n */\n\nimport { LogFunction } from \"@lisn/globals/types\";\n\nimport { LevelName, ConsoleInterface } from \"@lisn/debug/types\";\nimport { LocalConsole } from \"@lisn/debug/local-console\";\nimport { RemoteConsole } from \"@lisn/debug/remote-console\";\n\n/**\n * Holds a {@link LocalConsole} and optionally a {@link RemoteConsole} and logs\n * to both.\n */\nexport class Console implements ConsoleInterface {\n  readonly debug: LogFunction;\n  readonly log: LogFunction;\n  readonly info: LogFunction;\n  readonly warn: LogFunction;\n  readonly error: LogFunction;\n\n  /**\n   * @param remoteUrl        Attempt to use a remote logger at this URL.\n   * @param [connectTimeout] The timeout in ms for a remote connection to be\n   *                         considered failed. See {@link RemoteConsole}.\n   */\n  constructor(remoteUrl?: string, connectTimeout?: number) {\n    let remoteConsole;\n    // RemoteConsole import may be replaced with null by rollup when bundling\n    // production, so check\n    if (remoteUrl) {\n      remoteConsole = RemoteConsole.reuse(remoteUrl, connectTimeout);\n    } else {\n      remoteConsole = null;\n    }\n\n    const localConsole = new LocalConsole();\n    const sendLog = (level: LevelName, args: unknown[]) => {\n      localConsole[level](...args);\n      if (remoteConsole) {\n        remoteConsole[level](...args);\n      }\n    };\n\n    this.debug = (...args) => sendLog(\"debug\", args);\n    this.log = (...args) => sendLog(\"log\", args);\n    this.info = (...args) => sendLog(\"info\", args);\n    this.warn = (...args) => sendLog(\"warn\", args);\n    this.error = (...args) => sendLog(\"error\", args);\n  }\n}\n","/**\n * @module Debugging\n *\n * @categoryDescription Logging\n * {@link Debugging.LocalConsole | LocalConsole} logs to the local browser\n * console. On iOS devices it uses `console.info` for all levels because of a\n * bug in WebKit whereby other log levels don't show in some remote debuggers.\n * Also, iOS console only supports a single argument, so it joins the given\n * arguments as a single string.\n *\n * {@link Debugging.RemoteConsole | RemoteConsole} connects to a remote\n * {@link https://socket.io/ | socket.io} server and logs messages to it.\n *\n * {@link Console} holds a {@link LocalConsole} and optionally a\n * {@link RemoteConsole} and logs to both.\n *\n * {@link Logger} holds a {@link Console} and implements debug at 10 different\n * levels. The maximum logged level is configurable. Also emits a prefix in\n * debug messages that identifies the instance.\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { settings } from \"@lisn/globals/settings\";\n\nimport { LogFunction } from \"@lisn/globals/types\";\n\nimport { randId } from \"@lisn/utils/text\";\n\nimport { LoggerInterface, LoggerConfig } from \"@lisn/debug/types\";\nimport { Console } from \"@lisn/debug/console\";\n\n/**\n * Holds a {@link Console} and implements debug at 10 different levels. The\n * maximum logged level is configurable. Also emits a prefix in debug messages\n * that identifies the instance.\n *\n * @category Logging\n */\nexport class Logger implements LoggerInterface {\n  readonly debug: LogFunction;\n  readonly log: LogFunction;\n  readonly info: LogFunction;\n  readonly warn: LogFunction;\n  readonly error: LogFunction;\n  readonly debug1: LogFunction;\n  readonly debug2: LogFunction;\n  readonly debug3: LogFunction;\n  readonly debug4: LogFunction;\n  readonly debug5: LogFunction;\n  readonly debug6: LogFunction;\n  readonly debug7: LogFunction;\n  readonly debug8: LogFunction;\n  readonly debug9: LogFunction;\n  readonly debug10: LogFunction;\n  readonly getName: () => string;\n  readonly getVerbosityLevel: () => number;\n  readonly setVerbosityLevel: (level: number) => void;\n\n  constructor(config?: LoggerConfig) {\n    config ??= {};\n    const myConfig = MH.merge(\n      {\n        // set defaults\n        verbosityLevel: settings.verbosityLevel,\n        remoteLoggerURL: settings.remoteLoggerURL,\n        remoteLoggerOnMobileOnly: settings.remoteLoggerOnMobileOnly,\n        debugID: randId(),\n      },\n      config,\n    );\n\n    let remoteLoggerURL = \"\";\n    if (\n      !getBooleanURLParam(\"disableRemoteLog\") &&\n      (myConfig.remoteLoggerOnMobileOnly === false || isMobile())\n    ) {\n      remoteLoggerURL = myConfig.remoteLoggerURL ?? \"\";\n    }\n\n    const name = myConfig.name ?? \"\";\n    const myConsole = new Console(\n      remoteLoggerURL,\n      myConfig.remoteLoggerConnectTimeout,\n    );\n    // use setters bellow to validate value\n    let verbosityLevel = 0;\n    const logPrefix = `[LISN${name ? \": \" + name : \"\"}]`;\n    const debugID = myConfig.debugID;\n    const debugPrefix = `[LISN${(name ? \": \" + name : \"\") + (debugID ? \"-\" + debugID : \"\")}]`;\n\n    this.getName = () => name;\n\n    this.getVerbosityLevel = () => verbosityLevel;\n    this.setVerbosityLevel = (l) => {\n      verbosityLevel = l;\n    };\n\n    this.setVerbosityLevel(myConfig.verbosityLevel ?? 0);\n\n    this.debug1 = (...args) => logDebugN(this, 1, debugPrefix, ...args);\n    this.debug2 = (...args) => logDebugN(this, 2, debugPrefix, ...args);\n    this.debug3 = (...args) => logDebugN(this, 3, debugPrefix, ...args);\n    this.debug4 = (...args) => logDebugN(this, 4, debugPrefix, ...args);\n    this.debug5 = (...args) => logDebugN(this, 5, debugPrefix, ...args);\n    this.debug6 = (...args) => logDebugN(this, 6, debugPrefix, ...args);\n    this.debug7 = (...args) => logDebugN(this, 7, debugPrefix, ...args);\n    this.debug8 = (...args) => logDebugN(this, 8, debugPrefix, ...args);\n    this.debug9 = (...args) => logDebugN(this, 9, debugPrefix, ...args);\n    this.debug10 = (...args) => logDebugN(this, 10, debugPrefix, ...args);\n\n    this.debug = (...args) => myConsole.debug(debugPrefix, ...args);\n    this.log = (...args) => myConsole.log(logPrefix, ...args);\n    this.info = (...args) => myConsole.info(logPrefix, ...args);\n    this.warn = (...args) => myConsole.warn(logPrefix, ...args);\n    this.error = (...args) => {\n      myConsole.error(logPrefix, ...args);\n    };\n\n    // --------------------\n    if (\"logAtCreation\" in myConfig) {\n      this.debug6(\"New logger:\", myConfig.logAtCreation);\n    }\n  }\n}\n\nexport type ErrorMatchList = Array<\n  RegExp | string | { new (): Error } | symbol\n>;\n\n// ----------------------------------------\n\nconst logDebugN = (logger: Logger, level: number, ...args: unknown[]) => {\n  if (!MH.isNumber(level)) {\n    args.unshift(level);\n    level = 1;\n    logger.error(MH.bugError(\"Missing logger.debug level\"));\n  }\n\n  if (logger.getVerbosityLevel() < level) {\n    return;\n  }\n\n  logger.debug(`[DEBUG ${level}]`, ...args);\n};\n\nconst isMobile = () => {\n  const regex =\n    /Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;\n  return regex.test(MH.userAgent);\n};\n\nconst getBooleanURLParam = (name: string) => {\n  const value = getURLParameter(name);\n  return value && (value === \"1\" || MH.toLowerCase(value) === \"true\");\n};\n\nconst getURLParameter = (name: string) => {\n  if (!MH.hasDOM()) {\n    return null;\n  }\n\n  const loc = MH.getDoc().location;\n  if (typeof URLSearchParams !== \"undefined\") {\n    const urlParams = new URLSearchParams(loc.search);\n    return urlParams.get(name);\n  }\n\n  name = MH.strReplace(name, /[[\\]]/g, \"\\\\$&\");\n  const regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n  const match = loc.href.match(regex);\n\n  if (!match) {\n    return null;\n  }\n\n  if (!match[2]) {\n    return \"\";\n  }\n  return decodeURIComponent(MH.strReplace(match[2], /\\+/g, \" \"));\n};\n","/**\n * @module\n * @ignore\n * @internal\n */\n\n// Used internally to allow importing it conditionally based on the bundle\n// type. This module's export is replaced with a dummy null export in\n// production bundles.\nimport { Logger } from \"@lisn/debug/logger\";\nimport { Console } from \"@lisn/debug/console\";\nimport { RemoteConsole } from \"@lisn/debug/remote-console\";\n\nconst result = { Logger, Console, RemoteConsole };\nexport default result as typeof result | null;\n","/**\n * @module Modules/Callback\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { getDebouncedHandler } from \"@lisn/utils/tasks\";\n\nimport debug from \"@lisn/debug/debug\";\n\n/**\n * @typeParam Args See {@link Callback}\n */\nexport type CallbackHandler<Args extends unknown[] = []> = (\n  ...args: Args\n) => CallbackReturnType | Promise<CallbackReturnType>;\n\nexport type CallbackReturnType =\n  | typeof Callback.KEEP\n  | typeof Callback.REMOVE\n  | void;\n\n/**\n * For minification optimization. Exposed through Callback.wrap.\n *\n * @ignore\n * @internal\n */\nexport const wrapCallback = <Args extends unknown[] = []>(\n  handlerOrCallback: CallbackHandler<Args> | Callback<Args>,\n  debounceWindow = 0,\n): Callback<Args> => {\n  const isFunction = MH.isFunction(handlerOrCallback);\n  let isRemoved = () => false;\n\n  if (isFunction) {\n    // check if it's an invoke method\n    const callback = callablesMap.get(handlerOrCallback);\n    if (callback) {\n      return wrapCallback(callback);\n    }\n  } else {\n    isRemoved = handlerOrCallback.isRemoved;\n  }\n\n  const handler: CallbackHandler<Args> = isFunction\n    ? handlerOrCallback\n    : (...args: Args) => handlerOrCallback.invoke(...args);\n\n  const wrapper = new Callback<Args>(\n    getDebouncedHandler(debounceWindow, (...args: Args) => {\n      if (!isRemoved()) {\n        return handler(...args);\n      }\n    }),\n  );\n\n  if (!isFunction) {\n    handlerOrCallback.onRemove(wrapper.remove);\n  }\n\n  return wrapper;\n};\n\n/**\n * {@link Callback} wraps user-supplied callbacks. Supports\n * - removing a callback either when calling {@link remove} or if the user\n *   handler returns {@link Callback.REMOVE}\n * - calling custom {@link onRemove} hooks\n * - debouncing (via {@link wrap})\n * - awaiting on an asynchronous handler and ensuring that the handler does not\n *  run concurrently to itself, i.e. subsequent {@link invoke}s will be queued\n *\n * @typeParam Args The type of arguments that the callback expects.\n */\nexport class Callback<Args extends unknown[] = []> {\n  /**\n   * Possible return value for the handler.\n   *\n   * Do not do anything. Same as not retuning anything from the function.\n   */\n  static readonly KEEP: unique symbol = MC.SYMBOL(\n    \"KEEP\",\n  ) as typeof Callback.KEEP;\n\n  /**\n   * Possible return value for the handler.\n   *\n   * Will remove this callback.\n   */\n  static readonly REMOVE: unique symbol = MC.SYMBOL(\n    \"REMOVE\",\n  ) as typeof Callback.REMOVE;\n\n  /**\n   * Call the handler with the given arguments.\n   *\n   * If the handler is asynchronous, it awaits on it. Furthermore, calls will\n   * always wait for previous calls to this handler to complete first, i.e. it\n   * never runs concurrently to itself. If you need multiple calls to the async\n   * handler to run concurrently, then wrap it in a non-async function that\n   * does not await it.\n   *\n   * The returned promise is rejected in two cases:\n   * - If the callback throws an error or returns a rejected Promise.\n   * - If the callback is removed _after_ you call {@link invoke} but before the\n   *   handler is actually called (while it's waiting in the queue to be called)\n   *   In this case, the rejection reason is {@link Callback.REMOVE}.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the callback is already removed.\n   */\n  readonly invoke: (...args: Args) => Promise<void>;\n\n  /**\n   * Mark the callback as removed and call the registered {@link onRemove} hooks.\n   *\n   * Future attempts to call it will result in\n   * {@link Errors.LisnUsageError | LisnUsageError}.\n   */\n  readonly remove: () => void;\n\n  /**\n   * Returns true if the callback has been removed and cannot be called again.\n   */\n  readonly isRemoved: () => boolean;\n\n  /**\n   * Registers the given function to be called when the callback is removed.\n   *\n   * You can call {@link onRemove} multiple times to register multiple hooks.\n   */\n  readonly onRemove: (fn: () => void) => void;\n\n  /**\n   * Wraps the given handler or callback as a callback, optionally debounced by\n   * the given debounce window.\n   *\n   * If the argument is already a callback _or an invoke method of a callback_,\n   * then the wrapper will call that callback and return the same value as it.\n   * It will also set up the returned wrapper callback so that it is removed\n   * when the original (given) callback is removed. However, removing the\n   * returned wrapper callback will _not_ cause the original callback (being\n   * wrapped) to be removed. If you want to do this, then do\n   * `wrapper.onRemove(wrapped.remove)`.\n   *\n   * Note that if the argument is a callback that's already debounced by a\n   * _larger_ window, then `debounceWindow` will have no effect.\n   *\n   * @param debounceWindow If non-0, the callback will be called at most\n   *                       every `debounceWindow` ms. The arguments it will\n   *                       be called with will be the last arguments the\n   *                       wrapper was called with.\n   */\n  static readonly wrap = wrapCallback;\n\n  /**\n   * @param handler The actual function to call. This should return one of\n   *                the known {@link CallbackReturnType} values.\n   */\n  constructor(handler: CallbackHandler<Args>) {\n    const logger = debug\n      ? new debug.Logger({ name: \"Callback\", logAtCreation: handler })\n      : null;\n\n    let isRemoved = false;\n    const id = MC.SYMBOL();\n\n    const onRemove = MH.newSet<() => void>();\n\n    this.isRemoved = () => isRemoved;\n\n    this.remove = () => {\n      if (!isRemoved) {\n        debug: logger?.debug8(\"Removing\");\n        isRemoved = true;\n\n        for (const rmFn of onRemove) {\n          rmFn();\n        }\n\n        CallbackScheduler._clear(id);\n      }\n    };\n\n    this.onRemove = (fn) => onRemove.add(fn);\n\n    this.invoke = (...args) =>\n      MH.newPromise((resolve, reject) => {\n        debug: logger?.debug8(\"Calling with\", args);\n        if (isRemoved) {\n          reject(MH.usageError(\"Callback has been removed\"));\n          return;\n        }\n\n        CallbackScheduler._push(\n          id,\n          async () => {\n            let result;\n            try {\n              result = await handler(...args);\n            } catch (err) {\n              reject(err);\n            }\n\n            if (result === Callback.REMOVE) {\n              this.remove();\n            }\n\n            resolve();\n          },\n          reject,\n        );\n      });\n\n    callablesMap.set(this.invoke, this);\n  }\n}\n\n// ----------------------------------------\n\ntype CallbackSchedulerTask = () => Promise<void>;\ntype CallbackSchedulerQueueItem = {\n  _task: CallbackSchedulerTask;\n  _running: boolean;\n  _onRemove: (reason: typeof Callback.REMOVE) => void;\n};\n\ntype CallableCallback<Args extends unknown[] = []> = (...args: Args) => void;\n\nconst callablesMap = MH.newWeakMap<CallableCallback, Callback>();\n\nconst CallbackScheduler = (() => {\n  const queues = MH.newMap<symbol, CallbackSchedulerQueueItem[]>();\n\n  const flush = async (queue: CallbackSchedulerQueueItem[]) => {\n    // So that callbacks are always called asynchronously for consistency,\n    // await here before calling 1st\n    await null;\n    while (MH.lengthOf(queue)) {\n      // shouldn't throw anything as Callback must catch errors\n      queue[0]._running = true;\n      await queue[0]._task();\n\n      // only remove when done\n      queue.shift();\n    }\n  };\n\n  return {\n    _clear: (id: symbol) => {\n      const queue = queues.get(id);\n      if (queue) {\n        let item: CallbackSchedulerQueueItem | undefined;\n        while ((item = queue.shift())) {\n          if (!item._running) {\n            item._onRemove(Callback.REMOVE);\n          }\n        }\n\n        MH.deleteKey(queues, id);\n      }\n    },\n\n    _push: (id: symbol, task: CallbackSchedulerTask, onRemove: () => void) => {\n      let queue = queues.get(id);\n      if (!queue) {\n        queue = [];\n        queues.set(id, queue);\n      }\n\n      queue.push({ _task: task, _onRemove: onRemove, _running: false });\n      if (MH.lengthOf(queue) === 1) {\n        flush(queue);\n      }\n    },\n  };\n})();\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { LogFunction } from \"@lisn/globals/types\";\n\nimport { joinAsString } from \"@lisn/utils/text\";\n\nimport { Callback } from \"@lisn/modules/callback\";\n\n/**\n * Like `console.info` except if the string representation of the given\n * arguments has already been logged, it does nothing.\n *\n * @category Logging\n */\nexport const logInfo: LogFunction = (...args) => {\n  if (!isMessageSeen(args)) {\n    MH.consoleInfo(MC.LOG_PREFIX, ...args);\n  }\n};\n\n/**\n * Like `console.warn` except if the string representation of the given\n * arguments has already been logged, it does nothing.\n *\n * @category Logging\n */\nexport const logWarn: LogFunction = (...args) => {\n  if (!isMessageSeen(args)) {\n    MH.consoleWarn(MC.LOG_PREFIX, ...args);\n  }\n};\n\n/**\n * Like `console.error` except if the string representation of the given\n * arguments has already been logged, it does nothing.\n *\n * @category Logging\n */\nexport const logError: LogFunction = (...args) => {\n  if (\n    (MH.lengthOf(args) > 1 || args[0] !== Callback.REMOVE) &&\n    !isMessageSeen(args)\n  ) {\n    MH.consoleError(MC.LOG_PREFIX, ...args);\n  }\n};\n\nconst discardMessages = MH.newSet<string>();\nconst isMessageSeen = (args: unknown[]) => {\n  const msg = joinAsString(\" \", ...args);\n  const isSeen = discardMessages.has(msg);\n  discardMessages.add(msg);\n  return isSeen;\n};\n","/**\n * @module Utils\n *\n * @categoryDescription DOM: Preventing layout trashing\n *\n * {@link waitForMeasureTime} allows you to schedule tasks that read or\n * \"measure\", the DOM, for example getting computed styles, taking the\n * `offsetWidth` or the `scrollTop` of an element, etc... anything that _would_\n * force a layout if it runs after the layout has been invalidated by a\n * \"mutation\".\n *\n * See https://gist.github.com/paulirish/5d52fb081b3570c81e3 for a list of\n * operations that should be run on a valid layout to avoid forced layouts.\n *\n * {@link waitForMutateTime} allows you to schedule tasks that invalidate the\n * DOM layout by making changes to the style, inserting or removing elements,\n * etc.\n *\n * These ensure that:\n * - All mutation tasks that would invalidate the style run together before the\n *   next repaint.\n * - All measurement tasks that need a valid style will run as soon as possible\n *   after the next repaint.\n * - If a mutation task is scheduled by another mutation task, it will run in\n *   the same batch.\n * - If a measurement task is scheduled by either a mutation or another\n *   measurement task, it will run in the same batch.\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { logError } from \"@lisn/utils/log\";\nimport { scheduleHighPriorityTask } from \"@lisn/utils/tasks\";\n\n/**\n * Returns a Promise that is resolved before the next repaint.\n *\n * @category DOM: Preventing layout trashing\n */\nexport const waitForMutateTime = () =>\n  MH.newPromise<void>((resolve) => {\n    scheduleDOMTask(scheduledDOMMutations, resolve);\n  });\n\n/**\n * Returns a Promise that is resolved as soon as possible after the next\n * repaint.\n *\n * @category DOM: Preventing layout trashing\n */\nexport const waitForMeasureTime = () =>\n  MH.newPromise<void>((resolve) => {\n    scheduleDOMTask(scheduledDOMMeasurements, resolve);\n  });\n\n/**\n * Returns a Promise that is resolved before the repaint that follows the next\n * repaint.\n *\n * @category DOM: Preventing layout trashing\n */\nexport const waitForSubsequentMutateTime = () =>\n  waitForMutateTime().then(waitForMeasureTime).then(waitForMutateTime);\n\n/**\n * Returns a Promise that is resolved as soon as possible after the repaint\n * that follows the next repaint.\n *\n * @category DOM: Preventing layout trashing\n */\nexport const waitForSubsequentMeasureTime = () =>\n  waitForMeasureTime().then(waitForMutateTime).then(waitForMeasureTime);\n\n/**\n * @ignore\n * @internal\n *\n * @since v1.2.0\n */\nexport const asyncMutatorFor =\n  <Args extends unknown[], Ret>(func: (...args: Args) => Ret) =>\n  async (...args: Args) =>\n    waitForMutateTime().then(() => func(...args));\n\n/**\n * @ignore\n * @internal\n *\n * @since v1.2.0\n */\nexport const asyncMeasurerFor =\n  <Args extends unknown[], Ret>(func: (...args: Args) => Ret) =>\n  async (...args: Args) =>\n    waitForMeasureTime().then(() => func(...args));\n\n// ----------------------------------------\n\ntype TaskResolver = () => void;\ntype DOMTaskQueue = TaskResolver[];\n\nconst scheduledDOMMeasurements: DOMTaskQueue = [];\nconst scheduledDOMMutations: DOMTaskQueue = [];\nlet hasScheduledDOMTasks = false;\n\nconst scheduleDOMTask = (queue: DOMTaskQueue, resolve: TaskResolver) => {\n  queue.push(resolve);\n  if (!hasScheduledDOMTasks) {\n    hasScheduledDOMTasks = true;\n    MH.onAnimationFrame(runAllDOMTasks);\n  }\n};\n\nconst runAllDOMTasks = async () => {\n  // We suspend (await null) after each queue to ensure that microtasks that\n  // have been added by await waitFor* or waitFor*().then run before the next\n  // queue, so that if they schedule more measurements and/or mutations, they\n  // can be flushed now, in the same batch.\n\n  // We're inside an animation frame. Run all mutation tasks now.\n  while (MH.lengthOf(scheduledDOMMutations)) {\n    runDOMTaskQueue(scheduledDOMMutations);\n    // wait for tasks awaiting on the resolved promises, then check queue again\n    await null;\n  }\n\n  // The measurement queue is now empty => scheduling measurements after\n  // this point will result in rescheduling both queues again in the next\n  // frame.\n  //\n  // Schedule the measurement tasks as soon as possible, after the upcoming\n  // paint. Use a macro task with as high priority as possible.\n  scheduleHighPriorityTask(async () => {\n    while (MH.lengthOf(scheduledDOMMeasurements)) {\n      runDOMTaskQueue(scheduledDOMMeasurements);\n      // wait for tasks awaiting on the resolved promises, then check queue again\n      await null;\n    }\n\n    if (MH.lengthOf(scheduledDOMMutations)) {\n      // There have been mutations added. Schedule another flush.\n      MH.onAnimationFrame(runAllDOMTasks);\n    } else {\n      hasScheduledDOMTasks = false;\n    }\n  });\n};\n\nconst runDOMTaskQueue = (queue: DOMTaskQueue) => {\n  let resolve: TaskResolver | undefined;\n  while ((resolve = queue.shift())) {\n    try {\n      resolve();\n    } catch (err) /* istanbul ignore next */ {\n      logError(err);\n    }\n  }\n};\n","/**\n * @module Utils\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { DOMElement } from \"@lisn/globals/types\";\n\n/**\n * Returns all the child elements of the given element that are not `script` or\n * `style` tags.\n *\n * @category DOM: Querying\n */\nexport const getVisibleContentChildren = (element: Element) =>\n  MH.filter([...MH.childrenOf(element)], (ch) =>\n    isVisibleContentTag(MH.tagName(ch)),\n  );\n\n/**\n * Returns whether the given tag is _not_ `script` or `style`. Comparison is\n * case insensitive.\n *\n * @category DOM: Querying\n */\nexport const isVisibleContentTag = (tagName: string) =>\n  !MH.includes([\"script\", \"style\"], MH.toLowerCase(tagName));\n\n/**\n * Returns whether the given tag name has by default an inline display.\n * Comparison is case insensitive.\n *\n * @category DOM: Querying\n */\nexport const isInlineTag = (tagName: string) =>\n  inlineTags.has(tagName.toLowerCase());\n\n/**\n * Returns whether the given element is as {@link DOMElement}.\n *\n * @category DOM: Querying\n */\nexport const isDOMElement = (target: unknown): target is DOMElement =>\n  MH.isHTMLElement(target) ||\n  MH.isInstanceOf(target, SVGElement) ||\n  (typeof MathMLElement !== \"undefined\" &&\n    MH.isInstanceOf(target, MathMLElement));\n\n// --------------------\n\nconst inlineTags = MH.newSet([\n  \"a\",\n  \"abbr\",\n  \"acronym\",\n  \"b\",\n  \"bdi\",\n  \"bdo\",\n  \"big\",\n  \"button\",\n  \"cite\",\n  \"code\",\n  \"data\",\n  \"dfn\",\n  \"em\",\n  \"i\",\n  \"img\",\n  \"input\",\n  \"kbd\",\n  \"label\",\n  \"mark\",\n  \"map\",\n  \"object\",\n  \"output\",\n  \"q\",\n  \"rp\",\n  \"rt\",\n  \"ruby\",\n  \"s\",\n  \"samp\",\n  \"script\",\n  \"select\",\n  \"small\",\n  \"span\",\n  \"strong\",\n  \"sub\",\n  \"sup\",\n  \"textarea\",\n  \"time\",\n  \"tt\",\n  \"u\",\n  \"var\",\n]);\n","/**\n * @module Utils\n *\n * @categoryDescription CSS: Altering\n * These functions transition an element from one CSS class to another, but\n * could lead to forced layout if not scheduled using {@link waitForMutateTime}.\n * If a delay is supplied, then the transition is \"scheduled\" and if the\n * opposite transition is executed before the scheduled one, the original one\n * is cancelled. See {@link transitionElement} for an example.\n *\n * @categoryDescription CSS: Altering (optimized)\n * These functions transition an element from one CSS class to another in an\n * optimized way using {@link waitForMutateTime} and so are asynchronous.\n * If a delay is supplied, then the transition is \"scheduled\" and if the\n * opposite transition is executed before the scheduled one, the original one\n * is cancelled. See {@link transitionElement} for an example.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { DOMElement, FlexDirection } from \"@lisn/globals/types\";\n\nimport {\n  waitForMeasureTime,\n  waitForMutateTime,\n  asyncMeasurerFor,\n  asyncMutatorFor,\n  waitForSubsequentMutateTime,\n} from \"@lisn/utils/dom-optimize\";\nimport { isDOMElement } from \"@lisn/utils/dom-query\";\nimport { isValidNum, roundNumTo } from \"@lisn/utils/math\";\nimport { waitForDelay } from \"@lisn/utils/tasks\";\nimport { camelToKebabCase, splitOn } from \"@lisn/utils/text\";\n\n/**\n * Removes the given `fromCls` class and adds the given `toCls` class to the\n * element.\n *\n * Unlike {@link https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList/replace | DOMTokenList:replace},\n * this will always add `toCls` even if `fromCls` isn't in the element's class list.\n *\n * @returns True if there was a change made (class removed or added), false\n * otherwise.\n *\n * @category CSS: Altering\n */\nexport const transitionElementNow = (\n  element: Element,\n  fromCls: string,\n  toCls: string,\n) => {\n  cancelCSSTransitions(element, fromCls, toCls);\n\n  // Avoid triggering MutationObserver unnecessarily.\n  let didChange = false;\n  if (hasClass(element, fromCls)) {\n    didChange = true;\n    removeClassesNow(element, fromCls);\n  }\n\n  if (!hasClass(element, toCls)) {\n    addClassesNow(element, toCls);\n    didChange = true;\n  }\n\n  return didChange;\n};\n\n/**\n * Like {@link transitionElementNow} except it will {@link waitForMutateTime},\n * and optionally a delay, and it finally awaits for the effective style's\n * transition-duration.\n *\n * If a delay is supplied, then the transition is \"scheduled\" and if the\n * opposite transition is executed before the scheduled one, this one is\n * cancelled.\n *\n * @example\n *\n * - {@link showElement} with delay of 100 schedules `lisn-hide` -> `lisn-show`\n *   in 100ms\n * - then if {@link hideElementNow} is called, or a scheduled\n *   {@link hideElement} completes  before that timer runs out, this call to\n *   {@link showElement} aborts\n *\n * ```javascript\n * hideElement(someElement, 10);\n * // this will be aborted in 10ms when the scheduled hideElement above\n * // completes\n * showElement(someElement, 100);\n * ```\n *\n * ```javascript\n * // this will be aborted in 10ms when the hideElement that will be scheduled\n * // below completes\n * showElement(someElement, 100);\n * hideElement(someElement, 10);\n * ```\n *\n * ```javascript\n * // this will be aborted immediately by hideElementNow that runs straight\n * // afterwards\n * showElement(someElement, 100);\n * hideElementNow(someElement);\n * ```\n *\n * ```javascript\n * hideElementNow(someElement);\n * // this will NOT be aborted because hideElementNow has completed already\n * showElement(someElement, 100);\n * ```\n *\n * @category CSS: Altering (optimized)\n */\nexport const transitionElement = async (\n  element: Element,\n  fromCls: string,\n  toCls: string,\n  delay = 0,\n) => {\n  const thisTransition = scheduleCSSTransition(element, toCls);\n\n  if (delay) {\n    await waitForDelay(delay);\n  }\n\n  await waitForMutateTime();\n  if (thisTransition._isCancelled()) {\n    // it has been overridden by a later transition\n    return false;\n  }\n\n  const didChange = transitionElementNow(element, fromCls, toCls);\n  thisTransition._finish();\n\n  if (!didChange) {\n    return false;\n  }\n\n  // Await for the transition duration so that caller awaiting on us knows when\n  // it's complete.\n  const transitionDuration = await getMaxTransitionDuration(element);\n  if (transitionDuration) {\n    await waitForDelay(transitionDuration);\n  }\n\n  return true;\n};\n\n/**\n * Transitions an element from class `lisn-undisplay` (which applies `display:\n * none`) to `lisn-display` (no style associated with this).\n *\n * The difference between this and simply removing the `lisn-undisplay` class\n * is that previously scheduled transitions to `lisn-undisplay` will be\n * cancelled.\n *\n * @see {@link transitionElementNow}\n *\n * @category CSS: Altering\n */\nexport const displayElementNow = (element: Element) =>\n  transitionElementNow(element, MC.PREFIX_UNDISPLAY, MC.PREFIX_DISPLAY);\n\n/**\n * Like {@link displayElementNow} except it will {@link waitForMutateTime}, and\n * optionally a delay.\n *\n * @see {@link transitionElement}\n *\n * @category CSS: Altering (optimized)\n */\nexport const displayElement = (element: Element, delay = 0) =>\n  transitionElement(element, MC.PREFIX_UNDISPLAY, MC.PREFIX_DISPLAY, delay);\n\n/**\n * The opposite of {@link displayElementNow}.\n *\n * @see {@link transitionElementNow}\n *\n * @category CSS: Altering\n */\nexport const undisplayElementNow = (element: Element) =>\n  transitionElementNow(element, MC.PREFIX_DISPLAY, MC.PREFIX_UNDISPLAY);\n\n/**\n * Like {@link undisplayElementNow} except it will {@link waitForMutateTime},\n * and optionally a delay.\n *\n * @see {@link transitionElement}\n *\n * @category CSS: Altering (optimized)\n */\nexport const undisplayElement = (element: Element, delay = 0) =>\n  transitionElement(element, MC.PREFIX_DISPLAY, MC.PREFIX_UNDISPLAY, delay);\n\n/**\n * Transitions an element from class `lisn-hide` (which makes the element\n * hidden) to `lisn-show` (which shows it). These classes have CSS\n * transitions applied so the element is faded into and out of view.\n *\n * @see {@link transitionElementNow}.\n *\n * @category CSS: Altering\n */\nexport const showElementNow = (element: Element) =>\n  transitionElementNow(element, MC.PREFIX_HIDE, MC.PREFIX_SHOW);\n\n/**\n * Like {@link showElementNow} except it will {@link waitForMutateTime}, and\n * optionally a delay.\n *\n * @see {@link transitionElement}\n *\n * @category CSS: Altering (optimized)\n */\nexport const showElement = (element: Element, delay = 0) =>\n  transitionElement(element, MC.PREFIX_HIDE, MC.PREFIX_SHOW, delay);\n\n/**\n * The opposite of {@link showElementNow}.\n *\n * @see {@link transitionElementNow}\n *\n * @category CSS: Altering\n */\nexport const hideElementNow = (element: Element) =>\n  transitionElementNow(element, MC.PREFIX_SHOW, MC.PREFIX_HIDE);\n\n/**\n * Like {@link hideElementNow} except it will {@link waitForMutateTime}, and\n * optionally a delay.\n *\n * @see {@link transitionElement}\n *\n * @category CSS: Altering (optimized)\n */\nexport const hideElement = (element: Element, delay = 0) =>\n  transitionElement(element, MC.PREFIX_SHOW, MC.PREFIX_HIDE, delay);\n\n/**\n * If {@link isElementUndisplayed}, it will {@link displayElementNow},\n * otherwise it will {@link undisplayElementNow}.\n *\n * @see {@link transitionElementNow}\n *\n * @category CSS: Altering\n */\nexport const toggleDisplayElementNow = (element: Element) =>\n  isElementUndisplayed(element)\n    ? displayElementNow(element)\n    : undisplayElementNow(element);\n\n/**\n * Like {@link toggleDisplayElementNow} except it will {@link waitForMutateTime},\n * and optionally a delay.\n *\n * @see {@link transitionElement}\n *\n * @category CSS: Altering (optimized)\n */\nexport const toggleDisplayElement = (element: Element, delay = 0) =>\n  isElementUndisplayed(element)\n    ? displayElement(element, delay)\n    : undisplayElement(element, delay);\n\n/**\n * If {@link isElementHidden}, it will {@link showElementNow}, otherwise\n * {@link hideElementNow}.\n *\n * @see {@link transitionElementNow}\n *\n * @category CSS: Altering\n */\nexport const toggleShowElementNow = (element: Element) =>\n  isElementHidden(element) ? showElementNow(element) : hideElementNow(element);\n\n/**\n * Like {@link toggleShowElementNow} except it will {@link waitForMutateTime}, and\n * optionally a delay.\n *\n * @see {@link transitionElement}\n *\n * @category CSS: Altering (optimized)\n */\nexport const toggleShowElement = (element: Element, delay = 0) =>\n  isElementHidden(element)\n    ? showElement(element, delay)\n    : hideElement(element, delay);\n\n/**\n * Returns true if the element's class list contains `lisn-hide`.\n *\n * @category CSS: Altering (optimized)\n */\nexport const isElementHidden = (element: Element) =>\n  hasClass(element, MC.PREFIX_HIDE);\n\n/**\n * Returns true if the element's class list contains `lisn-undisplay`.\n *\n * @category CSS: Altering (optimized)\n */\nexport const isElementUndisplayed = (element: Element) =>\n  hasClass(element, MC.PREFIX_UNDISPLAY);\n\n/**\n * Returns true if the element's class list contains the given class.\n *\n * @category CSS: Altering (optimized)\n */\nexport const hasClass = (element: Element, className: string) =>\n  MH.classList(element).contains(className);\n\n/**\n * Returns true if the element's class list contains all of the given classes.\n *\n * @since v1.2.0\n *\n * @category CSS: Altering (optimized)\n */\nexport const hasAllClasses = (element: Element, ...classNames: string[]) =>\n  MH.lengthOf(classNames) > 0 &&\n  !MH.some(classNames, (className) => !hasClass(element, className));\n\n/**\n * Returns true if the element's class list contains any of the given classes.\n *\n * @since v1.2.0\n *\n * @category CSS: Altering (optimized)\n */\nexport const hasAnyClass = (element: Element, ...classNames: string[]) =>\n  MH.some(classNames, (className) => hasClass(element, className));\n\n/**\n * Adds the given classes to the element.\n *\n * @category CSS: Altering\n */\nexport const addClassesNow = (element: Element, ...classNames: string[]) =>\n  MH.classList(element).add(...classNames);\n\n/**\n * Like {@link addClassesNow} except it will {@link waitForMutateTime}.\n *\n * @category CSS: Altering (optimized)\n */\nexport const addClasses = asyncMutatorFor(addClassesNow);\n\n/**\n * Removes the given classes to the element.\n *\n * @category CSS: Altering\n */\nexport const removeClassesNow = (element: Element, ...classNames: string[]) =>\n  MH.classList(element).remove(...classNames);\n\n/**\n * Like {@link removeClassesNow} except it will {@link waitForMutateTime}.\n *\n * @category CSS: Altering (optimized)\n */\nexport const removeClasses = asyncMutatorFor(removeClassesNow);\n\n/**\n * Toggles the given class on the element.\n *\n * @param force See {@link https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList/toggle | DOMTokenList:toggle}\n *\n * @category CSS: Altering\n */\nexport const toggleClassNow = (\n  element: Element,\n  className: string,\n  force?: boolean,\n) => MH.classList(element).toggle(className, force);\n\n/**\n * Like {@link toggleClassNow} except it will {@link waitForMutateTime}.\n *\n * @category CSS: Altering (optimized)\n */\nexport const toggleClass = asyncMutatorFor(toggleClassNow);\n\n/**\n * Toggles the given classes on the element. This function does not accept the\n * `force` parameter.\n *\n * @since v1.2.0\n *\n * @category CSS: Altering\n */\nexport const toggleClassesNow = (element: Element, ...classNames: string[]) => {\n  for (const cls of classNames) {\n    toggleClassNow(element, cls);\n  }\n};\n\n/**\n * Like {@link toggleClassesNow} except it will {@link waitForMutateTime}.\n *\n * @since v1.2.0\n *\n * @category CSS: Altering (optimized)\n */\nexport const toggleClasses = asyncMutatorFor(toggleClassesNow);\n\n/**\n * Replaces the given class on the element with a new one.\n *\n * @param force See {@link https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList/replace | DOMTokenList:replace}\n *\n * @since v1.2.0\n *\n * @category CSS: Altering\n */\nexport const replaceClassNow = (\n  element: Element,\n  oldClassName: string,\n  newClassName: string,\n) => MH.classList(element).replace(oldClassName, newClassName);\n\n/**\n * Like {@link replaceClassNow} except it will {@link waitForMutateTime}.\n *\n * @since v1.2.0\n *\n * @category CSS: Altering (optimized)\n */\nexport const replaceClass = asyncMutatorFor(replaceClassNow);\n\n// For *Data: to avoid unnecessary type checking that ensures element is\n// HTMLElement or SVGElement, use getAttribute instead of dataset.\n\n/**\n * Returns the value of the given data attribute. The name of the attribute\n * must _not_ start with `data`. It can be in either camelCase or kebab-case,\n * it is converted as needed.\n *\n * @category CSS: Altering (optimized)\n */\nexport const getData = (element: Element, name: string) =>\n  MH.getAttr(element, MH.prefixData(name));\n\n/**\n * Returns the value of the given data attribute as a boolean. Its value is\n * expected to be either blank or \"true\" (which result in `true`), or \"false\"\n * (which results in `false`).\n *\n * The name of the attribute must _not_ start with `data`. It can be in either\n * camelCase or kebab-case, it is converted as needed.\n *\n * @since v1.2.0\n *\n * @category CSS: Altering (optimized)\n */\nexport const getBooleanData = (element: Element, name: string) => {\n  const value = getData(element, name);\n  return value !== null && value !== \"false\";\n};\n\n/**\n * @ignore\n * @deprecated\n */\nexport const getBoolData = getBooleanData;\n\n/**\n * Sets the given data attribute.\n *\n * The name of the attribute must _not_ start with `data`. It can be in either\n * camelCase or kebab-case, it is converted as needed.\n *\n * @category CSS: Altering\n */\nexport const setDataNow = (element: Element, name: string, value: string) =>\n  MH.setAttr(element, MH.prefixData(name), value);\n\n/**\n * Like {@link setDataNow} except it will {@link waitForMutateTime}.\n *\n * @category CSS: Altering (optimized)\n */\nexport const setData = asyncMutatorFor(setDataNow);\n\n/**\n * Sets the given data attribute with value \"true\" (default) or \"false\".\n *\n * The name of the attribute must _not_ start with `data`. It can be in either\n * camelCase or kebab-case, it is converted as needed.\n *\n * @since v1.2.0\n *\n * @category CSS: Altering\n */\nexport const setBooleanDataNow = (\n  element: Element,\n  name: string,\n  value = true,\n) => MH.setAttr(element, MH.prefixData(name), value + \"\");\n\n/**\n * @ignore\n * @deprecated\n */\nexport const setBoolDataNow = setBooleanDataNow;\n\n/**\n * Like {@link setBooleanDataNow} except it will {@link waitForMutateTime}.\n *\n * @since v1.2.0\n *\n * @category CSS: Altering (optimized)\n */\nexport const setBooleanData = asyncMutatorFor(setBooleanDataNow);\n\n/**\n * @ignore\n * @deprecated\n */\nexport const setBoolData = setBooleanData;\n\n/**\n * Sets the given data attribute with value \"false\".\n *\n * The name of the attribute must _not_ start with `data`. It can be in either\n * camelCase or kebab-case, it is converted as needed.\n *\n * @since v1.2.0\n *\n * @category CSS: Altering\n */\nexport const unsetBooleanDataNow = (element: Element, name: string) =>\n  MH.unsetAttr(element, MH.prefixData(name));\n\n/**\n * @ignore\n * @deprecated\n */\nexport const unsetBoolDataNow = unsetBooleanDataNow;\n\n/**\n * Like {@link unsetBooleanDataNow} except it will {@link waitForMutateTime}.\n *\n * @since v1.2.0\n *\n * @category CSS: Altering (optimized)\n */\nexport const unsetBooleanData = asyncMutatorFor(unsetBooleanDataNow);\n\n/**\n * @ignore\n * @deprecated\n */\nexport const unsetBoolData = unsetBooleanData;\n\n/**\n * Deletes the given data attribute.\n *\n * The name of the attribute must _not_ start with `data`. It can be in either\n * camelCase or kebab-case, it is converted as needed.\n *\n * @category CSS: Altering\n */\nexport const delDataNow = (element: Element, name: string) =>\n  MH.delAttr(element, MH.prefixData(name));\n\n/**\n * Like {@link delDataNow} except it will {@link waitForMutateTime}.\n *\n * @category CSS: Altering (optimized)\n */\nexport const delData = asyncMutatorFor(delDataNow);\n\n/**\n * Returns the value of the given property from the computed style of the\n * element.\n *\n * @category DOM: Altering\n */\nexport const getComputedStylePropNow = (element: Element, prop: string) =>\n  getComputedStyle(element).getPropertyValue(prop);\n\n/**\n * Like {@link getComputedStylePropNow} except it will {@link waitForMeasureTime}.\n *\n * @category DOM: Altering (optimized)\n */\nexport const getComputedStyleProp = asyncMeasurerFor(getComputedStylePropNow);\n\n/**\n * Returns the value of the given property from the inline style of the\n * element.\n *\n * @category DOM: Altering\n */\nexport const getStylePropNow = (element: Element, prop: string) =>\n  (element as DOMElement).style?.getPropertyValue(prop);\n\n/**\n * Like {@link getStylePropNow} except it will {@link waitForMeasureTime}.\n *\n * @category DOM: Altering (optimized)\n */\nexport const getStyleProp = asyncMeasurerFor(getStylePropNow);\n\n/**\n * Sets the given property on the inline style of the element.\n *\n * @category DOM: Altering\n */\nexport const setStylePropNow = (\n  element: Element,\n  prop: string,\n  value: string,\n) => (element as DOMElement).style?.setProperty(prop, value);\n\n/**\n * Like {@link setStylePropNow} except it will {@link waitForMutateTime}.\n *\n * @category DOM: Altering (optimized)\n */\nexport const setStyleProp = asyncMutatorFor(setStylePropNow);\n\n/**\n * Deletes the given property on the inline style of the element.\n *\n * @category DOM: Altering\n */\nexport const delStylePropNow = (element: Element, prop: string) =>\n  (element as DOMElement).style?.removeProperty(prop);\n\n/**\n * Like {@link delStylePropNow} except it will {@link waitForMutateTime}.\n *\n * @category DOM: Altering (optimized)\n */\nexport const delStyleProp = asyncMutatorFor(delStylePropNow);\n\n/**\n * Returns the flex direction of the given element **if it has a flex layout**.\n *\n * @returns `null` if the element does not have a flex layout.\n *\n * @since v1.2.0\n */\nexport const getFlexDirection = async (\n  element: Element,\n): Promise<FlexDirection | null> => {\n  const displayStyle = await getComputedStyleProp(element, \"display\");\n  if (!displayStyle.includes(\"flex\")) {\n    return null;\n  }\n\n  return (await getComputedStyleProp(\n    element,\n    \"flex-direction\",\n  )) as FlexDirection;\n};\n\n/**\n * Returns the flex direction of the given element's parent **if it has a flex\n * layout**.\n *\n * @returns `null` if the element's parent does not have a flex layout.\n *\n * @since v1.2.0\n */\nexport const getParentFlexDirection = async (\n  element: Element,\n): Promise<FlexDirection | null> => {\n  const parent = MH.parentOf(element);\n  return parent ? getFlexDirection(parent) : null;\n};\n\n/**\n * Returns true if the given element has a flex layout. If direction is given,\n * then it also needs to match.\n *\n * @since v1.2.0\n */\nexport const isFlex = async (element: Element, direction?: FlexDirection) => {\n  const flexDirection = await getFlexDirection(element);\n\n  if (direction) {\n    return direction === flexDirection;\n  }\n\n  return flexDirection !== null;\n};\n\n/**\n * Returns true if the given element's parent has a flex layout. If direction is\n * given, then it also needs to match.\n *\n * @since v1.2.0\n */\nexport const isFlexChild = async (\n  element: Element,\n  direction?: FlexDirection,\n) => {\n  const parent = MH.parentOf(element);\n  return parent ? isFlex(parent, direction) : false;\n};\n\n/**\n * In milliseconds.\n *\n * @ignore\n * @internal\n */\nexport const getMaxTransitionDuration = async (element: Element) => {\n  const propVal = await getComputedStyleProp(element, \"transition-duration\");\n\n  return MH.max(\n    ...splitOn(propVal, \",\", true).map((strValue) => {\n      let duration = MH.parseFloat(strValue) || 0;\n\n      if (strValue === duration + \"s\") {\n        duration *= 1000;\n      }\n\n      return duration;\n    }),\n  );\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const disableInitialTransition = async (element: Element, delay = 0) => {\n  await addClasses(element, MC.PREFIX_TRANSITION_DISABLE);\n  if (delay) {\n    await waitForDelay(delay);\n  }\n\n  await waitForSubsequentMutateTime();\n  removeClassesNow(element, MC.PREFIX_TRANSITION_DISABLE);\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const setHasModal = () => setBooleanData(MH.getBody(), PREFIX_HAS_MODAL);\n\n/**\n * @ignore\n * @internal\n */\nexport const delHasModal = () => delData(MH.getBody(), PREFIX_HAS_MODAL);\n\n/**\n * @ignore\n * @internal\n */\nexport const copyStyle = async (\n  fromElement: Element,\n  toElement: Element,\n  includeComputedProps?: string[],\n) => {\n  if (!isDOMElement(fromElement) || !isDOMElement(toElement)) {\n    return;\n  }\n\n  await waitForMeasureTime();\n  const props: Record<string, string> = {};\n\n  if (includeComputedProps) {\n    for (const prop of includeComputedProps) {\n      props[prop] = getComputedStylePropNow(fromElement, prop);\n    }\n  }\n\n  const style = fromElement.style; // only inline styles\n  for (const prop in style) {\n    const value = style.getPropertyValue(prop);\n    if (value) {\n      props[prop] = value;\n    }\n  }\n\n  for (const prop in props) {\n    setStyleProp(toElement, prop, props[prop]);\n  }\n\n  addClasses(toElement, ...MH.classList(fromElement));\n};\n\n/**\n * If the props keys are in camelCase they are converted to kebab-case\n *\n * If a value is null or undefined, the property is deleted.\n *\n * @ignore\n * @internal\n */\nexport const setNumericStyleJsVarsNow = (\n  element: Element,\n  props: CssNumericProps,\n  options: {\n    _prefix?: string;\n    _units?: string;\n    _numDecimal?: number;\n  } = {},\n) => {\n  if (!isDOMElement(element)) {\n    return;\n  }\n\n  const varPrefix = MH.prefixCssJsVar(options?._prefix ?? \"\");\n  for (const prop in props) {\n    const cssPropSuffix = camelToKebabCase(prop);\n    const varName = `${varPrefix}${cssPropSuffix}`;\n\n    let value: number | null;\n\n    if (!isValidNum(props[prop])) {\n      value = null;\n    } else {\n      value = props[prop];\n      const thisNumDecimal =\n        options?._numDecimal ?? (value > 0 && value < 1 ? 2 : 0);\n      value = roundNumTo(value, thisNumDecimal);\n    }\n\n    if (value === null) {\n      delStylePropNow(element, varName);\n    } else {\n      setStylePropNow(element, varName, value + (options?._units ?? \"\"));\n    }\n  }\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const setNumericStyleJsVars = asyncMutatorFor(setNumericStyleJsVarsNow);\n\n// ----------------------------------------\n\ntype CssNumericProps = Record<string, number | undefined | null>;\n\ntype CSSTransition = {\n  _cancel: () => undefined;\n  _finish: () => undefined;\n  _isCancelled: () => boolean;\n};\n\nconst PREFIX_HAS_MODAL = MH.prefixName(\"has-modal\");\n\nconst scheduledCSSTransitions = MH.newWeakMap<\n  Element,\n  Record<string, CSSTransition>\n>();\n\nconst cancelCSSTransitions = (element: Element, ...toClasses: string[]) => {\n  const scheduledTransitions = scheduledCSSTransitions.get(element);\n  if (!scheduledTransitions) {\n    return;\n  }\n\n  for (const toCls of toClasses) {\n    const scheduledTransition = scheduledTransitions[toCls];\n    if (scheduledTransition) {\n      scheduledTransition._cancel();\n    }\n  }\n};\n\nconst scheduleCSSTransition = (element: Element, toCls: string) => {\n  let scheduledTransitions = scheduledCSSTransitions.get(element);\n  if (!scheduledTransitions) {\n    scheduledTransitions = {};\n    scheduledCSSTransitions.set(element, scheduledTransitions);\n  }\n\n  let isCancelled = false;\n  scheduledTransitions[toCls] = {\n    _cancel: () => {\n      isCancelled = true;\n      MH.deleteObjKey(scheduledTransitions, toCls);\n    },\n    _finish: () => {\n      MH.deleteObjKey(scheduledTransitions, toCls);\n    },\n    _isCancelled: () => {\n      return isCancelled;\n    },\n  };\n\n  return scheduledTransitions[toCls];\n};\n","/**\n * @module Utils\n *\n * @categoryDescription DOM: Altering\n * These functions alter the DOM tree, but could lead to forced layout if not\n * scheduled using {@link Utils.waitForMutateTime}.\n *\n * @categoryDescription DOM: Altering (optimized)\n * These functions alter the DOM tree in an optimized way using\n * {@link Utils.waitForMutateTime} and so are asynchronous.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { settings } from \"@lisn/globals/settings\";\n\nimport {\n  hideElement,\n  hasAnyClass,\n  addClassesNow,\n  removeClassesNow,\n  getData,\n  setDataNow,\n  setBooleanData,\n} from \"@lisn/utils/css-alter\";\nimport { asyncMutatorFor } from \"@lisn/utils/dom-optimize\";\nimport { isInlineTag } from \"@lisn/utils/dom-query\";\nimport { logWarn } from \"@lisn/utils/log\";\nimport { randId } from \"@lisn/utils/text\";\n\n/**\n * Wraps the element in the given wrapper, or a newly created element if not given.\n *\n * @param [options.wrapper]\n *              If it's an element, it is used as the wrapper. If it's a string\n *              tag name, then a new element with this tag is created as the\n *              wrapper. If not given, then `div` is used if the element to be\n *              wrapped has an block-display tag, or otherwise `span` (if the\n *              element to be wrapped has an inline tag name).\n * @param [options.ignoreMove]\n *              If true, the DOM watcher instances will ignore the operation of\n *              replacing the element (so as to not trigger relevant callbacks).\n * @returns The wrapper element that was either passed in options or created.\n *\n * @category DOM: Altering\n */\nexport const wrapElementNow = (\n  element: Element,\n  options?: {\n    wrapper?: HTMLElement | keyof HTMLElementTagNameMap;\n    ignoreMove?: boolean;\n  },\n) => {\n  const wrapper = createWrapperFor(element, options?.wrapper);\n\n  if (options?.ignoreMove === true) {\n    ignoreMove(element, {\n      from: MH.parentOf(element),\n      to: wrapper,\n    });\n\n    ignoreMove(wrapper, {\n      to: MH.parentOf(element),\n    });\n  }\n\n  element.replaceWith(wrapper);\n  wrapper.append(element);\n\n  return wrapper;\n};\n\n/**\n * Like {@link wrapElementNow} except it will {@link Utils.waitForMutateTime}.\n *\n * @category DOM: Altering (optimized)\n */\nexport const wrapElement = asyncMutatorFor(wrapElementNow);\n\n/**\n * Wraps the element's children in the given wrapper, or a newly created element\n * if not given.\n *\n * @see {@link wrapElementNow}.\n *\n * @category DOM: Altering\n */\nexport const wrapChildrenNow = (\n  element: Element,\n  options?: {\n    wrapper?: HTMLElement | keyof HTMLElementTagNameMap;\n    ignoreMove?: boolean;\n  },\n) => {\n  const wrapper = createWrapperFor(element, options?.wrapper);\n  const { ignoreMove } = options ?? {};\n\n  moveChildrenNow(element, wrapper, { ignoreMove });\n  moveElementNow(wrapper, {\n    to: element,\n    ignoreMove,\n  });\n\n  return wrapper;\n};\n\n/**\n * Like {@link wrapChildrenNow} except it will {@link Utils.waitForMutateTime}.\n *\n * @category DOM: Altering (optimized)\n */\nexport const wrapChildren = asyncMutatorFor(wrapChildrenNow);\n\n/**\n * Replace an element with another one.\n *\n * @param [options.ignoreMove]\n *              If true, the DOM watcher instances will ignore the operation of\n *              moving the element (so as to not trigger relevant callbacks).\n *\n * @category DOM: Altering\n */\nexport const replaceElementNow = (\n  element: Element,\n  newElement: Element,\n  options?: {\n    ignoreMove?: boolean;\n  },\n) => {\n  if (options?.ignoreMove === true) {\n    ignoreMove(\n      // remove element\n      element,\n      { from: MH.parentOf(element) },\n    );\n\n    ignoreMove(\n      // move newElement to element's current parent\n      newElement,\n      { from: MH.parentOf(newElement), to: MH.parentOf(element) },\n    );\n  }\n\n  element.replaceWith(newElement);\n};\n\n/**\n * Like {@link replaceElementNow} except it will {@link Utils.waitForMutateTime}.\n *\n * @category DOM: Altering (optimized)\n */\nexport const replaceElement = asyncMutatorFor(replaceElementNow);\n\n/**\n * Replace an element with another one.\n *\n * @param [options.ignoreMove]\n *              If true, the DOM watcher instances will ignore the operation of\n *              moving the element (so as to not trigger relevant callbacks).\n *\n * @category DOM: Altering\n */\nexport const swapElementsNow = (\n  elementA: Element,\n  elementB: Element,\n  options?: {\n    ignoreMove?: boolean;\n  },\n) => {\n  const temp = MH.createElement(\"div\");\n  replaceElementNow(elementA, temp, options);\n  replaceElementNow(elementB, elementA, options);\n  replaceElementNow(temp, elementB, options);\n};\n\n/**\n * Like {@link swapElementsNow} except it will {@link Utils.waitForMutateTime}.\n *\n * @category DOM: Altering (optimized)\n */\nexport const swapElements = asyncMutatorFor(swapElementsNow);\n\n// [TODO v2]: moveChildren to accept newParent as options.to\n\n/**\n * Move an element's children to a new element\n *\n * @param [options.ignoreMove]\n *              If true, the DOM watcher instances will ignore the operation of\n *              moving the children (so as to not trigger relevant callbacks).\n *\n * @category DOM: Altering\n */\nexport const moveChildrenNow = (\n  oldParent: Element,\n  newParent: Element,\n  options?: {\n    ignoreMove?: boolean;\n  },\n) => {\n  if (options?.ignoreMove === true) {\n    for (const child of MH.childrenOf(oldParent)) {\n      ignoreMove(child, {\n        from: oldParent,\n        to: newParent,\n      });\n    }\n  }\n\n  newParent.append(...MH.childrenOf(oldParent));\n};\n\n/**\n * Like {@link moveChildrenNow} except it will {@link Utils.waitForMutateTime}.\n *\n * @category DOM: Altering (optimized)\n */\nexport const moveChildren = asyncMutatorFor(moveChildrenNow);\n\n/**\n * Moves an element to a new position.\n *\n * @param [options.to]         The new parent or sibling (depending on\n *                             `options.position`). If not given, the\n *                             element is removed from the DOM.\n * @param [options.position]   - append (default): append to `options.to`\n *                             - prepend: prepend to `options.to`\n *                             - before: insert before `options.to`\n *                             - after: insert after `options.to`\n * @param [options.ignoreMove] If true, the DOM watcher instances will\n *                             ignore the operation of moving the element\n *                             (so as to not trigger relevant callbacks).\n *\n * @category DOM: Altering\n */\nexport const moveElementNow = (\n  element: Element,\n  options?: {\n    to?: Element;\n    position?: \"append\" | \"prepend\" | \"before\" | \"after\";\n    ignoreMove?: boolean;\n  },\n) => {\n  let parentEl = options?.to ?? null;\n  const position = options?.position || \"append\";\n  if (position === \"before\" || position === \"after\") {\n    parentEl = MH.parentOf(options?.to);\n  }\n\n  if (options?.ignoreMove === true) {\n    ignoreMove(element, {\n      from: MH.parentOf(element),\n      to: parentEl,\n    });\n  }\n\n  if (options?.to) {\n    options.to[position](element);\n  } else {\n    MH.remove(element);\n  }\n};\n\n/**\n * Like {@link moveElementNow} except it will {@link Utils.waitForMutateTime}.\n *\n * @category DOM: Altering (optimized)\n */\nexport const moveElement = asyncMutatorFor(moveElementNow);\n\n/**\n * It will {@link hideElement} and then remove it from the DOM.\n *\n * @param [options.ignoreMove]\n *              If true, the DOM watcher instances will ignore the operation of\n *              replacing the element (so as to not trigger relevant callbacks).\n *\n * @category DOM: Altering (optimized)\n */\nexport const hideAndRemoveElement = async (\n  element: Element,\n  delay = 0,\n  options?: {\n    ignoreMove?: boolean;\n  },\n) => {\n  await hideElement(element, delay);\n  moveElementNow(element, options);\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const getOrAssignID = (element: Element, prefix = \"\") => {\n  let domID = element.id;\n  if (!domID) {\n    domID = `${prefix}-${randId()}`;\n    element.id = domID;\n  }\n\n  return domID;\n};\n\n/**\n * @ignore\n * @internal\n *\n * @since v1.2.0\n */\nexport const isAllowedToWrap = (element: Element) =>\n  settings.contentWrappingAllowed === true &&\n  getData(element, MC.PREFIX_NO_WRAP) === null;\n\n/**\n * @ignore\n * @internal\n *\n * @param [options.classNames] Default is [MC.PREFIX_WRAPPER]. Pass `null` to\n *                             disable check.\n *\n * @since v1.2.0\n */\nexport const getWrapper = (\n  element: Element,\n  options?: {\n    _tagName?: keyof HTMLElementTagNameMap;\n    _classNames?: string[] | null;\n  },\n) => {\n  const { _tagName: tagName, _classNames: classNames = [MC.PREFIX_WRAPPER] } =\n    options ?? {};\n  const parent = MH.parentOf(element);\n  if (\n    MH.lengthOf(MH.childrenOf(parent)) === 1 &&\n    MH.isHTMLElement(parent) &&\n    (!tagName || MH.hasTagName(parent, tagName)) &&\n    (!classNames || hasAnyClass(parent, ...classNames))\n  ) {\n    // Already wrapped\n    return parent;\n  }\n\n  return null; // don't check the element itself, only its parent\n};\n\n/**\n * @ignore\n * @internal\n *\n * @param [options.classNames] Default is [MC.PREFIX_WRAPPER]. Pass `null` to\n *                             disable check.\n *\n * @since v1.2.0\n */\nexport const getContentWrapper = (\n  element: Element,\n  options?: {\n    _tagName?: keyof HTMLElementTagNameMap;\n    _classNames?: string[] | null;\n  },\n) => {\n  const { _tagName: tagName, _classNames: classNames = [MC.PREFIX_WRAPPER] } =\n    options ?? {};\n  const firstChild = MH.childrenOf(element)[0];\n  if (\n    MH.lengthOf(MH.childrenOf(element)) === 1 &&\n    MH.isHTMLElement(firstChild) &&\n    (!tagName || MH.hasTagName(firstChild, tagName)) &&\n    (!classNames || hasAnyClass(firstChild, ...classNames))\n  ) {\n    // Already wrapped\n    return firstChild;\n  }\n\n  return null;\n};\n\n/**\n * @ignore\n * @internal\n *\n * @since v1.2.0\n */\nexport const tryWrapNow = <O extends ContentWrappingOptions>(\n  element: Element,\n  options?: O,\n) => _tryWrapNow(element, options);\n\n/**\n * @ignore\n * @internal\n *\n * @since v1.2.0\n */\nexport const tryWrap = asyncMutatorFor(tryWrapNow);\n\n/**\n * @ignore\n * @internal\n *\n * @since v1.2.0\n */\nexport const tryWrapContentNow = <O extends ContentWrappingOptions>(\n  element: Element,\n  options?: O,\n) => _tryWrapNow(element, options, true);\n\n/**\n * @ignore\n * @internal\n *\n * @since v1.2.0\n */\nexport const tryWrapContent = asyncMutatorFor(tryWrapContentNow);\n\n/**\n * @ignore\n * @internal\n *\n * @since v1.2.0\n */\nexport const unwrapContentNow = (wrapper: Element, classNames?: string[]) => {\n  const parent = wrapper.parentElement;\n  if (parent) {\n    moveChildrenNow(wrapper, parent, { ignoreMove: true });\n    moveElementNow(wrapper, { ignoreMove: true });\n    if (classNames) {\n      removeClassesNow(wrapper, ...classNames);\n    }\n  }\n};\n\n/**\n * @ignore\n * @internal\n *\n * @since v1.2.0\n */\nexport const unwrapContent = asyncMutatorFor(unwrapContentNow);\n\n/**\n * @ignore\n * @internal\n */\nexport const cloneElement = <E extends Element>(element: E) => {\n  const clone = element.cloneNode(true) as E;\n  setBooleanData(clone, MH.prefixName(\"clone\"));\n  return clone;\n};\n\n/**\n * Creates a dummy hidden clone that's got animation and transitions disabled\n * and absolute position, wrapped in a wrapper (of size 0) and inserts it just\n * before the `insertBefore` element (or if not given, the original element),\n * so that the hidden clone overlaps the actual element's regular\n * (pre-transformed) position.\n *\n * It clears the ID of the clone.\n *\n * Returns the clone.\n *\n * @ignore\n * @internal\n */\nexport const insertGhostCloneNow = <E extends Element>(\n  element: E,\n  insertBefore: Element | null = null,\n) => {\n  const clone = cloneElement(element);\n  clone.id = \"\";\n\n  addClassesNow(\n    clone,\n    MC.PREFIX_GHOST,\n    MC.PREFIX_TRANSITION_DISABLE,\n    MC.PREFIX_ANIMATE_DISABLE,\n  );\n\n  const wrapper = _tryWrapNow(clone, { _required: true });\n\n  moveElementNow(wrapper, {\n    to: insertBefore ?? element,\n    position: \"before\",\n    ignoreMove: true,\n  });\n\n  return { _wrapper: wrapper, _clone: clone };\n};\n\n/**\n * @ignore\n * @internal\n *\n * Exposed via DOMWatcher\n */\nexport const insertGhostClone = asyncMutatorFor(insertGhostCloneNow);\n\n/**\n * @ignore\n * @internal\n *\n * Exposed via DOMWatcher\n */\nexport const ignoreMove = (\n  target: Element,\n  options: { from?: Element | null; to?: Element | null },\n) =>\n  recordsToSkipOnce.set(target, {\n    from: options.from ?? null,\n    to: options.to ?? null,\n  });\n\n/**\n * @ignore\n * @internal\n */\nexport const getIgnoreMove = (\n  target: Element,\n): { from: Element | null; to: Element | null } | null =>\n  recordsToSkipOnce.get(target) ?? null;\n\n/**\n * @ignore\n * @internal\n */\nexport const clearIgnoreMove = (target: Element) => {\n  // We should not clear the entry the first time the operation is observed\n  // (when we return true here), because there may be multiple DOMWatcher\n  // instances that will observe it and need to query it. Instead do it shortly.\n  MH.setTimer(() => {\n    MH.deleteKey(recordsToSkipOnce, target);\n  }, 100);\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const insertArrow = (\n  target: Element,\n  direction: \"up\" | \"down\" | \"left\" | \"right\",\n  position: \"prepend\" | \"append\" | \"before\" | \"after\" = \"append\",\n  tag = \"span\",\n) => {\n  const arrow = MH.createElement(tag);\n  addClassesNow(arrow, MH.prefixName(MC.S_ARROW));\n  setDataNow(arrow, MH.prefixName(\"direction\"), direction);\n  moveElement(arrow, { to: target, position, ignoreMove: true });\n  return arrow;\n};\n\n// ----------------------------------------\n\ntype ContentWrappingOptions = {\n  _tagName?: keyof HTMLElementTagNameMap;\n  _classNames?: string[]; // if the wrapper has any one of these, it will be re-used\n  _ignoreMove?: boolean; // default is true here\n  _required?: boolean; // if true, will ignore contentWrappingAllowed and data-lisn-no-wrap\n  _requiredBy?: string; // for logging purposes\n};\n\nconst recordsToSkipOnce = MH.newMap<\n  /* target being moved */ Element,\n  { from: Element | null; to: Element | null }\n>();\n\nconst createWrapperFor = (\n  element: Element,\n  wrapper: HTMLElement | keyof HTMLElementTagNameMap | undefined,\n) => {\n  if (MH.isElement(wrapper)) {\n    return wrapper;\n  }\n\n  let tag = wrapper;\n  if (!tag) {\n    if (isInlineTag(MH.tagName(element))) {\n      tag = \"span\";\n    } else {\n      tag = \"div\";\n    }\n  }\n\n  return MH.createElement(tag);\n};\n\nconst _tryWrapNow = <O extends ContentWrappingOptions>(\n  element: Element,\n  options: O | undefined,\n  wrapContent = false, // if true, wrap its children, otherwise given element\n) => {\n  const {\n    _tagName: tagName,\n    _classNames: classNames = [MC.PREFIX_WRAPPER],\n    _ignoreMove: ignoreMove = true,\n    _required: required = false,\n    _requiredBy: requiredBy = \"\",\n  } = options ?? {};\n\n  const getWrapperFn = wrapContent ? getContentWrapper : getWrapper;\n  const wrapFn = wrapContent ? wrapChildrenNow : wrapElementNow;\n  const allowedToWrap = isAllowedToWrap(element);\n\n  let wrapper = getWrapperFn(element, options);\n  if (!wrapper && (required || allowedToWrap)) {\n    wrapper = wrapFn(element, { wrapper: tagName, ignoreMove });\n    if (classNames) {\n      addClassesNow(wrapper, ...classNames);\n    }\n    if (isInlineTag(MH.tagName(wrapper))) {\n      addClassesNow(wrapper, MC.PREFIX_INLINE_WRAPPER);\n    }\n\n    if (!allowedToWrap && requiredBy) {\n      logWarn(\n        `content wrapping is disabled for element but wrapping is required by ${requiredBy}`,\n      );\n    }\n  }\n\n  return wrapper as O extends { _required: true }\n    ? HTMLElement\n    : HTMLElement | null;\n};\n","/**\n * @module Utils\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { settings } from \"@lisn/globals/settings\";\n\nimport { NonNullableReturnType } from \"@lisn/globals/types\";\n\n/**\n * Returns a Promise that is resolved when the given `checkFn` function returns\n * a value other than `null` or `undefined`.\n *\n * The Promise is resolved with `checkFn`'s return value.\n *\n * The function is called initially, and then every time there are changes to\n * the DOM children. Uses\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver | MutationObserver}.\n *\n * @param timeout If given, then if no such element is present after this many\n *                milliseconds, the promise will resolve to `null`.\n *\n * @category DOM: Events\n */\nexport const waitForElement = <\n  F extends () => unknown,\n  T extends number | undefined = undefined,\n>(\n  checkFn: F,\n  timeout?: number,\n) =>\n  MH.newPromise<\n    T extends undefined\n      ? NonNullableReturnType<F>\n      : null | NonNullableReturnType<F>\n  >((resolve) => {\n    const callFn = () => {\n      const result = checkFn();\n      if (!MH.isNullish(result)) {\n        resolve(result as NonNullableReturnType<F>);\n        return true; // done\n      }\n      return false;\n    };\n\n    if (callFn()) {\n      return; // resolved already\n    }\n\n    if (!MH.isNullish(timeout)) {\n      MH.setTimer(() => {\n        resolve(\n          null as T extends undefined\n            ? NonNullableReturnType<F>\n            : null | NonNullableReturnType<F>,\n        );\n        observer.disconnect();\n      }, timeout);\n    }\n\n    const observer = MH.newMutationObserver(() => {\n      if (callFn()) {\n        observer.disconnect();\n      }\n    });\n\n    observer.observe(MH.getDocElement(), {\n      childList: true,\n      subtree: true,\n    });\n  });\n\n/**\n * Returns a Promise that is resolved when the given `checkFn` function returns\n * a value other than `null` or `undefined` or the\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/Document/readyState | Document:readyState}\n * becomes \"interactive\".\n *\n * It always calls the given `checkFn` first before examining the `readyState`.\n *\n * If the `readyState` became interactive before the element was found, the\n * Promise resolves to `null`. Otherwise the Promise is resolved with `checkFn`'s\n * return value.\n *\n * The function is called initially, and then every time there are changes to\n * the DOM children. Uses\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver | MutationObserver}.\n *\n * @category DOM: Events\n */\nexport const waitForElementOrInteractive = <F extends () => unknown>(\n  checkFn: F,\n) =>\n  MH.newPromise<NonNullableReturnType<F> | null>((resolve) => {\n    let isInteractive = false;\n    // Check element first, then readyState. The callback to waitForElement is\n    // run synchronously first time, so isInteractive will be false and checkFn\n    // will run.\n    waitForElement(() => isInteractive || checkFn()).then((res) => {\n      if (!isInteractive) {\n        resolve(res as NonNullableReturnType<F>);\n      } // else already resolved to null\n    });\n\n    waitForInteractive().then(() => {\n      isInteractive = true;\n      resolve(null);\n    });\n  });\n\n/**\n * Returns a Promise that is resolved when the\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/Document/readyState | Document:readyState}\n * is \"interactive\" (or if it's already \"interactive\" or \"complete\", the\n * Promise is fulfilled immediately).\n *\n * @category DOM: Events\n */\nexport const waitForInteractive = () =>\n  MH.newPromise<void>((resolve) => {\n    const readyState = MH.getReadyState();\n    if (readyState === INTERACTIVE || readyState === COMPLETE) {\n      resolve();\n      return;\n    }\n\n    MH.getDoc().addEventListener(\"DOMContentLoaded\", () => resolve());\n  });\n\n/**\n * Returns a Promise that is resolved when the\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/Document/readyState | Document:readyState}\n * is \"complete\" (or if it's already \"complete\", the Promise is fulfilled\n * immediately).\n *\n * @category DOM: Events\n */\nexport const waitForComplete = () =>\n  MH.newPromise<void>((resolve) => {\n    if (MH.getReadyState() === COMPLETE) {\n      resolve();\n      return;\n    }\n\n    MH.getDoc().addEventListener(\"readystatechange\", () => {\n      if (MH.getReadyState() === COMPLETE) {\n        resolve();\n      }\n    });\n  });\n\n/**\n * Returns a Promise that is resolved either when the\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/Document/readyState | Document:readyState}\n * is \"complete\" or the `readyState` is \"interactive\" and at least\n * {@link settings.pageLoadTimeout} milliseconds have passed (if > 0) since it\n * became \"interactive\".\n *\n * @category DOM: Events\n */\nexport const waitForPageReady = () =>\n  MH.newPromise<void>((resolve) => {\n    if (pageIsReady) {\n      resolve();\n      return;\n    }\n\n    return waitForInteractive().then(() => {\n      // Setup a listener for the complete state but wait at most\n      // <pageLoadTimeout> (if specified)\n      let timer: ReturnType<typeof setTimeout> | null = null;\n\n      const dispatchReady = () => {\n        pageIsReady = true;\n        if (timer) {\n          MH.clearTimer(timer);\n          timer = null;\n        }\n        resolve();\n      };\n\n      if (settings.pageLoadTimeout > 0) {\n        timer = MH.setTimer(() => {\n          dispatchReady();\n        }, settings.pageLoadTimeout);\n      }\n\n      waitForComplete().then(dispatchReady);\n    });\n  });\n\n/**\n * Returns true if the page is \"ready\". See {@link waitForPageReady}.\n *\n * @category DOM: Events\n */\nexport const isPageReady = () => pageIsReady;\n\n// --------------------\n\nconst COMPLETE = \"complete\";\nconst INTERACTIVE = \"interactive\";\n\nlet pageIsReady = false;\n\nif (!MH.hasDOM()) {\n  pageIsReady = true;\n} else {\n  waitForPageReady(); // ensure pageIsReady is set even if waitForPageReady is not called\n}\n","/**\n * @module Watchers/DOMWatcher\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  MutationCategory,\n  CommaSeparatedStr,\n  AtLeastOne,\n} from \"@lisn/globals/types\";\n\nimport { DOM_CATEGORIES_SPACE } from \"@lisn/utils/dom\";\nimport {\n  getIgnoreMove,\n  clearIgnoreMove,\n  ignoreMove,\n} from \"@lisn/utils/dom-alter\";\nimport { waitForElement } from \"@lisn/utils/dom-events\";\nimport { logError } from \"@lisn/utils/log\";\nimport { omitKeys } from \"@lisn/utils/misc\";\nimport { objToStrKey } from \"@lisn/utils/text\";\nimport { validateStrList } from \"@lisn/utils/validation\";\n\nimport {\n  CallbackHandler,\n  Callback,\n  wrapCallback,\n} from \"@lisn/modules/callback\";\nimport { newXMap } from \"@lisn/modules/x-map\";\n\nimport debug from \"@lisn/debug/debug\";\n\n/**\n * {@link DOMWatcher} listens for changes do the DOM tree. It's built on top of\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver | MutationObserver}.\n *\n * It manages registered callbacks globally and reuses MutationObservers for\n * more efficient performance.\n *\n * Each instance of DOMWatcher manages up to two MutationObservers: one\n * for `childList` changes and one for attribute changes, and it disconnects\n * them when there are no active callbacks for the relevant type.\n *\n * `characterData` and changes to base\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/Node | Node}s\n * (non-{@link https://developer.mozilla.org/en-US/docs/Web/API/Element | Element})\n * are not supported.\n */\nexport class DOMWatcher {\n  /**\n   * Call the given handler whenever there's a matching mutation within this\n   * DOMWatcher's {@link DOMWatcherConfig.root | root}.\n   *\n   * If {@link OnMutationOptions.skipInitial | options.skipInitial} is `false`\n   * (default), _and_ {@link OnMutationOptions.selector | options.selector} is\n   * given, _and_ {@link OnMutationOptions.categories | options.categories}\n   * includes \"added\", the handler is also called (almost) immediately with all\n   * existing elements matching the selector under this DOMWatcher's\n   * {@link DOMWatcherConfig.root | root}.\n   *\n   * **IMPORTANT:** The same handler can _not_ be added multiple times, even if\n   * the options differ. If the handler has already been added, it is removed\n   * and re-added with the current options.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the options are not valid.\n   */\n  readonly onMutation: (\n    handler: OnMutationHandler,\n    options?: OnMutationOptions,\n  ) => Promise<void>;\n\n  /**\n   * Removes a previously added handler.\n   */\n  readonly offMutation: (handler: OnMutationHandler) => void;\n\n  /**\n   * Ignore an upcoming moving/adding/removing of an element.\n   *\n   * The operation must complete within the next cycle, by the time\n   * MutationObserver calls us.\n   *\n   * Use this to prevent this instance of DOMWatcher from calling any callbacks\n   * that listen for relevant changes as a result of this operation, to prevent\n   * loops for example.\n   *\n   * **IMPORTANT:**\n   *\n   * Ignoring moving of an element from a parent _inside_ this DOMWatcher's\n   * root to another parent that's _outside_ the root, will work as expected,\n   * even though the \"adding to the new parent\" mutation will not be observed.\n   * This is because the element's current parent at the time of the mutation\n   * callback can be examined.\n   *\n   * However if you want to ignore moving of an element _from a parent outside\n   * this DOMWatcher's root_ you need to specify from: null since the \"removal\n   * from the old parent\" mutation would not be observed and there's no way to\n   * examine it's previous parent at the time the \"adding to the new parent\"\n   * mutation is observed.\n   *\n   * For this reason, setting `options.from` to be an element that's not under\n   * the root is internally treated the same as `options.from: null`.\n   */\n  readonly ignoreMove: (target: Element, options: MoveOptions) => void;\n\n  /**\n   * Creates a new instance of DOMWatcher with the given\n   * {@link DOMWatcherConfig}. It does not save it for future reuse.\n   */\n  static create(config?: DOMWatcherConfig) {\n    return new DOMWatcher(getConfig(config), CONSTRUCTOR_KEY);\n  }\n\n  /**\n   * Returns an existing instance of DOMWatcher with the given\n   * {@link DOMWatcherConfig}, or creates a new one.\n   *\n   * **NOTE:** It saves it for future reuse, so don't use this for temporary\n   * short-lived watchers.\n   */\n  static reuse(config?: DOMWatcherConfig) {\n    const myConfig = getConfig(config);\n    const configStrKey = objToStrKey(omitKeys(myConfig, { _root: null }));\n\n    const root = myConfig._root === MH.getBody() ? null : myConfig._root;\n    let instance = instances.get(root)?.get(configStrKey);\n    if (!instance) {\n      instance = new DOMWatcher(myConfig, CONSTRUCTOR_KEY);\n      instances.sGet(root).set(configStrKey, instance);\n    }\n\n    return instance;\n  }\n\n  private constructor(\n    config: DOMWatcherConfigInternal,\n    key: typeof CONSTRUCTOR_KEY,\n  ) {\n    if (key !== CONSTRUCTOR_KEY) {\n      throw MH.illegalConstructorError(\"DOMWatcher.create\");\n    }\n\n    const logger = debug\n      ? new debug.Logger({ name: \"DOMWatcher\", logAtCreation: config })\n      : null;\n\n    const buffer = newXMap<Element, MutationOperationInternal>((t) => ({\n      _target: t,\n      _categoryBitmask: 0,\n      _attributes: MH.newSet(),\n      _addedTo: null,\n      _removedFrom: null,\n    }));\n\n    const allCallbacks = MH.newMap<\n      OnMutationHandler,\n      {\n        _callback: OnMutationCallback;\n        _options: OnMutationOptionsInternal;\n      }\n    >();\n\n    // ----------\n\n    let timer: ReturnType<typeof setTimeout> | null = null;\n    const mutationHandler = (records: MutationRecord[]) => {\n      debug: logger?.debug9(`Got ${records.length} new records`, records);\n\n      for (const record of records) {\n        const target = MH.targetOf(record);\n        const recType = record.type;\n\n        /* istanbul ignore next */\n        if (!MH.isElement(target)) {\n          continue;\n        }\n\n        if (recType === MC.S_CHILD_LIST) {\n          for (const child of record.addedNodes) {\n            if (MH.isElement(child)) {\n              const operation = buffer.sGet(child);\n              operation._addedTo = target;\n              operation._categoryBitmask |= ADDED_BIT;\n            }\n          }\n\n          for (const child of record.removedNodes) {\n            if (MH.isElement(child)) {\n              const operation = buffer.sGet(child);\n              operation._removedFrom = target;\n              operation._categoryBitmask |= REMOVED_BIT;\n            }\n          }\n\n          //\n        } else if (recType === MC.S_ATTRIBUTES && record.attributeName) {\n          const operation = buffer.sGet(target);\n          operation._attributes.add(record.attributeName);\n          operation._categoryBitmask |= ATTRIBUTE_BIT;\n        }\n      }\n\n      // Schedule flushing of the buffer asynchronously so that we can combine\n      // the records from the two MutationObservers.\n      if (!timer && MH.sizeOf(buffer)) {\n        timer = MH.setTimer(() => {\n          debug: logger?.debug9(`Processing ${buffer.size} operations`);\n          for (const operation of buffer.values()) {\n            if (shouldSkipOperation(operation)) {\n              debug: logger?.debug10(\"Skipping operation\", operation);\n            } else {\n              processOperation(operation);\n            }\n          }\n\n          buffer.clear();\n          timer = null;\n        }, 0);\n      }\n    };\n\n    const observers: Record<MutationType, MyObserver> = {\n      [MC.S_CHILD_LIST]: {\n        _observer: MH.newMutationObserver(mutationHandler),\n        _isActive: false,\n      },\n      [MC.S_ATTRIBUTES]: {\n        _observer: MH.newMutationObserver(mutationHandler),\n        _isActive: false,\n      },\n    };\n\n    // ----------\n\n    const createCallback = (\n      handler: OnMutationHandler,\n      options: OnMutationOptionsInternal,\n    ): OnMutationCallback => {\n      MH.remove(allCallbacks.get(handler)?._callback);\n\n      debug: logger?.debug5(\"Adding/updating handler\", options);\n      const callback = wrapCallback(handler);\n      callback.onRemove(() => deleteHandler(handler));\n\n      allCallbacks.set(handler, { _callback: callback, _options: options });\n      return callback;\n    };\n\n    // ----------\n\n    const setupOnMutation = async (\n      handler: OnMutationHandler,\n      userOptions: OnMutationOptions | undefined,\n    ) => {\n      const options = getOptions(userOptions ?? {});\n      const callback = createCallback(handler, options);\n\n      let root = config._root ?? MH.getBody();\n      if (!root) {\n        root = await waitForElement(MH.getBody);\n      } else {\n        // So that the call is always async\n        await null;\n      }\n\n      if (callback.isRemoved()) {\n        return;\n      }\n\n      if (options._categoryBitmask & (ADDED_BIT | REMOVED_BIT)) {\n        activateObserver(root, MC.S_CHILD_LIST);\n      }\n\n      if (options._categoryBitmask & ATTRIBUTE_BIT) {\n        activateObserver(root, MC.S_ATTRIBUTES);\n      }\n\n      if (\n        userOptions?.skipInitial ||\n        !options._selector ||\n        !(options._categoryBitmask & ADDED_BIT)\n      ) {\n        return;\n      }\n\n      // As some of the matching elements that currently exist in the root may\n      // have just been added and therefore in the MutationObserver's queue, to\n      // avoid calling the handler with those entries twice, we empty its queue\n      // now and process it (which would also invoke the newly added callback).\n      // Then we skip any elements returned in querySelectorAll that were in\n      // the queue.\n\n      const childQueue = observers[MC.S_CHILD_LIST]._observer.takeRecords();\n      mutationHandler(childQueue);\n\n      for (const element of [\n        ...MH.querySelectorAll(root, options._selector),\n        ...(root.matches(options._selector) ? [root] : []),\n      ]) {\n        const initOperation: MutationOperationInternal = {\n          _target: element,\n          _categoryBitmask: ADDED_BIT,\n          _attributes: MH.newSet(),\n          _addedTo: MH.parentOf(element),\n          _removedFrom: null,\n        };\n\n        const bufferedOperation = buffer.get(element);\n        const diffOperation = getDiffOperation(\n          initOperation,\n          bufferedOperation,\n        );\n\n        if (diffOperation) {\n          if (shouldSkipOperation(diffOperation)) {\n            debug: logger?.debug10(\"Skipping operation\", diffOperation);\n          } else {\n            debug: logger?.debug5(\"Calling initially with\", diffOperation);\n            await invokeCallback(callback, diffOperation);\n          }\n        }\n      }\n    };\n\n    // ----------\n\n    const deleteHandler = (handler: OnMutationHandler) => {\n      MH.deleteKey(allCallbacks, handler);\n\n      let activeCategories = 0;\n      for (const entry of allCallbacks.values()) {\n        activeCategories |= entry._options._categoryBitmask;\n      }\n\n      if (!(activeCategories & (ADDED_BIT | REMOVED_BIT))) {\n        deactivateObserver(MC.S_CHILD_LIST);\n      }\n\n      if (!(activeCategories & ATTRIBUTE_BIT)) {\n        deactivateObserver(MC.S_ATTRIBUTES);\n      }\n    };\n\n    // ----------\n\n    const processOperation = (operation: MutationOperationInternal) => {\n      debug: logger?.debug10(\"Processing operation\", operation);\n\n      for (const entry of allCallbacks.values()) {\n        const categoryBitmask = entry._options._categoryBitmask;\n        const target = entry._options._target;\n        const selector = entry._options._selector;\n\n        if (!(operation._categoryBitmask & categoryBitmask)) {\n          debug: logger?.debug10(`Category does not match: ${categoryBitmask}`);\n          continue;\n        }\n\n        const currentTargets = [];\n        if (target) {\n          if (!operation._target.contains(target)) {\n            debug: logger?.debug10(\"Target does not match\", target);\n            continue;\n          }\n\n          currentTargets.push(target);\n        }\n\n        if (selector) {\n          const matches = [...MH.querySelectorAll(operation._target, selector)];\n\n          if (operation._target.matches(selector)) {\n            matches.push(operation._target);\n          }\n\n          if (!MH.lengthOf(matches)) {\n            debug: logger?.debug10(`Selector does not match: ${selector}`);\n            continue;\n          }\n\n          currentTargets.push(...matches);\n        }\n\n        invokeCallback(entry._callback, operation, currentTargets);\n      }\n    };\n\n    // ----------\n\n    const activateObserver = (root: Element, mutationType: MutationType) => {\n      if (!observers[mutationType]._isActive) {\n        debug: logger?.debug3(\n          `Activating mutation observer for '${mutationType}'`,\n        );\n        observers[mutationType]._observer.observe(root, {\n          [mutationType]: true,\n          subtree: config._subtree,\n        });\n        observers[mutationType]._isActive = true;\n      }\n    };\n\n    // ----------\n\n    const deactivateObserver = (mutationType: MutationType) => {\n      if (observers[mutationType]._isActive) {\n        debug: logger?.debug3(\n          `Disconnecting mutation observer for '${mutationType}'`,\n        );\n        observers[mutationType]._observer.disconnect();\n        observers[mutationType]._isActive = false;\n      }\n    };\n\n    // ----------\n\n    const shouldSkipOperation = (\n      operation: MutationOperationInternal,\n    ): boolean => {\n      const target = operation._target;\n      const requestToSkip = getIgnoreMove(target);\n      if (!requestToSkip) {\n        return false;\n      }\n\n      const removedFrom = operation._removedFrom;\n      const addedTo = MH.parentOf(target);\n      const requestFrom = requestToSkip.from;\n      const requestTo = requestToSkip.to;\n\n      const root = config._root ?? MH.getBody();\n      // If \"from\" is currently outside our root, we may not have seen a\n      // removal operation.\n      if (\n        (removedFrom === requestFrom || !root.contains(requestFrom)) &&\n        addedTo === requestTo\n      ) {\n        clearIgnoreMove(target);\n        return true;\n      }\n\n      return false;\n    };\n\n    // ----------\n\n    this.ignoreMove = ignoreMove;\n\n    // ----------\n\n    this.onMutation = setupOnMutation;\n\n    // ----------\n\n    this.offMutation = (handler) => {\n      debug: logger?.debug5(\"Removing handler\");\n      MH.remove(allCallbacks.get(handler)?._callback);\n    };\n  }\n}\n\n/**\n * @interface\n */\nexport type DOMWatcherConfig = {\n  /**\n   * The root element to observe for changes.\n   *\n   * It cannot be overridden on a per-callback basis.\n   *\n   * @defaultValue document.body\n   */\n  root?: Element | null;\n\n  /**\n   * Whether to observe root's subtree for changes or just direct descendants.\n   *\n   * It cannot be overridden on a per-callback basis.\n   *\n   * @defaultValue true\n   */\n  subtree?: boolean;\n};\n\n/**\n * @interface\n */\nexport type OnMutationOptions = {\n  /**\n   * If this is given, then the handler would only be called for operations\n   * where the target is _either_ the given element or an ancestor of it, i.e.\n   * it {@link https://developer.mozilla.org/en-US/docs/Web/API/Node/contains | Node:contains} it.\n   *\n   * @defaultValue undefined\n   */\n  target?: Element;\n\n  /**\n   * If this is given, then the handler would only be called for operations\n   * where the target matches the given selector _or contains an element\n   * matching the given selector_.\n   *\n   * @defaultValue undefined\n   */\n  selector?: string;\n\n  /**\n   * Specifies a list of {@link MutationCategory}s to target for.\n   *\n   * If not given, then the handler is called for any of the supported\n   * mutations.\n   *\n   * It can be a comma-separated list of category names or an array of such\n   * names.\n   *\n   * @defaultValue undefined\n   */\n  categories?: CommaSeparatedStr<MutationCategory> | MutationCategory[];\n\n  /**\n   * Do not call the handler until there's a future matching mutation.\n   *\n   * By default, if `selector` is given, and `categories` includes `added`, we\n   * call the handler (almost) immediately with all elements matching selector\n   * relative to this DOMWatcher's root.\n   *\n   * The initial operation will contain just the element and\n   * `addedTo: <current parent>`.\n   *\n   * @defaultValue false\n   */\n  skipInitial?: boolean;\n};\n\nexport type MoveOptions = AtLeastOne<{\n  /**\n   * If to is missing or null, it's a removal operation.\n   */\n  to: Element | null;\n\n  /**\n   * If from is missing or null, it's an insertion operation.\n   */\n  from: Element | null;\n}>;\n\nexport type MutationOperation = {\n  /**\n   * The target that was changed.\n   */\n  target: Element;\n\n  /**\n   * The target that the callback was interested in.\n   *\n   * If `selector` is given as part of {@link OnMutationOptions}, then\n   * `currentTarget` will point to the target that matched the selector\n   * starting at the operation's `target` as the root. If the operation's\n   * `target` contains more than one element matching selector, the callback\n   * will be called once for _each_ matching child.\n   *\n   * If `target` is given as part of {@link OnMutationOptions}, then\n   * `currentTarget` will be that element.\n   */\n  currentTarget: Element;\n\n  /**\n   * The list of attributes that were changed in this round.\n   */\n  attributes: Set<string>;\n\n  /**\n   * The element that the target was added to, i.e. it's new parent. It is null\n   * if the target was not moved to a new element _during this round_. It does\n   * not mean that this is its current parent.\n   */\n  addedTo: Element | null;\n\n  /**\n   * The element that the target was removed from, i.e. it's old parent. It is\n   * null if the target was not removed from a previous element _during this\n   * round_. It does not mean it did not previously have a parent, but that its\n   * removal was not observed.\n   */\n  removedFrom: Element | null;\n};\n\n/**\n * The handler is invoked with one argument:\n *\n * - a {@link MutationOperation} for a set of mutations related to a particular\n *   element\n *\n * The handler could be invoked multiple times in each \"round\" (cycle of event\n * loop) if there are mutation operations for more than one element that match\n * the supplied {@link OnMutationOptions}.\n */\nexport type OnMutationHandlerArgs = [MutationOperation];\nexport type OnMutationCallback = Callback<OnMutationHandlerArgs>;\nexport type OnMutationHandler =\n  | CallbackHandler<OnMutationHandlerArgs>\n  | OnMutationCallback;\n\n// ----------------------------------------\n\ntype DOMWatcherConfigInternal = {\n  _root: Element | null;\n  _subtree: boolean;\n};\n\ntype OnMutationOptionsInternal = {\n  _target: Element | null;\n  _selector: string;\n  _categoryBitmask: number;\n};\n\ntype MyObserver = {\n  _observer: MutationObserver;\n  _isActive: boolean;\n};\n\ntype MutationType = \"childList\" | \"attributes\";\n\ntype MutationOperationInternal = {\n  _target: Element;\n  _attributes: Set<string>;\n  _addedTo: Element | null;\n  _removedFrom: Element | null;\n  _categoryBitmask: number;\n};\n\nconst CONSTRUCTOR_KEY: unique symbol = MC.SYMBOL() as typeof CONSTRUCTOR_KEY;\nconst instances = newXMap<Element | null, Map<string, DOMWatcher>>(() =>\n  MH.newMap(),\n);\n\nconst getConfig = (\n  config: DOMWatcherConfig | undefined,\n): DOMWatcherConfigInternal => {\n  return {\n    _root: config?.root ?? null,\n    _subtree: config?.subtree ?? true,\n  };\n};\n\nconst CATEGORIES_BITS = DOM_CATEGORIES_SPACE.bit;\nconst ADDED_BIT = CATEGORIES_BITS[MC.S_ADDED];\nconst REMOVED_BIT = CATEGORIES_BITS[MC.S_REMOVED];\nconst ATTRIBUTE_BIT = CATEGORIES_BITS[MC.S_ATTRIBUTE];\n\n// ----------------------------------------\n\nconst getOptions = (options: OnMutationOptions): OnMutationOptionsInternal => {\n  let categoryBitmask = 0;\n  const categories = validateStrList(\n    \"categories\",\n    options.categories,\n    DOM_CATEGORIES_SPACE.has,\n  );\n\n  if (categories) {\n    for (const cat of categories) {\n      categoryBitmask |= CATEGORIES_BITS[cat];\n    }\n  } else {\n    categoryBitmask = DOM_CATEGORIES_SPACE.bitmask; // default: all\n  }\n\n  const selector = options.selector ?? \"\";\n  if (!MH.isString(selector)) {\n    throw MH.usageError(\"'selector' must be a string\");\n  }\n\n  return {\n    _categoryBitmask: categoryBitmask,\n    _target: options.target ?? null,\n    _selector: selector,\n  };\n};\n\nconst getDiffOperation = (\n  operationA: MutationOperationInternal,\n  operationB: MutationOperationInternal | undefined,\n): MutationOperationInternal | null => {\n  if (!operationB || operationA._target !== operationB._target) {\n    return operationA;\n  }\n\n  const attributes = MH.newSet<string>();\n  for (const attr of operationA._attributes) {\n    if (!operationB._attributes.has(attr)) {\n      attributes.add(attr);\n    }\n  }\n\n  const categoryBitmask =\n    operationA._categoryBitmask ^ operationB._categoryBitmask;\n\n  const addedTo =\n    operationA._addedTo === operationB._addedTo ? null : operationA._addedTo;\n\n  const removedFrom =\n    operationA._removedFrom === operationB._removedFrom\n      ? null\n      : operationA._removedFrom;\n\n  if (!MH.sizeOf(attributes) && !categoryBitmask && !addedTo && !removedFrom) {\n    return null;\n  }\n\n  return {\n    _target: operationA._target,\n    _categoryBitmask: categoryBitmask,\n    _attributes: attributes,\n    _addedTo: addedTo,\n    _removedFrom: removedFrom,\n  };\n};\n\nconst invokeCallback = (\n  callback: OnMutationCallback,\n  operation: MutationOperationInternal,\n  currentTargets: Element[] = [],\n) => {\n  if (!MH.lengthOf(currentTargets)) {\n    currentTargets = [operation._target];\n  }\n\n  for (const currentTarget of currentTargets) {\n    callback\n      .invoke({\n        target: operation._target,\n        currentTarget,\n        attributes: operation._attributes,\n        addedTo: operation._addedTo,\n        removedFrom: operation._removedFrom,\n      })\n      .catch(logError);\n  }\n};\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  Direction,\n  XYDirection,\n  ZDirection,\n  NoDirection,\n  AmbiguousDirection,\n  CommaSeparatedStr,\n  Vector,\n} from \"@lisn/globals/types\";\n\nimport { maxAbs, areParallel } from \"@lisn/utils/math\";\nimport { isValidStrList, validateStrList } from \"@lisn/utils/validation\";\n\n/**\n * Returns the cardinal direction in the XY plane for the larger of the two\n * deltas (horizontal vs vertical).\n *\n * If both deltas are 0, returns \"none\".\n *\n * If both deltas are equal and non-0, returns \"ambiguous\".\n *\n * @category Directions\n */\nexport const getMaxDeltaDirection = (\n  deltaX: number,\n  deltaY: number,\n): XYDirection | NoDirection | AmbiguousDirection => {\n  if (!MH.abs(deltaX) && !MH.abs(deltaY)) {\n    return MC.S_NONE;\n  }\n\n  if (MH.abs(deltaX) === MH.abs(deltaY)) {\n    return MC.S_AMBIGUOUS;\n  }\n\n  if (MH.abs(deltaX) > MH.abs(deltaY)) {\n    return deltaX < 0 ? MC.S_LEFT : MC.S_RIGHT;\n  }\n  return deltaY < 0 ? MC.S_UP : MC.S_DOWN;\n};\n\n/**\n * Returns the approximate direction of the given 2D vector as one of the\n * cardinal (XY plane) ones: \"up\", \"down\", \"left\" or \"right\"; or \"ambiguous\".\n *\n * @param angleDiffThreshold See {@link areParallel} or\n *                           {@link Utils.areAntiParallel | areAntiParallel}.\n *                           This determines whether the inferred direction is\n *                           ambiguous. For it to _not_ be ambiguous it must\n *                           align with one of the four cardinal directions to\n *                           within `angleDiffThreshold`. It doesn't make\n *                           sense for this value to be < 0 or >= 45 degrees.\n *                           If it is, it's forced to be positive (absolute)\n *                           and <= 44.99.\n *\n * @category Directions\n */\nexport const getVectorDirection = (\n  vector: Vector,\n  angleDiffThreshold = 0,\n): XYDirection | AmbiguousDirection | NoDirection => {\n  angleDiffThreshold = MH.min(44.99, MH.abs(angleDiffThreshold));\n\n  if (!maxAbs(...vector)) {\n    return MC.S_NONE;\n  } else if (areParallel(vector, [1, 0], angleDiffThreshold)) {\n    return MC.S_RIGHT;\n  } else if (areParallel(vector, [0, 1], angleDiffThreshold)) {\n    return MC.S_DOWN;\n  } else if (areParallel(vector, [-1, 0], angleDiffThreshold)) {\n    return MC.S_LEFT;\n  } else if (areParallel(vector, [0, -1], angleDiffThreshold)) {\n    return MC.S_UP;\n  }\n\n  return MC.S_AMBIGUOUS;\n};\n\n/**\n * Returns the opposite direction to the given direction or null if the given\n * direction has no opposite.\n *\n * @example\n * ```javascript\n * getOppositeDirection(\"up\"); // -> \"down\"\n * getOppositeDirection(\"down\"); // -> \"up\"\n * getOppositeDirection(\"left\"); // -> \"right\"\n * getOppositeDirection(\"right\"); // -> \"left\"\n * getOppositeDirection(\"none\"); // -> null\n * getOppositeDirection(\"ambiguous\"); // -> null\n * ```\n *\n * @category Directions\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *                If the given view is not valid.\n */\nexport const getOppositeDirection = (\n  direction: Direction,\n): Direction | null => {\n  if (!(direction in OPPOSITE_DIRECTIONS)) {\n    throw MH.usageError(\"Invalid 'direction'\");\n  }\n\n  return OPPOSITE_DIRECTIONS[direction];\n};\n\n/**\n * Returns the set of directions which are opposite to the given set of directions.\n *\n * There are two sets of opposite pairs (\"up\"/\"down\" and \"left\"/\"right\") and at\n * least one of the two opposing directions of a pair must be present for the\n * other one to be included. If both directions that constitute a pair of\n * opposites is given, then the other pair is returned instead (minus any that\n * are present in the input). See examples below for clarification.\n *\n * @example\n * ```javascript\n * getOppositeXYDirections(\"up\"); // -> [\"down\"]\n * getOppositeXYDirections(\"left\"); // -> [\"right\"]\n * getOppositeXYDirections(\"up,down\"); // -> [\"left\",\"right\"]\n * getOppositeXYDirections(\"up,left\"); // -> [\"down\",\"right\"]\n * getOppositeXYDirections(\"up,left,right\"); // -> [\"down\"]\n * getOppositeXYDirections(\"none\"); // -> throws\n * getOppositeXYDirections(\"ambiguous\"); // -> throws\n * getOppositeXYDirections(\"in\"); // -> throws\n * ```\n *\n * @category Directions\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *                If the given view is not valid.\n */\nexport const getOppositeXYDirections = (\n  directions: CommaSeparatedStr<XYDirection> | XYDirection[],\n): XYDirection[] => {\n  const directionList = validateStrList(\n    \"directions\",\n    directions,\n    isValidXYDirection,\n  );\n\n  if (!directionList) {\n    throw MH.usageError(\"'directions' is required\");\n  }\n\n  const opposites: XYDirection[] = [];\n  for (const direction of directionList) {\n    const opposite = getOppositeDirection(direction);\n    if (\n      opposite &&\n      isValidXYDirection(opposite) &&\n      !MH.includes(directionList, opposite)\n    ) {\n      opposites.push(opposite);\n    }\n  }\n\n  if (!MH.lengthOf(opposites)) {\n    for (const direction of XY_DIRECTIONS) {\n      if (!MH.includes(directionList, direction)) {\n        opposites.push(direction);\n      }\n    }\n  }\n\n  return opposites;\n};\n\n/**\n * Returns true if the given direction is one of the known XY ones.\n *\n * @category Validation\n */\nexport const isValidXYDirection = (\n  direction: string,\n): direction is XYDirection => MH.includes(XY_DIRECTIONS, direction);\n\n/**\n * Returns true if the given direction is one of the known Z ones.\n *\n * @category Validation\n */\nexport const isValidZDirection = (direction: string): direction is ZDirection =>\n  MH.includes(Z_DIRECTIONS, direction);\n\n/**\n * Returns true if the given string is a valid direction.\n *\n * @category Validation\n */\nexport const isValidDirection = (direction: string): direction is Direction =>\n  MH.includes(DIRECTIONS, direction);\n\n/**\n * Returns true if the given string or array is a list of valid directions.\n *\n * @category Validation\n */\nexport const isValidDirectionList = (\n  directions: string | string[],\n): directions is CommaSeparatedStr<Direction> | Direction[] =>\n  isValidStrList(directions, isValidDirection, false);\n\n/**\n * @ignore\n * @internal\n */\nexport const XY_DIRECTIONS = [\n  MC.S_UP,\n  MC.S_DOWN,\n  MC.S_LEFT,\n  MC.S_RIGHT,\n] as const;\n\n/**\n * @ignore\n * @internal\n */\nexport const Z_DIRECTIONS = [MC.S_IN, MC.S_OUT] as const;\n\n/**\n * @ignore\n * @internal\n */\nexport const SCROLL_DIRECTIONS = [\n  ...XY_DIRECTIONS,\n  MC.S_NONE,\n  MC.S_AMBIGUOUS,\n] as const;\n\n/**\n * @ignore\n * @internal\n */\nexport const DIRECTIONS = [\n  ...XY_DIRECTIONS,\n  ...Z_DIRECTIONS,\n  MC.S_NONE,\n  MC.S_AMBIGUOUS,\n] as const;\n\n// --------------------\n\nconst OPPOSITE_DIRECTIONS = {\n  [MC.S_UP]: MC.S_DOWN,\n  [MC.S_DOWN]: MC.S_UP,\n  [MC.S_LEFT]: MC.S_RIGHT,\n  [MC.S_RIGHT]: MC.S_LEFT,\n  [MC.S_IN]: MC.S_OUT,\n  [MC.S_OUT]: MC.S_IN,\n  [MC.S_NONE]: null,\n  [MC.S_AMBIGUOUS]: null,\n} as const;\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { addClasses, removeClasses } from \"@lisn/utils/css-alter\";\nimport { copyExistingKeys } from \"@lisn/utils/misc\";\n\nimport { XMap, newXMapGetter, newXWeakMap } from \"@lisn/modules/x-map\";\n\n/**\n * Calls the given event listener, which could be a function that's callable\n * directly, or an object that has a `handleEvent` function property.\n *\n * @category Events: Generic\n */\nexport const callEventListener = (\n  handler: EventListenerOrEventListenerObject,\n  event: Event,\n) => {\n  if (MH.isFunction(handler)) {\n    handler.call(event.currentTarget ?? self, event);\n  } else {\n    handler.handleEvent.call(event.currentTarget ?? self, event);\n  }\n};\n\n/**\n * Adds an event listener for the given event name to the given target.\n *\n * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener | EventTarget:addEventListener}\n * but it handles `options` object in case the browser does not support those.\n * Does not support the `signal` option unless browser natively supports that.\n *\n * @returns `true` if successfully added, or `false` if the same handler has\n * already been added by us, or if the handler is not a valid event listener.\n *\n * @category Events: Generic\n */\nexport const addEventListenerTo = (\n  target: EventTarget,\n  eventType: string,\n  handler: EventListenerOrEventListenerObject,\n  options?: boolean | AddEventListenerOptions,\n): boolean => {\n  options ??= false;\n  eventType = transformEventType(eventType);\n  if (getEventHandlerData(target, eventType, handler, options)) {\n    // already added\n    return false;\n  }\n\n  let thirdArg = options;\n  let wrappedHandler = handler;\n\n  // If the user passed an options object but the browser only supports a\n  // boolen for 'useCapture', then handle this.\n  const supports = getBrowserSupport();\n  if (MH.isNonPrimitive(options)) {\n    if (!supports._optionsArg) {\n      thirdArg = options.capture ?? false;\n    }\n\n    if (options.once && !supports._options.once) {\n      // Remove the handler once it's called once\n      wrappedHandler = (event) => {\n        removeEventListenerFrom(target, eventType, handler, options);\n        callEventListener(handler, event);\n      };\n    }\n  }\n\n  setEventHandlerData(target, eventType, handler, options, {\n    _wrappedHandler: wrappedHandler,\n    _thirdArg: thirdArg,\n  });\n\n  target.addEventListener(eventType, wrappedHandler, thirdArg);\n  return true;\n};\n\n/**\n * Removes an event listener that has been added using\n * {@link addEventListenerTo}.\n *\n * **IMPORTANT:** If you have added a listener using the built-in\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener | EventTarget:addEventListener},\n * then you should use\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/removeEventListener | EventTarget:removeEventListener},\n * to remove it, not this function.\n *\n * @returns `true` if successfully removed, or `false` if the handler has not\n * been added by us.\n *\n * @category Events: Generic\n */\nexport const removeEventListenerFrom = (\n  target: EventTarget,\n  eventType: string,\n  handler: EventListenerOrEventListenerObject,\n  options?: boolean | AddEventListenerOptions,\n) => {\n  options ??= false;\n  eventType = transformEventType(eventType);\n  const data = getEventHandlerData(target, eventType, handler, options);\n\n  if (!data) {\n    return false;\n  }\n\n  target.removeEventListener(eventType, data._wrappedHandler, data._thirdArg);\n  deleteEventHandlerData(target, eventType, handler, options);\n  return true;\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const preventSelect = (target: EventTarget) => {\n  addEventListenerTo(target, MC.S_SELECTSTART, MH.preventDefault);\n  if (MH.isElement(target)) {\n    addClasses(target, MC.PREFIX_NO_SELECT);\n  }\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const undoPreventSelect = (target: EventTarget) => {\n  removeEventListenerFrom(target, MC.S_SELECTSTART, MH.preventDefault);\n  if (MH.isElement(target)) {\n    removeClasses(target, MC.PREFIX_NO_SELECT);\n  }\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const getBrowserSupport = (): BrowserEventSupport => {\n  if (browserEventSupport) {\n    // already detected\n    return browserEventSupport;\n  }\n\n  const supports = {\n    _pointer: false,\n    _optionsArg: false,\n    _options: {\n      capture: false,\n      passive: false,\n      once: false,\n      signal: false,\n    },\n  };\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#safely_detecting_option_support\n  const optTest = {};\n  let opt: keyof typeof supports._options;\n  for (opt in supports._options) {\n    const thisOpt = opt;\n    MH.defineProperty(optTest, thisOpt, {\n      get: () => {\n        supports._options[thisOpt] = true;\n        if (thisOpt === \"signal\") {\n          return new AbortController().signal;\n        }\n        return false;\n      },\n    });\n  }\n\n  const dummyHandler = () => {}; // TypeScript does not accept null\n  const dummyElement = MH.createElement(\"div\");\n  try {\n    dummyElement.addEventListener(\"testOptionSupport\", dummyHandler, optTest);\n    dummyElement.removeEventListener(\n      \"testOptionSupport\",\n      dummyHandler,\n      optTest,\n    );\n    supports._optionsArg = true;\n  } catch (e__ignored) {\n    //\n  }\n\n  supports._pointer = \"onpointerup\" in dummyElement;\n\n  browserEventSupport = supports;\n  return supports;\n};\n\n// --------------------\n\ntype EventHandlerData = {\n  _wrappedHandler: EventListenerOrEventListenerObject;\n  _thirdArg: boolean | AddEventListenerOptions;\n};\n\nlet browserEventSupport: BrowserEventSupport;\n\nconst registeredEventHandlerData = newXWeakMap<\n  EventTarget,\n  XMap<\n    string, // event type\n    XMap<\n      EventListenerOrEventListenerObject, // user-supplied handler\n      Map<\n        string, // str repr of options\n        EventHandlerData\n      >\n    >\n  >\n>(newXMapGetter(newXMapGetter(() => MH.newMap())));\n\n// detect browser features, see below\ntype BrowserEventSupport = {\n  _pointer: boolean;\n  _optionsArg: boolean;\n  _options: {\n    capture: boolean;\n    passive: boolean;\n    once: boolean;\n    signal: boolean;\n  };\n};\n\nconst getEventOptionsStr = (\n  options: boolean | AddEventListenerOptions,\n): string => {\n  const finalOptions: AddEventListenerOptions = {\n    capture: false,\n    passive: false,\n    once: false,\n  };\n\n  if (options === false || options === true) {\n    finalOptions.capture = options;\n  } else if (MH.isObject(options)) {\n    copyExistingKeys(options, finalOptions);\n  }\n\n  return MH.stringify(finalOptions);\n};\n\nconst getEventHandlerData = (\n  target: EventTarget,\n  eventType: string,\n  handler: EventListenerOrEventListenerObject,\n  options: boolean | AddEventListenerOptions,\n) => {\n  const optionsStr = getEventOptionsStr(options);\n  return registeredEventHandlerData\n    .get(target)\n    ?.get(eventType)\n    ?.get(handler)\n    ?.get(optionsStr);\n};\n\nconst deleteEventHandlerData = (\n  target: EventTarget,\n  eventType: string,\n  handler: EventListenerOrEventListenerObject,\n  options: boolean | AddEventListenerOptions,\n) => {\n  const optionsStr = getEventOptionsStr(options);\n  MH.deleteKey(\n    registeredEventHandlerData.get(target)?.get(eventType)?.get(handler),\n    optionsStr,\n  );\n  registeredEventHandlerData.prune(target, eventType, handler);\n};\n\nconst setEventHandlerData = (\n  target: EventTarget,\n  eventType: string,\n  handler: EventListenerOrEventListenerObject,\n  options: boolean | AddEventListenerOptions,\n  data: EventHandlerData,\n) => {\n  const optionsStr = getEventOptionsStr(options);\n  registeredEventHandlerData\n    .sGet(target)\n    .sGet(eventType)\n    .sGet(handler)\n    .set(optionsStr, data);\n};\n\nconst transformEventType = (eventType: string) => {\n  const supports = getBrowserSupport();\n  if (eventType.startsWith(MC.S_POINTER) && !supports._pointer) {\n    // TODO maybe log a warning message is it's not supported, e.g. there's no\n    // mousecancel\n    return MH.strReplace(eventType, MC.S_POINTER, MC.S_MOUSE);\n  }\n\n  return eventType;\n};\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { Direction, GestureDevice, GestureIntent } from \"@lisn/globals/types\";\n\nimport { isValidStrList } from \"@lisn/utils/validation\";\n\n/**\n * `deltaX` and `deltaY` together specify the precise direction in the XY plane\n * of the move if relevant (i.e. other than zoom intent). The direction\n * specifies the effective X (\"left\"/\"right\"), Y (\"up\"/\"down\") or Z (\"in\"/\"out\")\n * direction, or \"none\"/\"ambiguous\".\n *\n * `deltaZ` specifies relative zoom in or out for zoom intents.\n * For zoom in, deltaZ is always > 1, and for zoom out it is < 1.\n * For non-zoom events it is 1.\n *\n * For zoom intents, `direction` would be either in, out or none.\n * For other intents, it would be up, down, left, right, none or ambiguous.\n *\n * For important notes on the delta values see\n * - {@link Utils.getKeyGestureFragment | getKeyGestureFragment}\n * - {@link Utils.getTouchGestureFragment | getTouchGestureFragment}\n * - {@link Utils.getWheelGestureFragment | getWheelGestureFragment}\n *\n * @category Gestures\n */\nexport type GestureFragment = {\n  device: GestureDevice;\n  direction: Direction;\n  intent: GestureIntent;\n  deltaX: number;\n  deltaY: number;\n  deltaZ: number;\n};\n\n/**\n * Returns true if the given string is a valid gesture device.\n *\n * @category Validation\n */\nexport const isValidInputDevice = (device: string): device is GestureDevice =>\n  MH.includes(DEVICES, device);\n\n/**\n * Returns true if the given string is a valid gesture intent.\n *\n * @category Validation\n */\nexport const isValidIntent = (intent: string): intent is GestureIntent =>\n  MH.includes(INTENTS, intent);\n\n/**\n * Returns true if the given string or array is a list of valid gesture\n * devices.\n *\n * @category Validation\n */\nexport const isValidInputDeviceList = (devices: string | string[]) =>\n  isValidStrList(devices, isValidInputDevice, false);\n\n/**\n * Returns true if the given string or array is a list of valid gesture\n * intents.\n *\n * @category Validation\n */\nexport const isValidIntentList = (intents: string | string[]) =>\n  isValidStrList(intents, isValidIntent, false);\n\n/**\n * @ignore\n * @internal\n */\nexport const addDeltaZ = (current: number, increment: number) =>\n  MH.max(MIN_DELTA_Z, current * increment);\n\n/**\n * @ignore\n * @internal\n */\nexport const DEVICES: GestureDevice[] = [\n  MC.S_KEY,\n  MC.S_POINTER,\n  MC.S_TOUCH,\n  MC.S_WHEEL,\n] as const;\n\n/**\n * @ignore\n * @internal\n */\nexport const INTENTS: GestureIntent[] = [\n  MC.S_SCROLL,\n  MC.S_ZOOM,\n  MC.S_DRAG,\n  MC.S_UNKNOWN,\n] as const;\n\n// Do not allow zooming out more than this value\nconst MIN_DELTA_Z = 0.1;\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { settings } from \"@lisn/globals/settings\";\n\nimport { Direction, GestureIntent } from \"@lisn/globals/types\";\n\nimport { getVectorDirection } from \"@lisn/utils/directions\";\n\nimport { GestureFragment, addDeltaZ } from \"@lisn/utils/gesture\";\n\n/**\n * Returns a {@link GestureFragment} for the given events. Only \"keydown\"\n * events will be considered.\n *\n * If there are no \"keydown\" events in the given list of events, returns\n * `false`.\n *\n * The deltas of all events are summed together before determining final delta\n * and direction.\n *\n * If the events are of conflicting types, i.e. some scroll, some zoom, then\n * the intent will be \"unknown\" and the direction will be \"ambiguous\".\n *\n * Otherwise, if the deltas sum up to 0, the direction will be \"none\".\n *\n * **IMPORTANT NOTES ON THE DELTA VALUES**\n *\n * For key gestures the deltas are unreliable. You should not assume they\n * correspond to the would-be scroll or zoom amount that the browser would do.\n * But they can be used to determine relative amounts for animating, etc.\n *\n * Key press events can be divided into 3 categories: that scroll by a \"line\"\n * (e.g. arrow keys), by a \"page\" (e.g. PageUp/PageDown) or by the full content\n * height/width (e.g. Home/End). The actual scroll amount that _would_ result\n * from the event is dependent on the browser, the window size or the element's\n * scroll width/height, so ours can only be a best guess.\n *\n * Since the actual pixel equivalent is browser specific, we use reasonable\n * default values of delta for each of these \"line\", \"page\" or \"content\" modes,\n * similar to what\n * {@link Utils.getWheelGestureFragment | getWheelGestureFragment} does:\n * - For \"line\", then a configurable fixed value is used\n *  ({@link settings.deltaLineHeight}).\n * - For \"page\", then a configurable fixed value is used\n *  ({@link settings.deltaPageHeight}).\n * - For \"content\", the element's scroll height is used if given, otherwise\n *   the viewport height (same as \"page\"). We do not try to get the current\n *   scroll height of the target element, (which would be the best guess value\n *   of `deltaY` in case of Home/End key presses), as that would either involve\n *   an asynchronous action or would result in forced layout. If the caller is\n *   already tracking the scroll height of the target, you can pass this as an\n *   argument. Otherwise, we'll default to using the viewport height, same as\n *   for PageUp/Down.\n *\n * If the key gesture fragment is a result of multiple events that were\n * accumulated, the deltas are summed as usual, e.g. if a \"page\" is equal to 20\n * \"lines\", then pressing PageDown and then 10 times Up, would result in a\n * delta equal to 10 \"lines\" down.\n *\n * For zoom intents, `deltaZ` gives a relative change of scale, whereby each\n * press of + or - steps up by 15% or down by ~13% (`1 / 1.15` to be exact)\n * since the previous one.\n *\n * @param [options.angleDiffThreshold] See {@link getVectorDirection}\n * @param [options.scrollHeight]       Use this as deltaY when Home/End is\n *                                     pressed.\n *\n * @returns `false` if there are no \"keydown\" events in the list, otherwise a\n * {@link GestureFragment}.\n *\n * @category Gestures\n */\nexport const getKeyGestureFragment = (\n  events: Event | readonly Event[],\n  options?: {\n    angleDiffThreshold?: number;\n    scrollHeight?: number;\n  },\n): GestureFragment | false => {\n  if (!MH.isIterableObject(events)) {\n    events = [events];\n  }\n\n  const LINE = settings.deltaLineHeight;\n  const PAGE = settings.deltaPageHeight;\n  const CONTENT = options?.scrollHeight ?? PAGE;\n\n  const deltasUp = (amount: number): DeltasArr => [0, -amount, 1];\n  const deltasDown = (amount: number): DeltasArr => [0, amount, 1];\n  const deltasLeft = (amount: number): DeltasArr => [-amount, 0, 1];\n  const deltasRight = (amount: number): DeltasArr => [amount, 0, 1];\n  const deltasIn: DeltasArr = [0, 0, 1.15];\n  const deltasOut: DeltasArr = [0, 0, 1 / 1.15];\n\n  let direction: Direction = MC.S_NONE;\n  let intent: GestureIntent | null = null;\n  let deltaX = 0,\n    deltaY = 0,\n    deltaZ = 1;\n\n  for (const event of events) {\n    if (!MH.isKeyboardEvent(event) || event.type !== MC.S_KEYDOWN) {\n      continue;\n    }\n\n    const deltasForKey: Record<string, DeltasArr | null> = {\n      [SK_UP]: deltasUp(LINE),\n      [SK_ARROWUP]: deltasUp(LINE),\n      [SK_PAGEUP]: deltasUp(PAGE),\n      Home: deltasUp(CONTENT),\n      [SK_DOWN]: deltasDown(LINE),\n      [SK_ARROWDOWN]: deltasDown(LINE),\n      [SK_PAGEDOWN]: deltasDown(PAGE),\n      End: deltasDown(CONTENT),\n      [SK_LEFT]: deltasLeft(LINE),\n      [SK_ARROWLEFT]: deltasLeft(LINE),\n      [SK_RIGHT]: deltasRight(LINE),\n      [SK_ARROWRIGHT]: deltasRight(LINE),\n      \" \": (event.shiftKey ? deltasUp : deltasDown)(PAGE),\n      \"+\": deltasIn,\n      \"=\": event.ctrlKey ? deltasIn : null,\n      \"-\": deltasOut,\n    };\n\n    const theseDeltas = deltasForKey[event.key] ?? null;\n    if (!theseDeltas) {\n      // not a relevant key\n      continue;\n    }\n\n    const [thisDeltaX, thisDeltaY, thisDeltaZ] = theseDeltas;\n    const thisIntent = thisDeltaZ !== 1 ? MC.S_ZOOM : MC.S_SCROLL;\n\n    deltaX += thisDeltaX;\n    deltaY += thisDeltaY;\n    deltaZ = addDeltaZ(deltaZ, thisDeltaZ);\n\n    if (!intent) {\n      intent = thisIntent;\n    } else if (intent !== thisIntent) {\n      // mixture of zoom and scroll\n      intent = MC.S_UNKNOWN;\n    }\n  }\n\n  if (!intent) {\n    return false; // no relevant events\n  } else if (intent === MC.S_UNKNOWN) {\n    direction = MC.S_AMBIGUOUS;\n  } else if (intent === MC.S_ZOOM) {\n    direction = deltaZ > 1 ? MC.S_IN : deltaZ < 1 ? MC.S_OUT : MC.S_NONE;\n  } else {\n    direction = getVectorDirection(\n      [deltaX, deltaY],\n      options?.angleDiffThreshold,\n    );\n  }\n\n  return direction === MC.S_NONE\n    ? false\n    : {\n        device: MC.S_KEY,\n        direction,\n        intent,\n        deltaX,\n        deltaY,\n        deltaZ,\n      };\n};\n\n// --------------------\n\ntype DeltasArr = [number, number, number];\n\nconst SK_UP = \"Up\";\nconst SK_DOWN = \"Down\";\nconst SK_LEFT = \"Left\";\nconst SK_RIGHT = \"Right\";\nconst SK_PAGE = \"Page\";\nconst SK_ARROW = \"Arrow\";\nconst SK_PAGEUP = (SK_PAGE + SK_UP) as `${typeof SK_PAGE}${typeof SK_UP}`;\nconst SK_PAGEDOWN = (SK_PAGE + SK_DOWN) as `${typeof SK_PAGE}${typeof SK_DOWN}`;\nconst SK_ARROWUP = (SK_ARROW + SK_UP) as `${typeof SK_ARROW}${typeof SK_UP}`;\nconst SK_ARROWDOWN = (SK_ARROW +\n  SK_DOWN) as `${typeof SK_ARROW}${typeof SK_DOWN}`;\nconst SK_ARROWLEFT = (SK_ARROW +\n  SK_LEFT) as `${typeof SK_ARROW}${typeof SK_LEFT}`;\nconst SK_ARROWRIGHT = (SK_ARROW +\n  SK_RIGHT) as `${typeof SK_ARROW}${typeof SK_RIGHT}`;\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { getVectorDirection } from \"@lisn/utils/directions\";\nimport { getBrowserSupport } from \"@lisn/utils/event\";\nimport { GestureFragment } from \"@lisn/utils/gesture\";\n\n/**\n * Returns a {@link GestureFragment} for the given events. If the browser\n * supports Pointer events, then only \"pointermove\" events will be considered.\n * Otherwise, only \"mousemove\" events will be considered.\n *\n * If there are less than 2 such events in the given list of events, returns\n * `false`.\n *\n * If the gesture is to be considered terminated, e.g. because there is\n * \"pointercancel\" in the list or buttons other than the primary are pressed,\n * returns `null`.\n *\n * Pointer gestures always require the primary button to be pressed and the\n * resulting intent is always \"drag\", and `deltaZ` is always 1.\n *\n * @param [options.angleDiffThreshold] See {@link getVectorDirection}\n *\n * @returns `false` if there are less than 2 \"pointermove\"/\"mousemove\" events\n * in the list, `null` if the gesture is terminated, otherwise a\n * {@link GestureFragment}.\n *\n * @category Gestures\n */\nexport const getPointerGestureFragment = (\n  events: Event | readonly Event[],\n  options?: {\n    angleDiffThreshold?: number;\n  },\n): GestureFragment | null | false => {\n  if (!MH.isIterableObject(events)) {\n    events = [events];\n  }\n\n  let isCancelled = false;\n  const supports = getBrowserSupport();\n\n  // If the browser supports pointer events, then only take those; otherwise\n  // take the mouse events\n  const pointerEventClass = supports._pointer ? PointerEvent : MouseEvent;\n  const pointerUpType = supports._pointer ? MC.S_POINTERUP : MC.S_MOUSEUP;\n\n  const filteredEvents: MouseEvent[] = MH.filter(\n    events,\n    (event): event is MouseEvent => {\n      const eType = event.type;\n      isCancelled = isCancelled || eType === MC.S_POINTERCANCEL;\n      if (eType !== MC.S_CLICK && MH.isInstanceOf(event, pointerEventClass)) {\n        // Only events where the primary button is pressed (unless it's a\n        // pointerup event, in which case no buttons should be pressed) are\n        // considered, otherwise consider it terminated\n        isCancelled =\n          isCancelled ||\n          (eType === pointerUpType && event.buttons !== 0) ||\n          (eType !== pointerUpType && event.buttons !== 1);\n        // we don't handle touch pointer events\n        return !MH.isTouchPointerEvent(event);\n      }\n      return false;\n    },\n  );\n\n  const numEvents = MH.lengthOf(filteredEvents);\n  if (numEvents < 2) {\n    return false; // no enough events\n  }\n\n  if (isCancelled) {\n    return null; // terminated\n  }\n\n  const firstEvent = filteredEvents[0];\n  const lastEvent = filteredEvents[numEvents - 1];\n  if (MH.getPointerType(firstEvent) !== MH.getPointerType(lastEvent)) {\n    return null; // different devices, consider it terminated\n  }\n\n  const deltaX = lastEvent.clientX - firstEvent.clientX;\n  const deltaY = lastEvent.clientY - firstEvent.clientY;\n  const direction = getVectorDirection(\n    [deltaX, deltaY],\n    options?.angleDiffThreshold,\n  );\n\n  return direction === MC.S_NONE\n    ? false\n    : {\n        device: MC.S_POINTER,\n        direction,\n        intent: MC.S_DRAG,\n        deltaX,\n        deltaY,\n        deltaZ: 1,\n      };\n};\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { Direction, GestureIntent, Vector } from \"@lisn/globals/types\";\n\nimport { getVectorDirection } from \"@lisn/utils/directions\";\n\nimport {\n  maxAbs,\n  havingMaxAbs,\n  distanceBetween,\n  areAntiParallel,\n} from \"@lisn/utils/math\";\nimport { GestureFragment } from \"@lisn/utils/gesture\";\n\nimport { newXMap } from \"@lisn/modules/x-map\";\n\n/**\n * @category Gestures\n */\nexport type TouchDiff = {\n  startX: number;\n  startY: number;\n\n  endX: number;\n  endY: number;\n\n  deltaX: number;\n  deltaY: number;\n\n  isSignificant: boolean;\n};\n\n/**\n * Returns a {@link GestureFragment} for the given events. Only \"touchmove\" events\n * will be considered.\n *\n * If there are less than 2 such events in the given list of events, returns `false`.\n *\n * If the gesture is to be considered terminated, e.g. because there is\n * \"touchcancel\" in the list, returns `null`.\n *\n * Note that by default swipe actions follow the natural direction: swipe up\n * with scroll intent results in direction down and swipe down results in\n * direction up. Drag intent always follows the direction of the gesture.\n *\n * For zoom intents, which necessarily involves exactly two fingers `deltaZ`\n * is based on the relative change in distance between the fingers.\n *\n * @param [options.deltaThreshold]\n *                          A change of x or y coordinate less than this is\n *                          considered insignificant, for the purposes of\n *                          determining:\n *                          1) whether the inferred direction is in one of the\n *                             four cardinal ones, or otherwise ambiguous; and\n *                          2) whether more than two fingers have moved and\n *                             therefore whether the direction could be zoom or\n *                             not\n * @param [options.angleDiffThreshold] See {@link getVectorDirection}\n * @param [options.reverseScroll]\n *                          If set to `true`, will disable natural scroll\n *                          direction.\n * @param [options.dragHoldTime]\n *                          If the user presses and holds for at least the\n *                          given amount of milliseconds before moving the\n *                          finger(s), gestures other than pinch will be\n *                          treated as a drag instead of scroll as long as the\n *                          number of fingers touching the screen is\n *                          `options.dragNumFingers`. Default is 500ms.\n * @param [options.dragNumFingers]\n *                          The number of fingers that could be considered a\n *                          drag intent. Default is 1.\n *\n * @returns `false` if there are less than 2 \"touchmove\" events in the list,\n * `null` if the gesture is terminated, otherwise a {@link GestureFragment}.\n *\n * @category Gestures\n */\nexport const getTouchGestureFragment = (\n  events: Event[],\n  options?: {\n    deltaThreshold?: number;\n    angleDiffThreshold?: number;\n    reverseScroll?: boolean;\n    dragHoldTime?: number;\n    dragNumFingers?: number;\n  },\n): GestureFragment | null | false => {\n  if (!MH.isIterableObject(events)) {\n    events = [events];\n  }\n\n  let moves = getTouchDiff(events, options?.deltaThreshold);\n\n  if (!moves) {\n    return null; // terminated\n  }\n\n  let numMoves = MH.lengthOf(moves);\n\n  const holdTime = getHoldTime(events);\n  const canBeDrag =\n    holdTime >= (options?.dragHoldTime ?? 500) &&\n    numMoves === (options?.dragNumFingers ?? 1);\n  const angleDiffThreshold = options?.angleDiffThreshold;\n\n  let deltaX = havingMaxAbs(...moves.map((m) => m.deltaX));\n  let deltaY = havingMaxAbs(...moves.map((m) => m.deltaY));\n  let deltaZ = 1;\n\n  if (numMoves > 2) {\n    // Take only the significant ones\n    moves = MH.filter(moves, (d) => d.isSignificant);\n    numMoves = MH.lengthOf(moves);\n  }\n\n  let direction: Direction = MC.S_NONE;\n  let intent: GestureIntent = MC.S_UNKNOWN;\n  if (numMoves === 2) {\n    // Check if it's a zoom\n    const vectorA: Vector = [moves[0].deltaX, moves[0].deltaY];\n    const vectorB: Vector = [moves[1].deltaX, moves[1].deltaY];\n\n    // If either finger is approx stationary, or if they move in opposite directions,\n    // treat it as zoom.\n    if (\n      !havingMaxAbs(...vectorA) || // finger A still\n      !havingMaxAbs(...vectorB) || // finger B still\n      areAntiParallel(vectorA, vectorB, angleDiffThreshold)\n    ) {\n      // It's a pinch motion => zoom\n      const startDistance = distanceBetween(\n        [moves[0].startX, moves[0].startY],\n        [moves[1].startX, moves[1].startY],\n      );\n\n      const endDistance = distanceBetween(\n        [moves[0].endX, moves[0].endY],\n        [moves[1].endX, moves[1].endY],\n      );\n\n      direction = startDistance < endDistance ? MC.S_IN : MC.S_OUT;\n      deltaZ = endDistance / startDistance;\n      deltaX = deltaY = 0;\n      intent = MC.S_ZOOM;\n    }\n  }\n\n  const deltaSign = canBeDrag || options?.reverseScroll ? 1 : -1;\n  // If scrolling, swap the deltas for natural scroll direction.\n  // Add +0 to force -0 to be +0 since jest doesn't think they're equal\n  deltaX = deltaSign * deltaX + 0;\n  deltaY = deltaSign * deltaY + 0;\n\n  if (direction === MC.S_NONE) {\n    // Wasn't a zoom. Check if all moves are aligned.\n    let isFirst = true;\n\n    for (const m of moves) {\n      // There's at least one significant move, assume scroll or drag intent.\n      intent = canBeDrag ? MC.S_DRAG : MC.S_SCROLL;\n\n      const thisDirection = getVectorDirection(\n        [deltaSign * m.deltaX, deltaSign * m.deltaY],\n        angleDiffThreshold,\n      );\n\n      if (thisDirection === MC.S_NONE) {\n        continue;\n      }\n\n      if (isFirst) {\n        direction = thisDirection;\n      } else if (direction !== thisDirection) {\n        direction = MC.S_AMBIGUOUS;\n        break;\n      }\n\n      isFirst = false;\n    }\n  }\n\n  if (direction === MC.S_NONE) {\n    const lastTouchEvent = MH.lastOf(events.filter(MH.isTouchEvent));\n    // If all fingers have lifted off, consider it terminated, otherwise wait\n    // for more events.\n    return MH.lengthOf(lastTouchEvent?.touches) ? false : null;\n  }\n\n  return {\n    device: MC.S_TOUCH,\n    direction,\n    intent,\n    deltaX,\n    deltaY,\n    deltaZ,\n  };\n};\n\n/**\n * Returns a description of the changes in each finger between the first and\n * the last relevant TouchEvent in the list.\n *\n * If the gesture is to be considered terminated, e.g. because there is\n * \"touchcancel\" in the list, returns `null`.\n *\n * Note that, `deltaX`/`deltaY` are the end X/Y coordinate minus the start X/Y\n * coordinate. For natural scroll direction you should swap their signs.\n *\n * @param deltaThreshold If the change of x and y coordinate are both less\n *                       than this, it is marked as not significant.\n *\n * @category Gestures\n */\nexport const getTouchDiff = (\n  events: Event[],\n  deltaThreshold = 0,\n): TouchDiff[] | null => {\n  // Group each touch point of each event by identifier, so that we can get the\n  // start and end coordinate of each finger\n  const groupedTouches = newXMap<number, Touch[]>((): Touch[] => []);\n\n  for (const event of events) {\n    if (!MH.isTouchEvent(event)) {\n      continue;\n    }\n\n    if (event.type === MC.S_TOUCHCANCEL) {\n      return null; // gesture terminated\n    }\n\n    for (const touch of event.touches) {\n      groupedTouches.sGet(touch.identifier).push(touch);\n    }\n  }\n\n  const moves: TouchDiff[] = [];\n\n  for (const touchList of groupedTouches.values()) {\n    const nTouches = MH.lengthOf(touchList);\n    if (nTouches < 2) {\n      // Only one event had that finger in it, so there's no move for it\n      continue;\n    }\n\n    const firstTouch = touchList[0];\n    const lastTouch = touchList[nTouches - 1];\n    const startX = firstTouch.clientX;\n    const startY = firstTouch.clientY;\n\n    const endX = lastTouch.clientX;\n    const endY = lastTouch.clientY;\n\n    const deltaX = endX - startX;\n    const deltaY = endY - startY;\n\n    const isSignificant = maxAbs(deltaX, deltaY) >= deltaThreshold;\n\n    // Consider it a move in one of the 4 cardinal ones\n    moves.push({\n      startX,\n      startY,\n      endX,\n      endY,\n      deltaX,\n      deltaY,\n      isSignificant,\n    });\n  }\n\n  return moves;\n};\n\n// --------------------\n\nconst getHoldTime = (events: Event[]) => {\n  const firstStart = events.findIndex((e) => e.type === MC.S_TOUCHSTART);\n  const firstMove = events.findIndex((e) => e.type === MC.S_TOUCHMOVE);\n  if (firstStart < 0 || firstMove < 1) {\n    return 0;\n  }\n\n  return events[firstMove].timeStamp - events[firstStart].timeStamp;\n};\n","/**\n * @module\n * @ignore\n * @internal\n *\n * FULL CREDIT FOR THIS GOES TO\n * https://github.com/facebookarchive/fixed-data-table/blob/master/src/vendor_upstream/dom/normalizeWheel.js\n *\n * ADAPTED FROM THE ABOVE SOURCE\n *\n * ORIGINAL COPYRIGHT IN FILE PRESERVED:\n *\n * Copyright (c) 2015, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * ORIGINAL LICENSE\n *\n * BSD License\n *\n * For FixedDataTable software\n *\n * Copyright (c) 2015, Facebook, Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *\n *  * Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n *  * Neither the name Facebook nor the names of its contributors may be used to\n *    endorse or promote products derived from this software without specific\n *    prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\n * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { settings } from \"@lisn/globals/settings\";\n\n/**\n * ORIGINAL DEVELOPER COMMENT PRESERVED\n *\n * Mouse wheel (and 2-finger trackpad) support on the web sucks.  It is\n * complicated, thus this doc is long and (hopefully) detailed enough to answer\n * your questions.\n *\n * If you need to react to the mouse wheel in a predictable way, this code is\n * like your bestest friend. * hugs *\n *\n * As of today, there are 4 DOM event types you can listen to:\n *\n *   'wheel'                -- Chrome(31+), FF(17+), IE(9+)\n *   'mousewheel'           -- Chrome, IE(6+), Opera, Safari\n *   'MozMousePixelScroll'  -- FF(3.5 only!) (2010-2013) -- don't bother!\n *   'DOMMouseScroll'       -- FF(0.9.7+) since 2003\n *\n * So what to do?  The is the best:\n *\n *   normalizeWheel.getEventType();\n *\n * In your event callback, use this code to get sane interpretation of the\n * deltas.  This code will return an object with properties:\n *\n *   spinX   -- normalized spin speed (use for zoom) - x plane\n *   spinY   -- \" - y plane\n *   pixelX  -- normalized distance (to pixels) - x plane\n *   pixelY  -- \" - y plane\n *\n * Wheel values are provided by the browser assuming you are using the wheel to\n * scroll a web page by a number of lines or pixels (or pages).  Values can vary\n * significantly on different platforms and browsers, forgetting that you can\n * scroll at different speeds.  Some devices (like trackpads) emit more events\n * at smaller increments with fine granularity, and some emit massive jumps with\n * linear speed or acceleration.\n *\n * This code does its best to normalize the deltas for you:\n *\n *   - spin is trying to normalize how far the wheel was spun (or trackpad\n *     dragged).  This is super useful for zoom support where you want to\n *     throw away the chunky scroll steps on the PC and make those equal to\n *     the slow and smooth tiny steps on the Mac. Key data: This code tries to\n *     resolve a single slow step on a wheel to 1.\n *\n *   - pixel is normalizing the desired scroll delta in pixel units.  You'll\n *     get the crazy differences between browsers, but at least it'll be in\n *     pixels!\n *\n *   - positive value indicates scrolling DOWN/RIGHT, negative UP/LEFT.  This\n *     should translate to positive value zooming IN, negative zooming OUT.\n *     This matches the newer 'wheel' event.\n *\n * Why are there spinX, spinY (or pixels)?\n *\n *   - spinX is a 2-finger side drag on the trackpad, and a shift + wheel turn\n *     with a mouse.  It results in side-scrolling in the browser by default.\n *\n *   - spinY is what you expect -- it's the classic axis of a mouse wheel.\n *\n *   - I dropped spinZ/pixelZ.  It is supported by the DOM 3 'wheel' event and\n *     probably is by browsers in conjunction with fancy 3D controllers .. but\n *     you know.\n *\n * Implementation info:\n *\n * Examples of 'wheel' event if you scroll slowly (down) by one step with an\n * average mouse:\n *\n *   OS X + Chrome  (mouse)     -    4   pixel delta  (wheelDelta -120)\n *   OS X + Safari  (mouse)     -  N/A   pixel delta  (wheelDelta  -12)\n *   OS X + Firefox (mouse)     -    0.1 line  delta  (wheelDelta  N/A)\n *   Win8 + Chrome  (mouse)     -  100   pixel delta  (wheelDelta -120)\n *   Win8 + Firefox (mouse)     -    3   line  delta  (wheelDelta -120)\n *\n * On the trackpad:\n *\n *   OS X + Chrome  (trackpad)  -    2   pixel delta  (wheelDelta   -6)\n *   OS X + Firefox (trackpad)  -    1   pixel delta  (wheelDelta  N/A)\n *\n * On other/older browsers.. it's more complicated as there can be multiple and\n * also missing delta values.\n *\n * The 'wheel' event is more standard:\n *\n * http://www.w3.org/TR/DOM-Level-3-Events/#events-wheelevents\n *\n * The basics is that it includes a unit, deltaMode (pixels, lines, pages), and\n * deltaX, deltaY and deltaZ.  Some browsers provide other values to maintain\n * backward compatibility with older events.  Those other values help us\n * better normalize spin speed.  Example of what the browsers provide:\n *\n *                          | event.wheelDelta | event.detail\n *        ------------------+------------------+--------------\n *          Safari v5/OS X  |       -120       |       0\n *          Safari v5/Win7  |       -120       |       0\n *         Chrome v17/OS X  |       -120       |       0\n *         Chrome v17/Win7  |       -120       |       0\n *                IE9/Win7  |       -120       |   undefined\n *         Firefox v4/OS X  |     undefined    |       1\n *         Firefox v4/Win7  |     undefined    |       3\n */\nexport const normalizeWheel = (event: LegacyWheelEvent): WheelData => {\n  let spinX = 0,\n    spinY = 0,\n    pixelX = event.deltaX,\n    pixelY = event.deltaY;\n\n  const LINE = settings.deltaLineHeight;\n\n  // Legacy\n  if (event.detail !== undefined) {\n    spinY = event.detail;\n  }\n  if (event.wheelDelta !== undefined) {\n    spinY = -event.wheelDelta / 120;\n  }\n  if (event.wheelDeltaY !== undefined) {\n    spinY = -event.wheelDeltaY / 120;\n  }\n  if (event.wheelDeltaX !== undefined) {\n    spinX = -event.wheelDeltaX / 120;\n  }\n\n  if ((pixelX || pixelY) && event.deltaMode) {\n    if (event.deltaMode === 1) {\n      // delta in LINE units\n      pixelX *= LINE;\n      pixelY *= LINE;\n    } else {\n      // delta in PAGE units\n      pixelX *= settings.deltaPageWidth;\n      pixelY *= settings.deltaPageHeight;\n    }\n  }\n\n  // Fall-back if spin cannot be determined\n  if (pixelX && !spinX) {\n    spinX = pixelX < 1 ? -1 : 1;\n  }\n  if (pixelY && !spinY) {\n    spinY = pixelY < 1 ? -1 : 1;\n  }\n\n  return { spinX, spinY, pixelX, pixelY };\n};\n\nexport type WheelData = {\n  spinX: number;\n  spinY: number;\n  pixelX: number;\n  pixelY: number;\n};\n\n// --------------------\n\ntype LegacyWheelEvent = WheelEvent & {\n  wheelDelta?: number;\n  wheelDeltaX?: number;\n  wheelDeltaY?: number;\n};\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { Direction, GestureIntent } from \"@lisn/globals/types\";\n\nimport { getVectorDirection } from \"@lisn/utils/directions\";\n\nimport { havingMaxAbs } from \"@lisn/utils/math\";\nimport { normalizeWheel } from \"@lisn/utils/normalize-wheel\";\n\nimport { GestureFragment, addDeltaZ } from \"@lisn/utils/gesture\";\n\n/**\n * Returns a {@link GestureFragment} for the given events. Only \"wheel\" events\n * will be considered.\n *\n * If there are no \"wheel\" events in the given list of events, returns `false`.\n *\n * The deltas of all events are summed together before determining final delta\n * and direction.\n *\n * If the events are of conflicting types, i.e. some scroll, some zoom, then\n * the intent will be \"unknown\" and the direction will be \"ambiguous\".\n *\n * If the deltas sum up to 0, the direction will be \"none\".\n *\n * **IMPORTANT NOTES ON THE DELTA VALUES**\n *\n * For wheel gestures the deltas are _highly_ unreliable, especially when\n * zooming (Control + wheel or pinching trackpad). You should not assume they\n * correspond to the would-be scroll or zoom amount that the browser would do.\n * But they can be used to determine relative amounts for animating, etc.\n *\n * If the browser reports the delta values of a WheelEvent to be in mode \"line\",\n * then a configurable fixed value is used\n * ({@link Settings.settings.deltaLineHeight | settings.deltaLineHeight}).\n *\n * If the browser reports the delta values of a WheelEvent to be in mode \"page\",\n * then a configurable fixed value is used\n * ({@link Settings.settings.deltaPageWidth | settings.deltaPageWidth} and\n * ({@link Settings.settings.deltaPageHeight | settings.deltaPageHeight}).\n *\n * For zoom intents `deltaZ` is based on what the browser reports as the\n * `deltaY`, which in most browsers roughly corresponds to a percentage zoom\n * factor.\n *\n * @param [options.angleDiffThreshold] See {@link getVectorDirection}.\n *                                     Default is 5.\n *\n * @returns `false` if there are no \"wheel\" events in the list, otherwise a\n * {@link GestureFragment}.\n *\n * @category Gestures\n */\nexport const getWheelGestureFragment = (\n  events: Event | readonly Event[],\n  options?: {\n    angleDiffThreshold?: number;\n  },\n): GestureFragment | null | false => {\n  if (!MH.isIterableObject(events)) {\n    events = [events];\n  }\n\n  let direction: Direction = MC.S_NONE;\n  let intent: GestureIntent | null = null;\n  let deltaX = 0,\n    deltaY = 0,\n    deltaZ = 1;\n\n  for (const event of events) {\n    if (!MH.isWheelEvent(event) || event.type !== MC.S_WHEEL) {\n      continue;\n    }\n\n    const data = normalizeWheel(event);\n    let thisIntent: GestureIntent = MC.S_SCROLL;\n    let thisDeltaX = data.pixelX;\n    let thisDeltaY = data.pixelY;\n    let thisDeltaZ = 1;\n    const maxDelta = havingMaxAbs(thisDeltaX, thisDeltaY);\n\n    if (event.ctrlKey && !thisDeltaX) {\n      // Browsers report negative deltaY for zoom in, so swap sign\n      let percentage = -maxDelta;\n      // If it's more than 50, assume it's a mouse wheel => delta is roughly\n      // multiple of 10%. Otherwise a trackpad => delta is roughly multiple of 1%\n      if (MH.abs(percentage) >= 50) {\n        percentage /= 10;\n      }\n\n      thisDeltaZ = 1 + percentage / 100;\n\n      thisDeltaX = thisDeltaY = 0;\n      thisIntent = MC.S_ZOOM;\n    } else if (event.shiftKey && !thisDeltaX) {\n      // Holding Shift while turning wheel or swiping trackpad in vertically\n      // results in sideways scroll.\n      thisDeltaX = thisDeltaY;\n      thisDeltaY = 0;\n    }\n\n    deltaX += thisDeltaX;\n    deltaY += thisDeltaY;\n    deltaZ = addDeltaZ(deltaZ, thisDeltaZ);\n\n    if (!thisIntent) {\n      // not a relevant key\n    } else if (!intent) {\n      intent = thisIntent;\n    } else if (intent !== thisIntent) {\n      // mixture of zoom and scroll\n      intent = MC.S_UNKNOWN;\n    }\n  }\n\n  if (!intent) {\n    return false; // no relevant events\n  } else if (intent === MC.S_UNKNOWN) {\n    direction = MC.S_AMBIGUOUS;\n  } else if (intent === MC.S_ZOOM) {\n    direction = deltaZ > 1 ? MC.S_IN : deltaZ < 1 ? MC.S_OUT : MC.S_NONE;\n  } else {\n    direction = getVectorDirection(\n      [deltaX, deltaY],\n      options?.angleDiffThreshold,\n    );\n  }\n\n  return direction === MC.S_NONE\n    ? false\n    : {\n        device: MC.S_WHEEL,\n        direction,\n        intent,\n        deltaX,\n        deltaY,\n        deltaZ,\n      };\n};\n","/**\n * @module Watchers/GestureWatcher\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  Direction,\n  GestureIntent,\n  GestureDevice,\n  CommaSeparatedStr,\n} from \"@lisn/globals/types\";\n\nimport {\n  addClasses,\n  removeClasses,\n  setNumericStyleJsVars,\n} from \"@lisn/utils/css-alter\";\nimport { isValidDirection } from \"@lisn/utils/directions\";\nimport {\n  addEventListenerTo,\n  removeEventListenerFrom,\n  preventSelect,\n  undoPreventSelect,\n} from \"@lisn/utils/event\";\nimport { getDebouncedHandler } from \"@lisn/utils/tasks\";\n\nimport { addDeltaZ } from \"@lisn/utils/gesture\";\n\nimport {\n  isValidInputDevice,\n  isValidIntent,\n  GestureFragment,\n  DEVICES,\n  INTENTS,\n} from \"@lisn/utils/gesture\";\nimport { getKeyGestureFragment } from \"@lisn/utils/gesture-key\";\nimport { getPointerGestureFragment } from \"@lisn/utils/gesture-pointer\";\nimport { getTouchGestureFragment } from \"@lisn/utils/gesture-touch\";\nimport { getWheelGestureFragment } from \"@lisn/utils/gesture-wheel\";\nimport { logError } from \"@lisn/utils/log\";\nimport {\n  maxAbs,\n  toNonNegNum,\n  toPosNum,\n  toNumWithBounds,\n} from \"@lisn/utils/math\";\nimport { randId, objToStrKey } from \"@lisn/utils/text\";\nimport { validateStrList } from \"@lisn/utils/validation\";\n\nimport {\n  CallbackHandler,\n  Callback,\n  wrapCallback,\n} from \"@lisn/modules/callback\";\nimport { newXWeakMap } from \"@lisn/modules/x-map\";\n\nimport { LoggerInterface } from \"@lisn/debug/types\";\nimport debug from \"@lisn/debug/debug\";\n\n/**\n * {@link GestureWatcher} listens for user gestures resulting from wheel,\n * pointer, touch or key input events.\n *\n * It supports scroll, zoom or drag type gestures.\n *\n * It manages registered callbacks globally and reuses event listeners for more\n * efficient performance.\n */\nexport class GestureWatcher {\n  /**\n   * Call the given handler whenever the user performs a gesture on the target\n   * matching the given options.\n   *\n   * **IMPORTANT:** The same handler can _not_ be added multiple times for the\n   * same event target, even if the options differ. If the handler has already\n   * been added for this target, either using {@link onGesture} or\n   * {@link trackGesture}, then it will be removed and re-added with the\n   * current options.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the options are invalid.\n   */\n  readonly onGesture: (\n    target: EventTarget,\n    handler: OnGestureHandler,\n    options?: OnGestureOptions,\n  ) => Promise<void>;\n\n  /**\n   * Removes a previously added handler.\n   */\n  readonly offGesture: (target: EventTarget, handler: OnGestureHandler) => void;\n\n  /**\n   * This is the same as {@link onGesture} except that if `handler` is not\n   * given, then it defaults to an internal handler that updates a set of CSS\n   * variables on the target's style:\n   *\n   *   - `--lisn-js--<Intent>-delta-x`\n   *   - `--lisn-js--<Intent>-delta-y`\n   *   - `--lisn-js--<Intent>-delta-z`\n   *\n   * where and `<Intent>` is one of {@link GestureIntent} and the delta X, Y\n   * and Z are the _total summed up_ `deltaX`, `deltaY` and `deltaZ` since the\n   * callback was added, summed over all devices used (key, touch, etc).\n   *\n   * **IMPORTANT:** The same handler can _not_ be added multiple times for the\n   * same target, even if the options differ. If the handler has already been\n   * added for this target, either using {@link trackGesture} or using\n   * {@link onGesture}, then it will be removed and re-added with the current\n   * options.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the options are invalid.\n   */\n  readonly trackGesture: (\n    element: Element,\n    handler?: OnGestureHandler | null,\n    options?: OnGestureOptions,\n  ) => Promise<void>;\n\n  /**\n   * Removes a previously added handler for {@link trackGesture}.\n   */\n  readonly noTrackGesture: (\n    element: Element,\n    handler?: OnGestureHandler | null,\n  ) => void;\n\n  /**\n   * Creates a new instance of GestureWatcher with the given\n   * {@link GestureWatcherConfig}. It does not save it for future reuse.\n   */\n  static create(config?: GestureWatcherConfig) {\n    return new GestureWatcher(getConfig(config), CONSTRUCTOR_KEY);\n  }\n\n  /**\n   * Returns an existing instance of GestureWatcher with the given\n   * {@link GestureWatcherConfig}, or creates a new one.\n   *\n   * **NOTE:** It saves it for future reuse, so don't use this for temporary\n   * short-lived watchers.\n   */\n  static reuse(config?: GestureWatcherConfig) {\n    const myConfig = getConfig(config);\n    const configStrKey = objToStrKey(myConfig);\n\n    let instance = instances.get(configStrKey);\n    if (!instance) {\n      instance = new GestureWatcher(myConfig, CONSTRUCTOR_KEY);\n      instances.set(configStrKey, instance);\n    }\n\n    return instance;\n  }\n\n  private constructor(\n    config: GestureWatcherConfigInternal,\n    key: typeof CONSTRUCTOR_KEY,\n  ) {\n    if (key !== CONSTRUCTOR_KEY) {\n      throw MH.illegalConstructorError(\"GestureWatcher.create\");\n    }\n\n    const logger = debug\n      ? new debug.Logger({ name: \"GestureWatcher\", logAtCreation: config })\n      : null;\n\n    const allCallbacks = newXWeakMap<\n      EventTarget,\n      Map<\n        OnGestureHandler,\n        {\n          _callback: OnGestureCallback;\n          _wrapper: OnGestureHandlerWrapper;\n          _options: OnGestureOptionsInternal;\n        }\n      >\n    >(() => MH.newMap());\n\n    // For each target and event type, add only 1 global listener that will then\n    // manage the event queues and callbacks.\n    const allListeners = newXWeakMap<\n      EventTarget,\n      Map<GestureDevice, DeviceListeners>\n    >(() => MH.newMap());\n\n    // ----------\n\n    const createCallback = (\n      target: EventTarget,\n      handler: OnGestureHandler,\n      options: OnGestureOptionsInternal,\n    ): OnGestureCallback => {\n      MH.remove(allCallbacks.get(target)?.get(handler)?._callback);\n\n      debug: logger?.debug5(\"Adding/updating handler for\", options);\n      const { _callback, _wrapper } = getCallbackAndWrapper(\n        handler,\n        options,\n        logger,\n      );\n\n      _callback.onRemove(() => deleteHandler(target, handler, options));\n\n      allCallbacks.sGet(target).set(handler, {\n        _callback,\n        _wrapper,\n        _options: options,\n      });\n\n      return _callback;\n    };\n\n    // ----------\n\n    // async for consistency with other watchers and future compatibility in\n    // case of change needed\n    const setupOnGesture = async (\n      target: EventTarget,\n      handler: OnGestureHandler,\n      userOptions: OnGestureOptions | undefined,\n    ) => {\n      const options = getOptions(config, userOptions ?? {});\n      createCallback(target, handler, options);\n\n      for (const device of options._devices ?? DEVICES) {\n        let listeners = allListeners.get(target)?.get(device);\n        if (listeners) {\n          debug: logger?.debug4(\n            `Listeners already added for ${device}`,\n            target,\n            options,\n          );\n        } else {\n          debug: logger?.debug4(\n            `Adding listeners for ${device}`,\n            target,\n            options,\n          );\n\n          listeners = setupListeners(target, device, options);\n          allListeners.sGet(target).set(device, listeners);\n        }\n\n        listeners._nCallbacks++;\n        if (options._preventDefault) {\n          listeners._nPreventDefault++;\n        }\n      }\n    };\n\n    // ----------\n\n    const deleteHandler = (\n      target: EventTarget,\n      handler: OnGestureHandler,\n      options: OnGestureOptionsInternal,\n    ) => {\n      MH.deleteKey(allCallbacks.get(target), handler);\n      allCallbacks.prune(target);\n\n      for (const device of options._devices ?? DEVICES) {\n        const listeners = allListeners.get(target)?.get(device);\n        if (listeners) {\n          listeners._nCallbacks--;\n          if (options._preventDefault) {\n            listeners._nPreventDefault--;\n          }\n\n          if (!listeners._nCallbacks) {\n            debug: logger?.debug4(\n              `No more callbacks for target and device ${device}; removing listeners`,\n              target,\n            );\n\n            MH.deleteKey(allListeners.get(target), device);\n            listeners._remove();\n          }\n        }\n      }\n    };\n\n    // ----------\n\n    const invokeCallbacks = (\n      target: EventTarget,\n      device: GestureDevice,\n      event: Event,\n    ): boolean /* true if terminated */ => {\n      const preventDefault =\n        (allListeners.get(target)?.get(device)?._nPreventDefault ?? 0) > 0;\n\n      let isTerminated = false;\n      for (const { _wrapper } of allCallbacks.get(target)?.values() || []) {\n        isTerminated =\n          _wrapper(target, device, event, preventDefault) || isTerminated;\n      }\n\n      return isTerminated;\n    };\n\n    // ----------\n\n    const setupListeners = (\n      target: EventTarget,\n      device: GestureDevice,\n      options: OnGestureOptionsInternal,\n    ): DeviceListeners => {\n      const intents = options._intents;\n      let hasAddedTabIndex = false;\n      let hasPreventedSelect = false;\n\n      if (\n        device === MC.S_KEY &&\n        MH.isElement(target) &&\n        !MH.getTabIndex(target)\n      ) {\n        hasAddedTabIndex = true;\n        // enable element to receive keydown events\n        MH.setTabIndex(target);\n      } else if (MH.isElement(target) && device === MC.S_TOUCH) {\n        if (options._preventDefault) {\n          addClasses(target, MC.PREFIX_NO_TOUCH_ACTION);\n        }\n\n        if (!intents || MH.includes(intents, MC.S_DRAG)) {\n          hasPreventedSelect = true;\n          preventSelect(target);\n        }\n      }\n\n      const addOrRemoveListeners = (\n        action: \"add\" | \"remove\",\n        listener: EventListener,\n        eventTypes: readonly (keyof GlobalEventHandlersEventMap)[],\n      ) => {\n        const method =\n          action === \"add\" ? addEventListenerTo : removeEventListenerFrom;\n        for (const eventType of eventTypes) {\n          debug: logger?.debug8(`${action} listener for ${eventType}`, target);\n          method(target, eventType, listener, {\n            passive: false,\n            capture: true,\n          });\n        }\n      };\n\n      const addInitialListener = () =>\n        addOrRemoveListeners(\"add\", initialListener, initiatingEvents[device]);\n\n      const removeInitialListener = () =>\n        addOrRemoveListeners(\n          \"remove\",\n          initialListener,\n          initiatingEvents[device],\n        );\n\n      const addOngoingListener = () =>\n        addOrRemoveListeners(\"add\", processEvent, ongoingEvents[device]);\n\n      const removeOngoingListener = () =>\n        addOrRemoveListeners(\"remove\", processEvent, ongoingEvents[device]);\n\n      const initialListener = (event: Event) => {\n        processEvent(event);\n        removeInitialListener();\n        addOngoingListener();\n      };\n\n      const processEvent = (event: Event) => {\n        const isTerminated = invokeCallbacks(target, device, event);\n        if (isTerminated) {\n          removeOngoingListener();\n          addInitialListener();\n        }\n      };\n\n      addInitialListener();\n\n      return {\n        _nCallbacks: 0,\n        _nPreventDefault: 0,\n        _remove: () => {\n          if (MH.isElement(target)) {\n            if (hasAddedTabIndex) {\n              MH.unsetTabIndex(target);\n            }\n\n            removeClasses(target, MC.PREFIX_NO_TOUCH_ACTION);\n\n            if (hasPreventedSelect) {\n              undoPreventSelect(target);\n            }\n          }\n\n          removeOngoingListener();\n          removeInitialListener();\n        },\n      };\n    };\n\n    // ----------\n\n    this.trackGesture = (element, handler?, options?) => {\n      if (!handler) {\n        handler = setGestureCssProps;\n        // initial values\n        for (const intent of INTENTS) {\n          setGestureCssProps(element, {\n            intent,\n            totalDeltaX: 0,\n            totalDeltaY: 0,\n            totalDeltaZ: 1,\n          });\n        }\n      }\n\n      return setupOnGesture(element, handler, options);\n    };\n\n    // ----------\n\n    this.noTrackGesture = (element, handler?) => {\n      if (!handler) {\n        handler = setGestureCssProps;\n\n        // delete the properties\n        for (const intent of INTENTS) {\n          setGestureCssProps(element, { intent });\n        }\n      }\n\n      this.offGesture(element, handler);\n    };\n\n    // ----------\n\n    this.onGesture = setupOnGesture;\n\n    // ----------\n\n    this.offGesture = (target, handler) => {\n      debug: logger?.debug5(\"Removing handler\");\n      MH.remove(allCallbacks.get(target)?.get(handler)?._callback);\n    };\n  }\n}\n\n/**\n * @interface\n */\nexport type GestureWatcherConfig = {\n  /**\n   * The default value for\n   * {@link OnGestureOptions.preventDefault | preventDefault} in calls to\n   * {@link GestureWatcher.onGesture}.\n   *\n   * @defaultValue true\n   */\n  preventDefault?: boolean;\n\n  /**\n   * The default value for\n   * {@link OnGestureOptions.debounceWindow | debounceWindow} in calls to\n   * {@link GestureWatcher.onGesture}.\n   *\n   * @defaultValue 150\n   */\n  debounceWindow?: number;\n\n  /**\n   * The default value for\n   * {@link OnGestureOptions.deltaThreshold | deltaThreshold} in calls to\n   * {@link GestureWatcher.onGesture}.\n   *\n   * @defaultValue 5\n   */\n  deltaThreshold?: number;\n\n  /**\n   * The default value for\n   * {@link OnGestureOptions.angleDiffThreshold | angleDiffThreshold} in calls to\n   * {@link GestureWatcher.onGesture}.\n   *\n   * It does not make much sense to set this to 0.\n   *\n   * The value is in _degrees_, not radians.\n   *\n   * @defaultValue 35\n   */\n  angleDiffThreshold?: number;\n\n  /**\n   * The default value for\n   * {@link OnGestureOptions.naturalTouchScroll | naturalTouchScroll} in calls to\n   * {@link GestureWatcher.onGesture}.\n   *\n   * @defaultValue true\n   */\n  naturalTouchScroll?: boolean;\n\n  /**\n   * The default value for\n   * {@link OnGestureOptions.touchDragHoldTime | touchDragHoldTime} in calls to\n   * {@link GestureWatcher.onGesture}.\n   *\n   * @defaultValue 500\n   */\n  touchDragHoldTime?: number;\n\n  /**\n   * The default value for\n   * {@link OnGestureOptions.touchDragNumFingers | touchDragNumFingers} in calls to\n   * {@link GestureWatcher.onGesture}.\n   *\n   * @defaultValue 1\n   */\n  touchDragNumFingers?: number;\n};\n\n/**\n * @interface\n */\nexport type OnGestureOptions = {\n  /**\n   * One or more device types to listen for. If not specified, then all devices\n   * are enabled.\n   *\n   * It can be a comma-separated list of {@link GestureDevice}s or an array of\n   * such devices.\n   *\n   * @defaultValue undefined\n   */\n  devices?: CommaSeparatedStr<GestureDevice> | GestureDevice[];\n\n  /**\n   * If given, callback will only be called if the gesture's direction is one\n   * of the given ones.\n   *\n   * It can be a comma-separated list of {@link Direction}s or an array of such\n   * directions.\n   *\n   * @defaultValue undefined\n   */\n  directions?: CommaSeparatedStr<Direction> | Direction[];\n\n  /**\n   * If given, callback will only be called if the gesture's intent is one\n   * of the given ones.\n   *\n   * It can be a comma-separated list of {@link GestureIntent}s or an\n   * array of such intents.\n   *\n   * @defaultValue undefined\n   */\n  intents?: CommaSeparatedStr<GestureIntent> | GestureIntent[];\n\n  /**\n   * Set minimum total delta X. Further reductions in delta X below this value\n   * will be ignored.\n   *\n   * The value is in pixels and can be negative.\n   *\n   * @defaultValue undefined\n   */\n  minTotalDeltaX?: number;\n\n  /**\n   * Set maximum total delta X. Further increase in delta X above this value\n   * will be ignored.\n   *\n   * The value is in pixels.\n   *\n   * @defaultValue undefined\n   */\n  maxTotalDeltaX?: number;\n\n  /**\n   * Set minimum total delta Y. Further reductions in delta Y below this value\n   * will be ignored.\n   *\n   * The value is in pixels and can be negative.\n   *\n   * @defaultValue undefined\n   */\n  minTotalDeltaY?: number;\n\n  /**\n   * Set maximum total delta Y. Further increase in delta Y above this value\n   * will be ignored.\n   *\n   * The value is in pixels.\n   *\n   * @defaultValue undefined\n   */\n  maxTotalDeltaY?: number;\n\n  /**\n   * Set minimum total delta Z. Further reductions in delta Z below this value\n   * will be ignored.\n   *\n   * The value is in percentage zoom, relative to 1, and can be less than 1 but\n   * must be > 0.1 which is a hard minimum.\n   *\n   * @defaultValue undefined\n   */\n  minTotalDeltaZ?: number;\n\n  /**\n   * Set maximum total delta Z. Further increase in delta Z above this value\n   * will be ignored.\n   *\n   * The value is in percentage zoom, relative to 1, and must be positive.\n   *\n   * @defaultValue undefined\n   */\n  maxTotalDeltaZ?: number;\n\n  /**\n   * If true, the events of the gesture, e.g. relevant key presses or touch\n   * moves, etc, will have their default action prevented.\n   *\n   * **IMPORTANT:** For pointer gestures, then pointer/mouse down and click\n   * will be prevented.\n   *\n   * @defaultValue {@link GestureWatcherConfig.preventDefault}\n   */\n  preventDefault?: boolean;\n\n  /**\n   * If given, callback will be called at most once every `debounceWindow`\n   * milliseconds.\n   *\n   * Note that if both `debounceWindow` and `deltaThreshold` are set, _both_\n   * must be exceeded before callback is called.\n   *\n   * @defaultValue {@link GestureWatcherConfig.debounceWindow}\n   */\n  debounceWindow?: number;\n\n  /**\n   * Callback will only be called when the gesture's accumulated delta, since\n   * the last time callback was called, exceeds `deltaThreshold`.\n   *\n   * At least one of the three deltas (X, Y or Z) must exceed this number (in\n   * absolute value). Note that when comparing `deltaZ`, it is multiplied by\n   * 100 since it represents fractions of 1 (100%). So supplying\n   * `deltaThreshold` of 10 means is equivalent to the following condition:\n   *\n   * ```\n   * abs(deltaX) >= 10 || abs(deltaY) >= 10 ||  abs(1 - deltaZ) >= 0.1\n   * ```\n   *\n   * Accumulation of the delta ends if the gesture is terminated, for example,\n   * in case of touch gestures, by a \"touchcancel\" event of by the final finger\n   * lifting off..\n   *\n   * Note that if both `debounceWindow` and `deltaThreshold` are set, _both_\n   * must be exceeded before callback is called.\n   *\n   * @defaultValue {@link GestureWatcherConfig.deltaThreshold}\n   */\n  deltaThreshold?: number;\n\n  /**\n   * See {@link Utils.getVectorDirection | getVectorDirection}.\n   *\n   * @defaultValue {@link GestureWatcherConfig.angleDiffThreshold}\n   */\n  angleDiffThreshold?: number;\n\n  /**\n   * Whether touch scroll gestures follow the natural direction: swipe up\n   * with scroll intent results in direction down and swipe down results in\n   * direction up.\n   *\n   * @defaultValue {@link GestureWatcherConfig.naturalTouchScroll}\n   */\n  naturalTouchScroll?: boolean;\n\n  /**\n   * If the user presses and holds on a touchscreen for at least the given\n   * amount of milliseconds before moving the finger(s), touch gestures other\n   * than pinch will be treated as a drag intent instead of scroll as long as\n   * the number of fingers touching the screen is {@link touchDragNumFingers}.\n   *\n   * Set to 0 in order to treat _all_ non-pinch touch gestures as drag.\n   *\n   * Set to a negative number in order to treat _all_ non-pinch touch gestures\n   * as scroll.\n   *\n   * @defaultValue {@link GestureWatcherConfig.touchDragHoldTime}\n   */\n  touchDragHoldTime?: number;\n\n  /**\n   * The number of fingers that could be considered a drag intent for touch\n   * gestures.\n   *\n   * @defaultValue {@link GestureWatcherConfig.touchDragHoldTime}\n   */\n  touchDragNumFingers?: number;\n};\n\n/**\n * The handler is invoked with two arguments:\n *\n * - the event target that was passed to the {@link GestureWatcher.onGesture}\n *   call (equivalent to\n *   {@link https://developer.mozilla.org/en-US/docs/Web/API/Event/currentTarget | Event:currentTarget}).\n * - the {@link GestureData} that describes the gesture's progression since the\n *   last time the callback was called and since the callback was added.\n */\nexport type OnGestureHandlerArgs = [EventTarget, GestureData, Event[]];\nexport type OnGestureCallback = Callback<OnGestureHandlerArgs>;\nexport type OnGestureHandler =\n  | CallbackHandler<OnGestureHandlerArgs>\n  | OnGestureCallback;\n\nexport type GestureData = {\n  device: GestureDevice;\n  direction: Direction;\n  intent: GestureIntent;\n\n  /**\n   * Delta in the horizontal direction since the start of the gesture.\n   */\n  deltaX: number;\n\n  /**\n   * Delta in the vertical direction since the start of the gesture.\n   */\n  deltaY: number;\n\n  /**\n   * Relative fractional zoom in or out for zoom intents since the start of\n   * the gesture.\n   *\n   * For zoom in, `deltaZ` is always > 1, and for zoom out it is < 1.\n   *\n   * For non-zoom gestures it is 1.\n   */\n  deltaZ: number;\n\n  /**\n   * The time in milliseconds it took for the gesture. This will be the\n   * difference in timestamps between the first and last event that composed\n   * the gesture. For key and wheel gestures this could be 0, since 1 event is\n   * sufficient for them.\n   */\n  time: number;\n  // TODO totalTime, velocity (bound by max), averageVelocity (bound by max)\n\n  /**\n   * Delta in the horizontal direction since the callback was added.\n   */\n  totalDeltaX: number;\n\n  /**\n   * Delta in the vertical direction since the callback was added.\n   */\n  totalDeltaY: number;\n\n  /**\n   * Percentage (relative) zoom in or out for zoom intents since the callback\n   * was added.\n   */\n  totalDeltaZ: number;\n};\n\n// ----------------------------------------\n\ntype GestureWatcherConfigInternal = {\n  _preventDefault: boolean;\n  _debounceWindow: number;\n  _deltaThreshold: number;\n  _angleDiffThreshold: number;\n  _naturalTouchScroll: boolean;\n  _touchDragHoldTime: number;\n  _touchDragNumFingers: number;\n};\n\ntype OnGestureOptionsInternal = {\n  _devices: GestureDevice[] | null;\n  _directions: Direction[] | null;\n  _intents: GestureIntent[] | null;\n  _minTotalDeltaX: number | null;\n  _maxTotalDeltaX: number | null;\n  _minTotalDeltaY: number | null;\n  _maxTotalDeltaY: number | null;\n  _minTotalDeltaZ: number | null;\n  _maxTotalDeltaZ: number | null;\n  _preventDefault: boolean;\n  _debounceWindow: number;\n  _deltaThreshold: number;\n  _angleDiffThreshold: number;\n  _naturalTouchScroll: boolean;\n  _touchDragHoldTime: number;\n  _touchDragNumFingers: number;\n};\n\ntype OnGestureHandlerWrapper = (\n  _target: EventTarget,\n  _device: GestureDevice,\n  _event: Event,\n  _preventDefault: boolean,\n) => boolean;\n\n// Specific to a combination of target + device\ntype DeviceListeners = {\n  _nCallbacks: number; // total number of callbacks\n  _nPreventDefault: number; // total number wanting to prevent default action\n  _remove: () => void;\n};\n\nconst CONSTRUCTOR_KEY: unique symbol = MC.SYMBOL() as typeof CONSTRUCTOR_KEY;\nconst instances = MH.newMap<string, GestureWatcher>();\n\nconst getConfig = (\n  config: GestureWatcherConfig | undefined,\n): GestureWatcherConfigInternal => {\n  config ??= {};\n  return {\n    _preventDefault: config.preventDefault ?? true,\n    _debounceWindow: toNonNegNum(config[MC.S_DEBOUNCE_WINDOW], 150),\n    _deltaThreshold: toNonNegNum(config.deltaThreshold, 5),\n    _angleDiffThreshold: toPosNum(config.angleDiffThreshold, 35),\n    _naturalTouchScroll: config.naturalTouchScroll ?? true,\n    _touchDragHoldTime: config.touchDragHoldTime ?? 500,\n    _touchDragNumFingers: config.touchDragNumFingers ?? 1,\n  };\n};\n\nconst initiatingEvents: {\n  [D in GestureDevice]: readonly (keyof GlobalEventHandlersEventMap)[];\n} = {\n  key: [MC.S_KEYDOWN],\n  // If the browser doesn't support pointer events, then\n  // addEventListenerTo will transform it into mousedown\n  //\n  // We need to listen for click, since that occurs after a pointerup (i.e.\n  // after a gesure is terminated and the ongoing listeners removed), but it\n  // needs to have its default action prevented.\n  pointer: [MC.S_POINTERDOWN, MC.S_CLICK],\n  touch: [MC.S_TOUCHSTART],\n  wheel: [MC.S_WHEEL],\n} as const;\n\nconst ongoingEvents: {\n  [D in GestureDevice]: readonly (keyof GlobalEventHandlersEventMap)[];\n} = {\n  key: [MC.S_KEYDOWN],\n  pointer: [\n    // If the browser doesn't support point events, then\n    // addEventListenerTo will transform them into mouse*\n    MC.S_POINTERDOWN,\n    MC.S_POINTERUP, // would terminate\n    MC.S_POINTERMOVE,\n    MC.S_POINTERCANCEL, // would terminate\n    MC.S_CLICK, // would terminate; can be default-prevented\n  ],\n  touch: [MC.S_TOUCHSTART, MC.S_TOUCHEND, MC.S_TOUCHMOVE, MC.S_TOUCHCANCEL],\n  wheel: [MC.S_WHEEL],\n} as const;\n\nconst fragmentGetters: {\n  [D in GestureDevice]: (\n    events: Event[],\n    options: {\n      deltaThreshold?: number;\n      angleDiffThreshold?: number;\n      reverseScroll?: boolean;\n      dragHoldTime?: number;\n      dragNumFingers?: number;\n    },\n  ) => GestureFragment | null | false;\n} = {\n  [MC.S_KEY]: getKeyGestureFragment,\n  [MC.S_POINTER]: getPointerGestureFragment,\n  [MC.S_TOUCH]: getTouchGestureFragment,\n  [MC.S_WHEEL]: getWheelGestureFragment,\n};\n\nconst getOptions = (\n  config: GestureWatcherConfigInternal,\n  options: OnGestureOptions,\n): OnGestureOptionsInternal => {\n  const debounceWindow = toNonNegNum(\n    options[MC.S_DEBOUNCE_WINDOW],\n    config._debounceWindow, // watcher is never debounced, so apply default here\n  );\n  const deltaThreshold = toNonNegNum(\n    options.deltaThreshold,\n    config._deltaThreshold,\n  );\n\n  return {\n    _devices:\n      validateStrList(\"devices\", options.devices, isValidInputDevice) ?? null,\n    _directions:\n      validateStrList(\"directions\", options.directions, isValidDirection) ??\n      null,\n    _intents:\n      validateStrList(\"intents\", options.intents, isValidIntent) ?? null,\n    _minTotalDeltaX: options.minTotalDeltaX ?? null,\n    _maxTotalDeltaX: options.maxTotalDeltaX ?? null,\n    _minTotalDeltaY: options.minTotalDeltaY ?? null,\n    _maxTotalDeltaY: options.maxTotalDeltaY ?? null,\n    _minTotalDeltaZ: options.minTotalDeltaZ ?? null,\n    _maxTotalDeltaZ: options.maxTotalDeltaZ ?? null,\n    _preventDefault: options.preventDefault ?? config._preventDefault,\n    _debounceWindow: debounceWindow,\n    _deltaThreshold: deltaThreshold,\n    _angleDiffThreshold: toNonNegNum(\n      options.angleDiffThreshold,\n      config._angleDiffThreshold,\n    ),\n    _naturalTouchScroll:\n      options.naturalTouchScroll ?? config._naturalTouchScroll,\n    _touchDragHoldTime: options.touchDragHoldTime ?? config._touchDragHoldTime,\n    _touchDragNumFingers:\n      options.touchDragNumFingers ?? config._touchDragNumFingers,\n  };\n};\n\n// Since each callback needs to accumulate events during its debounce window\n// and until its threshold is exceeded, we use a wrapper around the\n// user-supplied handler to do that.\nconst getCallbackAndWrapper = (\n  handler: OnGestureHandler,\n  options: OnGestureOptionsInternal,\n  logger: LoggerInterface | null,\n): { _callback: OnGestureCallback; _wrapper: OnGestureHandlerWrapper } => {\n  let totalDeltaX = 0,\n    totalDeltaY = 0,\n    totalDeltaZ = 1;\n  // When there's a pointer down, drag then pointerup, since we prevent\n  // pointerdown default action, this results in a click event shortly\n  // afterwards even when there's been a movement of the mouse. We detect that\n  // and prevent this click.\n  let preventNextClick = false;\n\n  const directions = options._directions;\n  const intents = options._intents;\n  const minTotalDeltaX = options._minTotalDeltaX;\n  const maxTotalDeltaX = options._maxTotalDeltaX;\n  const minTotalDeltaY = options._minTotalDeltaY;\n  const maxTotalDeltaY = options._maxTotalDeltaY;\n  const minTotalDeltaZ = options._minTotalDeltaZ;\n  const maxTotalDeltaZ = options._maxTotalDeltaZ;\n  const deltaThreshold = options._deltaThreshold;\n  const angleDiffThreshold = options._angleDiffThreshold;\n  const reverseScroll = !options._naturalTouchScroll;\n  const dragHoldTime = options._touchDragHoldTime;\n  const dragNumFingers = options._touchDragNumFingers;\n\n  // The event queue is cleared when the threshold is exceeded AND the debounce\n  // window has passed. It's not necessary for the actual handler to be called\n  // then (e.g. if the direction or intent doesn't match, it won't be).\n  const eventQueue: Event[] = [];\n  const id = randId();\n\n  // Since handler could be a function or a callback (not callable), we wrap it\n  // so that in case it's already a callback, its removal will result in\n  // deleteHandler getting called. It is not debounced itself, instead there's\n  // a debounced wrapper that invokes it.\n  const callback = wrapCallback(handler);\n\n  // The debounced callback wrapper is what is debounced.\n  // It accumulates total deltas and checks if the conditions (of threshold,\n  // direction and intent) are satisfied before calling the real handler.\n  //\n  // Most importantly, since it is only called when the debounce window has\n  // expired it can clear the event queue if the threshold is also exceeded.\n  const debouncedWrapper = getDebouncedHandler(\n    options._debounceWindow,\n    (\n      target: EventTarget,\n      fragment: GestureFragment,\n      eventQueueCopy: Event[],\n    ) => {\n      if (callback.isRemoved()) {\n        return;\n      }\n\n      const deltaX = fragment.deltaX;\n      const deltaY = fragment.deltaY;\n      const deltaZ = fragment.deltaZ;\n      const device = fragment.device;\n\n      if (\n        MH.round(maxAbs(deltaX, deltaY, (1 - deltaZ) * 100)) < deltaThreshold\n      ) {\n        debug: logger?.debug7(\n          `[${id}] Delta threshold not exceeded for callback`,\n        );\n        return;\n      }\n\n      debug: logger?.debug9(`[${id}] Done summing events for ${device}`);\n      clearEventQueue(device, eventQueue);\n\n      const newTotalDeltaX = toNumWithBounds(totalDeltaX + deltaX, {\n        min: minTotalDeltaX,\n        max: maxTotalDeltaX,\n      });\n\n      const newTotalDeltaY = toNumWithBounds(totalDeltaY + deltaY, {\n        min: minTotalDeltaY,\n        max: maxTotalDeltaY,\n      });\n\n      const newTotalDeltaZ = toNumWithBounds(addDeltaZ(totalDeltaZ, deltaZ), {\n        min: minTotalDeltaZ,\n        max: maxTotalDeltaZ,\n      });\n\n      if (\n        newTotalDeltaX === totalDeltaX &&\n        newTotalDeltaY === totalDeltaY &&\n        newTotalDeltaZ === totalDeltaZ\n      ) {\n        return;\n      }\n\n      totalDeltaX = newTotalDeltaX;\n      totalDeltaY = newTotalDeltaY;\n      totalDeltaZ = newTotalDeltaZ;\n\n      const direction = fragment.direction;\n      const intent = fragment.intent;\n      const time =\n        eventQueueCopy[MH.lengthOf(eventQueueCopy) - 1]?.timeStamp -\n          eventQueueCopy[0]?.timeStamp || 0;\n\n      const data = {\n        device,\n        direction,\n        intent,\n        deltaX,\n        deltaY,\n        deltaZ,\n        time,\n        totalDeltaX,\n        totalDeltaY,\n        totalDeltaZ,\n      };\n\n      if (\n        direction !== MC.S_NONE &&\n        (!directions || MH.includes(directions, direction)) &&\n        (!intents || MH.includes(intents, intent))\n      ) {\n        callback.invoke(target, data, eventQueueCopy).catch(logError);\n      } else {\n        debug: logger?.debug7(\n          `[${id}] Directions or intents not matching for callback`,\n        );\n      }\n    },\n  );\n\n  // This wrapper is NOT debounced and adds the events to the queue, prevents\n  // default action if needed, and indicates whether the gesture is terminated.\n  const wrapper = (\n    target: EventTarget,\n    device: GestureDevice,\n    event: Event,\n    preventDefault: boolean,\n  ) => {\n    eventQueue.push(event);\n\n    const fragment = fragmentGetters[device](eventQueue, {\n      angleDiffThreshold,\n      deltaThreshold,\n      reverseScroll,\n      dragHoldTime,\n      dragNumFingers,\n    });\n\n    debug: logger?.debug8(\n      `[${id}] Got fragment for ${device} (${event.type})`,\n      fragment,\n      [...eventQueue].map((e) => e.type),\n    );\n\n    if (preventDefault) {\n      preventDefaultActionFor(\n        event,\n        !!fragment || (event.type === MC.S_CLICK && preventNextClick),\n      );\n    }\n\n    if (fragment === false) {\n      // not enough events in the queue, pass\n      debug: logger?.debug9(`[${id}] Not enough events for gesture ${device}`);\n      return false;\n    } else if (fragment === null) {\n      // consider the gesture terminated\n      clearEventQueue(device, eventQueue);\n      debug: logger?.debug9(`[${id}] Gesture for ${device} terminated`);\n      return true;\n    }\n\n    if (device === MC.S_POINTER) {\n      // If we're here, there's been a drag, expect a click immediately\n      // afterwards and prevent default action.\n      preventNextClick = true;\n      MH.setTimer(() => {\n        preventNextClick = false;\n      }, 10);\n    }\n\n    debouncedWrapper(\n      target,\n      fragment,\n      [...eventQueue], // copy\n    );\n\n    return false;\n  };\n\n  return { _callback: callback, _wrapper: wrapper };\n};\n\nconst clearEventQueue = (device: GestureDevice, queue: Event[]) => {\n  const keepLastEvent = device === MC.S_POINTER || device === MC.S_TOUCH;\n  queue.splice(0, MH.lengthOf(queue) - (keepLastEvent ? 1 : 0));\n};\n\nconst preventDefaultActionFor = (event: Event, isActualGesture: boolean) => {\n  const target = event.currentTarget;\n  const eventType = event.type;\n  const isPointerDown =\n    eventType === MC.S_POINTERDOWN || eventType === MC.S_MOUSEDOWN;\n\n  if (\n    eventType === MC.S_TOUCHMOVE ||\n    eventType === MC.S_WHEEL ||\n    ((eventType === MC.S_CLICK || eventType === MC.S_KEYDOWN) &&\n      isActualGesture) ||\n    (isPointerDown && (event as MouseEvent).buttons === 1)\n  ) {\n    MH.preventDefault(event);\n\n    if (isPointerDown && MH.isHTMLElement(target)) {\n      // Otherwise capturing key events won't work\n      target.focus({ preventScroll: true });\n    }\n  }\n};\n\nconst setGestureCssProps = (\n  target: EventTarget,\n  data: Partial<GestureData>,\n) => {\n  const intent = data.intent;\n\n  if (!MH.isElement(target) || !intent || intent === MC.S_UNKNOWN) {\n    return;\n  }\n\n  const prefix = `${intent}-`;\n\n  if (intent === MC.S_ZOOM) {\n    setNumericStyleJsVars(\n      target,\n      {\n        deltaZ: data.totalDeltaZ,\n      },\n      {\n        _prefix: prefix,\n        _numDecimal: 2,\n      },\n    ); // don't await here\n  } else {\n    setNumericStyleJsVars(\n      target,\n      {\n        deltaX: data.totalDeltaX,\n        deltaY: data.totalDeltaY,\n      },\n      {\n        _prefix: prefix,\n      },\n    ); // don't await here\n  }\n};\n","/**\n * @module Utils\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { LisnUsageError } from \"@lisn/globals/errors\";\nimport { settings } from \"@lisn/globals/settings\";\n\nimport {\n  DeviceSpec,\n  Device,\n  AspectRatioSpec,\n  AspectRatio,\n} from \"@lisn/globals/types\";\n\nimport { sortedKeysByVal } from \"@lisn/utils/math\";\nimport { validateStrList } from \"@lisn/utils/validation\";\n\nimport {\n  BitSpace,\n  newBitSpaces,\n  createBitSpace,\n} from \"@lisn/modules/bit-spaces\";\n\n/**\n * Returns true if the given string is a valid device name.\n *\n * @category Validation\n */\nexport const isValidDevice = (device: string): device is Device =>\n  ORDERED_DEVICES.has(device);\n\n/**\n * Returns true if the given string is a valid aspect ratio name.\n *\n * @category Validation\n */\nexport const isValidAspectRatio = (\n  aspectRatio: string,\n): aspectRatio is AspectRatio => ORDERED_ASPECTR.has(aspectRatio);\n\n/**\n * Returns true if the given string is a valid device specification (including\n * `\"min <Device>\"`, etc).\n *\n * Returns false for \"\", although if you passed \"\" in\n * {@link Watchers/LayoutWatcher.OnLayoutOptions | OnLayoutOptions} it would\n * accept it as specifying _all_ devices.\n *\n * @category Validation\n */\nexport const isValidDeviceList = (\n  device: string | string[],\n): device is DeviceSpec | Device[] =>\n  isValidForType(S_DEVICES, device, ORDERED_DEVICES);\n\n/**\n * Returns true if the given string is a valid aspect ratio specification\n * (including `\"min <AspectRatio>\"`, etc).\n *\n * Returns false for \"\", although if you passed \"\" in\n * {@link Watchers/LayoutWatcher.OnLayoutOptions | OnLayoutOptions} it would\n * accept it as specifying _all_ aspect ratios.\n *\n * @category Validation\n */\nexport const isValidAspectRatioList = (\n  aspectR: string | string[],\n): aspectR is AspectRatioSpec | AspectRatio[] =>\n  isValidForType(S_ASPECTRS_CAMEL, aspectR, ORDERED_ASPECTR);\n\n/**\n * Returns a list of {@link Device}s that are not covered by the given device\n * specification. See\n * {@link Watchers/LayoutWatcher.OnLayoutOptions | OnLayoutOptions} for accepted\n * formats.\n *\n * Returns an empty for \"\" or for a specification that includes all devices.\n *\n * @category Layout\n */\nexport const getOtherDevices = (device: DeviceSpec | Device[]): Device[] =>\n  getOtherLayouts(S_DEVICES, device, ORDERED_DEVICES);\n\n/**\n * Returns a list of {@link AspectRatio}s that are not covered by the given\n * aspect ratio specification. See\n * {@link Watchers/LayoutWatcher.OnLayoutOptions | OnLayoutOptions} for accepted\n * formats.\n *\n * Returns an empty for \"\" or for a specification that includes all aspect\n * ratios.\n *\n * @category Layout\n */\nexport const getOtherAspectRatios = (\n  aspectR: AspectRatioSpec | AspectRatio[],\n): AspectRatio[] => getOtherLayouts(S_ASPECTRS_CAMEL, aspectR, ORDERED_ASPECTR);\n\n/**\n * @ignore\n * @internal\n */\nexport const getLayoutBitmask = (options?: {\n  devices?: DeviceSpec | Device[];\n  aspectRatios?: AspectRatioSpec | AspectRatio[];\n}): number => {\n  let layoutBitmask =\n    getBitmaskFromSpec(S_DEVICES, options?.devices, ORDERED_DEVICES) |\n    getBitmaskFromSpec(\n      S_ASPECTRS_CAMEL,\n      options?.aspectRatios,\n      ORDERED_ASPECTR,\n    );\n\n  if (!layoutBitmask) {\n    layoutBitmask = ORDERED_DEVICES.bitmask | ORDERED_ASPECTR.bitmask; // default: all\n  }\n\n  return layoutBitmask;\n};\n\n// In ascending order by width.\nconst ORDERED_DEVICE_NAMES = sortedKeysByVal(settings.deviceBreakpoints);\nconst ORDERED_ASPECTR_NAMES = sortedKeysByVal(settings.aspectRatioBreakpoints);\n\nconst bitSpaces = newBitSpaces();\n\n/**\n * @ignore\n * @internal\n */\nexport const ORDERED_DEVICES = createBitSpace(\n  bitSpaces,\n  ...ORDERED_DEVICE_NAMES,\n);\n\n/**\n * @ignore\n * @internal\n */\nexport const ORDERED_ASPECTR = createBitSpace(\n  bitSpaces,\n  ...ORDERED_ASPECTR_NAMES,\n);\n\n/**\n * @ignore\n * @internal\n */\nexport const NUM_LAYOUTS =\n  MH.lengthOf(ORDERED_DEVICE_NAMES) + MH.lengthOf(ORDERED_ASPECTR_NAMES);\n\n// --------------------\n\nconst S_DEVICES = \"devices\";\nconst S_ASPECTRS_CAMEL = \"aspectRatios\";\n\n// Don't use capture groups for old browser support\nconst LAYOUT_RANGE_REGEX = RegExp(\n  \"^ *(?:\" +\n    \"([a-z-]+) +to +([a-z-]+)|\" +\n    \"min +([a-z-]+)|\" +\n    \"max +([a-z-]+)\" +\n    \") *$\",\n);\n\nconst getLayoutsFromBitmask = <T extends Device | AspectRatio>(\n  keyName: string,\n  bitmask: number,\n  bitSpace: BitSpace<T>,\n): T[] => {\n  const layouts: T[] = [];\n  for (let bit = bitSpace.start; bit <= bitSpace.end; bit++) {\n    const value = 1 << bit;\n    if (bitmask & value) {\n      const name = bitSpace.nameOf(value);\n      if (name) {\n        layouts.push(name);\n      }\n    }\n  }\n\n  return layouts;\n};\n\nconst getOtherLayouts = <T extends Device | AspectRatio>(\n  keyName: string,\n  spec: string | string[],\n  bitSpace: BitSpace<T>,\n): T[] => {\n  const bitmask = getBitmaskFromSpec(keyName, spec, bitSpace);\n  if (!bitmask) {\n    return [];\n  }\n\n  const oppositeBitmask = bitSpace.bitmask & ~bitmask;\n  return getLayoutsFromBitmask(keyName, oppositeBitmask, bitSpace);\n};\n\nconst isValidForType = <T extends Device | AspectRatio>(\n  keyName: string,\n  spec: string | string[],\n  bitSpace: BitSpace<T>,\n): boolean => {\n  try {\n    const bitmask = getBitmaskFromSpec(keyName, spec, bitSpace);\n    return bitmask !== 0;\n  } catch (err) {\n    if (MH.isInstanceOf(err, LisnUsageError)) {\n      return false;\n    }\n    throw err;\n  }\n};\n\nconst getBitmaskFromSpec = <T extends Device | AspectRatio>(\n  keyName: string,\n  spec: string | string[] | undefined | null,\n  bitSpace: BitSpace<T>,\n): number => {\n  if (MH.isEmpty(spec)) {\n    return 0;\n  }\n  const singleKeyName = keyName.slice(0, -1);\n\n  if (MH.isString(spec)) {\n    const rangeMatch = spec.match(LAYOUT_RANGE_REGEX);\n    if (rangeMatch) {\n      const minLayout = rangeMatch[1] || rangeMatch[3];\n      const maxLayout = rangeMatch[2] || rangeMatch[4];\n\n      if (minLayout !== undefined && !bitSpace.has(minLayout)) {\n        throw MH.usageError(`Unknown ${singleKeyName} '${minLayout}'`);\n      }\n\n      if (maxLayout !== undefined && !bitSpace.has(maxLayout)) {\n        throw MH.usageError(`Unknown ${singleKeyName} '${maxLayout}'`);\n      }\n\n      return bitSpace.bitmaskFor(minLayout, maxLayout);\n    }\n  }\n\n  let bitmask = 0;\n  const layouts = validateStrList(keyName, spec, bitSpace.has);\n  if (layouts) {\n    for (const lt of layouts) {\n      bitmask |= bitSpace.bit[lt];\n    }\n  }\n\n  return bitmask;\n};\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  addClassesNow,\n  removeClassesNow,\n  getData,\n} from \"@lisn/utils/css-alter\";\nimport {\n  waitForMeasureTime,\n  waitForMutateTime,\n} from \"@lisn/utils/dom-optimize\";\nimport { criticallyDamped } from \"@lisn/utils/math\";\n\nexport type ElapsedTimes = {\n  total: number;\n  sinceLast: number;\n};\n\n/**\n * The callback is as an argument the {@link ElapsedTimes | elapsed times}:\n * - The total elapsed time in milliseconds since the start\n * - The elapsed time in milliseconds since the previous frame\n *\n * The first time this callback is called both of these will be 0 unless seed\n * values were provided.\n *\n * The callback must return `true` if it wants to animate again on the next\n * frame and `false` if done.\n *\n * @since v1.2.0\n *\n * @category Animations\n */\nexport type AnimationCallback = (elapsed: ElapsedTimes) => boolean;\n\n/**\n * Returns a promise that resolves at the next animation frame. Async/await\n * version of\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/Window/requestAnimationFrame | requestAnimationFrame}.\n *\n * @returns The timestamp gotten from `requestAnimationFrame`\n *\n * @category Animations\n */\nexport const waitForAnimationFrame = async () =>\n  MH.newPromise<number>((resolve) => {\n    MH.onAnimationFrame(resolve);\n  });\n\n/**\n * Calls the given callback on every animation frame.\n *\n * The returned Promise resolves when the callback is done (returns `false`).\n *\n * @param callback  See {@link AnimationCallback}.\n * @param elapsed   Seed values to use as the total elapsed and elapsed since\n *                  last. Otherwise it will use the timestamp of the first frame\n *                  as the start, which will result in those values being 0 the\n *                  first time.\n *\n * @since v1.2.0\n *\n * @category Animations\n */\nexport const onEveryAnimationFrame = async (\n  callback: AnimationCallback,\n  elapsed?: ElapsedTimes,\n) => {\n  for await (elapsed of newAnimationFrameIterator(elapsed)) {\n    const shouldRepeat = callback(elapsed);\n    if (!shouldRepeat) {\n      break;\n    }\n  }\n};\n\n/**\n * Generator version of {@link onEveryAnimationFrame}.\n *\n * Returns a new async iterator which yields the total elapsed time and elapsed\n * time since the last call on every animation frame.\n *\n * @example\n * ```javascript\n * for await (const elapsed of newAnimationFrameIterator()) {\n *   // ... do something\n *   if (done) break;\n * }\n * ```\n *\n * @since v1.2.0\n *\n * @category Animations\n */\nexport async function* newAnimationFrameIterator(\n  elapsed?: ElapsedTimes,\n): AsyncGenerator<ElapsedTimes, never> {\n  let startTime: number, previousTimeStamp: number;\n  const { total: totalSeed = 0, sinceLast: sinceLastSeed = 0 } = elapsed ?? {};\n\n  const step = async () => {\n    const timeStamp = await waitForAnimationFrame();\n    if (!startTime || !previousTimeStamp) {\n      // First time\n      startTime = timeStamp - totalSeed;\n      previousTimeStamp = timeStamp - sinceLastSeed;\n    }\n\n    const totalElapsed = timeStamp - startTime;\n    const elapsedSinceLast = timeStamp - previousTimeStamp;\n    previousTimeStamp = timeStamp;\n\n    return { total: totalElapsed, sinceLast: elapsedSinceLast };\n  };\n\n  while (true) {\n    yield step();\n  }\n}\n\n/**\n * Returns an animation iterator based on {@link criticallyDamped} that starts\n * at the given position `l`, with velocity `v = 0` and time `t = 0` and yields\n * the new position and velocity, and total time at every animation frame.\n *\n * @param [settings.l]         The initial starting position.\n * @param [settings.lTarget]   The initial target position. Can be updated when\n *                             calling next().\n * @param [settings.lag]       See {@link criticallyDamped}.\n * @param [settings.precision] See {@link criticallyDamped}.\n *\n * @returns An iterator whose `next` method accepts an optional new `lTarget`.\n * The iterator yields an object containing successive values for:\n * - position (`l`)\n * - velocity (`v`)\n * - total time elapsed (`t`)\n *\n * @example\n * If you never need to update the target you can use a for await loop:\n *\n * ```javascript\n * const iterator = newCriticallyDampedAnimationIterator({\n *   l: 10,\n *   lTarget: 100,\n *   lag: 1500\n * });\n *\n * for await (const { l, v, t } of iterator) {\n *   console.log({ l, v, t });\n * }\n * ```\n *\n * @example\n * If you do need to update the target, then call `next` explicitly:\n *\n * ```javascript\n * const iterator = newCriticallyDampedAnimationIterator({\n *   l: 10,\n *   lTarget: 100,\n *   lag: 1500\n * });\n *\n * let { value: { l, v, t } } = await iterator.next();\n * ({ value: { l, v, t } } = await iterator.next()); // updated\n * ({ value: { l, v, t } } = await iterator.next(200)); // updated towards a new target\n * ```\n *\n * @since v1.2.0\n *\n * @category Animations\n */\nexport async function* newCriticallyDampedAnimationIterator(settings: {\n  lTarget: number;\n  lag: number;\n  l?: number;\n}): AsyncGenerator<{ l: number; v: number; t: number }, never> {\n  let { l, lTarget } = settings;\n  const { lag } = settings;\n  let v = 0,\n    t = 0,\n    dt = 0;\n\n  const next = async () => {\n    ({ l, v } = criticallyDamped({\n      l,\n      v,\n      lTarget,\n      dt,\n      lag,\n    }));\n    return { l, v, t };\n  };\n\n  for await ({ total: t, sinceLast: dt } of newAnimationFrameIterator()) {\n    if (dt === 0) {\n      continue;\n    }\n\n    lTarget = yield next() ?? lTarget;\n  }\n\n  throw null; // tell TypeScript it will never end\n}\n\n/**\n * @param webAnimationCallback This function is called for each\n *                             {@link https://developer.mozilla.org/en-US/docs/Web/API/Animation | Animation}\n *                             on the element. It {@link waitForMeasureTime}\n *                             before reading the animations.\n * @param legacyCallback       This function is called if the browser does not\n *                             support the Web Animations API. It is called\n *                             after {@link waitForMutateTime} so it can safely\n *                             modify styles.\n * @param realtime             If true, then it does not\n *                             {@link waitForMeasureTime} or\n *                             {@link waitForMutateTime} and runs\n *                             synchronously.\n *\n * @category Animations\n */\nexport const iterateAnimations = async (\n  element: Element,\n  webAnimationCallback: (animation: Animation) => void,\n  legacyCallback: (element: Element) => void,\n  realtime = false,\n) => {\n  /* istanbul ignore next */ // jsdom doesn't support Web Animations\n  if (\n    \"getAnimations\" in element &&\n    getData(element, MH.prefixName(\"test-legacy\")) === null\n  ) {\n    if (!realtime) {\n      await waitForMeasureTime();\n    }\n\n    for (const animation of element.getAnimations()) {\n      webAnimationCallback(animation);\n    }\n\n    // Old browsers, no Animation API\n  } else {\n    if (!realtime) {\n      await waitForMutateTime();\n    }\n\n    legacyCallback(element);\n  }\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const resetCssAnimationsNow = (element: Element) => {\n  addClassesNow(element, MC.PREFIX_ANIMATE_DISABLE); // cause it to reset\n  // If we remove the disable class immediately, then it will not have the\n  // effect to reset the animation, since the browser won't see any change in\n  // the classList at the start of the frame. So we ideally need to remove the\n  // disable class after the next paint. However, depending on the animation,\n  // and its state, disabling animation and waiting for the next animation\n  // frame may cause a visible glitch, so we need to force layout now.\n  /* eslint-disable-next-line @typescript-eslint/no-unused-expressions */\n  element[MC.S_CLIENT_WIDTH]; // forces layout\n\n  removeClassesNow(element, MC.PREFIX_ANIMATE_DISABLE);\n};\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { settings } from \"@lisn/globals/settings\";\n\nimport {\n  ScrollDirection,\n  ScrollTarget,\n  TargetCoordinates,\n  CoordinateOffset,\n  ScrollPosition,\n  Offset,\n} from \"@lisn/globals/types\";\n\nimport {\n  newAnimationFrameIterator,\n  ElapsedTimes,\n} from \"@lisn/utils/animations\";\nimport { getComputedStylePropNow } from \"@lisn/utils/css-alter\";\nimport { SCROLL_DIRECTIONS } from \"@lisn/utils/directions\";\nimport {\n  waitForInteractive,\n  waitForElementOrInteractive,\n} from \"@lisn/utils/dom-events\";\nimport { waitForMeasureTime } from \"@lisn/utils/dom-optimize\";\nimport { addEventListenerTo, removeEventListenerFrom } from \"@lisn/utils/event\";\nimport { logError, logWarn } from \"@lisn/utils/log\";\nimport { maxAbs, criticallyDamped } from \"@lisn/utils/math\";\nimport { randId, formatAsString } from \"@lisn/utils/text\";\nimport { isValidStrList } from \"@lisn/utils/validation\";\n\nimport { newXMap } from \"@lisn/modules/x-map\";\n\nimport debug from \"@lisn/debug/debug\";\n\n/**\n * @category Scrolling\n */\nexport type ScrollAction = {\n  cancel: () => boolean;\n\n  /**\n   * Will reject if the scroll is cancelled.\n   */\n  waitFor: () => Promise<ScrollPosition>;\n};\n\n/**\n * @category Scrolling\n * @interface\n */\nexport type ScrollToOptions = {\n  /**\n   * The element that should be scrolled.\n   *\n   * @defaultValue If `document.body` is scrollable, will use that; otherwise `document.scrollingElement`\n   */\n  scrollable?: Element;\n\n  /**\n   * Offset the target coordinates by the given amount(s).\n   *\n   * E.g. if the final target coordinates are computed to be\n   * `{top: 100, left: 0}` and you specify offset as `{top: 10, left: 20}`, it\n   * will scroll to  `{top: 110, left: 20}`.\n   *\n   * @defaultValue undefined\n   */\n  offset?: CoordinateOffset;\n\n  // TODO maybe support fixed average velocity as an alternative to fixed duration?\n  /**\n   * The duration of the scroll animation in milliseconds. If not given, it is\n   * instant.\n   *\n   * @defaultValue 0\n   */\n  duration?: number;\n\n  /**\n   * Whether another request to us to scroll the same target can interrupt this\n   * scroll before it finishes.\n   *\n   * @defaultValue false\n   */\n  weCanInterrupt?: boolean;\n\n  /**\n   * Whether a user attempt to scroll the target can interrupt this before it\n   * finishes.\n   *\n   * @defaultValue false\n   */\n  userCanInterrupt?: boolean;\n\n  /**\n   * If the scrolling element is already at the given coordinates (or strictly\n   * speaking we allow for 5 pixels difference), then if `altTarget` is given,\n   * this will become the target to scroll to.\n   *\n   * @defaultValue undefined\n   */\n  altTarget?: TargetCoordinates | Element | string;\n\n  /**\n   * Offset the target coordinates by the given amount(s) when `altTarget` is used.\n   *\n   * See {@link ScrollToOptions.offset}.\n   *\n   * @defaultValue undefined\n   */\n  altOffset?: CoordinateOffset;\n};\n\n// ----------\n\n/**\n * Returns true if the given element is scrollable in the given direction, or\n * in either direction (if `axis` is not given).\n *\n * It first checks whether the current scroll offset on the target along the\n * given axis is non-0, and if so returns true immediately. Otherwise it will\n * attempt to determine if it's scrollable using one of these methods\n * (controlled by `options.active`):\n * - passive check (default): Will examine `clientWidth/Height`,\n *   `scrollWidth/Height` as well as the computed `overflow` CSS property to try\n *   to determine if the target is scrollable. This is not 100% reliable but is\n *   safer than the active check\n * - active check: Will attempt to scroll the target by 1px and examine if the\n *   scroll offset had changed, then revert it back to 0. This is a more\n *   reliable check, however it can cause issues in certain contexts. In\n *   particular, if a scroll on the target had just been initiated (but it's\n *   scroll offset was still 0), the scroll may be cancelled. Never use that\n *   inside scroll-based handlers.\n *\n * **NOTE:** If the layout has been invalidated and not yet recalculated, this\n * will cause a forced layout, so always {@link waitForMeasureTime} before\n * calling this function when possible.\n *\n * @param [options.axis]    One of \"x\" or \"y\" for horizontal or vertical scroll\n *                          respectively. If not given, it checks both.\n * @param [options.active]  If true, then if the target's current scroll offset\n *                          is 0, it will attempt to scroll it rather than\n *                          looking at its overflow.\n * @param [options.noCache] By default the result of a check is cached for 1s\n *                          and if there's already a cached result for this\n *                          element, it is returned. Set this to true to disable\n *                          checking the cache and also saving the result into\n *                          the cache.\n *\n * @category Scrolling\n */\nexport const isScrollable = (\n  element: Element,\n  options?: {\n    axis?: \"x\" | \"y\";\n    active?: boolean;\n    noCache?: boolean;\n  },\n): boolean => {\n  const { axis, active, noCache } = options ?? {};\n  if (!axis) {\n    return (\n      isScrollable(element, { axis: \"y\", active, noCache }) ||\n      isScrollable(element, { axis: \"x\", active, noCache })\n    );\n  }\n\n  if (!noCache) {\n    const cachedResult = isScrollableCache.get(element)?.get(axis);\n    if (!MH.isNullish(cachedResult)) {\n      return cachedResult;\n    }\n  }\n\n  const offset = axis === \"x\" ? \"Left\" : \"Top\";\n  let result = false;\n\n  if (element[`scroll${offset}`]) {\n    result = true;\n  } else if (active) {\n    // Use scrollTo with explicit behavior set to instant instead of setting\n    // the scrollTop/Left properties since the latter doesn't work with\n    // scroll-behavior smooth.\n    MH.elScrollTo(element, { [MH.toLowerCase(offset)]: 1 });\n    const canScroll = element[`scroll${offset}`] > 0;\n    MH.elScrollTo(element, { [MH.toLowerCase(offset)]: 0 });\n    result = canScroll;\n  } else {\n    const dimension = axis === \"x\" ? \"Width\" : \"Height\";\n    const hasOverflow =\n      element[`scroll${dimension}`] > element[`client${dimension}`];\n    const overflowProp = getComputedStylePropNow(element, \"overflow\");\n    result = hasOverflow && MH.includes([\"scroll\", \"auto\"], overflowProp);\n  }\n\n  if (!noCache) {\n    isScrollableCache.sGet(element).set(axis, result);\n    MH.setTimer(() => {\n      MH.deleteKey(isScrollableCache.get(element), axis);\n      isScrollableCache.prune(element);\n    }, IS_SCROLLABLE_CACHE_TIMEOUT);\n  }\n\n  return result;\n};\n\n/**\n * Returns the closest scrollable ancestor of the given element, _not including\n * it_.\n *\n * @param options See {@link isScrollable}\n *\n * @returns `null` if no scrollable ancestors are found.\n *\n * @category Scrolling\n */\nexport const getClosestScrollable = (\n  element: Element,\n  options?: {\n    axis?: \"x\" | \"y\";\n    active?: boolean;\n    noCache?: boolean;\n  },\n) => {\n  // Walk up the tree, starting at the element in question but excluding it.\n  let ancestor: Element | null | undefined = element;\n  while ((ancestor = MH.parentOf(ancestor))) {\n    if (isScrollable(ancestor, options)) {\n      return ancestor;\n    }\n  }\n\n  return null;\n};\n\n/**\n * Returns the current {@link ScrollAction} if any.\n *\n * @category Scrolling\n */\nexport const getCurrentScrollAction = (\n  scrollable?: Element,\n): ScrollAction | null => {\n  scrollable = toScrollableOrDefault(scrollable);\n  const info = currentScrollInfos.get(scrollable);\n  if (info) {\n    return MH.copyObject(info._action);\n  }\n  return null;\n};\n\n/**\n * Scrolls the given scrollable element to the given `to` target.\n *\n * Returns `null` if there's an ongoing scroll that is not cancellable.\n *\n * Note that if `to` is an element or a selector, then it _must_ be a\n * descendant of the scrollable element.\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *               If the target coordinates are invalid.\n *\n * @param to If this is an element, then its top-left position is used as\n *           the target coordinates. If it is a string, then it is treated\n *           as a selector for an element using `querySelector`.\n *\n * @returns `null` if there's an ongoing scroll that is not cancellable,\n * otherwise a {@link ScrollAction}.\n *\n * @category Scrolling\n */\nexport const scrollTo = (\n  to: TargetCoordinates | Element | string,\n  userOptions?: ScrollToOptions,\n): ScrollAction | null => {\n  const options = getOptions(to, userOptions);\n  const scrollable = options._scrollable;\n\n  // cancel current scroll action if any\n  const info = currentScrollInfos.get(scrollable);\n  if (info) {\n    if (!info._action.cancel()) {\n      // current scroll action is not cancellable by us\n      return null;\n    }\n  }\n\n  let isCancelled = false;\n\n  const cancelFn = options._weCanInterrupt\n    ? () => (isCancelled = true)\n    : () => false;\n\n  const scrollEvents = [\"touchmove\", \"wheel\"]; // don't bother with keyboard\n  let preventScrollHandler: EventListener | null = null;\n\n  if (options._userCanInterrupt) {\n    for (const eventType of scrollEvents) {\n      addEventListenerTo(\n        scrollable,\n        eventType,\n        () => {\n          isCancelled = true;\n        },\n        { once: true },\n      );\n    }\n  } else {\n    preventScrollHandler = MH.preventDefault;\n    for (const eventType of scrollEvents) {\n      addEventListenerTo(scrollable, eventType, preventScrollHandler, {\n        passive: false,\n      });\n    }\n  }\n\n  const thisInfo: ScrollInfo = {\n    _action: {\n      waitFor: () => scrollActionPromise,\n      cancel: cancelFn,\n    },\n  };\n\n  const cleanup = () => {\n    if (currentScrollInfos.get(scrollable)?._action === thisInfo._action) {\n      MH.deleteKey(currentScrollInfos, scrollable);\n    }\n\n    if (preventScrollHandler) {\n      for (const eventType of scrollEvents) {\n        removeEventListenerFrom(scrollable, eventType, preventScrollHandler, {\n          passive: false,\n        });\n      }\n    }\n  };\n\n  const scrollActionPromise = initiateScroll(options, () => isCancelled);\n  thisInfo._action.waitFor().then(cleanup).catch(cleanup);\n\n  updateCurrentScrollInfo(scrollable, thisInfo);\n  return thisInfo._action;\n};\n\n/**\n * Returns true if the given string is a valid scroll direction.\n *\n * @category Validation\n */\nexport const isValidScrollDirection = (\n  direction: string,\n): direction is ScrollDirection => MH.includes(SCROLL_DIRECTIONS, direction);\n\n/**\n * Returns true if the given string or array is a list of valid scroll\n * directions.\n *\n * @category Validation\n */\nexport const isValidScrollDirectionList = (directions: string | string[]) =>\n  isValidStrList(directions, isValidScrollDirection, false);\n\n/**\n * @ignore\n * @internal\n */\nexport const mapScrollable = (original: Element, actualScrollable: Element) =>\n  mappedScrollables.set(original, actualScrollable);\n\n/**\n * @ignore\n * @internal\n */\nexport const unmapScrollable = (original: Element) =>\n  MH.deleteKey(mappedScrollables, original);\n\n/**\n * @ignore\n * @internal\n */\nexport const getClientWidthNow = (element: Element) =>\n  isScrollableBodyInQuirks(element)\n    ? element.offsetWidth -\n      getBorderWidth(element, MC.S_LEFT) -\n      getBorderWidth(element, MC.S_RIGHT)\n    : element[MC.S_CLIENT_WIDTH];\n\n/**\n * @ignore\n * @internal\n */\nexport const getClientHeightNow = (element: Element) =>\n  isScrollableBodyInQuirks(element)\n    ? element.offsetHeight -\n      getBorderWidth(element, MC.S_TOP) -\n      getBorderWidth(element, MC.S_BOTTOM)\n    : element[MC.S_CLIENT_HEIGHT];\n\n/**\n * @ignore\n * @internal\n */\nexport const tryGetMainContentElement = (): HTMLElement | null =>\n  mainContentElement ?? null;\n\n/**\n * @ignore\n * @internal\n *\n * Exposed via ScrollWatcher\n */\nexport const fetchMainContentElement = async (): Promise<HTMLElement> => {\n  await init();\n\n  return mainContentElement;\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const tryGetMainScrollableElement = (): HTMLElement | null =>\n  mainScrollableElement ?? null;\n\n/**\n * @ignore\n * @internal\n *\n * Exposed via ScrollWatcher\n */\nexport const fetchMainScrollableElement = async (): Promise<HTMLElement> => {\n  await init();\n\n  return mainScrollableElement;\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const getDefaultScrollingElement = () => {\n  const body = MH.getBody();\n  return isScrollable(body) ? body : (MH.getDocScrollingElement() ?? body);\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const tryGetScrollableElement = (\n  target: ScrollTarget | null | undefined,\n): Element | null => toScrollableOrMain(target, tryGetMainScrollableElement);\n\n/**\n * @ignore\n * @internal\n */\nexport const fetchScrollableElement = async (\n  target: ScrollTarget | null | undefined,\n): Promise<Element> => toScrollableOrMain(target, fetchMainScrollableElement);\n\n// ----------------------------------------\n\ntype ScrollToOptionsInternal = {\n  _target: TargetCoordinates;\n  _offset: CoordinateOffset | null;\n  _altTarget: TargetCoordinates | null;\n  _altOffset: CoordinateOffset | null;\n  _scrollable: Element;\n  _duration: number;\n  _weCanInterrupt: boolean;\n  _userCanInterrupt: boolean;\n};\n\ntype Velocity = { top: number; left: number };\n\ntype ScrollInfo = {\n  _action: ScrollAction;\n  _position?: ScrollPosition;\n  _velocity?: Velocity;\n  _elapsed?: ElapsedTimes;\n};\n\nconst IS_SCROLLABLE_CACHE_TIMEOUT = 1000;\n\nconst isScrollableCache = newXMap<Element, Map<\"x\" | \"y\", boolean>>(() =>\n  MH.newMap(),\n);\n\nconst mappedScrollables = MH.newMap<Element, Element>();\n\nconst currentScrollInfos = MH.newMap<Element, ScrollInfo>();\n\nconst DIFF_THRESHOLD = 5;\nconst arePositionsDifferent = (\n  start: ScrollPosition,\n  end: ScrollPosition,\n  threshold = DIFF_THRESHOLD,\n) => maxAbs(start.top - end.top, start.left - end.left) > threshold;\n\n// must be called in \"measure time\"\nconst getBorderWidth = (element: Element, side: Offset) =>\n  MH.ceil(MH.parseFloat(getComputedStylePropNow(element, `border-${side}`)));\n\nconst isScrollableBodyInQuirks = (element: Element): element is HTMLElement =>\n  element === MH.getBody() && MH.getDocScrollingElement() === null;\n\nconst toScrollableOrMain = <R>(\n  target: ScrollTarget | null | undefined,\n  getMain: () => R,\n): Element | R => {\n  if (MH.isElement(target)) {\n    return mappedScrollables.get(target) ?? target;\n  }\n\n  if (!target || target === MH.getWindow() || target === MH.getDoc()) {\n    return getMain();\n  }\n\n  throw MH.usageError(\"Unsupported scroll target\");\n};\n\nconst toScrollableOrDefault = (scrollable: Element | undefined): Element =>\n  scrollable ?? getDefaultScrollingElement();\n\nconst getOptions = (\n  to: TargetCoordinates | Element | string,\n  options: ScrollToOptions | undefined,\n): ScrollToOptionsInternal => {\n  const scrollable = toScrollableOrDefault(options?.scrollable);\n  const target = getTargetCoordinates(scrollable, to);\n  const altTarget = options?.altTarget\n    ? getTargetCoordinates(scrollable, options?.altTarget)\n    : null;\n\n  return {\n    _target: target,\n    _offset: options?.offset ?? null,\n    _altTarget: altTarget,\n    _altOffset: options?.altOffset ?? null,\n    _scrollable: scrollable,\n    _duration: options?.duration ?? 0,\n    _weCanInterrupt: options?.weCanInterrupt ?? false,\n    _userCanInterrupt: options?.userCanInterrupt ?? false,\n  };\n};\n\nconst updateCurrentScrollInfo = (\n  scrollable: Element,\n  newInfo: Partial<ScrollInfo>,\n) => {\n  const existingScrollInfo = currentScrollInfos.get(scrollable);\n  const _action = newInfo._action ?? existingScrollInfo?._action;\n  if (_action) {\n    currentScrollInfos.set(\n      scrollable,\n      MH.merge(existingScrollInfo, newInfo, { _action }),\n    );\n  }\n};\n\nconst getTargetCoordinates = (\n  scrollable: Element,\n  target: TargetCoordinates | Element | string,\n): TargetCoordinates => {\n  const isDocScrollingElement = scrollable === MH.getDocScrollingElement();\n\n  if (MH.isElement(target)) {\n    if (scrollable === target || !scrollable.contains(target)) {\n      throw MH.usageError(\"Target must be a descendant of the scrollable one\");\n    }\n\n    return {\n      top: () =>\n        MH.getBoundingClientRect(target).top -\n        MH.getBoundingClientRect(scrollable).top +\n        (isDocScrollingElement ? 0 : scrollable[MC.S_SCROLL_TOP]),\n      left: () =>\n        MH.getBoundingClientRect(target).left -\n        MH.getBoundingClientRect(scrollable).left +\n        (isDocScrollingElement ? 0 : scrollable[MC.S_SCROLL_LEFT]),\n    };\n  }\n\n  if (MH.isString(target)) {\n    const targetEl = MH.docQuerySelector(target);\n    if (!targetEl) {\n      throw MH.usageError(`No match for '${target}'`);\n    }\n\n    return getTargetCoordinates(scrollable, targetEl);\n  }\n\n  if (!MH.isObject(target) || !(\"top\" in target || \"left\" in target)) {\n    throw MH.usageError(\"Invalid coordinates\");\n  }\n\n  return target;\n};\n\nconst getStartEndPosition = async (\n  options: ScrollToOptionsInternal,\n): Promise<{ _start: ScrollPosition; _end: ScrollPosition }> => {\n  await waitForMeasureTime();\n\n  const applyOffset = (\n    position: ScrollPosition,\n    offset: CoordinateOffset | null,\n  ) => {\n    position.top += offset?.top ?? 0;\n    position.left += offset?.left ?? 0;\n  };\n\n  const scrollable = options._scrollable;\n  const start = {\n    top: scrollable[MC.S_SCROLL_TOP],\n    left: scrollable[MC.S_SCROLL_LEFT],\n  };\n\n  let end = getEndPosition(scrollable, start, options._target);\n  applyOffset(end, options._offset);\n\n  if (!arePositionsDifferent(start, end) && options._altTarget) {\n    end = getEndPosition(scrollable, start, options._altTarget);\n    applyOffset(end, options._altOffset);\n  }\n\n  return { _start: start, _end: end };\n};\n\n// must be called in \"measure time\"\nconst getEndPosition = (\n  scrollable: Element,\n  startPosition: ScrollPosition,\n  targetCoordinates: TargetCoordinates,\n): ScrollPosition => {\n  // by default no change in scroll top or left\n  const endPosition = MH.copyObject(startPosition);\n\n  if (!MH.isNullish(targetCoordinates?.top)) {\n    if (MH.isFunction(targetCoordinates.top)) {\n      endPosition.top = targetCoordinates.top(scrollable);\n    } else {\n      endPosition.top = targetCoordinates.top;\n    }\n  }\n\n  if (!MH.isNullish(targetCoordinates?.left)) {\n    if (MH.isFunction(targetCoordinates.left)) {\n      endPosition.left = targetCoordinates.left(scrollable);\n    } else {\n      endPosition.left = targetCoordinates.left;\n    }\n  }\n\n  // Set boundaries\n  const scrollH = scrollable[MC.S_SCROLL_HEIGHT];\n  const scrollW = scrollable[MC.S_SCROLL_WIDTH];\n  const clientH = getClientHeightNow(scrollable);\n  const clientW = getClientWidthNow(scrollable);\n  endPosition.top = MH.min(scrollH - clientH, endPosition.top);\n  endPosition.top = MH.max(0, endPosition.top);\n\n  endPosition.left = MH.min(scrollW - clientW, endPosition.left);\n  endPosition.left = MH.max(0, endPosition.left);\n\n  return endPosition;\n};\n\nconst initiateScroll = async (\n  options: ScrollToOptionsInternal,\n  isCancelled: () => boolean,\n) => {\n  const position = await getStartEndPosition(options);\n  const duration = options._duration;\n  const scrollable = options._scrollable;\n  const existingScrollInfo = currentScrollInfos.get(scrollable);\n\n  const currentPosition = existingScrollInfo?._position ?? position._start;\n  const currentVelocity = existingScrollInfo?._velocity ?? {\n    [MC.S_TOP]: 0,\n    [MC.S_LEFT]: 0,\n  };\n  let elapsed = existingScrollInfo?._elapsed;\n\n  const logger = debug\n    ? new debug.Logger({\n        name: `scroll-${formatAsString(scrollable)}-${randId()}`,\n        logAtCreation: {\n          options,\n          position,\n          elapsed,\n          currentPosition: MH.copyObject(currentPosition),\n          currentVelocity: MH.copyObject(currentVelocity),\n        },\n      })\n    : null;\n\n  for await (elapsed of newAnimationFrameIterator(elapsed)) {\n    const deltaTime = elapsed.sinceLast;\n    if (deltaTime === 0) {\n      // First time\n      continue;\n    }\n\n    // Element.scrollTo equates to a measurement and needs to run after\n    // painting to avoid forced layout.\n    await waitForMeasureTime();\n\n    if (isCancelled()) {\n      // Reject the promise\n      logger?.debug8(\"Cancelled\");\n      throw currentPosition;\n    }\n\n    for (const s of [MC.S_LEFT, MC.S_TOP] as const) {\n      const { l, v } = criticallyDamped({\n        l: currentPosition[s],\n        v: currentVelocity[s],\n        lTarget: position._end[s],\n        dt: deltaTime,\n        lag: duration,\n      });\n\n      currentPosition[s] = l;\n      currentVelocity[s] = v;\n    }\n\n    updateCurrentScrollInfo(scrollable, {\n      _position: currentPosition,\n      _velocity: currentVelocity,\n      _elapsed: elapsed,\n    });\n\n    const isDone = !arePositionsDifferent(currentPosition, position._end, 0.5);\n    if (isDone) {\n      MH.assign(currentPosition, position._end); // use exact final coordinates\n    }\n\n    MH.elScrollTo(scrollable, currentPosition);\n\n    if (isDone) {\n      logger?.debug8(\"Done\");\n      break;\n    }\n  }\n\n  return currentPosition;\n};\n\n// ------------------------------\n\nlet mainContentElement: HTMLElement;\nlet mainScrollableElement: HTMLElement;\n\nlet initPromise: Promise<void> | null = null;\nconst init = (): Promise<void> => {\n  if (!initPromise) {\n    initPromise = (async () => {\n      const mainScrollableElementSelector =\n        settings.mainScrollableElementSelector;\n\n      const contentElement = await waitForElementOrInteractive(() => {\n        return mainScrollableElementSelector\n          ? MH.docQuerySelector(mainScrollableElementSelector)\n          : MH.getBody(); // default if no selector\n      });\n\n      // defaults\n      mainScrollableElement = getDefaultScrollingElement();\n      mainContentElement = MH.getBody();\n\n      if (!contentElement) {\n        logError(\n          MH.usageError(\n            `No match for '${mainScrollableElementSelector}'. ` +\n              \"Scroll tracking/capturing may not work as intended.\",\n          ),\n        );\n      } else if (!MH.isHTMLElement(contentElement)) {\n        logWarn(\"mainScrollableElementSelector should point to an HTMLElement\");\n      } else if (contentElement !== mainContentElement) {\n        mainScrollableElement = mainContentElement = contentElement;\n      }\n    })();\n  }\n\n  return initPromise;\n};\n\n// Try to find the main scrollable/content elements asap so that tryGetMain*\n// can return them if called before fetchMain*\nif (MH.hasDOM()) {\n  waitForInteractive().then(init);\n}\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  addClasses,\n  addClassesNow,\n  setDataNow,\n  setStylePropNow,\n} from \"@lisn/utils/css-alter\";\nimport { moveElement, tryWrapContent } from \"@lisn/utils/dom-alter\";\nimport { waitForElement } from \"@lisn/utils/dom-events\";\nimport { waitForMutateTime } from \"@lisn/utils/dom-optimize\";\nimport { camelToKebabCase, objToStrKey } from \"@lisn/utils/text\";\nimport {\n  isScrollable,\n  tryGetMainContentElement,\n  fetchMainContentElement,\n} from \"@lisn/utils/scroll\";\n\nimport { newXWeakMap } from \"@lisn/modules/x-map\";\n\n/**\n * @category Overlays\n * @interface\n */\nexport type OverlayOptions = {\n  /**\n   * The parent element to insert the overlay into.\n   *\n   * If not given, then:\n   * - if the overlay is to have a `position: fixed`, then `document.body` is used\n   * - otherwise,\n   *   {@link Settings.settings.mainScrollableElementSelector | the main scrolling element}\n   *   is used\n   */\n  parent?: HTMLElement;\n\n  /**\n   * If set, then it will be assigned as the DOM element ID for the new\n   * overlay.\n   *\n   * Furthermore, the new overlay will be created and will not be saved for\n   * future reuse.\n   *\n   * By default, if `id` is not given, the overlay will be saved, and if\n   * {@link createOverlay} is called again with the same `style`, `data` and\n   * parent, the previous overlay is returned.\n   */\n  id?: string;\n\n  /**\n   * Every entry in this object will be set on the `style` of the new overlay.\n   *\n   * **IMPORTANT:** By default overlays are positioned absolutely, so if you need\n   * another positioning, override this here by setting a `position` key in\n   * `style`. If position is either \"absolute\" (by default or explicitly set) or\n   * \"fixed\", and none of `top` or `bottom` is given, `top: 0` is set; and\n   * similarly, if none of `left` or `right` is given, `left: 0` is set.\n   */\n  style?: Record<string, string>;\n\n  /**\n   * Every entry in this object will be set as a data attribute on the new\n   * overlay.\n   *\n   * Keys can be either kebab-case or camelCase (they will be converted if\n   * needed). Do _not_ include the \"data-\" prefix which will be added\n   * automatically. E.g. both \"foo-bar\" and \"fooBar\" will result in\n   * \"data-foo-bar\" being set.\n   */\n  data?: Record<string, string>;\n};\n\n/**\n * Returns an existing overlay for this specification. If the overlay was just\n * created it may not yet be attached to the DOM.\n *\n * @category Overlays\n */\nexport const getOverlay = (userOptions?: OverlayOptions) => {\n  const options = tryGetOverlayOptions(userOptions);\n  if (!options) {\n    return null;\n  }\n\n  return overlays.get(options._parent)?.get(options._overlayKey) ?? null;\n};\n\n/**\n * Creates a new overlay, and inserts it into the DOM as soon as\n * {@link waitForMutateTime} resolves, or returns an already existing matching\n * overlay.\n *\n * **Note** that if {@link OverlayOptions.id} is set, a new overlay will\n * _always_ be created.\n *\n * @category Overlays\n */\nexport const createOverlay = async (userOptions?: OverlayOptions) => {\n  const options = await fetchOverlayOptions(userOptions);\n  const canReuse = !options._id;\n\n  if (canReuse) {\n    const existingOverlay = overlays\n      .get(options._parent)\n      ?.get(options._overlayKey);\n\n    if (existingOverlay) {\n      if (!MH.parentOf(existingOverlay)) {\n        // not yet inserted into the DOM, so wait until it is\n        await waitForMutateTime();\n      }\n      return existingOverlay;\n    }\n  }\n\n  // Create a new one\n  const overlay = createOnlyOverlay(options);\n  if (canReuse) {\n    // Save it now before awating, so that concurrent requests to create the\n    // same one use it\n    overlays.sGet(options._parent).set(options._overlayKey, overlay);\n  } else {\n    overlay.id = options._id;\n  }\n\n  const isPercentageHOffset = MH.includes(\n    (options._style.left || \"\") + (options._style.right || \"\"),\n    \"%\",\n  );\n\n  const isPercentageVOffset = MH.includes(\n    (options._style.top || \"\") + (options._style.bottom || \"\"),\n    \"%\",\n  );\n\n  let needsContentWrapping = false;\n  let parentEl = options._parent;\n  if (isPercentageHOffset || isPercentageVOffset) {\n    needsContentWrapping =\n      (isPercentageHOffset && isScrollable(parentEl, { axis: \"x\" })) ||\n      (isPercentageVOffset && isScrollable(parentEl, { axis: \"y\" }));\n  }\n\n  if (needsContentWrapping) {\n    // TODO Is it possible to unwrap the children when no longer needing this\n    // overlay? Probably not worth the effort. ViewWatcher doesn't remove old\n    // olverlays anyway.\n    parentEl = await tryWrapContent(parentEl, {\n      _classNames: [MC.PREFIX_WRAPPER, PREFIX_WRAPPER],\n      _required: true,\n      _requiredBy: \"percentage offset view trigger with scrolling root\",\n    });\n  }\n\n  if (options._style.position === MC.S_ABSOLUTE) {\n    // Ensure parent has non-static positioning\n    addClasses(parentEl, MH.prefixName(\"overlay-container\"));\n  }\n\n  await moveElement(overlay, { to: parentEl });\n\n  return overlay;\n};\n\n// ----------------------------------------\n\ntype OverlayOptionsInternal = {\n  _parent: HTMLElement;\n  _id: string;\n  _style: Record<string, string>;\n  _data: Record<string, string>;\n  _overlayKey: string;\n};\n\nconst PREFIX_WRAPPER = MH.prefixName(\"overlay-wrapper\");\n\nconst overlays = newXWeakMap<HTMLElement, Map<string, HTMLElement>>(() =>\n  MH.newMap(),\n);\n\nconst tryGetOverlayOptions = (\n  userOptions: OverlayOptions | undefined,\n): OverlayOptionsInternal | null => {\n  const style = getCssProperties(userOptions?.style);\n  const data = userOptions?.data ?? {};\n  const parentEl = tryGetParent(userOptions?.parent, style.position);\n  if (!parentEl) {\n    return null;\n  }\n\n  return {\n    _parent: parentEl,\n    _id: userOptions?.id ?? \"\",\n    _style: style,\n    _data: data,\n    _overlayKey: getOverlayKey(style, data),\n  };\n};\n\nconst fetchOverlayOptions = async (\n  userOptions: OverlayOptions | undefined,\n): Promise<OverlayOptionsInternal> => {\n  const style = getCssProperties(userOptions?.style);\n  const data = userOptions?.data ?? {};\n  const parentEl = await fetchParent(userOptions?.parent, style.position);\n\n  return {\n    _parent: parentEl,\n    _id: userOptions?.id ?? \"\",\n    _style: style,\n    _data: data,\n    _overlayKey: getOverlayKey(style, data),\n  };\n};\n\nconst getOverlayKey = (\n  style: Record<string, string>,\n  data: Record<string, string>,\n) => objToStrKey(style) + \"|\" + objToStrKey(data);\n\nconst getCssProperties = (style: Record<string, string> | undefined) => {\n  const finalCssProperties: Record<string, string> = MH.merge(\n    style,\n    { position: style?.position || MC.S_ABSOLUTE }, // default\n  );\n\n  if (\n    finalCssProperties.position === MC.S_ABSOLUTE ||\n    finalCssProperties.position === MC.S_FIXED\n  ) {\n    if (\n      MH.isEmpty(finalCssProperties.top) &&\n      MH.isEmpty(finalCssProperties.bottom)\n    ) {\n      finalCssProperties.top = \"0px\";\n    }\n\n    if (\n      MH.isEmpty(finalCssProperties.left) &&\n      MH.isEmpty(finalCssProperties.right)\n    ) {\n      finalCssProperties.left = \"0px\";\n    }\n  }\n\n  return finalCssProperties;\n};\n\nconst tryGetParent = (\n  userSuppliedParent: HTMLElement | undefined | null,\n  position: string,\n) =>\n  userSuppliedParent ??\n  (position === MC.S_FIXED ? MH.getBody() : tryGetMainContentElement());\n\nconst fetchParent = async (\n  userSuppliedParent: HTMLElement | undefined | null,\n  position: string,\n) =>\n  userSuppliedParent ??\n  (position === MC.S_FIXED\n    ? await waitForElement(MH.getBody)\n    : await fetchMainContentElement());\n\nconst createOnlyOverlay = (options: OverlayOptionsInternal) => {\n  const overlay = MH.createElement(\"div\");\n\n  addClassesNow(overlay, MH.prefixName(\"overlay\"));\n\n  const data = options._data;\n  for (const attr of MH.keysOf(data)) {\n    setDataNow(overlay, camelToKebabCase(attr), data[attr]);\n  }\n\n  const style = options._style;\n  for (const prop of MH.keysOf(style)) {\n    setStylePropNow(overlay, prop, style[prop]);\n  }\n\n  return overlay;\n};\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { Box, Dimension, Size } from \"@lisn/globals/types\";\n\nimport { waitForMeasureTime } from \"@lisn/utils/dom-optimize\";\nimport { createOverlay } from \"@lisn/utils/overlays\";\n\n/**\n * Returns the content box size of the given\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserverEntry | ResizeObserverEntry}.\n *\n * @category Size measurements\n */\nexport const getEntryContentBox = (entry: ResizeObserverEntry): Size => {\n  const size = entry.contentBoxSize;\n\n  if (size) {\n    return getSizeFromInlineBlock(size);\n  }\n\n  const rect = entry.contentRect;\n  return { [MC.S_WIDTH]: rect[MC.S_WIDTH], [MC.S_HEIGHT]: rect[MC.S_HEIGHT] };\n};\n\n/**\n * Returns the border box size of the given\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserverEntry | ResizeObserverEntry}.\n *\n * @param fallbackToContent If the entry does not contain border box\n *                          measurements (depending on browser), then fall back\n *                          to using the content box size. Otherwise (by\n *                          default) will return `NaN` values for width and\n *                          height.\n *\n * @category Size measurements\n */\nexport const getEntryBorderBox = (\n  entry: ResizeObserverEntry,\n  fallbackToContent = false,\n): Size => {\n  const size = entry.borderBoxSize;\n\n  if (size) {\n    return getSizeFromInlineBlock(size);\n  } else if (fallbackToContent) {\n    return getEntryContentBox(entry);\n  }\n\n  return { [MC.S_WIDTH]: NaN, [MC.S_HEIGHT]: NaN };\n};\n\n/**\n * Returns true if the given string is a valid box type.\n *\n * @category Validation\n */\nexport const isValidBox = (box: string): box is Box =>\n  MH.includes(ALL_BOXES, box);\n\n/**\n * Returns true if the given string is a valid dimension.\n *\n * @category Validation\n */\nexport const isValidDimension = (dimension: string): dimension is Dimension =>\n  MH.includes(ALL_DIMENSIONS, dimension);\n\n/**\n * @ignore\n * @internal\n */\nexport const tryGetViewportOverlay = (): HTMLElement | null =>\n  viewportOverlay ?? null;\n\n/**\n * @ignore\n * @internal\n *\n * Exposed via SizeWatcher\n */\nexport const fetchViewportOverlay = async (): Promise<HTMLElement> => {\n  await init();\n\n  return viewportOverlay;\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const fetchViewportSize = async (realtime = false) => {\n  if (!realtime) {\n    await waitForMeasureTime();\n  }\n\n  const root = MH.hasDOM()\n    ? (MH.getDocScrollingElement() ?? MH.getBody())\n    : null;\n\n  return {\n    [MC.S_WIDTH]: root?.clientWidth ?? 0,\n    [MC.S_HEIGHT]: root?.clientHeight ?? 0,\n  };\n};\n\n// ----------------------------------------\n\nconst S_INLINE_SIZE = \"inlineSize\";\nconst S_BLOCK_SIZE = \"blockSize\";\n\nconst ALL_BOXES: Box[] = [\"content\", \"border\"] as const;\nconst ALL_DIMENSIONS: Dimension[] = [MC.S_WIDTH, MC.S_HEIGHT] as const;\n\nconst getSizeFromInlineBlock = (\n  size: ResizeObserverSize | ReadonlyArray<ResizeObserverSize>,\n): Size => {\n  /* istanbul ignore else */\n  if (MH.isIterableObject(size)) {\n    return {\n      [MC.S_WIDTH]: size[0][S_INLINE_SIZE],\n      [MC.S_HEIGHT]: size[0][S_BLOCK_SIZE],\n    };\n  }\n  return {\n    // in some browsers inlineSize and blockSize are scalars and nor Arrays\n    [MC.S_WIDTH]: (size as { [S_INLINE_SIZE]: number })[S_INLINE_SIZE],\n    [MC.S_HEIGHT]: (size as { [S_BLOCK_SIZE]: number })[S_BLOCK_SIZE],\n  };\n};\n\n// ------------------------------\n\nlet viewportOverlay: HTMLElement;\nlet initPromise: Promise<void> | null = null;\nconst init = (): Promise<void> => {\n  if (!initPromise) {\n    initPromise = (async () => {\n      viewportOverlay = await createOverlay({\n        id: MH.prefixName(\"vp-ovrl\"),\n        style: {\n          position: \"fixed\",\n          [MC.S_WIDTH]: \"100vw\",\n          [MC.S_HEIGHT]: \"100vh\",\n        },\n      });\n    })();\n  }\n\n  return initPromise;\n};\n","/**\n * @module Modules/XResizeObserver\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { logWarn, logError } from \"@lisn/utils/log\";\n\nimport debug from \"@lisn/debug/debug\";\n\nexport type XResizeObserverCallback = (\n  entries: ResizeObserverEntry[],\n  observer: XResizeObserver,\n) => void;\n\n/**\n * {@link XResizeObserver} is an extension of\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver | ResizeObserver}\n * - observes both border box and content box size changes\n * - can skip the initial callback that happens shortly after setting up via\n *   {@link observeLater}\n * - can debounce the callback\n */\nexport class XResizeObserver {\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver/observe | ResizeObserver:observe} except it accepts multiple targets.\n   */\n  readonly observe: (...targets: Element[]) => void;\n\n  /**\n   * Like {@link observe} but it ignores the initial almost immediate callback\n   * and only calls the callback on a subsequent resize.\n   *\n   * If the target is already being observed, nothing is done.\n   */\n  readonly observeLater: (...targets: Element[]) => void;\n\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver/unobserve | ResizeObserver:unobserve} except it accepts multiple targets.\n   */\n  readonly unobserve: (...targets: Element[]) => void;\n\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver/disconnect | ResizeObserver:disconnect}.\n   */\n  readonly disconnect: () => void;\n\n  /**\n   * @param debounceWindow Debounce the handler so that it's called at most\n   *                       every `debounceWindow` ms.\n   */\n  constructor(callback: XResizeObserverCallback, debounceWindow?: number) {\n    const logger = debug ? new debug.Logger({ name: \"XResizeObserver\" }) : null;\n\n    // Keep the latest ResizeObserverEntry for each target during the\n    // debounceWindow. Short-lived, so ok to use a Map.\n    const buffer = MH.newMap<Element, ResizeObserverEntry>();\n\n    // Since internally we have two observers, one for border box, one for\n    // content box, we will get called initially twice for a target. So we keep\n    // a counter of 1 or 2 for how many more calls to ignore.\n    const targetsToSkip = MH.newWeakMap<Element, 1 | 2>();\n\n    let observedTargets = MH.newWeakSet<Element>();\n\n    debounceWindow ??= 0;\n\n    let timer: ReturnType<typeof setTimeout> | null = null;\n    const resizeHandler = (entries: ResizeObserverEntry[]) => {\n      // Override entries for previous targets, but keep entries whose targets\n      // were not resized in this round\n      for (const entry of entries) {\n        const target = MH.targetOf(entry);\n        const skipNum = targetsToSkip.get(target);\n        if (skipNum !== undefined) {\n          if (skipNum === 2) {\n            // expect one more call\n            targetsToSkip.set(target, 1);\n          } else {\n            // done\n            /* istanbul ignore next */\n            if (skipNum !== 1) {\n              logError(MH.bugError(`# targetsToSkip is ${skipNum}`));\n            }\n            MH.deleteKey(targetsToSkip, target);\n          }\n\n          continue;\n        }\n\n        buffer.set(target, entry);\n      }\n\n      debug: logger?.debug9(\n        `Got ${entries.length} new entries. ` +\n          `Have ${buffer.size} unique-target entries`,\n        entries,\n      );\n\n      if (!timer && MH.sizeOf(buffer)) {\n        timer = MH.setTimer(() => {\n          if (MH.sizeOf(buffer)) {\n            callback(MH.arrayFrom(buffer.values()), this);\n            buffer.clear();\n          }\n\n          timer = null;\n        }, debounceWindow);\n      }\n    };\n\n    const borderObserver = MH.newResizeObserver(resizeHandler);\n    const contentObserver = MH.newResizeObserver(resizeHandler);\n    if (!borderObserver || !contentObserver) {\n      logWarn(\n        \"This browser does not support ResizeObserver. Some features won't work.\",\n      );\n    }\n\n    const observeTarget = (target: Element) => {\n      observedTargets.add(target);\n      borderObserver?.observe(target, { box: \"border-box\" });\n      contentObserver?.observe(target);\n    };\n\n    // --------------------\n\n    this.observe = (...targets) => {\n      debug: logger?.debug10(\"Observing targets\", targets);\n\n      for (const target of targets) {\n        observeTarget(target);\n      }\n    };\n\n    this.observeLater = (...targets) => {\n      debug: logger?.debug10(\"Observing targets (later)\", targets);\n      for (const target of targets) {\n        // Only skip them if not already observed, otherwise the initial\n        // (almost) immediate callback won't happen anyway.\n        if (observedTargets.has(target)) {\n          continue;\n        }\n\n        targetsToSkip.set(target, 2);\n        observeTarget(target);\n      }\n    };\n\n    this.unobserve = (...targets) => {\n      debug: logger?.debug10(\"Unobserving targets\", targets);\n\n      for (const target of targets) {\n        MH.deleteKey(observedTargets, target);\n        borderObserver?.unobserve(target);\n        contentObserver?.unobserve(target);\n      }\n    };\n\n    this.disconnect = () => {\n      debug: logger?.debug10(\"Disconnecting\");\n      observedTargets = MH.newWeakSet();\n      borderObserver?.disconnect();\n      contentObserver?.disconnect();\n    };\n  }\n}\n","/**\n * @module Watchers/SizeWatcher\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { Box, Dimension, Size, SizeTarget } from \"@lisn/globals/types\";\n\nimport { setNumericStyleJsVars } from \"@lisn/utils/css-alter\";\nimport { logError } from \"@lisn/utils/log\";\nimport { toNonNegNum } from \"@lisn/utils/math\";\nimport {\n  isValidBox,\n  isValidDimension,\n  getEntryBorderBox,\n  getEntryContentBox,\n  tryGetViewportOverlay,\n  fetchViewportOverlay,\n} from \"@lisn/utils/size\";\nimport { objToStrKey } from \"@lisn/utils/text\";\n\nimport {\n  CallbackHandler,\n  Callback,\n  wrapCallback,\n} from \"@lisn/modules/callback\";\nimport { newXWeakMap } from \"@lisn/modules/x-map\";\nimport { XResizeObserver } from \"@lisn/modules/x-resize-observer\";\n\nimport debug from \"@lisn/debug/debug\";\n\n/**\n * {@link SizeWatcher} monitors the size of a given target. It's built on top\n * of {@link https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver | ResizeObserver}.\n *\n * It manages registered callbacks globally and reuses ResizeObservers.\n *\n * Each instance of SizeWatcher manages up to two ResizeObservers: one\n * for content-box size changes and one for border-box size changes.\n */\nexport class SizeWatcher {\n  /**\n   * Call the given handler whenever the target's size changes.\n   *\n   * Unless {@link OnResizeOptions.skipInitial} is true, the handler is also\n   * called (almost) immediately with the latest size data.\n   *\n   * **IMPORTANT:** The same handler can _not_ be added multiple times for the\n   * same target, even if the options differ. If the handler has already been\n   * added for this target, either using {@link onResize} or {@link trackSize},\n   * then it will be removed and re-added with the current options.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the target or options are invalid.\n   */\n  readonly onResize: (\n    handler: OnResizeHandler,\n    options?: OnResizeOptions,\n  ) => Promise<void>;\n\n  /**\n   * Removes a previously added handler.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the target is invalid.\n   */\n  readonly offResize: (handler: OnResizeHandler, target?: SizeTarget) => void;\n\n  /**\n   * This is the same as {@link onResize} except that if `handler` is not given,\n   * then it defaults to an  handler that updates a set of CSS variables on the\n   * target's style:\n   *\n   * - If {@link OnResizeOptions.target | options.target} is not given, or is\n   *   `window`, the following CSS variables are set on the root (`html`)\n   *   element and represent the viewport size:\n   *   - `--lisn-js--window-border-width`\n   *   - `--lisn-js--window-border-height`\n   *   - `--lisn-js--window-content-width`\n   *   - `--lisn-js--window-content-height`\n   *\n   * - Otherwise, the following variables are set on the target itself and\n   *   represent its visible size:\n   *   - `--lisn-js--border-width`\n   *   - `--lisn-js--border-height`\n   *   - `--lisn-js--content-width`\n   *   - `--lisn-js--content-height`\n   *\n   * If `target` is `document`, then it will use `document.documentElement`.\n   *\n   * **IMPORTANT:** The same handler can _not_ be added multiple times for the\n   * same target, even if the options differ. If the handler has already been\n   * added for this target, either using {@link onResize} or {@link trackSize},\n   * then it will be removed and re-added with the current options.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the target or options are invalid.\n   */\n  readonly trackSize: (\n    handler?: OnResizeHandler | null,\n    options?: OnResizeOptions,\n  ) => Promise<void>;\n\n  /**\n   * Removes a previously added handler for {@link trackSize}.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the target is invalid.\n   */\n  readonly noTrackSize: (\n    handler?: OnResizeHandler | null,\n    target?: SizeTarget,\n  ) => void;\n\n  /**\n   * Get the size of the given target. It will get the size from a\n   * ResizeObserverEntry and so it's always delayed by one frame at least.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the target is invalid.\n   */\n  readonly fetchCurrentSize: (target?: SizeTarget) => Promise<SizeData>;\n\n  /**\n   * Creates a new instance of SizeWatcher with the given\n   * {@link SizeWatcherConfig}. It does not save it for future reuse.\n   */\n  static create(config?: SizeWatcherConfig) {\n    return new SizeWatcher(getConfig(config), CONSTRUCTOR_KEY);\n  }\n\n  /**\n   * Returns an existing instance of SizeWatcher with the given\n   * {@link SizeWatcherConfig}, or creates a new one.\n   *\n   * **NOTE:** It saves it for future reuse, so don't use this for temporary\n   * short-lived watchers.\n   */\n  static reuse(config?: SizeWatcherConfig) {\n    const myConfig = getConfig(config);\n    const configStrKey = objToStrKey(myConfig);\n\n    let instance = instances.get(configStrKey);\n    if (!instance) {\n      instance = new SizeWatcher(myConfig, CONSTRUCTOR_KEY);\n      instances.set(configStrKey, instance);\n    }\n\n    return instance;\n  }\n\n  private constructor(\n    config: SizeWatcherConfigInternal,\n    key: typeof CONSTRUCTOR_KEY,\n  ) {\n    if (key !== CONSTRUCTOR_KEY) {\n      throw MH.illegalConstructorError(\"SizeWatcher.create\");\n    }\n\n    const logger = debug\n      ? new debug.Logger({ name: \"SizeWatcher\", logAtCreation: config })\n      : null;\n\n    const allSizeData = MH.newWeakMap<Element, SizeData>();\n\n    const allCallbacks = newXWeakMap<\n      Element,\n      Map<OnResizeHandler, CallbackEntry>\n    >(() => MH.newMap());\n\n    // ----------\n\n    const resizeHandler = (entries: ResizeObserverEntry[]) => {\n      for (const entry of entries) {\n        processEntry(entry);\n      }\n    };\n\n    // Don't debounce the observer, only callbacks.\n    const xObserver = new XResizeObserver(resizeHandler);\n\n    // ----------\n\n    const fetchCurrentSize = async (\n      target: SizeTarget | undefined,\n    ): Promise<SizeData> => {\n      const element = await fetchElement(target);\n      const sizeData = allSizeData.get(element);\n      if (sizeData) {\n        return MH.copyObject(sizeData);\n      }\n\n      return MH.newPromise((resolve) => {\n        // Use a temp ResizeObserver\n        const observer = MH.newResizeObserver((entries) => {\n          const sizeData = getSizeData(entries[0]);\n          observer?.disconnect();\n          resolve(sizeData); // no need to copy or save it\n        });\n\n        if (observer) {\n          observer.observe(element);\n        } else {\n          // Warning would have already been logged by XResizeObserver\n          resolve({\n            border: { [MC.S_WIDTH]: 0, [MC.S_HEIGHT]: 0 },\n            content: { [MC.S_WIDTH]: 0, [MC.S_HEIGHT]: 0 },\n          });\n        }\n      });\n    };\n\n    // ----------\n\n    const fetchOptions = async (\n      options: OnResizeOptions,\n    ): Promise<OnResizeOptionsInternal> => {\n      const box = options.box ?? null;\n      if (box && !isValidBox(box)) {\n        throw MH.usageError(`Unknown box type: '${box}'`);\n      }\n\n      const dimension = options.dimension ?? null;\n      if (dimension && !isValidDimension(dimension)) {\n        throw MH.usageError(`Unknown dimension: '${dimension}'`);\n      }\n\n      return {\n        _element: await fetchElement(MH.targetOf(options)),\n        _box: box,\n        _dimension: dimension,\n        // If threshold is 0, internally treat as 1 (pixel)\n        _threshold:\n          toNonNegNum(options.threshold, config._resizeThreshold) || 1,\n        _debounceWindow:\n          options[MC.S_DEBOUNCE_WINDOW] ?? config._debounceWindow,\n      };\n    };\n\n    // ----------\n\n    const createCallback = (\n      handler: OnResizeHandler,\n      options: OnResizeOptionsInternal,\n    ): CallbackEntry => {\n      const element = options._element;\n      MH.remove(allCallbacks.get(element)?.get(handler)?._callback);\n\n      debug: logger?.debug5(\"Adding/updating handler\", options);\n      const callback = wrapCallback(handler, options._debounceWindow);\n      callback.onRemove(() => {\n        deleteHandler(handler, options);\n      });\n\n      const entry = { _callback: callback, _options: options };\n      allCallbacks.sGet(element).set(handler, entry);\n      return entry;\n    };\n\n    // ----------\n\n    const setupOnResize = async (\n      handler: OnResizeHandler,\n      userOptions: OnResizeOptions | undefined,\n    ) => {\n      const options = await fetchOptions(userOptions ?? {});\n      const element = options._element;\n\n      // Don't await for the size data before creating the callback so that\n      // setupOnResize and removeOnResize have the same \"timing\" and therefore\n      // calling onResize and offResize immediately without awaiting removes the\n      // callback.\n      const entry = createCallback(handler, options);\n      const callback = entry._callback;\n      const sizeData = await fetchCurrentSize(element);\n\n      if (callback.isRemoved()) {\n        return;\n      }\n\n      entry._data = sizeData;\n      allSizeData.set(element, sizeData);\n\n      // Always use observeLater. This is because the initial call to callback\n      // shouldn't be debounced, and so we call it manually here, regardless if\n      // it's a new target or not. Therefore we don't want the observer to also\n      // call it in case it _is_ a new target.\n      // It's ok if already observed, won't do anything.\n      xObserver.observeLater(element);\n\n      if (!userOptions?.skipInitial) {\n        debug: logger?.debug5(\"Calling initially with\", element, sizeData);\n        // Use a one-off callback that's not debounced for the initial call.\n        await invokeCallback(wrapCallback(handler), element, sizeData);\n      }\n    };\n\n    // ----------\n\n    const removeOnResize = async (\n      handler: OnResizeHandler,\n      target: SizeTarget | undefined,\n    ) => {\n      const options = await fetchOptions({ target });\n      const element = options._element;\n      const currEntry = allCallbacks.get(element)?.get(handler);\n      if (currEntry) {\n        MH.remove(currEntry._callback);\n\n        if (handler === setSizeCssProps) {\n          // delete the properties\n          setSizeCssProps(element, null);\n        }\n      }\n    };\n\n    // ----------\n\n    const deleteHandler = (\n      handler: OnResizeHandler,\n      options: OnResizeOptionsInternal,\n    ) => {\n      const element = options._element;\n      MH.deleteKey(allCallbacks.get(element), handler);\n      allCallbacks.prune(element);\n\n      if (!allCallbacks.has(element)) {\n        debug: logger?.debug4(\n          \"No more callbacks for target; unobserving\",\n          element,\n        );\n        xObserver.unobserve(element);\n        MH.deleteKey(allSizeData, element);\n      }\n    };\n\n    // ----------\n\n    const processEntry = (entry: ResizeObserverEntry) => {\n      // In reality, it can't be just a base Element\n      const element = MH.targetOf(entry);\n\n      const latestData = getSizeData(entry);\n      allSizeData.set(element, latestData);\n\n      debug: logger?.debug9(\"New size data\", element, latestData);\n\n      for (const entry of allCallbacks.get(element)?.values() || []) {\n        const thresholdsExceeded = hasExceededThreshold(\n          entry._options,\n          latestData,\n          entry._data,\n        );\n\n        if (!thresholdsExceeded) {\n          debug: logger?.debug9(\"Threshold not exceeded\");\n          continue;\n        }\n\n        entry._data = latestData;\n\n        invokeCallback(entry._callback, element, latestData);\n      }\n    };\n\n    // ----------\n\n    this.fetchCurrentSize = fetchCurrentSize;\n\n    // ----------\n\n    this.trackSize = async (handler?, options?) => {\n      if (!handler) {\n        handler = setSizeCssProps;\n      }\n\n      return setupOnResize(handler, options);\n    };\n\n    // ----------\n\n    this.noTrackSize = (handler?, target?) => {\n      if (!handler) {\n        handler = setSizeCssProps;\n      }\n\n      removeOnResize(handler, target); // no need to await\n    };\n\n    // ----------\n\n    this.onResize = setupOnResize;\n\n    // ----------\n\n    this.offResize = (handler, target?) => {\n      removeOnResize(handler, target); // no need to await\n    };\n  }\n}\n\n/**\n * @interface\n */\nexport type SizeWatcherConfig = {\n  /**\n   * The default value for\n   * {@link OnResizeOptions.debounceWindow | debounceWindow} in calls to\n   * {@link SizeWatcher.onResize}.\n   *\n   * @defaultValue 75\n   */\n  debounceWindow?: number;\n\n  /**\n   * The default value for\n   * {@link OnResizeOptions.threshold | threshold} in calls to\n   * {@link SizeWatcher.onResize}.\n   *\n   * @defaultValue 50\n   */\n  resizeThreshold?: number;\n};\n\n/**\n * @interface\n */\nexport type OnResizeOptions = {\n  /**\n   * If it is not given, or is `null` or `window`, then it will track the size\n   * of the viewport (akin to `clientHeight` on `documentElement`).\n   *\n   * If it is `document`, then it will use `document.documentElement`.\n   *\n   * Other values of target must be an `Element` and are taken literally.\n   *\n   * @defaultValue undefined\n   */\n  target?: SizeTarget;\n\n  /**\n   * Specifies whether to listen for changes in content box size or border box\n   * size.\n   *\n   * If not given, then it listens for changes in either.\n   *\n   * @defaultValue undefined\n   */\n  box?: Box;\n\n  /**\n   * Specifies whether to listen for changes in width or height.\n   *\n   * If not given, then it listens for changes in either.\n   *\n   * @defaultValue undefined\n   */\n  dimension?: Dimension;\n\n  /**\n   * If non-0, the handler will only be called when the target's size in the\n   * observed {@link OnResizeOptions.dimension} and {@link OnResizeOptions.box}\n   * type has changed at least `threshold` pixels since the last time the\n   * handler was called.\n   *\n   * Special case when `threshold` is 0 and at least one of\n   * {@link OnResizeOptions.dimension} or {@link OnResizeOptions.box} is given:\n   * if there's a resize event but the size in the observed dimensions/box\n   * types has not changed, the callback is _not_ called.\n   *\n   * @defaultValue {@link SizeWatcherConfig.resizeThreshold}\n   */\n  threshold?: number;\n\n  /**\n   * Do not call the handler until there's a future resize of the element.\n   *\n   * By default we call the handler (almost) immediately with the current size\n   * data for the target.\n   *\n   * @defaultValue false\n   */\n  skipInitial?: boolean;\n\n  /**\n   * If non-0, the handler will be \"debounced\" so it's called at most\n   * `debounceWindow` milliseconds.\n   *\n   * @defaultValue {@link SizeWatcherConfig.debounceWindow}\n   */\n  debounceWindow?: number;\n};\n\n/**\n * The handler is invoked with three arguments:\n *\n * - the element that has been resized: if the target you requested was the\n *   viewport, then this will be a fixed positioned overlay that tracks the\n *   size of the viewport\n * - the {@link SizeData} for the element\n */\nexport type OnResizeHandlerArgs = [Element, SizeData];\nexport type OnResizeCallback = Callback<OnResizeHandlerArgs>;\nexport type OnResizeHandler =\n  | CallbackHandler<OnResizeHandlerArgs>\n  | OnResizeCallback;\n\nexport type SizeData = Record<Box, Size>;\n\n// ----------------------------------------\n\ntype SizeWatcherConfigInternal = {\n  _debounceWindow: number;\n  _resizeThreshold: number;\n};\n\ntype OnResizeOptionsInternal = {\n  _element: Element;\n  _box: Box | null;\n  _dimension: Dimension | null;\n  _threshold: number;\n  _debounceWindow: number;\n};\n\ntype CallbackEntry = {\n  _callback: OnResizeCallback;\n  _options: OnResizeOptionsInternal;\n  _data?: SizeData;\n};\n\nconst CONSTRUCTOR_KEY: unique symbol = MC.SYMBOL() as typeof CONSTRUCTOR_KEY;\nconst instances = MH.newMap<string, SizeWatcher>();\n\nconst getConfig = (\n  config: SizeWatcherConfig | undefined,\n): SizeWatcherConfigInternal => {\n  config ??= {};\n  return {\n    _debounceWindow: toNonNegNum(config[MC.S_DEBOUNCE_WINDOW], 75),\n    // If threshold is 0, internally treat as 1 (pixel)\n    _resizeThreshold: toNonNegNum(config.resizeThreshold, 50) || 1,\n  };\n};\n\n// --------------------\n\nconst hasExceededThreshold = (\n  options: OnResizeOptionsInternal,\n  latestData: SizeData,\n  lastThresholdData: SizeData | undefined,\n): boolean => {\n  if (!lastThresholdData) {\n    /* istanbul ignore */\n    return false;\n  }\n\n  let box: Box, dim: Dimension;\n  for (box in latestData) {\n    if (options._box && options._box !== box) {\n      continue;\n    }\n\n    for (dim in latestData[box]) {\n      if (options._dimension && options._dimension !== dim) {\n        continue;\n      }\n\n      const diff = MH.abs(latestData[box][dim] - lastThresholdData[box][dim]);\n      if (diff >= options._threshold) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n};\n\nconst getSizeData = (entry: ResizeObserverEntry): SizeData => {\n  const borderBox = getEntryBorderBox(entry, true);\n  const contentBox = getEntryContentBox(entry);\n\n  return {\n    border: borderBox,\n    content: contentBox,\n  };\n};\n\nconst setSizeCssProps = (\n  element: Element,\n  sizeData: SizeData | undefined | null,\n) => {\n  let prefix = \"\";\n  if (element === tryGetViewportOverlay()) {\n    // Set the CSS vars on the root element\n    element = MH.getDocElement();\n    prefix = \"window-\";\n  }\n\n  const props = {\n    borderWidth: sizeData?.border[MC.S_WIDTH],\n    borderHeight: sizeData?.border[MC.S_HEIGHT],\n    contentWidth: sizeData?.content[MC.S_WIDTH],\n    contentHeight: sizeData?.content[MC.S_HEIGHT],\n  };\n  setNumericStyleJsVars(element, props, { _prefix: prefix }); // don't await here\n};\n\nconst fetchElement = async (\n  target: SizeTarget | undefined,\n): Promise<Element> => {\n  if (MH.isElement(target)) {\n    return target;\n  }\n\n  if (!target || target === MH.getWindow()) {\n    return fetchViewportOverlay();\n  }\n\n  if (target === MH.getDoc()) {\n    return MH.getDocElement();\n  }\n\n  throw MH.usageError(\"Unsupported resize target\");\n};\n\nconst invokeCallback = (\n  callback: OnResizeCallback,\n  element: Element,\n  sizeData: SizeData,\n) => callback.invoke(element, MH.copyObject(sizeData)).catch(logError);\n","/**\n * @module Watchers/LayoutWatcher\n */\n\n// NOTES FOR DEVELOPERS\n//\n// For each layout (device or aspect ratio), we create an overlay that has a\n// a width that corresponds to the layout:\n//  - for device layouts, it's a fixed width in pixels, equal to the minimum\n//    width of the device\n//  - for aspect ratio layouts, the overlay has a width that's relative to\n//    the root's height, equal to the minimum width of the aspect ratio\n//\n// Then we observe each overlay with an IntersectionObserver whose root\n// is this Watcher's root and whose root margin is -100% from the left (i.e.\n// right-most edge of the root).\n//\n// If the root is null, i.e. the viewport, the overlays will have a \"fixed\"\n// position and be inserted in document.body. Otherwise, they'll be inserted\n// in the root element with an \"absolute\" position. The root element, if not\n// body must be positioned. It gets a default position of \"relative\" through\n// the class `.lisn-overlay-container`, which Overlays ensures it gets.\n//\n// If using custom root we track its size through SizeWatcher as the\n// aspectRatio overlays are relative to the height, and we can't rely on CSS\n// alone as the root may not have a fixed height through CSS.\n//\n// Whenever any overlay intersects the root, this means that the viewport\n// width is now equal to or narrower than the overlay.\n//\n// ~~~~ The current device or aspect ratio corresponds to the _widest_\n// ~~~~ overlay that does not intersect.\n//\n// For example:\n//\n// | mobile\n// ========| mobile-wide\n// ======================| tablet\n// =========================================| desktop\n//\n// _________________________________| viewport width\n//\n// Here, mobile, mobile-wide and tablet overlays are _not_ intersecting, only\n// desktop intersects. The device layout is therefore tablet.\n//\n// Therefore:\n// - have the layout bit spaces ordered from narrowest layout at lowest bit\n//   to widest layout at hightest bit\n// - keep a running bitmask of which overlays are not intersecting and update\n//   it each time there is an IntersectionObserverEntry.\n// - get the highest device or aspect ratio bit in that bitmask to find out\n//   the widest non-intersecting overlay\n//\n// For simplicity we create overlays also for layouts that have a 0-width.\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { settings } from \"@lisn/globals/settings\";\n\nimport {\n  Layout,\n  DeviceSpec,\n  Device,\n  AspectRatioSpec,\n  AspectRatio,\n} from \"@lisn/globals/types\";\n\nimport { getData } from \"@lisn/utils/css-alter\";\nimport {\n  getLayoutBitmask,\n  NUM_LAYOUTS,\n  ORDERED_DEVICES,\n  ORDERED_ASPECTR,\n} from \"@lisn/utils/layout\";\nimport { logError, logWarn } from \"@lisn/utils/log\";\nimport { omitKeys, copyExistingKeys } from \"@lisn/utils/misc\";\nimport { createOverlay } from \"@lisn/utils/overlays\";\nimport { objToStrKey } from \"@lisn/utils/text\";\n\nimport {\n  CallbackHandler,\n  Callback,\n  wrapCallback,\n} from \"@lisn/modules/callback\";\nimport { newXMap } from \"@lisn/modules/x-map\";\n\nimport { SizeWatcher } from \"@lisn/watchers/size-watcher\";\n\nimport debug from \"@lisn/debug/debug\";\n\n/**\n * {@link LayoutWatcher} listens for changes in either the width or aspect\n * ratio of the viewport or the given {@link LayoutWatcherConfig.root | root}.\n *\n * It does not track resize events; rather it's built on top of\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver | IntersectionObserver}.\n *\n * It manages registered callbacks globally and reuses IntersectionObservers\n * for more efficient performance.\n */\nexport class LayoutWatcher {\n  /**\n   * Call the given handler whenever the layout changes.\n   *\n   * Unless {@link OnLayoutOptions.skipInitial} is true, the handler is also\n   * called (almost) immediately with the current layout.\n   *\n   * **IMPORTANT:** The same handler can _not_ be added multiple times, even if\n   * the options differ. If the handler has already been added, it is removed\n   * and re-added with the current options.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the options are invalid.\n   */\n  readonly onLayout: (\n    handler: OnLayoutHandler,\n    options?: OnLayoutOptions,\n  ) => Promise<void>;\n\n  /**\n   * Removes a previously added handler.\n   */\n  readonly offLayout: (handler: OnLayoutHandler) => void;\n\n  /**\n   * Get the current screen layout.\n   */\n  readonly fetchCurrentLayout: () => Promise<LayoutData>;\n\n  /**\n   * Creates a new instance of LayoutWatcher with the given\n   * {@link LayoutWatcherConfig}. It does not save it for future reuse.\n   */\n  static create(config?: LayoutWatcherConfig) {\n    return new LayoutWatcher(getConfig(config), CONSTRUCTOR_KEY);\n  }\n\n  /**\n   * Returns an existing instance of LayoutWatcher with the given\n   * {@link LayoutWatcherConfig}, or creates a new one.\n   *\n   * **NOTE:** It saves it for future reuse, so don't use this for temporary\n   * short-lived watchers.\n   */\n  static reuse(config?: LayoutWatcherConfig) {\n    const myConfig = getConfig(config);\n    const configStrKey = objToStrKey(omitKeys(myConfig, { _root: null }));\n\n    let instance = instances.get(myConfig._root)?.get(configStrKey);\n    if (!instance) {\n      instance = new LayoutWatcher(myConfig, CONSTRUCTOR_KEY);\n      instances.sGet(myConfig._root).set(configStrKey, instance);\n    }\n\n    return instance;\n  }\n\n  private constructor(\n    config: LayoutWatcherConfigInternal,\n    key: typeof CONSTRUCTOR_KEY,\n  ) {\n    if (key !== CONSTRUCTOR_KEY) {\n      throw MH.illegalConstructorError(\"LayoutWatcher.create\");\n    }\n\n    const logger = debug\n      ? new debug.Logger({ name: \"LayoutWatcher\", logAtCreation: config })\n      : null;\n    let nonIntersectingBitmask = 0;\n    let currentLayoutData: LayoutData = {\n      device: null,\n      aspectRatio: null,\n    };\n\n    const allCallbacks = MH.newMap<\n      OnLayoutHandler,\n      {\n        _callback: OnLayoutCallback;\n        _layoutBitmask: number;\n      }\n    >();\n\n    // ----------\n\n    const fetchCurrentLayout = async (): Promise<LayoutData> => {\n      await readyPromise;\n\n      return MH.copyObject(currentLayoutData);\n    };\n\n    // ----------\n\n    const setupOverlays = async () => {\n      const { root, overlays } = await createOverlays(\n        config._root,\n        config._deviceBreakpoints,\n        config._aspectRatioBreakpoints,\n      );\n\n      return MH.newPromise<void>((resolve) => {\n        let isReady = false;\n\n        const intersectionHandler = (entries: IntersectionObserverEntry[]) => {\n          const numEntries = MH.lengthOf(entries);\n          debug: logger?.debug9(`Got ${numEntries} new entries`, entries);\n\n          if (!isReady) {\n            /* istanbul ignore next */ // shouldn't happen\n            if (numEntries < NUM_LAYOUTS) {\n              logWarn(\n                MH.bugError(\n                  `Got IntersectionObserver ${numEntries}, ` +\n                    `expected >= ${NUM_LAYOUTS}`,\n                ),\n              );\n            }\n          }\n\n          for (const entry of entries) {\n            nonIntersectingBitmask = getNonIntersecting(\n              nonIntersectingBitmask,\n              entry,\n            );\n          }\n\n          // If this is the initial call from IntersectionObserver, skip callbacks.\n          // Those that have skipInitial: false would be called elsewhere, by\n          // setupOnLayout\n          processLayoutChange(!isReady);\n          isReady = true;\n          resolve(); // ready after IntersectionObserver has called us the 1st time\n        };\n\n        // ----------\n\n        const observeOptions = {\n          root,\n          rootMargin: \"5px 0% 5px -100%\",\n        };\n\n        const observer = MH.newIntersectionObserver(\n          intersectionHandler,\n          observeOptions,\n        );\n\n        for (const triggerOverlay of overlays) {\n          observer.observe(triggerOverlay);\n        }\n      });\n    };\n\n    // ----------\n\n    const createCallback = (\n      handler: OnLayoutHandler,\n      layoutBitmask: number,\n    ): OnLayoutCallback => {\n      MH.remove(allCallbacks.get(handler)?._callback);\n\n      debug: logger?.debug5(\"Adding/updating handler\", layoutBitmask);\n      const callback = wrapCallback(handler);\n      callback.onRemove(() => {\n        deleteHandler(handler);\n      });\n\n      allCallbacks.set(handler, {\n        _callback: callback,\n        _layoutBitmask: layoutBitmask,\n      });\n      return callback;\n    };\n\n    const setupOnLayout = async (\n      handler: OnLayoutHandler,\n      options: OnLayoutOptions | undefined,\n    ) => {\n      const layoutBitmask = getLayoutBitmask(options);\n      const callback = createCallback(handler, layoutBitmask);\n\n      if (options?.skipInitial) {\n        return;\n      }\n\n      const layoutData = await fetchCurrentLayout();\n\n      if (\n        !callback.isRemoved() &&\n        changeMatches(layoutBitmask, layoutData, null)\n      ) {\n        debug: logger?.debug5(\"Calling initially with\", layoutData);\n        await invokeCallback(callback, layoutData);\n      }\n    };\n\n    const deleteHandler = (handler: OnLayoutHandler) => {\n      MH.deleteKey(allCallbacks, handler);\n      // no need to unobserve the overlays\n    };\n\n    const processLayoutChange = (skipCallbacks: boolean) => {\n      const deviceBit = MH.floor(\n        MH.log2(nonIntersectingBitmask & ORDERED_DEVICES.bitmask),\n      );\n\n      const aspectRatioBit = MH.floor(\n        MH.log2(nonIntersectingBitmask & ORDERED_ASPECTR.bitmask),\n      );\n\n      const layoutData: LayoutData = { device: null, aspectRatio: null };\n\n      // -Infinity means all of the overlays are intersecting, which would only\n      // happen if the narrowest overlay is not actually 0-width (which is not the\n      // case by default and against the recommended settings).\n      if (deviceBit !== -MC.INFINITY) {\n        layoutData.device = ORDERED_DEVICES.nameOf(1 << deviceBit);\n      }\n      if (aspectRatioBit !== -MC.INFINITY) {\n        layoutData.aspectRatio = ORDERED_ASPECTR.nameOf(1 << aspectRatioBit);\n      }\n\n      debug: logger?.debug8(\"New layout\", layoutData);\n\n      if (!skipCallbacks) {\n        for (const entry of allCallbacks.values()) {\n          const layoutBitmask = entry._layoutBitmask;\n          if (!changeMatches(layoutBitmask, layoutData, currentLayoutData)) {\n            debug: logger?.debug9(\n              `Layout change does not match bitmask ${layoutBitmask}`,\n            );\n            continue;\n          }\n\n          invokeCallback(entry._callback, layoutData);\n        }\n      }\n\n      currentLayoutData = layoutData;\n    };\n\n    const readyPromise = setupOverlays(); // no need to await\n\n    // ----------\n\n    this.fetchCurrentLayout = fetchCurrentLayout;\n\n    // ----------\n\n    this.onLayout = setupOnLayout;\n\n    // ----------\n\n    this.offLayout = (handler) => {\n      debug: logger?.debug5(\"Removing handler\");\n      MH.remove(allCallbacks.get(handler)?._callback);\n    };\n  }\n}\n\n/**\n * @interface\n */\nexport type LayoutWatcherConfig = {\n  /**\n   * The root element whose layout to watch. If not given or `null`, then the\n   * viewport layout is watched.\n   *\n   * @defaultValue null\n   */\n  root?: HTMLElement | null;\n\n  /**\n   * Use custom device breakpoints. Only known device names ({@link Device})\n   * are supported. If any are missing from the given dictionary, the value\n   * from {@link settings.deviceBreakpoints} is used.\n   *\n   * @defaultValue {@link settings.deviceBreakpoints}\n   */\n  deviceBreakpoints?: typeof settings.deviceBreakpoints;\n\n  /**\n   * Use custom aspect ratio breakpoints. Only known aspect ratio names\n   * ({@link AspectRatio}) are supported. If any are missing from the given\n   * dictionary, the value from {@link settings.aspectRatioBreakpoints} is\n   * used.\n   *\n   * @defaultValue {@link settings.aspectRatioBreakpoints}\n   */\n  aspectRatioBreakpoints?: typeof settings.aspectRatioBreakpoints;\n};\n\n/**\n * @interface\n */\nexport type OnLayoutOptions = {\n  /**\n   * Specifies a list of {@link Device}s to target for.\n   *\n   * The handler will only be called if there is a change of device to a device\n   * matching the specification.\n   *\n   * It can be:\n   * - \"min <Device>\": devices at least as wide as `<Device>`\n   * - \"max <Device>\": devices at most as wide as `<Device>`\n   * - \"<DeviceMin> to <DeviceMax>\": devices at least as wide as `<DeviceMin>`\n   *                                 and at most as wide as `<DeviceMax>`\n   * - a comma-separated list of device names\n   * - an array of device names\n   *\n   * **NOTE**\n   *\n   * If only one of {@link devices} or {@link aspectRatios} is specified, the\n   * handler will only be called for matching changes of device or aspect ratio\n   * respectively.\n   *\n   * If neither is specified, the handler will be called for any change of layout\n   * (device or aspect ratio).\n   *\n   * Also note that an empty array is treated the same as not given, or `null`.\n   *\n   * @defaultValue undefined\n   */\n  devices?: DeviceSpec | Device[];\n\n  /**\n   * Specifies a list of {@link AspectRatio}s to target for.\n   *\n   * The handler will only be called if there is a change of aspect ratio to\n   * an aspect ratios matching the specification.\n   *\n   * It can be:\n   * - \"min <AspectRatio>\": aspect ratios at least as wide as `<AspectRatio>`\n   * - \"max <AspectRatio>\": aspect ratios at most as wide as `<AspectRatio>`\n   * - \"<AspectRatioMin> to <AspectRatioMax>\": aspect ratios at least as wide\n   *                        as `<AspectRatioMin>` and at most as wide as\n   *                        `<AspectRatioMax>`\n   * - a comma-separated list of aspect ratio names\n   * - an array of aspect ratio names\n   *\n   * **NOTE**\n   *\n   * If only one of {@link devices} or {@link aspectRatios} is specified, the\n   * handler will only be called for matching changes of device or aspect ratio\n   * respectively.\n   *\n   * If neither is specified, the handler will be called for any change of layout\n   * (device or aspect ratio).\n   *\n   * @defaultValue undefined\n   */\n  aspectRatios?: AspectRatioSpec | AspectRatio[];\n\n  /**\n   * Do not call the handler until there's a future change of layout.\n   *\n   * By default, we call the handler (almost) immediately with the current\n   * layout data if it matches the given {@link devices} and {@link aspectRatios}.\n   *\n   * @defaultValue false\n   */\n  skipInitial?: boolean;\n};\n\n/**\n * The handler is invoked with one argument:\n *\n * - the current {@link LayoutData}\n */\nexport type OnLayoutHandlerArgs = [LayoutData];\nexport type OnLayoutCallback = Callback<OnLayoutHandlerArgs>;\nexport type OnLayoutHandler =\n  | CallbackHandler<OnLayoutHandlerArgs>\n  | OnLayoutCallback;\n\n/**\n * Note that {@link device} or {@link aspectRatio} would only be null if the\n * viewport is narrower than the narrowest device/aspect ratio. This would only\n * happen if the narrowest device/aspect ratio is _not_ 0-width (which is not\n * the case with the default breakpoints and is against the recommendation for\n * setting breakpoints.\n */\nexport type LayoutData = {\n  device: Device | null;\n  aspectRatio: AspectRatio | null;\n};\n\n// ----------------------------------------\n\ntype LayoutWatcherConfigInternal = {\n  _root: HTMLElement | null;\n  _deviceBreakpoints: typeof settings.deviceBreakpoints;\n  _aspectRatioBreakpoints: typeof settings.aspectRatioBreakpoints;\n};\n\nconst CONSTRUCTOR_KEY: unique symbol = MC.SYMBOL() as typeof CONSTRUCTOR_KEY;\nconst instances = newXMap<HTMLElement | null, Map<string, LayoutWatcher>>(() =>\n  MH.newMap(),\n);\n\nconst VAR_BORDER_HEIGHT = MH.prefixCssJsVar(\"border-height\");\nconst PREFIX_DEVICE = MH.prefixName(\"device\");\nconst PREFIX_ASPECTR = MH.prefixName(\"aspect-ratio\");\n\nconst getConfig = (\n  config: LayoutWatcherConfig | undefined,\n): LayoutWatcherConfigInternal => {\n  const deviceBreakpoints = MH.copyObject(settings.deviceBreakpoints);\n  if (config?.deviceBreakpoints) {\n    copyExistingKeys(config.deviceBreakpoints, deviceBreakpoints);\n  }\n\n  const aspectRatioBreakpoints = MH.copyObject(settings.aspectRatioBreakpoints);\n\n  if (config?.aspectRatioBreakpoints) {\n    copyExistingKeys(config.aspectRatioBreakpoints, aspectRatioBreakpoints);\n  }\n\n  return {\n    _root: config?.root ?? null,\n    _deviceBreakpoints: deviceBreakpoints,\n    _aspectRatioBreakpoints: aspectRatioBreakpoints,\n  };\n};\n\n// ----------------------------------------\n\nconst createOverlays = async (\n  root: HTMLElement | null,\n  deviceBreakpoints: typeof settings.deviceBreakpoints,\n  aspectRatioBreakpoints: typeof settings.aspectRatioBreakpoints,\n) => {\n  const overlayPromises = [];\n\n  let overlayParent: HTMLElement;\n  if (root) {\n    overlayParent = root;\n  } else {\n    // Since modals remove the scrollbar on the body when active, the width of\n    // the body changes upon open/close of a modal, which would create\n    // glitching if it happens near a device breakpoint. So if the root is the\n    // viewport, we create a fixed positioned container to hold the overlays\n    // and set its width to be 100vw and use that as the root of\n    overlayParent = await createOverlay({\n      style: {\n        position: \"fixed\",\n        [MC.S_WIDTH]: \"100vw\",\n      },\n    });\n  }\n\n  let device: Device;\n  for (device in deviceBreakpoints) {\n    overlayPromises.push(\n      createOverlay({\n        parent: overlayParent,\n        style: {\n          position: \"absolute\",\n          [MC.S_WIDTH]: deviceBreakpoints[device] + \"px\",\n        },\n        data: {\n          [PREFIX_DEVICE]: device,\n        },\n      }),\n    );\n  }\n\n  const parentHeightCss = root ? `var(${VAR_BORDER_HEIGHT}, 0) * 1px` : \"100vh\";\n  if (root) {\n    SizeWatcher.reuse().trackSize(null, { target: root });\n  }\n\n  let aspectRatio: AspectRatio;\n  for (aspectRatio in aspectRatioBreakpoints) {\n    overlayPromises.push(\n      createOverlay({\n        parent: overlayParent,\n        style: {\n          position: \"absolute\",\n          [MC.S_WIDTH]:\n            `calc(${aspectRatioBreakpoints[aspectRatio]} ` +\n            `* ${parentHeightCss})`,\n        },\n        data: {\n          [PREFIX_ASPECTR]: aspectRatio,\n        },\n      }),\n    );\n  }\n\n  const overlays = await MH.promiseAll(overlayPromises);\n  return { root: overlayParent, overlays };\n};\n\nconst getOverlayLayout = (overlay: HTMLElement): Layout | null => {\n  const layout =\n    getData(overlay, PREFIX_DEVICE) || getData(overlay, PREFIX_ASPECTR);\n  /* istanbul ignore else */\n  if (layout && (ORDERED_DEVICES.has(layout) || ORDERED_ASPECTR.has(layout))) {\n    return layout;\n  } else {\n    // shouldn't happen\n    logError(MH.bugError(\"No device or aspectRatio data attribute\"));\n    return null;\n  }\n};\n\nconst changeMatches = (\n  layoutBitmask: number,\n  thisLayoutData: LayoutData,\n  prevLayoutData: LayoutData | undefined | null,\n): boolean => {\n  // True if the callback is interested in a change of device and there's a\n  // change of device and the new device is one of the ones it's interested in\n  // (or it's null, i.e. device is undefined).\n  // And the same for aspect ratios.\n\n  if (\n    prevLayoutData?.device !== thisLayoutData.device &&\n    (!thisLayoutData.device ||\n      ORDERED_DEVICES.bit[thisLayoutData.device] & layoutBitmask)\n  ) {\n    return true;\n  }\n\n  if (\n    prevLayoutData?.aspectRatio !== thisLayoutData.aspectRatio &&\n    (!thisLayoutData.aspectRatio ||\n      ORDERED_ASPECTR.bit[thisLayoutData.aspectRatio] & layoutBitmask)\n  ) {\n    return true;\n  }\n\n  return false;\n};\n\nconst getNonIntersecting = (\n  nonIntersectingBitmask: number, // current\n  entry: IntersectionObserverEntry,\n): number => {\n  const target = MH.targetOf(entry);\n  /* istanbul ignore next */ // shouldn't happen\n  if (!MH.isHTMLElement(target)) {\n    logError(\n      MH.bugError(\n        `IntersectionObserver called us with '${MH.typeOrClassOf(target)}'`,\n      ),\n    );\n    return nonIntersectingBitmask;\n  }\n\n  const layout = getOverlayLayout(target);\n  let bit = 0;\n  if (!layout) {\n    // error already logged by getOverlayLayout\n  } else if (ORDERED_DEVICES.has(layout)) {\n    bit = ORDERED_DEVICES.bit[layout];\n  } else if (ORDERED_ASPECTR.has(layout)) {\n    bit = ORDERED_ASPECTR.bit[layout];\n  } else {\n    /* istanbul ignore next */ // shouldn't happen\n    logError(\n      MH.bugError(`Unknown device or aspectRatio data attribute: ${layout}`),\n    );\n  }\n\n  if (entry.isIntersecting) {\n    nonIntersectingBitmask &= ~bit;\n  } else {\n    nonIntersectingBitmask |= bit;\n  }\n\n  return nonIntersectingBitmask;\n};\n\nconst invokeCallback = (callback: OnLayoutCallback, layoutData: LayoutData) =>\n  callback.invoke(MH.copyObject(layoutData)).catch(logError);\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { PointerAction } from \"@lisn/globals/types\";\n\nimport { isValidStrList } from \"@lisn/utils/validation\";\n\n/**\n * Returns true if the given string is a valid pointer action.\n *\n * @category Validation\n */\nexport const isValidPointerAction = (action: string): action is PointerAction =>\n  MH.includes(POINTER_ACTIONS, action);\n\n/**\n * Returns true if the given string or array is a valid list of pointer\n * actions.\n *\n * @category Validation\n */\nexport const isValidPointerActionList = (actions: string | string[]) =>\n  isValidStrList(actions, isValidPointerAction, false);\n\n/**\n * @ignore\n * @internal\n */\nexport const POINTER_ACTIONS: PointerAction[] = [\n  MC.S_CLICK,\n  MC.S_HOVER,\n  MC.S_PRESS,\n] as const;\n","/**\n * @module Watchers/PointerWatcher\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { PointerAction, CommaSeparatedStr } from \"@lisn/globals/types\";\n\nimport {\n  addEventListenerTo,\n  removeEventListenerFrom,\n  preventSelect,\n  undoPreventSelect,\n} from \"@lisn/utils/event\";\nimport { logError } from \"@lisn/utils/log\";\nimport { isValidPointerAction, POINTER_ACTIONS } from \"@lisn/utils/pointer\";\nimport { objToStrKey } from \"@lisn/utils/text\";\nimport { validateStrList } from \"@lisn/utils/validation\";\n\nimport {\n  CallbackHandler,\n  Callback,\n  wrapCallback,\n} from \"@lisn/modules/callback\";\nimport { newXWeakMap } from \"@lisn/modules/x-map\";\n\n/**\n * {@link PointerWatcher} listens for simple pointer actions like clicks, press\n * and hold or hover.\n */\nexport class PointerWatcher {\n  /**\n   * Call the `startHandler` whenever the pointer action begins.\n   * Call the `endHandler` whenever the pointer action ends. If `endHandler` is\n   * not given, it defaults to `startHandler`.\n   *\n   * For an explanation of what \"begins\" and \"ends\" means for each supported\n   * action, see {@link OnPointerOptions.actions}.\n   *\n   * **IMPORTANT:** The same handlers can _not_ be added multiple times for the\n   * same event target, even if the options differ. If the handler has already\n   * been added for this target, then it will be removed and re-added with the\n   * current options.\n   */\n  readonly onPointer: (\n    target: EventTarget,\n    startHandler: OnPointerHandler,\n    endHandler?: OnPointerHandler,\n    options?: OnPointerOptions,\n  ) => Promise<void>;\n\n  /**\n   * Removes previously added handlers.\n   */\n  readonly offPointer: (\n    target: EventTarget,\n    startHandler: OnPointerHandler,\n    endHandler?: OnPointerHandler,\n  ) => void;\n\n  /**\n   * Creates a new instance of PointerWatcher with the given\n   * {@link PointerWatcherConfig}. It does not save it for future reuse.\n   */\n  static create(config?: PointerWatcherConfig) {\n    return new PointerWatcher(getConfig(config), CONSTRUCTOR_KEY);\n  }\n\n  /**\n   * Returns an existing instance of PointerWatcher with the given\n   * {@link PointerWatcherConfig}, or creates a new one.\n   *\n   * **NOTE:** It saves it for future reuse, so don't use this for temporary\n   * short-lived watchers.\n   */\n  static reuse(config?: PointerWatcherConfig) {\n    const myConfig = getConfig(config);\n    const configStrKey = objToStrKey(myConfig);\n\n    let instance = instances.get(configStrKey);\n    if (!instance) {\n      instance = new PointerWatcher(myConfig, CONSTRUCTOR_KEY);\n      instances.set(configStrKey, instance);\n    }\n\n    return instance;\n  }\n\n  private constructor(\n    config: PointerWatcherConfigInternal,\n    key: typeof CONSTRUCTOR_KEY,\n  ) {\n    if (key !== CONSTRUCTOR_KEY) {\n      throw MH.illegalConstructorError(\"PointerWatcher.create\");\n    }\n\n    // Keep this watcher super simple. The events we listen for don't fire at a\n    // high rate and it's unlikely for there to be many many callbacks for each\n    // target and event type, so don't bother with using a delegating listener,\n    // etc.\n\n    // Keep a map of callbacks so we can lookup the callback by the handler\n    // (and also to prevent duplicate handler for each target, for consistency\n    // with other watchers).\n    const allCallbacks = newXWeakMap<\n      EventTarget,\n      Map<OnPointerHandler, OnPointerCallback>\n    >(() => MH.newMap());\n\n    // ----------\n\n    const createCallback = (\n      target: EventTarget,\n      handler: OnPointerHandler,\n    ): OnPointerCallback => {\n      MH.remove(allCallbacks.get(target)?.get(handler));\n\n      const callback = wrapCallback(handler);\n      callback.onRemove(() => {\n        MH.deleteKey(allCallbacks.get(target), handler);\n      });\n\n      allCallbacks.sGet(target).set(handler, callback);\n      return callback;\n    };\n\n    // async for consistency with other watchers and future compatibility in\n    // case of change needed\n    const setupOnPointer = async (\n      target: EventTarget,\n      startHandler: OnPointerHandler,\n      endHandler: OnPointerHandler | undefined,\n      userOptions: OnPointerOptions | undefined,\n    ) => {\n      const options = getOptions(config, userOptions);\n      const startCallback = createCallback(target, startHandler);\n      const endCallback =\n        endHandler && endHandler !== startHandler\n          ? createCallback(target, endHandler)\n          : startCallback;\n\n      for (const action of options._actions) {\n        listenerSetupFn[action](target, startCallback, endCallback, options);\n      }\n    };\n\n    // ----------\n\n    this.onPointer = setupOnPointer;\n\n    // ----------\n\n    this.offPointer = (target, startHandler, endHandler?) => {\n      const entry = allCallbacks.get(target);\n      MH.remove(entry?.get(startHandler));\n      if (endHandler) {\n        MH.remove(entry?.get(endHandler));\n      }\n    };\n  }\n}\n\n/**\n * @interface\n */\nexport type PointerWatcherConfig = {\n  /**\n   * The default value for\n   * {@link OnPointerOptions.preventDefault | preventDefault} in calls to\n   * {@link PointerWatcher.onPointer}.\n   *\n   * @defaultValue false\n   */\n  preventDefault?: boolean;\n\n  /**\n   * The default value for\n   * {@link OnPointerOptions.preventSelect | preventSelect} in calls to\n   * {@link PointerWatcher.onPointer}.\n   *\n   * @defaultValue true\n   */\n  preventSelect?: boolean;\n};\n\n/**\n * @interface\n */\nexport type OnPointerOptions = {\n  /**\n   * One or more of of \"click\", \"hover\" or \"press\". If not specified, then all\n   * actions are enabled.\n   *\n   * It can be a comma-separated list of {@link PointerAction}s or an array of\n   * such actions.\n   *\n   * For click actions, the start handler is called for every odd number of\n   * clicks (1st, 3rd, 5th, etc), and the end handler is called for every other\n   * click. It functions like a toggle.\n   *\n   * For hover and press actions, the start handler is called when the pointer\n   * enters or presses down on the target respectively, and the end handler is\n   * called when the pointer leaves or comes off the target respectively.\n   *\n   * Note that on touch screens, hover and press actions behave identically.\n   *\n   * @defaultValue undefined\n   */\n  actions?: CommaSeparatedStr<PointerAction> | PointerAction[];\n\n  /**\n   * If true, the events of the pointer actions, e.g. click, will have their\n   * default action prevented.\n   *\n   * @defaultValue {@link PointerWatcherConfig.preventDefault}\n   */\n  preventDefault?: boolean;\n\n  /**\n   * If true (default), then for press actions (and hover actions on touch\n   * screens) it will prevent starting a text selection.\n   *\n   * @defaultValue {@link PointerWatcherConfig.preventSelect}\n   */\n  preventSelect?: boolean;\n};\n\n/**\n * The handler is invoked with two arguments:\n *\n * - the event target that was passed to the {@link PointerWatcher.onPointer}\n *   call (equivalent to\n *   {@link https://developer.mozilla.org/en-US/docs/Web/API/Event/currentTarget | Event:currentTarget}).\n * - the {@link PointerActionData} describing the state of the action.\n */\nexport type OnPointerHandlerArgs = [EventTarget, PointerActionData, Event];\nexport type OnPointerCallback = Callback<OnPointerHandlerArgs>;\nexport type OnPointerHandler =\n  | CallbackHandler<OnPointerHandlerArgs>\n  | OnPointerCallback;\n\nexport type PointerActionData = {\n  action: PointerAction;\n  state: \"ON\" | \"OFF\";\n};\n\n// ----------------------------------------\n\ntype PointerWatcherConfigInternal = {\n  _preventDefault: boolean;\n  _preventSelect: boolean;\n};\n\ntype OnPointerOptionsInternal = {\n  _actions: PointerAction[];\n  _preventDefault: boolean;\n  _preventSelect: boolean;\n};\n\nconst CONSTRUCTOR_KEY: unique symbol = MC.SYMBOL() as typeof CONSTRUCTOR_KEY;\nconst instances = MH.newMap<string, PointerWatcher>();\n\nconst getConfig = (\n  config: PointerWatcherConfig | undefined,\n): PointerWatcherConfigInternal => {\n  return {\n    _preventDefault: config?.preventDefault ?? false,\n    _preventSelect: config?.preventSelect ?? true,\n  };\n};\n\nconst getOptions = (\n  config: PointerWatcherConfigInternal,\n  options: OnPointerOptions | undefined,\n): OnPointerOptionsInternal => {\n  return {\n    _actions:\n      validateStrList(\"actions\", options?.actions, isValidPointerAction) ||\n      POINTER_ACTIONS,\n    _preventDefault: options?.preventDefault ?? config._preventDefault,\n    _preventSelect: options?.preventSelect ?? config._preventSelect,\n  };\n};\n\nconst setupClickListener = (\n  target: EventTarget,\n  startCallback: OnPointerCallback,\n  endCallback: OnPointerCallback,\n  options: OnPointerOptionsInternal,\n) => {\n  // false if next will start; true if next will end.\n  let toggleState = false;\n\n  const wrapper = (event: Event) => {\n    if (options._preventDefault) {\n      MH.preventDefault(event);\n    }\n\n    toggleState = !toggleState;\n\n    const data: PointerActionData = {\n      action: MC.S_CLICK,\n      state: toggleState ? \"ON\" : \"OFF\",\n    };\n\n    invokeCallback(\n      toggleState ? startCallback : endCallback,\n      target,\n      data,\n      event,\n    );\n  };\n\n  addEventListenerTo(target, MC.S_CLICK, wrapper);\n\n  const remove = () => removeEventListenerFrom(target, MC.S_CLICK, wrapper);\n\n  startCallback.onRemove(remove);\n  endCallback.onRemove(remove);\n};\n\nconst setupPointerListeners = (\n  action: typeof MC.S_HOVER | typeof MC.S_PRESS,\n  target: EventTarget,\n  startCallback: OnPointerCallback,\n  endCallback: OnPointerCallback,\n  options: OnPointerOptionsInternal,\n) => {\n  // If the browser doesn't support pointer events, then\n  // addEventListenerTo will transform these into mouse*\n  const startEventSuff = action === MC.S_HOVER ? \"enter\" : \"down\";\n  const endEventSuff = action === MC.S_HOVER ? \"leave\" : \"up\";\n  const startEvent = MC.S_POINTER + startEventSuff;\n  const endEvent = MC.S_POINTER + endEventSuff;\n\n  const wrapper = (event: Event, callback: OnPointerCallback) => {\n    if (options._preventDefault) {\n      MH.preventDefault(event);\n    }\n\n    const data: PointerActionData = {\n      action,\n      state:\n        MH.strReplace(event.type, /pointer|mouse/, \"\") === startEventSuff\n          ? \"ON\"\n          : \"OFF\",\n    };\n\n    invokeCallback(callback, target, data, event);\n  };\n  const startListener = (event: Event) => wrapper(event, startCallback);\n  const endListener = (event: Event) => wrapper(event, endCallback);\n\n  addEventListenerTo(target, startEvent, startListener);\n  addEventListenerTo(target, endEvent, endListener);\n\n  // On some touch screen devices pressing and holding will initiate select\n  // and result in touchend, so we prevent text select\n  if (options._preventSelect) {\n    preventSelect(target);\n  }\n\n  startCallback.onRemove(() => {\n    undoPreventSelect(target);\n    removeEventListenerFrom(target, startEvent, startListener);\n  });\n\n  endCallback.onRemove(() => {\n    undoPreventSelect(target);\n    removeEventListenerFrom(target, endEvent, endListener);\n  });\n};\n\nconst listenerSetupFn: {\n  [D in PointerAction]: (\n    target: EventTarget,\n    startCallback: OnPointerCallback,\n    endCallback: OnPointerCallback,\n    options: OnPointerOptionsInternal,\n  ) => void;\n} = {\n  click: setupClickListener,\n  hover: (...args) => setupPointerListeners(MC.S_HOVER, ...args),\n  press: (...args) => setupPointerListeners(MC.S_PRESS, ...args),\n} as const;\n\nconst invokeCallback = (\n  callback: OnPointerCallback,\n  target: EventTarget,\n  actionData: PointerActionData,\n  event: Event,\n) => callback.invoke(target, MH.copyObject(actionData), event).catch(logError);\n","/**\n * @module Watchers/ScrollWatcher\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { XYDirection, ScrollDirection, SizeTarget } from \"@lisn/globals/types\";\n\nimport {\n  ScrollTarget,\n  TargetCoordinate,\n  TargetCoordinates,\n  CommaSeparatedStr,\n} from \"@lisn/globals/types\";\n\nimport { setNumericStyleJsVars } from \"@lisn/utils/css-alter\";\nimport { getMaxDeltaDirection } from \"@lisn/utils/directions\";\nimport { moveElement, tryWrapContent } from \"@lisn/utils/dom-alter\";\nimport { waitForMeasureTime } from \"@lisn/utils/dom-optimize\";\nimport { addEventListenerTo, removeEventListenerFrom } from \"@lisn/utils/event\";\nimport { logError } from \"@lisn/utils/log\";\nimport { toNonNegNum, maxAbs } from \"@lisn/utils/math\";\nimport {\n  scrollTo,\n  getCurrentScrollAction,\n  getClientWidthNow,\n  getClientHeightNow,\n  tryGetMainScrollableElement,\n  fetchMainContentElement,\n  fetchMainScrollableElement,\n  fetchScrollableElement,\n  isValidScrollDirection,\n  ScrollAction,\n  ScrollToOptions,\n} from \"@lisn/utils/scroll\";\nimport { objToStrKey } from \"@lisn/utils/text\";\nimport { validateStrList } from \"@lisn/utils/validation\";\n\nimport {\n  CallbackHandler,\n  Callback,\n  wrapCallback,\n} from \"@lisn/modules/callback\";\nimport { newXWeakMap } from \"@lisn/modules/x-map\";\n\nimport { MutationOperation, DOMWatcher } from \"@lisn/watchers/dom-watcher\";\nimport { SizeWatcher } from \"@lisn/watchers/size-watcher\";\n\nimport debug from \"@lisn/debug/debug\";\n\n// re-export for convenience\nexport type { ScrollAction, ScrollToOptions } from \"@lisn/utils/scroll\";\n\n/**\n * {@link ScrollWatcher} listens for scroll events in any direction.\n *\n * It manages registered callbacks globally and reuses event listeners for more\n * efficient performance.\n */\nexport class ScrollWatcher {\n  /**\n   * Call the given handler whenever the given scrollable is scrolled.\n   *\n   * Unless {@link OnScrollOptions.skipInitial} is true, the handler is also\n   * called (almost) immediately with the latest scroll data. If a scroll has\n   * not yet been observed on the scrollable and its `scrollTop` and\n   * `scrollLeft` are 0, then the direction is {@link Types.NoDirection} and\n   * the handler is only called if {@link Types.NoDirection} is part of the\n   * supplied {@link OnScrollOptions.directions | options.directions} (or\n   * {@link OnScrollOptions.directions | options.directions} is not given).\n   *\n   * **IMPORTANT:** The same handler can _not_ be added multiple times for the\n   * same scrollable, even if the options differ. If the handler has already\n   * been added for this scrollable, either using {@link trackScroll} or using\n   * {@link onScroll}, then it will be removed and re-added with the current\n   * options. So if previously it was also tracking content size changes using\n   * {@link trackScroll}, it will no longer do so.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the options are invalid.\n   */\n  readonly onScroll: (\n    handler: OnScrollHandler,\n    options?: OnScrollOptions,\n  ) => Promise<void>;\n\n  /**\n   * Removes a previously added handler.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the scrollable is invalid.\n   */\n  readonly offScroll: (\n    handler: OnScrollHandler,\n    scrollable?: ScrollTarget,\n  ) => void;\n\n  /**\n   * This everything that {@link onScroll} does plus more:\n   *\n   * In addition to a scroll event, the handler is also called when either the\n   * offset size or scroll (content) size of the scrollable changes as that\n   * would affect its `scrollTopFraction` and `scrollLeftFraction` and possibly\n   * the `scrollTop` and `scrollLeft` as well.\n   *\n   * **IMPORTANT:** The same handler can _not_ be added multiple times for the\n   * same scrollable, even if the options differ. If the handler has already\n   * been added for this scrollable, either using {@link trackScroll} or using\n   * {@link onScroll}, then it will be removed and re-added with the current\n   * options.\n   *\n   * ------\n   *\n   * If `handler` is not given, then it defaults to an internal handler that\n   * updates a set of CSS variables on the scrollable element's style:\n   *\n   * - If {@link OnScrollOptions.scrollable | options.scrollable} is not given,\n   *   or is `null`, `window` or `document`, the following CSS variables are\n   *   set on the root (`html`) element and represent the scroll of the\n   *   {@link Settings.settings.mainScrollableElementSelector | the main scrolling element}:\n   *   - `--lisn-js--page-scroll-top`\n   *   - `--lisn-js--page-scroll-top-fraction`\n   *   - `--lisn-js--page-scroll-left`\n   *   - `--lisn-js--page-scroll-left-fraction`\n   *   - `--lisn-js--page-scroll-width`\n   *   - `--lisn-js--page-scroll-height`\n   *\n   * - Otherwise, the following variables are set on the scrollable itself,\n   *   and represent its scroll offset:\n   *   - `--lisn-js--scroll-top`\n   *   - `--lisn-js--scroll-top-fraction`\n   *   - `--lisn-js--scroll-left`\n   *   - `--lisn-js--scroll-left-fraction`\n   *   - `--lisn-js--scroll-width`\n   *   - `--lisn-js--scroll-height`\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the options are invalid.\n   */\n  readonly trackScroll: (\n    handler?: OnScrollHandler | null,\n    options?: OnScrollOptions,\n  ) => Promise<void>;\n\n  /**\n   * Removes a previously added handler for {@link trackScroll}.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the scrollable is invalid.\n   */\n  readonly noTrackScroll: (\n    handler?: OnScrollHandler | null,\n    scrollable?: ScrollTarget,\n  ) => void;\n\n  /**\n   * Get the scroll offset of the given scrollable. By default, it will\n   * {@link waitForMeasureTime} and so will be delayed by one frame.\n   *\n   * @param realtime If true, it will not {@link waitForMeasureTime}. Use\n   *                 this only when doing realtime scroll-based animations\n   *                 as it may cause a forced layout.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the scrollable is invalid.\n   */\n  readonly fetchCurrentScroll: (\n    scrollable?: ScrollTarget,\n    realtime?: boolean,\n  ) => Promise<ScrollData>;\n\n  /**\n   * Scrolls the given scrollable element to in the given direction.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the direction or options are invalid.\n   */\n  readonly scroll: (\n    direction: XYDirection,\n    options?: ScrollOptions,\n  ) => Promise<ScrollAction | null>;\n\n  /**\n   * Scrolls the given scrollable element to the given `to` scrollable.\n   *\n   * Returns `null` if there's an ongoing scroll that is not cancellable.\n   *\n   * Note that if `to` is an element or a selector, then it _must_ be a\n   * descendant of the scrollable element.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the \"to\" coordinates or options are invalid.\n   *\n   * @param to If this is an element, then its top-left position is used as\n   *           the target coordinates. If it is a string, then it is treated\n   *           as a selector for an element using `querySelector`.\n   * @param [options.scrollable]\n   *           If not given, it defaults to\n   *           {@link Settings.settings.mainScrollableElementSelector | the main scrolling element}.\n   *\n   * @returns `null` if there's an ongoing scroll that is not cancellable,\n   * otherwise a {@link ScrollAction}.\n   */\n  readonly scrollTo: (\n    to: TargetCoordinates | Element | string,\n    options?: ScrollToOptions,\n  ) => Promise<ScrollAction | null>;\n\n  /**\n   * Returns the current {@link ScrollAction} if any.\n   *\n   * @param scrollable If not given, it defaults to\n   *                   {@link Settings.settings.mainScrollableElementSelector | the main scrolling element}\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the scrollable is invalid.\n   */\n  readonly fetchCurrentScrollAction: (\n    scrollable?: Element,\n  ) => Promise<ScrollAction | null>;\n\n  /**\n   * Cancels the ongoing scroll that's resulting from smooth scrolling\n   * triggered in the past. Does not interrupt or prevent further scrolling.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the scrollable is invalid.\n   *\n   * @param [options.immediate] If true, then it will not use\n   *                            {@link waitForMeasureTime} or\n   *                            {@link Utils.waitForMutateTime | waitForMutateTime}.\n   *                            Warning: this will likely result in forced layout.\n   */\n  readonly stopUserScrolling: (options?: {\n    scrollable?: ScrollTarget;\n    immediate?: boolean;\n  }) => Promise<void>;\n\n  /**\n   * Returns the element that holds the main page content. By default it's\n   * `document.body` but is overridden by\n   * {@link Settings.settings.mainScrollableElementSelector}.\n   *\n   * It will wait for the element to be available if not already.\n   */\n  static fetchMainContentElement(): Promise<HTMLElement> {\n    return fetchMainContentElement();\n  }\n\n  /**\n   * Returns the scrollable element that holds the wrapper around the main page\n   * content. By default it's `document.scrollable` (unless `document.body` is\n   * actually scrollable, in which case it will be used) but it will be\n   * different if {@link Settings.settings.mainScrollableElementSelector} is set.\n   *\n   * It will wait for the element to be available if not already.\n   */\n  static fetchMainScrollableElement(): Promise<HTMLElement> {\n    return fetchMainScrollableElement();\n  }\n\n  /**\n   * Creates a new instance of ScrollWatcher with the given\n   * {@link ScrollWatcherConfig}. It does not save it for future reuse.\n   */\n  static create(config?: ScrollWatcherConfig) {\n    return new ScrollWatcher(getConfig(config), CONSTRUCTOR_KEY);\n  }\n\n  /**\n   * Returns an existing instance of ScrollWatcher with the given\n   * {@link ScrollWatcherConfig}, or creates a new one.\n   *\n   * **NOTE:** It saves it for future reuse, so don't use this for temporary\n   * short-lived watchers.\n   */\n  static reuse(config?: ScrollWatcherConfig) {\n    const myConfig = getConfig(config);\n    const configStrKey = objToStrKey(myConfig);\n\n    let instance = instances.get(configStrKey);\n    if (!instance) {\n      instance = new ScrollWatcher(myConfig, CONSTRUCTOR_KEY);\n      instances.set(configStrKey, instance);\n    }\n\n    return instance;\n  }\n\n  private constructor(\n    config: ScrollWatcherConfigInternal,\n    key: typeof CONSTRUCTOR_KEY,\n  ) {\n    if (key !== CONSTRUCTOR_KEY) {\n      throw MH.illegalConstructorError(\"ScrollWatcher.create\");\n    }\n\n    const logger = debug\n      ? new debug.Logger({ name: \"ScrollWatcher\", logAtCreation: config })\n      : null;\n\n    const allScrollData = MH.newWeakMap<Element, ScrollData>();\n\n    const activeListeners = MH.newWeakMap<\n      ScrollTarget,\n      { _nRealtime: number }\n    >();\n\n    const allCallbacks = newXWeakMap<\n      Element,\n      Map<OnScrollHandler, CallbackEntry>\n    >(() => MH.newMap());\n\n    // ----------\n\n    const fetchCurrentScroll = async (\n      element: Element,\n      realtime = false,\n      isScrollEvent = false,\n    ): Promise<ScrollData> => {\n      // The scroll data can change event without a scroll event, e.g. by the\n      // element changing size, so always get the latest here.\n      const previousEventData = allScrollData.get(element);\n      const latestData = await fetchScrollData(\n        element,\n        previousEventData,\n        realtime,\n      );\n\n      // If there hasn't been a scroll event, use the old scroll direction\n      if (!isScrollEvent && previousEventData) {\n        latestData.direction = previousEventData.direction;\n      }\n      return latestData;\n    };\n\n    // ----------\n\n    const createCallback = (\n      handler: OnScrollHandler,\n      options: OnScrollOptionsInternal,\n      trackType: TrackType,\n    ): CallbackEntry => {\n      const element = options._element;\n      MH.remove(allCallbacks.get(element)?.get(handler)?._callback);\n\n      debug: logger?.debug5(\"Adding/updating handler\", options);\n      const callback = wrapCallback(handler, options._debounceWindow);\n      callback.onRemove(() => {\n        deleteHandler(handler, options);\n      });\n\n      const entry = {\n        _callback: callback,\n        _trackType: trackType,\n        _options: options,\n      };\n      allCallbacks.sGet(element).set(handler, entry);\n\n      return entry;\n    };\n\n    // ----------\n\n    const setupOnScroll = async (\n      handler: OnScrollHandler,\n      userOptions: OnScrollOptions | undefined,\n      trackType: TrackType,\n    ) => {\n      const options = await fetchOnScrollOptions(config, userOptions ?? {});\n      const element = options._element;\n\n      // Don't await for the scroll data before creating the callback so that\n      // setupOnScroll and removeOnScroll have the same \"timing\" and therefore\n      // calling onScroll and offScroll immediately without awaiting removes the\n      // callback.\n      const entry = createCallback(handler, options, trackType);\n      const callback = entry._callback;\n\n      const eventTarget = options._eventTarget;\n      const scrollData = await fetchCurrentScroll(\n        element,\n        options._debounceWindow === 0,\n      );\n\n      if (callback.isRemoved()) {\n        return;\n      }\n\n      entry._data = scrollData;\n      allScrollData.set(element, scrollData);\n\n      if (trackType === TRACK_FULL) {\n        await setupSizeTrack(entry);\n      }\n\n      let listenerOptions = activeListeners.get(eventTarget);\n      if (!listenerOptions) {\n        debug: logger?.debug4(\"Adding scroll listener\", eventTarget);\n        listenerOptions = { _nRealtime: 0 };\n        activeListeners.set(eventTarget, listenerOptions);\n        // Don't debounce the scroll handler, only the callbacks.\n        addEventListenerTo(eventTarget, MC.S_SCROLL, scrollHandler);\n      }\n\n      if (options._debounceWindow === 0) {\n        listenerOptions._nRealtime++;\n      }\n\n      const directions = options._directions;\n      if (\n        !callback.isRemoved() &&\n        !userOptions?.skipInitial &&\n        directionMatches(directions, scrollData.direction)\n      ) {\n        debug: logger?.debug5(\"Calling initially with\", element, scrollData);\n        // Use a one-off callback that's not debounced for the initial call.\n        await invokeCallback(wrapCallback(handler), element, scrollData);\n      }\n    };\n\n    // ----------\n\n    const removeOnScroll = async (\n      handler: OnScrollHandler,\n      scrollable: ScrollTarget | undefined,\n      trackType: TrackType,\n    ) => {\n      const options = await fetchOnScrollOptions(config, { scrollable });\n      const element = options._element;\n      const currEntry = allCallbacks.get(element)?.get(handler);\n      if (currEntry?._trackType === trackType) {\n        MH.remove(currEntry._callback);\n\n        if (handler === setScrollCssProps) {\n          // delete the properties\n          setScrollCssProps(element, null);\n        }\n      }\n    };\n\n    // ----------\n\n    const deleteHandler = (\n      handler: OnScrollHandler,\n      options: OnScrollOptionsInternal,\n    ) => {\n      const element = options._element;\n      const eventTarget = options._eventTarget;\n\n      MH.deleteKey(allCallbacks.get(element), handler);\n      allCallbacks.prune(element);\n\n      const listenerOptions = activeListeners.get(eventTarget);\n      if (listenerOptions && options._debounceWindow === 0) {\n        listenerOptions._nRealtime--;\n      }\n\n      if (!allCallbacks.has(element)) {\n        debug: logger?.debug4(\n          \"No more callbacks for scrollable; removing listener\",\n          element,\n        );\n\n        MH.deleteKey(allScrollData, element);\n        removeEventListenerFrom(eventTarget, MC.S_SCROLL, scrollHandler);\n        MH.deleteKey(activeListeners, eventTarget);\n        // TODO: Should we unwrap children if previously WE wrapped them?\n      }\n    };\n\n    // ----------\n\n    const setupSizeTrack = async (entry: CallbackEntry) => {\n      const options = entry._options;\n      const element = options._element;\n      const scrollCallback = entry._callback;\n      debug: logger?.debug8(\"Setting up size tracking\", element);\n\n      const doc = MH.getDoc();\n      const docScrollingElement = MH.getDocScrollingElement();\n\n      const resizeCallback = wrapCallback(async () => {\n        // Get the latest scroll data for the scrollable\n        // Currently, the resize callback is already delayed by a frame due to\n        // the SizeWatcher, so we don't need to treat this as realtime.\n        const latestData = await fetchCurrentScroll(element);\n        const thresholdsExceeded = hasExceededThreshold(\n          options,\n          latestData,\n          entry._data,\n        );\n\n        if (!thresholdsExceeded) {\n          debug: logger?.debug9(\n            \"Threshold not exceeded\",\n            options,\n            latestData,\n            entry._data,\n          );\n        } else if (!scrollCallback.isRemoved()) {\n          await invokeCallback(scrollCallback, element, latestData);\n        }\n      });\n\n      scrollCallback.onRemove(resizeCallback.remove);\n\n      // Don't use default instance as it has a high threshold.\n      const sizeWatcher = SizeWatcher.reuse();\n      const setupOnResize = (target?: SizeTarget) =>\n        sizeWatcher.onResize(resizeCallback, {\n          target,\n          [MC.S_DEBOUNCE_WINDOW]: options._debounceWindow,\n          // TODO maybe accepts resizeThreshold option\n          threshold: options._threshold,\n        });\n\n      if (element === docScrollingElement) {\n        // In case we're tracking the main document scroll, then we only need to\n        // observe the viewport size and the size of the documentElement (which is\n        // the content size).\n\n        setupOnResize(); // viewport size\n        setupOnResize(doc); // content size\n\n        return;\n      }\n\n      // ResizeObserver only detects changes in offset width/height which is\n      // the visible size of the scrolling element, and that is not affected by the\n      // size of its content.\n      // But we also need to detect changes in the scroll width/height which is\n      // the size of the content.\n      // We also need to keep track of elements being added to the scrollable element.\n\n      const observedElements = MH.newSet<Element>([element]);\n\n      // Observe the scrolling element\n      setupOnResize(element);\n\n      // And also its children (if possible, a single wrapper around them\n      const wrapper = await tryWrapContent(element, {\n        _classNames: [MC.PREFIX_WRAPPER, PREFIX_WRAPPER],\n      });\n      if (wrapper) {\n        setupOnResize(wrapper);\n        observedElements.add(wrapper);\n\n        //\n      } else {\n        for (const child of MH.childrenOf(element)) {\n          setupOnResize(child);\n          observedElements.add(child);\n        }\n      }\n\n      // Watch for newly added elements\n      const domWatcher = DOMWatcher.create({\n        root: element,\n        // only direct children\n        subtree: false,\n      });\n\n      const onAddedCallback = wrapCallback((operation: MutationOperation) => {\n        const child = MH.currentTargetOf(operation);\n        // If we've just added the wrapper, it will be in DOMWatcher's queue,\n        // so check.\n        if (child !== wrapper) {\n          if (wrapper) {\n            // Move this child into the wrapper. If this results in change of size\n            // for wrapper, SizeWatcher will call us.\n            moveElement(child, { to: wrapper, ignoreMove: true });\n          } else {\n            // Track the size of this child.\n            // Don't skip initial, call the callback now\n            setupOnResize(child);\n            observedElements.add(child);\n          }\n        }\n      });\n\n      domWatcher.onMutation(onAddedCallback, { categories: [MC.S_ADDED] });\n      resizeCallback.onRemove(onAddedCallback.remove);\n    };\n\n    // ----------\n\n    const scrollHandler = async (event: Event) => {\n      // We cannot use event.currentTarget because scrollHandler is called inside\n      // a setTimeout so by that time, currentTarget is null or something else.\n      //\n      // However, target and currentTarget only differ when the event is in the\n      // bubbling or capturing phase. Because\n      //\n      // - the scroll event only bubbles when fired on document, and (it only\n      //   bubbles up to window)\n      // - and we never attach the listener to the capturing phase\n      // - and we always use document instead of window to listen for scroll on\n      //   document\n      //\n      // then event.target suffices.\n      const scrollable = MH.targetOf(event);\n      /* istanbul ignore next */\n      if (!scrollable || !(MH.isElement(scrollable) || MH.isDoc(scrollable))) {\n        return;\n      }\n\n      const element = await fetchScrollableElement(scrollable);\n      const realtime = (activeListeners.get(scrollable)?._nRealtime ?? 0) > 0;\n      const latestData = await fetchCurrentScroll(element, realtime, true);\n      allScrollData.set(element, latestData);\n\n      debug: logger?.debug9(\"Scroll event\", element, latestData);\n\n      for (const entry of allCallbacks.get(element)?.values() || []) {\n        // Consider the direction since the last scroll event and not the\n        // direction based on the largest delta the last time the callback\n        // was called.\n        const options = entry._options;\n        const thresholdsExceeded = hasExceededThreshold(\n          options,\n          latestData,\n          entry._data,\n        );\n\n        if (!thresholdsExceeded) {\n          debug: logger?.debug9(\n            \"Threshold not exceeded\",\n            options,\n            latestData,\n            entry._data,\n          );\n          continue;\n        }\n\n        // If threshold has been exceeded, always update the latest data for\n        // this callback.\n        entry._data = latestData;\n\n        if (!directionMatches(options._directions, latestData.direction)) {\n          debug: logger?.debug9(\n            \"Direction does not match\",\n            options,\n            latestData,\n          );\n          continue;\n        }\n\n        invokeCallback(entry._callback, element, latestData);\n      }\n    };\n\n    // ----------\n\n    this.fetchCurrentScroll = (scrollable?, realtime?) =>\n      fetchScrollableElement(scrollable).then((element) =>\n        fetchCurrentScroll(element, realtime),\n      );\n\n    // ----------\n\n    this.scroll = (direction, options) => {\n      if (!isValidScrollDirection(direction)) {\n        throw MH.usageError(`Unknown scroll direction: '${direction}'`);\n      }\n\n      const isVertical = direction === MC.S_UP || direction === MC.S_DOWN;\n      const sign = direction === MC.S_UP || direction === MC.S_LEFT ? -1 : 1;\n      let targetCoordinate: TargetCoordinate;\n\n      const amount = options?.amount ?? 100;\n      const asFractionOf = options?.asFractionOf;\n\n      if (asFractionOf === \"visible\") {\n        targetCoordinate = isVertical\n          ? (el) =>\n              el[MC.S_SCROLL_TOP] +\n              (sign * amount * getClientHeightNow(el)) / 100\n          : (el) =>\n              el[MC.S_SCROLL_LEFT] +\n              (sign * amount * getClientWidthNow(el)) / 100;\n\n        //\n      } else if (asFractionOf === \"content\") {\n        targetCoordinate = isVertical\n          ? (el) =>\n              el[MC.S_SCROLL_TOP] +\n              (sign * amount * el[MC.S_SCROLL_HEIGHT]) / 100\n          : (el) =>\n              el[MC.S_SCROLL_LEFT] +\n              (sign * amount * el[MC.S_SCROLL_WIDTH]) / 100;\n\n        //\n      } else if (asFractionOf !== undefined && asFractionOf !== \"pixel\") {\n        throw MH.usageError(\n          `Unknown 'asFractionOf' keyword: '${asFractionOf}'`,\n        );\n\n        //\n      } else {\n        targetCoordinate = isVertical\n          ? (el) => el[MC.S_SCROLL_TOP] + sign * amount\n          : (el) => el[MC.S_SCROLL_LEFT] + sign * amount;\n      }\n\n      const target = isVertical\n        ? { top: targetCoordinate }\n        : { left: targetCoordinate };\n\n      return this.scrollTo(target, options);\n    };\n\n    // ----------\n\n    this.scrollTo = async (to, options) =>\n      scrollTo(\n        to,\n        MH.merge(options, {\n          duration: options?.duration ?? config._scrollDuration, // default\n          scrollable: await fetchScrollableElement(options?.scrollable), // override\n        }),\n      );\n\n    // ----------\n\n    this.fetchCurrentScrollAction = (scrollable?) =>\n      fetchScrollableElement(scrollable).then((element) =>\n        getCurrentScrollAction(element),\n      );\n\n    // ----------\n\n    this.stopUserScrolling = async (options) => {\n      const element = await fetchScrollableElement(options?.scrollable);\n      const stopScroll = () =>\n        MH.elScrollTo(element, {\n          top: element[MC.S_SCROLL_TOP],\n          left: element[MC.S_SCROLL_LEFT],\n        });\n\n      if (options?.immediate) {\n        stopScroll();\n      } else {\n        waitForMeasureTime().then(stopScroll);\n      }\n    };\n\n    // ----------\n\n    this.trackScroll = (handler?, options?) => {\n      if (!handler) {\n        handler = setScrollCssProps;\n      }\n\n      return setupOnScroll(handler, options, TRACK_FULL);\n    };\n\n    // ----------\n\n    this.noTrackScroll = (handler?, scrollable?) => {\n      if (!handler) {\n        handler = setScrollCssProps;\n      }\n\n      removeOnScroll(handler, scrollable, TRACK_FULL); // no need to await\n    };\n\n    // ----------\n\n    this.onScroll = (handler, options?) =>\n      setupOnScroll(handler, options, TRACK_REGULAR);\n\n    // ----------\n\n    this.offScroll = (handler, scrollable?) => {\n      removeOnScroll(handler, scrollable, TRACK_REGULAR); // no need to await\n    };\n  }\n}\n\n/**\n * @interface\n */\nexport type ScrollWatcherConfig = {\n  /**\n   * The default value for\n   * {@link OnScrollOptions.debounceWindow | debounceWindow} in calls to\n   * {@link ScrollWatcher.onScroll}.\n   *\n   * @defaultValue 75\n   */\n  debounceWindow?: number;\n\n  /**\n   * The default value for\n   * {@link OnScrollOptions.threshold | threshold} in calls to\n   * {@link ScrollWatcher.onScroll}.\n   *\n   * @defaultValue 50\n   */\n  scrollThreshold?: number;\n\n  /**\n   * The default value for\n   * {@link ScrollOptions.duration | duration} in calls to\n   * {@link ScrollWatcher.scroll} and {@link ScrollWatcher.scrollTo}.\n   *\n   * @defaultValue 1000\n   */\n  scrollDuration?: number;\n};\n\n/**\n * @interface\n */\nexport type OnScrollOptions = {\n  /**\n   * If it is not given, or is `null`, `window` or `document`, then it will\n   * track the scroll of the\n   * {@link Settings.settings.mainScrollableElementSelector | the main scrolling element}.\n   *\n   * Other values must be an `Element` and are taken literally.\n   *\n   * @defaultValue undefined\n   */\n  scrollable?: ScrollTarget;\n\n  /**\n   * If non-0, the scroll handler will only be called when the scrollable's\n   * scroll offset in the observed direction has changed at least\n   * `scrollThreshold` pixels since the last time the handler was called.\n   *\n   * @defaultValue {@link ScrollWatcherConfig.scrollThreshold}\n   */\n  threshold?: number;\n\n  /**\n   * Specifies a list of {@link ScrollDirection}s to listen for.\n   *\n   * It can be a comma-separated list of direction names or an array of such\n   * names.\n   *\n   * If not given, then it listens for scrolls in any direction, including\n   * {@link Types.NoDirection} and {@link Types.AmbiguousDirection}.\n   *\n   * The {@link Types.NoDirection} occurs when the callback is called initially\n   * (if `skipInitial` is not `true`) and there hasn't yet been a scroll\n   * observed on the scrollable _and_ it's `scrollTop`/`scrollLeft` are 0.\n   *\n   * The {@link Types.AmbiguousDirection} occurs when the user scrolls\n   * diagonally with close to equal deltas in both horizontal and vertical\n   * direction.\n   *\n   * **IMPORTANT:**\n   *\n   * The direction of a scroll event is always based on comparing `deltaX` and\n   * `deltaY` relative to the _last scroll event_ (within the `debounceWindow`,\n   * and not to the scroll data for the last time the callback was called (in\n   * case it was skipped because `threshold` was not exceeded or in case it was\n   * debounced by a larger window than the watcher).\n   *\n   * I.e. if you have both `threshold` and `directions` restricted, or if the\n   * callback has a larger debounce window than the watcher, it is possible for\n   * there to be a change in the relevant `scrollTop`/`scrollLeft` offset that\n   * exceeds the threshold, and for the callback to _not_ be called.\n   *\n   * For a callback to be called, both of these must be true:\n   * - the change in `scrollTop`/`scrollLeft`, _compared to the last time the\n   *   callback was called_ must exceed the {@link threshold}\n   * - the effective scroll direction, _compared to the last scroll event_\n   *   prior to the _watcher's_ debounce window must be one of the given\n   *   {@link directions}.\n   *\n   * @defaultValue undefined\n   */\n  directions?: CommaSeparatedStr<ScrollDirection> | ScrollDirection[];\n\n  /**\n   * Do not call the handler until there's a future scroll of the element.\n   *\n   * By default we call the handler (almost) immediately if there's been a\n   * scroll in one of the given directions, or if there has not been a scroll\n   * but directions includes {@link Types.NoDirection}, but you can disable\n   * this initial call here.\n   *\n   * @defaultValue false\n   */\n  skipInitial?: boolean;\n\n  /**\n   * If non-0, the handler will be \"debounced\" so it's called at most\n   * `debounceWindow` milliseconds.\n   *\n   * **IMPORTANT:**\n   * If the debounce window is non-0 (default), then the callback is always\n   * delayed by at least an animation frame following a scroll event to allow\n   * for optimized `scrollTop`/`scrollLeft` measurements via\n   * {@link waitForMeasureTime}.\n   *\n   * If you set this is 0, this indicates that the callback should be\n   * \"realtime\" and will therefore skip {@link waitForMeasureTime}, which could\n   * lead to forced re-layouts, but you probably need this when doing\n   * scroll-based animations.\n   *\n   * @defaultValue {@link ScrollWatcherConfig.debounceWindow}\n   */\n  debounceWindow?: number;\n};\n\n/**\n * @interface\n */\nexport type ScrollOptions = ScrollToOptions & {\n  /**\n   * How much to scroll in the given direction.\n   *\n   * @defaultValue 100\n   */\n  amount?: number;\n\n  /**\n   * If set to \"pixel\" (default), `amount` is taken as absolute pixels.\n   *\n   * If set to \"visible\", `amount` is taken as percent of the element's visible\n   * size in the scrolling direction (100 means full client width for\n   * horizontal or height for vertical scroll).\n   *\n   * If set to \"content\", `amount` is taken as percent of the element's full\n   * content size in the scrolling direction (100 means full scroll width for\n   * horizontal or height for vertical scroll).\n   *\n   * @defaultValue \"pixel\"\n   */\n  asFractionOf?: \"pixel\" | \"visible\" | \"content\";\n};\n\n/**\n * The handler is invoked with two arguments:\n *\n * - the element that has been resized\n * - the {@link ScrollData} for the element\n */\nexport type OnScrollHandlerArgs = [Element, ScrollData];\nexport type OnScrollCallback = Callback<OnScrollHandlerArgs>;\nexport type OnScrollHandler =\n  | CallbackHandler<OnScrollHandlerArgs>\n  | OnScrollCallback;\n\nexport type ScrollData = {\n  clientWidth: number;\n  clientHeight: number;\n  scrollWidth: number;\n  scrollHeight: number;\n\n  scrollTop: number;\n\n  /**\n   * This is the `scrollTop` relative to the full `scrollHeight` minus the\n   * `clientHeight`, ranging from 0 to 1.\n   */\n  scrollTopFraction: number;\n\n  scrollLeft: number;\n\n  /**\n   * This is the `scrollLeft` relative to the full `scrollWidth` minus the\n   * `clientWidth`, ranging from 0 to 1.\n   */\n  scrollLeftFraction: number;\n\n  /**\n   * This is the direction of the last scroll action, i.e. _compared to the\n   * last scroll event_, not necessarily based on the deltas compared to the\n   * last time this callback was called.\n   */\n  direction: ScrollDirection;\n};\n\n// ----------------------------------------\n\ntype ScrollWatcherConfigInternal = {\n  _debounceWindow: number;\n  _scrollThreshold: number;\n  _scrollDuration: number;\n};\n\ntype OnScrollOptionsInternal = {\n  _element: Element;\n  _eventTarget: ScrollTarget;\n  _directions: ScrollDirection[] | null;\n  _threshold: number;\n  _debounceWindow: number;\n};\n\ntype CallbackEntry = {\n  _callback: OnScrollCallback;\n  _trackType: TrackType;\n  _options: OnScrollOptionsInternal;\n  _data?: ScrollData;\n};\n\ntype TrackType = typeof TRACK_REGULAR | typeof TRACK_FULL;\n\nconst CONSTRUCTOR_KEY: unique symbol = MC.SYMBOL() as typeof CONSTRUCTOR_KEY;\nconst instances = MH.newMap<string, ScrollWatcher>();\n\nconst PREFIX_WRAPPER = MH.prefixName(\"scroll-watcher-wrapper\");\n\nconst getConfig = (\n  config: ScrollWatcherConfig | undefined,\n): ScrollWatcherConfigInternal => {\n  config ??= {};\n  return {\n    _debounceWindow: toNonNegNum(config[MC.S_DEBOUNCE_WINDOW], 75),\n    // If threshold is 0, internally treat as 1 (pixel)\n    _scrollThreshold: toNonNegNum(config.scrollThreshold, 50) || 1,\n    _scrollDuration: toNonNegNum(config.scrollDuration, 1000),\n  };\n};\n\nconst TRACK_REGULAR = 1; // only scroll events\nconst TRACK_FULL = 2; // scroll + resizing of content and/or wrapper\n\n// --------------------\n\nconst fetchOnScrollOptions = async (\n  config: ScrollWatcherConfigInternal,\n  options: OnScrollOptions,\n): Promise<OnScrollOptionsInternal> => {\n  const directions =\n    validateStrList(\"directions\", options.directions, isValidScrollDirection) ||\n    null;\n\n  const element = await fetchScrollableElement(options.scrollable);\n\n  return {\n    _element: element,\n    _eventTarget: getEventTarget(element),\n    _directions: directions,\n    // If threshold is 0, internally treat as 1 (pixel)\n    _threshold: toNonNegNum(options.threshold, config._scrollThreshold) || 1,\n    _debounceWindow: options[MC.S_DEBOUNCE_WINDOW] ?? config._debounceWindow,\n  };\n};\n\nconst directionMatches = (\n  userDirections: ScrollDirection[] | null,\n  latestDirection: ScrollDirection,\n) => !userDirections || MH.includes(userDirections, latestDirection);\n\nconst hasExceededThreshold = (\n  options: OnScrollOptionsInternal,\n  latestData: ScrollData,\n  lastThresholdData: ScrollData | undefined,\n): boolean => {\n  const directions = options._directions;\n  const threshold = options._threshold;\n  if (!lastThresholdData) {\n    /* istanbul ignore */\n    return false;\n  }\n\n  const topDiff = maxAbs(\n    latestData[MC.S_SCROLL_TOP] - lastThresholdData[MC.S_SCROLL_TOP],\n    latestData[MC.S_SCROLL_HEIGHT] - lastThresholdData[MC.S_SCROLL_HEIGHT],\n    latestData[MC.S_CLIENT_HEIGHT] - lastThresholdData[MC.S_CLIENT_HEIGHT],\n  );\n\n  const leftDiff = maxAbs(\n    latestData[MC.S_SCROLL_LEFT] - lastThresholdData[MC.S_SCROLL_LEFT],\n    latestData[MC.S_SCROLL_WIDTH] - lastThresholdData[MC.S_SCROLL_WIDTH],\n    latestData[MC.S_CLIENT_WIDTH] - lastThresholdData[MC.S_CLIENT_WIDTH],\n  );\n\n  // If the callback is only interested in up/down, then only check the\n  // scrollTop delta, and similarly for left/right.\n  let checkTop = false,\n    checkLeft = false;\n  if (\n    !directions ||\n    MH.includes(directions, MC.S_NONE) ||\n    MH.includes(directions, MC.S_AMBIGUOUS)\n  ) {\n    checkTop = checkLeft = true;\n  } else {\n    if (\n      MH.includes(directions, MC.S_UP) ||\n      MH.includes(directions, MC.S_DOWN)\n    ) {\n      checkTop = true;\n    }\n    if (\n      MH.includes(directions, MC.S_LEFT) ||\n      MH.includes(directions, MC.S_RIGHT)\n    ) {\n      checkLeft = true;\n    }\n  }\n\n  return (\n    (checkTop && topDiff >= threshold) || (checkLeft && leftDiff >= threshold)\n  );\n};\n\nconst fetchScrollData = async (\n  element: Element,\n  previousEventData: ScrollData | undefined,\n  realtime: boolean,\n): Promise<ScrollData> => {\n  if (!realtime) {\n    await waitForMeasureTime();\n  }\n\n  const scrollTop = MH.ceil(element[MC.S_SCROLL_TOP]);\n  const scrollLeft = MH.ceil(element[MC.S_SCROLL_LEFT]);\n  const scrollWidth = element[MC.S_SCROLL_WIDTH];\n  const scrollHeight = element[MC.S_SCROLL_HEIGHT];\n  const clientWidth = getClientWidthNow(element);\n  const clientHeight = getClientHeightNow(element);\n\n  const scrollTopFraction =\n    MH.round(scrollTop) / (scrollHeight - clientHeight || MC.INFINITY);\n  const scrollLeftFraction =\n    MH.round(scrollLeft) / (scrollWidth - clientWidth || MC.INFINITY);\n\n  const prevScrollTop = previousEventData?.scrollTop ?? 0;\n  const prevScrollLeft = previousEventData?.scrollLeft ?? 0;\n\n  const direction = getMaxDeltaDirection(\n    scrollLeft - prevScrollLeft,\n    scrollTop - prevScrollTop,\n  );\n\n  return {\n    direction,\n    [MC.S_CLIENT_WIDTH]: clientWidth,\n    [MC.S_CLIENT_HEIGHT]: clientHeight,\n    [MC.S_SCROLL_WIDTH]: scrollWidth,\n    [MC.S_SCROLL_HEIGHT]: scrollHeight,\n    [MC.S_SCROLL_TOP]: scrollTop,\n    [MC.S_SCROLL_TOP_FRACTION]: scrollTopFraction,\n    [MC.S_SCROLL_LEFT]: scrollLeft,\n    [MC.S_SCROLL_LEFT_FRACTION]: scrollLeftFraction,\n  };\n};\n\nconst setScrollCssProps = (\n  element: Element,\n  scrollData: Partial<ScrollData> | undefined | null,\n) => {\n  let prefix = \"\";\n  if (element === tryGetMainScrollableElement()) {\n    // Set the CSS vars on the root element\n    element = MH.getDocElement();\n    prefix = \"page-\";\n  }\n\n  scrollData ??= {};\n  const props = {\n    [MC.S_SCROLL_TOP]: scrollData[MC.S_SCROLL_TOP],\n    [MC.S_SCROLL_TOP_FRACTION]: scrollData[MC.S_SCROLL_TOP_FRACTION],\n    [MC.S_SCROLL_LEFT]: scrollData[MC.S_SCROLL_LEFT],\n    [MC.S_SCROLL_LEFT_FRACTION]: scrollData[MC.S_SCROLL_LEFT_FRACTION],\n    [MC.S_SCROLL_WIDTH]: scrollData[MC.S_SCROLL_WIDTH],\n    [MC.S_SCROLL_HEIGHT]: scrollData[MC.S_SCROLL_HEIGHT],\n  };\n  setNumericStyleJsVars(element, props, { _prefix: prefix });\n};\n\nconst getEventTarget = (element: Element): ScrollTarget => {\n  if (element === MH.getDocScrollingElement()) {\n    return MH.getDoc();\n  }\n\n  return element;\n};\n\nconst invokeCallback = (\n  callback: OnScrollCallback,\n  element: Element,\n  scrollData: ScrollData,\n) => callback.invoke(element, MH.copyObject(scrollData)).catch(logError);\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { ScrollOffset, View, CommaSeparatedStr } from \"@lisn/globals/types\";\n\nimport { isValidStrList, validateStrList } from \"@lisn/utils/validation\";\n\nimport { newBitSpaces, createBitSpace } from \"@lisn/modules/bit-spaces\";\n\n/**\n * Returns true if the given string is a valid {@link ScrollOffset}.\n *\n * @category Validation\n */\nexport const isValidScrollOffset = (offset: string): offset is ScrollOffset =>\n  offset.match(OFFSET_REGEX) !== null;\n\n/**\n * Returns true if the given string is a valid \"view\".\n *\n * @category Validation\n */\nexport const isValidView = (view: string): view is View =>\n  MH.includes(VIEWS, view);\n\n/**\n * Returns true if the given string or array is a list of valid views.\n *\n * @category Validation\n */\nexport const isValidViewList = (views: string | string[]) =>\n  isValidStrList(views, isValidView, false);\n\n/**\n * Returns the views that are opposite to the given set of views.\n *\n * Above and below are opposites, and so are left and right.\n *\n * \"at\" is a special case. It is considered opposite to any view in the sense\n * that if it is not present in `views` it will always be included in the\n * returned array. However it is not \"strongly\" opposite in the sense that it\n * will not cause other views to be included in the result unless it is the\n * only view in `views`. That is, there are two sets of strongly opposite pairs\n * (\"above\"/\"below\" and \"left\"/\"right\") and at least one of the two opposing\n * views of a pair must be present for the other one to be included, _except in\n * the special case of `views` being \"at\"_. See examples below for\n * clarification.\n *\n * **Note** that the order of the returned array is not defined.\n *\n * @example\n * Returns [\"above\", \"below\", \"left\", \"right\"] (not definite order), since\n * \"at\" is the only view present and is opposite to all:\n *\n * ```javascript\n * getOppositeViews(\"at\"); // -> [\"above\", \"below\", \"left\", \"right\"] (not necessarily in this order)\n * ```\n *\n * @example\n * Returns [\"below\"]. \"left\" and \"right\" are NOT included even though \"at\" is\n * given, because at least one of the two opposing views of a pair must be\n * present for the other one to be included (except in the special case of\n * `views` being \"at\").\n *\n * ```javascript\n * getOppositeViews(\"at,above\"); // -> [\"below\"]\n * ```\n *\n * @example\n * ```javascript\n * getOppositeViews(\"above\"); // -> [\"at\", \"below\"] (not necessarily in this order)\n * ```\n *\n * @example\n * ```javascript\n * getOppositeViews(\"above,below\"); // -> [\"at\"]\n * ```\n *\n * @example\n * ```javascript\n * getOppositeViews(\"at,above,below\"); // -> []\n * ```\n *\n * @example\n * ```javascript\n * getOppositeViews(\"above,right\"); // -> [\"at\", \"below\", \"left\"] (not necessarily in this order)\n * ```\n *\n * @example\n * ```javascript\n * getOppositeViews(\"at,above,right\"); // -> [\"below\", \"left\"] (not necessarily in this order)\n * ```\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *                If the given view is not valid, including if it's empty \"\".\n *\n * @category Views\n */\nexport const getOppositeViews = (\n  views: CommaSeparatedStr<View> | View[],\n): View[] => {\n  if (!views) {\n    throw MH.usageError(\"'views' cannot be empty\");\n  }\n\n  const bitmask = getViewsBitmask(views);\n  let oppositeBitmask = VIEWS_SPACE.bitmask & ~bitmask; // initial, all not present in bitmask\n\n  // If the given view is \"at\", then include all the other ones.\n  // Otherwise include only the opposite views of those directional\n  // (above/below/left/right) that are present. I.e. if neither left not right\n  // is given, then don't include them\n  if (bitmask !== VIEWS_SPACE.bit.at) {\n    // remove the opposite ones to those not present\n    if (!(bitmask & VIEWS_SPACE.bit.above)) {\n      oppositeBitmask &= ~VIEWS_SPACE.bit.below;\n    }\n\n    if (!(bitmask & VIEWS_SPACE.bit.below)) {\n      oppositeBitmask &= ~VIEWS_SPACE.bit.above;\n    }\n\n    if (!(bitmask & VIEWS_SPACE.bit.left)) {\n      oppositeBitmask &= ~VIEWS_SPACE.bit.right;\n    }\n\n    if (!(bitmask & VIEWS_SPACE.bit.right)) {\n      oppositeBitmask &= ~VIEWS_SPACE.bit.left;\n    }\n  }\n\n  return getViewsFromBitmask(oppositeBitmask);\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const getViewsBitmask = (\n  viewsStr: View[] | string | undefined,\n): number => {\n  let viewsBitmask = 0;\n  const views = validateStrList(\"views\", viewsStr, isValidView);\n\n  if (views) {\n    for (const v of views) {\n      if (!isValidView(v)) {\n        throw MH.usageError(`Unknown view '${v}'`);\n      }\n\n      viewsBitmask |= VIEWS_SPACE.bit[v];\n    }\n  } else {\n    viewsBitmask = VIEWS_SPACE.bitmask; // default: all\n  }\n\n  return viewsBitmask;\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const parseScrollOffset = (input: string) => {\n  const match = input.match(OFFSET_REGEX);\n  if (!match) {\n    throw MH.usageError(`Invalid offset: '${input}'`);\n  }\n\n  const reference = match[1];\n  const value = match[2];\n  /* istanbul ignore next */ // shouldn't happen\n  if (!reference || !value) {\n    throw MH.bugError(\"Offset regex: blank capture groups\");\n  }\n\n  return { reference, value };\n};\n\nconst VIEWS: View[] = [\n  MC.S_AT,\n  MC.S_ABOVE,\n  MC.S_BELOW,\n  MC.S_LEFT,\n  MC.S_RIGHT,\n] as const;\n\n/**\n * @ignore\n * @internal\n */\nexport const VIEWS_SPACE = createBitSpace<View>(newBitSpaces(), ...VIEWS);\n\n// --------------------\n\n// Don't use capture groups for old browser support\nconst OFFSET_REGEX = RegExp(\"(top|bottom|left|right): *([^ ].+)\");\n\nconst getViewsFromBitmask = (bitmask: number): View[] => {\n  const views: View[] = [];\n  for (let bit = VIEWS_SPACE.start; bit <= VIEWS_SPACE.end; bit++) {\n    const value = 1 << bit;\n    if (bitmask & value) {\n      const name = VIEWS_SPACE.nameOf(value);\n      if (name) {\n        views.push(name);\n      }\n    }\n  }\n\n  return views;\n};\n","/**\n * @module Modules/XIntersectionObserver\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nexport type XIntersectionObserverCallback = (\n  entries: IntersectionObserverEntry[],\n  observer: XIntersectionObserver,\n) => void;\n\n/**\n * {@link XIntersectionObserver} is an extension of\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver | IntersectionObserver}\n * with added capabilities:\n * - can skip the initial callback that happens shortly after setting up via\n *   {@link observeLater}\n */\nexport class XIntersectionObserver {\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/root | IntersectionObserver:root}.\n   */\n  readonly root!: Element | Document | null;\n\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/rootMargin | IntersectionObserver:rootMargin}.\n   */\n  readonly rootMargin!: string;\n\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/thresholds | IntersectionObserver:thresholds}.\n   */\n  readonly thresholds!: number[];\n\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/observe | IntersectionObserver:observe} except it accepts multiple\n   * targets.\n   */\n  readonly observe: (...targets: Element[]) => void;\n\n  /**\n   * Like {@link observe} but it ignores the initial almost immediate callback\n   * and only calls the callback on a subsequent intersection change.\n   */\n  readonly observeLater: (...targets: Element[]) => void;\n\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/unobserve | IntersectionObserver:unobserve} except it accepts multiple\n   * targets.\n   */\n  readonly unobserve: (...targets: Element[]) => void;\n\n  /**\n   * Like {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/disconnect | IntersectionObserver:disconnect}.\n   */\n  readonly disconnect: () => void;\n\n  /**\n   * Like `IntersectionObserver.takeRecords`.\n   */\n  readonly takeRecords: () => void;\n\n  constructor(\n    callback: XIntersectionObserverCallback,\n    observeOptions?: IntersectionObserverInit,\n  ) {\n    let observedTargets = MH.newWeakSet<Element>();\n    const targetsToSkip = MH.newWeakSet<Element>();\n\n    const intersectionHandler = (entries: IntersectionObserverEntry[]) => {\n      const selectedEntries = [];\n\n      for (const entry of entries) {\n        if (targetsToSkip.has(MH.targetOf(entry))) {\n          MH.deleteKey(targetsToSkip, MH.targetOf(entry));\n          continue;\n        }\n\n        selectedEntries.push(entry);\n      }\n\n      if (MH.lengthOf(selectedEntries)) {\n        callback(selectedEntries, this);\n      }\n    };\n\n    const observer = MH.newIntersectionObserver(\n      intersectionHandler,\n      observeOptions,\n    );\n\n    MH.defineProperty(this, \"root\", { get: () => observer.root });\n    MH.defineProperty(this, \"rootMargin\", {\n      get: () => observer.rootMargin,\n    });\n    MH.defineProperty(this, \"thresholds\", {\n      get: () => observer.thresholds,\n    });\n\n    this.observe = (...targets) => {\n      for (const target of targets) {\n        observedTargets.add(target);\n        observer.observe(target);\n      }\n    };\n\n    this.observeLater = (...targets) => {\n      for (const target of targets) {\n        // Only skip them if not already observed, otherwise the initial\n        // (almost) immediate callback won't happen anyway.\n        if (observedTargets.has(target)) {\n          continue;\n        }\n\n        targetsToSkip.add(target);\n        this.observe(target);\n      }\n    };\n\n    this.unobserve = (...targets) => {\n      for (const target of targets) {\n        MH.deleteKey(observedTargets, target);\n        observer.unobserve(target);\n      }\n    };\n\n    this.disconnect = () => {\n      observedTargets = MH.newWeakSet();\n      observer.disconnect();\n    };\n\n    this.takeRecords = () => observer.takeRecords();\n  }\n}\n","/**\n * @module Watchers/ViewWatcher\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  ViewTarget,\n  View,\n  BoundingRect,\n  CommaSeparatedStr,\n} from \"@lisn/globals/types\";\n\nimport { setNumericStyleJsVars } from \"@lisn/utils/css-alter\";\nimport { waitForInteractive } from \"@lisn/utils/dom-events\";\nimport {\n  waitForMeasureTime,\n  waitForSubsequentMeasureTime,\n} from \"@lisn/utils/dom-optimize\";\nimport { logError } from \"@lisn/utils/log\";\nimport { omitKeys, compareValuesIn } from \"@lisn/utils/misc\";\nimport { createOverlay, OverlayOptions } from \"@lisn/utils/overlays\";\nimport { getClosestScrollable } from \"@lisn/utils/scroll\";\nimport { fetchViewportSize } from \"@lisn/utils/size\";\nimport { toMargins, objToStrKey } from \"@lisn/utils/text\";\nimport {\n  VIEWS_SPACE,\n  getViewsBitmask,\n  parseScrollOffset,\n} from \"@lisn/utils/views\";\n\nimport {\n  CallbackHandler,\n  Callback,\n  wrapCallback,\n} from \"@lisn/modules/callback\";\nimport { newXMap, newXWeakMap } from \"@lisn/modules/x-map\";\nimport { XIntersectionObserver } from \"@lisn/modules/x-intersection-observer\";\n\nimport { DOMWatcher } from \"@lisn/watchers/dom-watcher\";\nimport { ScrollWatcher } from \"@lisn/watchers/scroll-watcher\";\nimport { SizeWatcher } from \"@lisn/watchers/size-watcher\";\n\nimport debug from \"@lisn/debug/debug\";\n\n/**\n * {@link ViewWatcher} monitors the position of a given target relative to the\n * given {@link ViewWatcherConfig.root | root} or the viewport.\n *\n * It's built on top of\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver | IntersectionObserver}.\n *\n * It manages registered callbacks globally and reuses IntersectionObservers\n * for more efficient performance.\n */\nexport class ViewWatcher {\n  /**\n   * Call the given handler whenever the {@link ViewWatcherConfig.root | root}'s\n   * view relative to the target position changes, i.e. when the target enters\n   * or leaves the root.\n   *\n   * Unless {@link OnViewOptions.skipInitial} is true, the handler is also\n   * called (almost) immediately with the current view if it matches this\n   * set of options*.\n   *\n   * **IMPORTANT:** The same handler can _not_ be added multiple times for the\n   * same target, even if the options differ. If the handler has already been\n   * added for this target, either using {@link trackView} or using\n   * {@link onView}, then it will be removed and re-added with the current\n   * options. So if previously it was also tracking position across root\n   * using {@link trackView}, it will no longer do so.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the target or the options are invalid.\n   */\n  readonly onView: (\n    target: ViewTarget,\n    handler: OnViewHandler,\n    options?: OnViewOptions,\n  ) => Promise<void>;\n\n  /**\n   * Removes a previously added handler.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the target is invalid.\n   */\n  readonly offView: (target: ViewTarget, handler: OnViewHandler) => void;\n\n  /**\n   * This does more than just {@link onView}. The difference is that in\n   * addition to a change of {@link View}, such as the target entering or\n   * leaving the ViewWatcher's {@link ViewWatcherConfig.root | root} (by\n   * default the viewport), the handler is also called each time the target's\n   * relative view changes _while inside the root_.\n   *\n   * A change of relative position happens when:\n   * - the target is resized\n   * - the root is resized\n   * - the any of the target's scrollable ancestors is scrolled\n   * - the target's attributes changed that resulted in a change of position\n   *\n   * All of the above are accounted for. Internally it uses\n   * {@link ScrollWatcher}, {@link DOMWatcher} and {@link SizeWatcher} to keep\n   * track of all of this.\n   *\n   * If the target is leaves the ViewWatcher's\n   * {@link ViewWatcherConfig.root | root}, the handler will be called with\n   * the {@link ViewData}, and the above events will stop being tracked until\n   * the target enters the watcher's root again.\n   *\n   * **IMPORTANT:** The same handler can _not_ be added multiple times for the\n   * same target, even if the options differ. If the handler has already been\n   * added for this target, either using {@link trackView} or using\n   * {@link onView}, then it will be removed and re-added with the current\n   * options.\n   *\n   * ------\n   *\n   * If `handler` is not given, then it defaults to an internal handler that\n   * updates the following set of CSS variables on the target's style and\n   * represent its relative position:\n   *\n   * - `--lisn-js--r-top`\n   * - `--lisn-js--r-bottom`\n   * - `--lisn-js--r-left`\n   * - `--lisn-js--r-right`\n   * - `--lisn-js--r-width`\n   * - `--lisn-js--r-height`\n   * - `--lisn-js--r-h-middle`\n   * - `--lisn-js--r-v-middle`\n   *\n   * See {@link ViewData.relative} for an explanation of each.\n   *\n   * Note that only Element targets are supported here and not offsets.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the target or \"views\" are invalid.\n   */\n  readonly trackView: (\n    element: Element,\n    handler?: OnViewHandler | null,\n    options?: TrackViewOptions,\n  ) => Promise<void>;\n\n  /**\n   * Removes a previously added handler for {@link trackView}.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the target is invalid.\n   */\n  readonly noTrackView: (\n    element: Element,\n    handler?: OnViewHandler | null,\n  ) => void;\n\n  /**\n   * Get the current view relative to the target. By default, it will\n   * {@link waitForMeasureTime} and so will be delayed by one frame.\n   *\n   * @param realtime If true, it will not {@link waitForMeasureTime}. Use\n   *                 this only when doing realtime scroll-based animations\n   *                 as it may cause a forced layout.\n   */\n  readonly fetchCurrentView: (\n    target: ViewTarget,\n    realtime?: boolean,\n  ) => Promise<ViewData>;\n\n  /**\n   * Creates a new instance of ViewWatcher with the given\n   * {@link ViewWatcherConfig}. It does not save it for future reuse.\n   */\n  static create(config?: ViewWatcherConfig) {\n    return new ViewWatcher(getConfig(config), CONSTRUCTOR_KEY);\n  }\n\n  /**\n   * Returns an existing  instance of ViewWatcher with the given\n   * {@link ViewWatcherConfig}, or creates a new one.\n   *\n   * **NOTE:** It saves it for future reuse, so don't use this for temporary\n   * short-lived watchers.\n   */\n  static reuse(config?: ViewWatcherConfig) {\n    const myConfig = getConfig(config);\n    const configStrKey = objToStrKey(omitKeys(myConfig, { _root: null }));\n\n    let instance = instances.get(myConfig._root)?.get(configStrKey);\n    if (!instance) {\n      instance = new ViewWatcher(myConfig, CONSTRUCTOR_KEY);\n      instances.sGet(myConfig._root).set(configStrKey, instance);\n    }\n\n    return instance;\n  }\n\n  private constructor(\n    config: ViewWatcherConfigInternal,\n    key: typeof CONSTRUCTOR_KEY,\n  ) {\n    if (key !== CONSTRUCTOR_KEY) {\n      throw MH.illegalConstructorError(\"ViewWatcher.create\");\n    }\n\n    const logger = debug\n      ? new debug.Logger({ name: \"ViewWatcher\", logAtCreation: config })\n      : null;\n\n    const allViewData = MH.newWeakMap<Element, ViewData>();\n\n    const allCallbacks = newXWeakMap<\n      Element,\n      Map<\n        OnViewHandler,\n        {\n          _callback: OnViewCallback;\n          _trackType: TrackType;\n          _options: OnViewOptionsInternal;\n        }\n      >\n    >(() => MH.newMap());\n\n    const intersectionHandler = (entries: IntersectionObserverEntry[]) => {\n      debug: logger?.debug9(`Got ${entries.length} new entries`, entries);\n\n      for (const entry of entries) {\n        processEntry(entry);\n      }\n    };\n\n    const observeOptions = {\n      root: config._root,\n      threshold: config._threshold,\n      rootMargin: config._rootMargin,\n    };\n\n    const xObserver = new XIntersectionObserver(\n      intersectionHandler,\n      observeOptions,\n    );\n\n    // ----------\n\n    const fetchCurrentView = (\n      element: Element,\n      realtime = false,\n    ): Promise<ViewData> => {\n      const fetchData = async (\n        entryOrElement: IntersectionObserverEntry | Element,\n      ) => {\n        const intersection = await fetchIntersectionData(\n          config,\n          entryOrElement,\n          realtime,\n        );\n        const data = await fetchViewData(intersection, realtime);\n        return data;\n      };\n\n      if (realtime) {\n        return fetchData(element);\n      }\n\n      return MH.newPromise((resolve) => {\n        // Use a temp IntersectionObserver\n        const observer = MH.newIntersectionObserver((entries) => {\n          const promise = fetchData(entries[0]);\n          observer.disconnect();\n          promise.then(resolve);\n        }, observeOptions);\n\n        observer.observe(element);\n      });\n    };\n\n    // ----------\n\n    const createCallback = (\n      handler: OnViewHandler,\n      options: OnViewOptionsInternal,\n      trackType: TrackType,\n    ): OnViewCallback => {\n      const element = options._element;\n      MH.remove(allCallbacks.get(element)?.get(handler)?._callback);\n\n      debug: logger?.debug5(\"Adding/updating handler\", options);\n      const callback = wrapCallback(handler);\n      callback.onRemove(() => {\n        deleteHandler(handler, options);\n      });\n\n      allCallbacks.sGet(element).set(handler, {\n        _callback: callback,\n        _trackType: trackType,\n        _options: options,\n      });\n\n      return callback;\n    };\n\n    // ----------\n\n    const setupOnView = async (\n      target: ViewTarget,\n      handler: OnViewHandler,\n      userOptions: (OnViewOptions & TrackViewOptions) | undefined,\n      trackType: TrackType,\n    ) => {\n      const options = await fetchOptions(config._root, target, userOptions);\n      const element = options._element;\n\n      const callback = createCallback(handler, options, trackType);\n\n      // View watcher should be used before the DOM is loaded since the initial\n      // size of the root may be 0 or close to 0 and would lead to premature\n      // triggering.\n      await waitForInteractive();\n\n      // Initial call doesn't need to be realtime, and best to use an actual\n      // IntersectionObserverEntry for that one.\n      let viewData = await fetchCurrentView(element);\n\n      if (\n        viewData.rootBounds[MC.S_WIDTH] === 0 &&\n        viewData.rootBounds[MC.S_HEIGHT] === 0\n      ) {\n        // Possibly the root is being setup now, wait for one AF\n        debug: logger?.debug5(\n          \"Got zero root size, deferring for a bit\",\n          config._root,\n        );\n        await waitForSubsequentMeasureTime();\n        viewData = await fetchCurrentView(element);\n      }\n\n      if (trackType === TRACK_FULL) {\n        // Detect resize or scroll\n        await setupInviewTrack(options, callback, viewData);\n      }\n\n      if (callback.isRemoved()) {\n        return;\n      }\n\n      // Always use observeLater to skip the initial call from the\n      // IntersectionObserver, and call callbacks that have skipInitial: false\n      // here. Otherwise, we can't tell from inside the intersectionHandler whether\n      // a callback wants to skip its initial call or not.\n      //\n      // It's ok if already observed, won't do anything.\n      xObserver.observeLater(element);\n\n      if (!userOptions?.skipInitial) {\n        debug: logger?.debug5(\"Calling initially with\", element, viewData);\n        if (viewsToBitmask(viewData.views) & options._viewsBitmask) {\n          await invokeCallback(callback, element, viewData);\n        }\n      }\n    };\n\n    // ----------\n\n    const removeOnView = async (\n      target: ViewTarget,\n      handler: OnViewHandler,\n      trackType: TrackType,\n    ) => {\n      // For time sync, so that if called immediately after onView without\n      // awaiting, it will remove the callback that is about to be added.\n      // But if no such handler has been added we may unnecessarily\n      // create an overlay... TODO\n      const options = await fetchOptions(config._root, target, {});\n      const element = options._element;\n\n      const currEntry = allCallbacks.get(element)?.get(handler);\n      if (currEntry?._trackType === trackType) {\n        MH.remove(currEntry._callback);\n\n        if (handler === setViewCssProps) {\n          // delete the properties\n          setViewCssProps(element, null);\n        }\n      }\n    };\n\n    // ----------\n\n    const deleteHandler = (\n      handler: OnViewHandler,\n      options: OnViewOptionsInternal,\n    ) => {\n      const element = options._element;\n\n      MH.deleteKey(allCallbacks.get(element), handler);\n      allCallbacks.prune(element);\n\n      if (!allCallbacks.has(element)) {\n        debug: logger?.debug4(\n          \"No more callbacks for target; unobserving\",\n          element,\n        );\n\n        xObserver.unobserve(element);\n        MH.deleteKey(allViewData, element);\n      }\n    };\n\n    // ----------\n\n    const processEntry = async (entry: IntersectionObserverEntry) => {\n      // In reality, it can't be just a base Element\n      const element = MH.targetOf(entry);\n\n      // This doesn't need to be \"realtime\", since IntersectionObserver alone\n      // introduces a delay.\n      const intersection = await fetchIntersectionData(config, entry);\n      const latestData = await fetchViewData(intersection);\n      debug: logger?.debug9(\"Got ViewData\", element, latestData);\n\n      const viewsBitmask = viewsToBitmask(latestData.views);\n\n      for (const entry of allCallbacks.get(element)?.values() || []) {\n        if (viewsBitmask & entry._options._viewsBitmask) {\n          invokeCallback(entry._callback, element, latestData);\n        }\n      }\n    };\n\n    // ----------\n\n    const setupInviewTrack = async (\n      options: OnViewOptionsInternal,\n      viewCallback: OnViewCallback,\n      viewData: ViewData,\n    ) => {\n      const element = options._element;\n      debug: logger?.debug8(\n        \"Setting up size, scroll and attribute tracking\",\n        element,\n      );\n\n      const sizeWatcher = SizeWatcher.reuse();\n      const scrollWatcher = ScrollWatcher.reuse();\n      const realtime = options._debounceWindow === 0;\n\n      // Detect when target's class or style attribute change\n      const domWatcher = DOMWatcher.create({\n        root: element,\n        // only direct children\n        subtree: false,\n      });\n\n      // We need to remove the tracking callback when target leaves view and re-add\n      // it when it enters view. But the OnViewCallback that is associated may have\n      // already been added prior, by calling onView with this handler, so we can't\n      // always wrap around it, in order to detect when it's called with a change\n      // of view. So we setup another OnViewCallback tied to the tracking callback.\n      let isInview = false;\n\n      let removeTrackCallback: (() => void) | null = null;\n\n      // Finds any scrollable ancestors of the element and detect scroll on them.\n      const scrollableAncestors = await fetchScrollableAncestors(\n        element,\n        realtime,\n      );\n      if (viewCallback.isRemoved()) {\n        return;\n      }\n\n      const addTrackCallback = () => {\n        const trackCallback = wrapCallback(async () => {\n          const prevData = allViewData.get(element);\n\n          // Get the latest view data for the target\n          const latestData = await fetchCurrentView(element, realtime);\n          debug: logger?.debug9(\"Got ViewData\", element, latestData);\n\n          const changed = viewChanged(latestData, prevData);\n          if (changed) {\n            // When comparing for changes, we round the numbers to certain number\n            // of decimal places, and allViewData serves as a \"last threshold\"\n            // state, so only update it if there was a significant change.\n            // Otherwise very quick changes in small increments would get\n            // rejected as \"no change\".\n            allViewData.set(element, latestData);\n\n            if (isInview && !viewCallback.isRemoved()) {\n              // Could have been removed during the debounce window\n              await invokeCallback(viewCallback, element, latestData);\n            }\n          } else {\n            debug: logger?.debug9(\"ViewData same as last\");\n          }\n        });\n\n        // TODO Is there a better way to detect when it's moved?\n        viewCallback.onRemove(trackCallback.remove);\n        removeTrackCallback = trackCallback.remove;\n\n        // Detect when target's class or style attribute change\n        domWatcher.onMutation(trackCallback, {\n          categories: [MC.S_ATTRIBUTE],\n          [MC.S_SKIP_INITIAL]: true,\n        });\n\n        // Detect when target is resized\n        sizeWatcher.onResize(trackCallback, {\n          target: element,\n          [MC.S_DEBOUNCE_WINDOW]: options._debounceWindow,\n          threshold: options._resizeThreshold,\n          [MC.S_SKIP_INITIAL]: true,\n        });\n\n        // Detect when the root is resized\n        sizeWatcher.onResize(trackCallback, {\n          target: config._root ?? MH.getWindow(),\n          [MC.S_DEBOUNCE_WINDOW]: options._debounceWindow,\n          threshold: options._resizeThreshold,\n          [MC.S_SKIP_INITIAL]: true,\n        });\n\n        // Detect when the target's scrollable ancestors are scrolled (this\n        // will almost certainly include the main scrollable element).\n        for (const ancestor of scrollableAncestors) {\n          scrollWatcher.onScroll(trackCallback, {\n            scrollable: ancestor,\n            [MC.S_DEBOUNCE_WINDOW]: options._debounceWindow,\n            threshold: options._scrollThreshold,\n            [MC.S_SKIP_INITIAL]: true,\n          });\n        }\n      };\n\n      const enterOrLeaveCallback = createCallback(\n        (target__ignored, viewData) => {\n          if (viewData.views[0] === MC.S_AT) {\n            if (!isInview) {\n              isInview = true;\n              addTrackCallback();\n            }\n          } else if (removeTrackCallback) {\n            isInview = false;\n            removeTrackCallback();\n            removeTrackCallback = null;\n          }\n        },\n        MH.assign(options, {\n          _viewsBitmask: VIEWS_SPACE.bitmask,\n        }),\n        TRACK_REGULAR,\n      );\n\n      viewCallback.onRemove(enterOrLeaveCallback.remove);\n\n      allViewData.set(element, viewData); // to avoid duplicate initial call\n      // Setup the track and the \"inView\" state\n      if (!enterOrLeaveCallback.isRemoved()) {\n        invokeCallback(enterOrLeaveCallback, element, viewData);\n      }\n    };\n\n    // ----------\n\n    this.fetchCurrentView = (target, realtime = false) =>\n      fetchElement(config._root, target).then((element) =>\n        fetchCurrentView(element, realtime),\n      );\n\n    // ----------\n\n    this.trackView = (element, handler?, options?) => {\n      if (!handler) {\n        handler = setViewCssProps;\n      }\n\n      return setupOnView(element, handler, options, TRACK_FULL);\n    };\n\n    // ----------\n\n    this.noTrackView = (element, handler?) => {\n      if (!handler) {\n        handler = setViewCssProps;\n      }\n\n      removeOnView(element, handler, TRACK_FULL); // no need to await\n    };\n\n    // ----------\n\n    this.onView = (target, handler, options?) =>\n      setupOnView(target, handler, options, TRACK_REGULAR);\n\n    // ----------\n\n    this.offView = (target, handler) =>\n      removeOnView(target, handler, TRACK_REGULAR); // no need to await\n  }\n}\n\n/**\n * @interface\n */\nexport type ViewWatcherConfig = {\n  /**\n   * The root element to use for the IntersectionObserver.\n   *\n   * **NOTE:** If the target you want to observe (via\n   * {@link ViewWatcher.onView}) is inside a scrolling element, then you should\n   * probably set the watcher's root to be that scrolling element or a wrapper\n   * around it. However, even if you don't or can't do that, the watcher will\n   * try to be smart about that, and when the target is no longer intercepting\n   * because it's scrolled outside its scrolling container, and yet its\n   * bounding box is still inside the watcher root (e.g. the viewport) the\n   * watcher will determine the relative view based on the scrolling container\n   * and not the actual watcher root.\n   *\n   * @defaultValue null\n   */\n  root?: Element | null;\n\n  /**\n   * The rootMargin to pass to the IntersectionObserver constructor options.\n   *\n   * @defaultValue \"0px 0px 0px 0px\"\n   */\n  rootMargin?: string;\n\n  /**\n   * The threshold to pass to the IntersectionObserver constructor options.\n   *\n   * @defaultValue 0\n   */\n  threshold?: number | number[];\n};\n\n/**\n * @interface\n */\nexport type OnViewOptions = {\n  /**\n   * Specifies a list of {@link View}s to target for.\n   *\n   * The handler will only be called if there is a change of view relative to\n   * the target that matches the given ones.\n   *\n   * It can be a comma-separated list of \"views\" or an array of such names.\n   *\n   * @defaultValue undefined\n   */\n  views?: CommaSeparatedStr<View> | View[];\n\n  /**\n   * Do not call the handler until there's a future resize of the element.\n   *\n   * By default we call the handler (almost) immediately with the current size\n   * data for the target.\n   *\n   * @defaultValue false\n   */\n  skipInitial?: boolean;\n};\n\n/**\n * @interface\n */\nexport type TrackViewOptions = {\n  /**\n   * Use this debounce window for the {@link ScrollWatcher} and\n   * {@link SizeWatcher} involved in the view tracking.\n   *\n   * **IMPORTANT:**\n   * If the debounce window is non-0 (default), then the callback is always\n   * delayed by at least an animation frame following a scroll event to allow\n   * for optimized `scrollTop`/`scrollLeft` measurements via\n   * {@link waitForMeasureTime}.\n   *\n   * If you set this is 0, this indicates that the callback should be\n   * \"realtime\" and will therefore skip {@link waitForMeasureTime}, which could\n   * lead to forced re-layouts during scroll, but you probably need this when\n   * doing scroll-based animations.\n   *\n   * @defaultValue undefined // ScrollWatcher and SizeWatcher defaults\n   */\n  debounceWindow?: number;\n\n  /**\n   * Use this resize threshold for the {@link SizeWatcher} involved in the view\n   * tracking.\n   *\n   * @defaultValue undefined // SizeWatcher default\n   */\n  resizeThreshold?: number;\n\n  /**\n   * Use this scroll threshold for the {@link ScrollWatcher} involved in the\n   * view tracking.\n   *\n   * @defaultValue undefined // ScrollWatcher default\n   */\n  scrollThreshold?: number;\n\n  /**\n   * Do not call the handler until there's a future resize of the element.\n   *\n   * By default we call the handler (almost) immediately with the current size\n   * data for the target.\n   *\n   * @defaultValue false\n   */\n  skipInitial?: boolean;\n};\n\n/**\n * The handler is invoked with two arguments:\n *\n * - The element that is the target of the IntersectionObserver. If the call to\n *   {@link ViewWatcher.onView} specified an element as the target, it will be\n *   the same. If it specified an offset, then the element passed to the\n *   callback will be an absolutely positioned trigger overlay that's created\n *   as a result.\n * - the {@link ViewData} for relative to the target\n */\nexport type OnViewHandlerArgs = [Element, ViewData];\nexport type OnViewCallback = Callback<OnViewHandlerArgs>;\nexport type OnViewHandler = CallbackHandler<OnViewHandlerArgs> | OnViewCallback;\n\nexport type ViewData = {\n  isIntersecting: boolean;\n\n  targetBounds: BoundingRect;\n\n  rootBounds: BoundingRect;\n\n  /**\n   * The current view or views of the target. There would be two views given\n   * only if the target is _not_ in view and it's diagonally across from the\n   * root, e.g. both below and to the right.\n   */\n  views: [View, View?];\n\n  /**\n   * This is the target's position relative to the\n   * {@link ViewWatcherConfig.root | root} with values relative to the root\n   * size.\n   *\n   * It is like the {@link targetBounds} except that each quantity is scaled by\n   * the root's width or height, and having two additional computed values.\n   */\n  relative: {\n    x: number;\n    y: number;\n    top: number;\n    bottom: number;\n    left: number;\n    right: number;\n    width: number;\n    height: number;\n\n    /**\n     * Average of the relative left and right.\n     */\n    hMiddle: number;\n\n    /**\n     * Average of the relative top and bottom.\n     */\n    vMiddle: number;\n  };\n};\n\n// ----------------------------------------\n\ntype ViewWatcherConfigInternal = {\n  _root: Element | null;\n  _rootMargin: string;\n  _threshold: number | number[];\n};\n\ntype OnViewOptionsInternal = {\n  _element: Element;\n  _viewsBitmask: number;\n  _debounceWindow: number | undefined;\n  _resizeThreshold: number | undefined;\n  _scrollThreshold: number | undefined;\n};\n\ntype IntersectionData = {\n  _target: Element;\n  _targetBounds: BoundingRect;\n  _root: Element | null;\n  _rootMargins: [number, number, number, number];\n  _rootBounds: BoundingRect;\n  _isIntersecting: boolean | null; // null means unknown, no IntersectionObserverEntry\n  _isCrossOrigin: boolean | null; // null means unknown, no IntersectionObserverEntry\n};\n\ntype TrackType = typeof TRACK_REGULAR | typeof TRACK_FULL;\n\nconst CONSTRUCTOR_KEY: unique symbol = MC.SYMBOL() as typeof CONSTRUCTOR_KEY;\nconst instances = newXMap<Element | null, Map<string, ViewWatcher>>(() =>\n  MH.newMap(),\n);\n\nconst getConfig = (\n  config: ViewWatcherConfig | undefined,\n): ViewWatcherConfigInternal => {\n  return {\n    _root: config?.root ?? null,\n    _rootMargin: config?.rootMargin ?? \"0px 0px 0px 0px\",\n    _threshold: config?.threshold ?? 0,\n  };\n};\n\nconst TRACK_REGULAR = 1; // only entering/leaving root\nconst TRACK_FULL = 2; // entering/leaving + moving across (fine-grained)\n\n// --------------------\n\nconst fetchOptions = async (\n  root: Element | null,\n  target: ViewTarget,\n  options: (OnViewOptions & TrackViewOptions) | undefined,\n): Promise<OnViewOptionsInternal> => {\n  return {\n    _element: await fetchElement(root, target),\n    _viewsBitmask: getViewsBitmask(options?.views),\n    _debounceWindow: options?.debounceWindow,\n    _resizeThreshold: options?.resizeThreshold,\n    _scrollThreshold: options?.scrollThreshold,\n  };\n};\n\nconst fetchScrollableAncestors = async (\n  element: Element,\n  realtime: boolean,\n) => {\n  if (!realtime) {\n    await waitForMeasureTime();\n  }\n\n  const scrollableAncestors = [];\n  let ancestor: Element | null | undefined = element;\n  while ((ancestor = getClosestScrollable(ancestor, { active: true }))) {\n    scrollableAncestors.push(ancestor);\n  }\n\n  return scrollableAncestors;\n};\n\nconst viewChanged = (latestData: ViewData, prevData: ViewData | undefined) =>\n  !prevData ||\n  viewsToBitmask(prevData.views) !== viewsToBitmask(latestData.views) ||\n  !compareValuesIn(\n    MH.copyBoundingRectProps(prevData.targetBounds),\n    MH.copyBoundingRectProps(latestData.targetBounds),\n  ) ||\n  !compareValuesIn(prevData.rootBounds, latestData.rootBounds) ||\n  !compareValuesIn(prevData.relative, latestData.relative);\n\nconst viewsToBitmask = (views: [View, View?]) =>\n  VIEWS_SPACE.bit[views[0]] | (views[1] ? VIEWS_SPACE.bit[views[1]] : 0);\n\nconst fetchIntersectionData = async (\n  config: ViewWatcherConfigInternal,\n  entryOrTarget: IntersectionObserverEntry | Element,\n  realtime = false,\n): Promise<IntersectionData> => {\n  const root = config._root;\n  const vpSize = await fetchViewportSize(realtime);\n  const rootMargins = toMargins(config._rootMargin, vpSize);\n\n  let target: Element;\n  let targetBounds: BoundingRect;\n  let rootBounds: BoundingRect | null = null;\n  let isIntersecting: boolean | null = null;\n  let isCrossOrigin: boolean | null = null;\n\n  if (MH.isInstanceOf(entryOrTarget, IntersectionObserverEntry)) {\n    target = entryOrTarget.target;\n    targetBounds = entryOrTarget.boundingClientRect;\n    rootBounds = entryOrTarget.rootBounds;\n    isIntersecting = entryOrTarget.isIntersecting;\n    isCrossOrigin = !entryOrTarget.rootBounds;\n  } else {\n    target = entryOrTarget;\n    targetBounds = await fetchBounds(target, realtime);\n  }\n\n  if (!rootBounds) {\n    rootBounds = await fetchBounds(root, realtime, rootMargins);\n  }\n\n  return {\n    _target: target,\n    _targetBounds: targetBounds,\n    _root: root,\n    _rootMargins: rootMargins,\n    _rootBounds: rootBounds,\n    _isIntersecting: isIntersecting,\n    _isCrossOrigin: isCrossOrigin,\n  };\n};\n\nconst fetchBounds = async (\n  root: Element | null,\n  realtime: boolean,\n  rootMargins?: [number, number, number, number],\n): Promise<BoundingRect> => {\n  let rect: BoundingRect;\n\n  if (root) {\n    if (!realtime) {\n      await waitForMeasureTime();\n    }\n\n    rect = MH.copyBoundingRectProps(MH.getBoundingClientRect(root));\n  } else {\n    const { width, height } = await fetchViewportSize(realtime);\n    rect = {\n      x: 0,\n      left: 0,\n      right: width,\n      width,\n      y: 0,\n      top: 0,\n      bottom: height,\n      height,\n    };\n  }\n\n  if (rootMargins) {\n    rect.x = rect[MC.S_LEFT] -= rootMargins[3];\n    rect[MC.S_RIGHT] += rootMargins[1];\n    rect[MC.S_WIDTH] += rootMargins[1] + rootMargins[3];\n\n    rect.y = rect[MC.S_TOP] -= rootMargins[0];\n    rect[MC.S_BOTTOM] += rootMargins[2];\n    rect[MC.S_HEIGHT] += rootMargins[0] + rootMargins[2];\n  }\n\n  return rect;\n};\n\nconst fetchViewData = async (\n  intersection: IntersectionData,\n  realtime = false,\n): Promise<ViewData> => {\n  const vpSize = await fetchViewportSize(realtime);\n  const vpHeight = vpSize[MC.S_HEIGHT];\n  const vpWidth = vpSize[MC.S_WIDTH];\n\n  const views = await fetchViews(intersection, realtime);\n\n  const relative = MH.merge(\n    { hMiddle: NaN, vMiddle: NaN },\n    MH.copyBoundingRectProps(intersection._targetBounds),\n  );\n\n  relative.y /= vpHeight;\n  relative[MC.S_TOP] /= vpHeight;\n  relative[MC.S_BOTTOM] /= vpHeight;\n  relative[MC.S_HEIGHT] /= vpHeight;\n\n  relative.x /= vpWidth;\n  relative[MC.S_LEFT] /= vpWidth;\n  relative[MC.S_RIGHT] /= vpWidth;\n  relative[MC.S_WIDTH] /= vpWidth;\n\n  relative.hMiddle = (relative[MC.S_LEFT] + relative[MC.S_RIGHT]) / 2;\n  relative.vMiddle = (relative[MC.S_TOP] + relative[MC.S_BOTTOM]) / 2;\n\n  const viewData: ViewData = {\n    isIntersecting: intersection._isIntersecting ?? views[0] === MC.S_AT,\n    targetBounds: intersection._targetBounds,\n    rootBounds: intersection._rootBounds,\n    views,\n    relative,\n  };\n\n  return viewData;\n};\n\nconst fetchViews = async (\n  intersection: IntersectionData,\n  realtime: boolean,\n  useScrollingAncestor?: Element,\n): Promise<[View, View?]> => {\n  if (intersection._isIntersecting) {\n    return [MC.S_AT];\n  }\n\n  let rootBounds: BoundingRect;\n  if (useScrollingAncestor) {\n    rootBounds = await fetchBounds(\n      useScrollingAncestor,\n      realtime,\n      intersection._rootMargins,\n    );\n  } else {\n    rootBounds = intersection._rootBounds;\n  }\n\n  const targetBounds = intersection._targetBounds;\n  const delta = {\n    _left: rootBounds[MC.S_LEFT] - targetBounds[MC.S_LEFT],\n    _right: targetBounds[MC.S_RIGHT] - rootBounds[MC.S_RIGHT],\n    _top: rootBounds[MC.S_TOP] - targetBounds[MC.S_TOP],\n    _bottom: targetBounds[MC.S_BOTTOM] - rootBounds[MC.S_BOTTOM],\n  };\n\n  let xView: View | null = null;\n  let yView: View | null = null;\n  if (delta._left > 0 && delta._right > 0) {\n    // Target is wider than root: use greater delta to determine position.\n    // Remember, the view is the _root_ position relative to target.\n    xView = delta._left > delta._right ? MC.S_RIGHT : MC.S_LEFT;\n  } else if (delta._left > 0) {\n    // Target is to the left of the root\n    xView = MC.S_RIGHT;\n  } else if (delta._right > 0) {\n    // Target is to the right of the root\n    xView = MC.S_LEFT;\n  } // else target is horizontally contained in root, see below\n\n  if (delta._top > 0 && delta._bottom > 0) {\n    // Target is taller than root: use greater delta to determine position.\n    // Remember, the view is the _root_ position relative to target.\n    yView = delta._top > delta._bottom ? MC.S_BELOW : MC.S_ABOVE;\n  } else if (delta._top > 0) {\n    // Target is above the root\n    yView = MC.S_BELOW;\n  } else if (delta._bottom > 0) {\n    // Target is below the root\n    yView = MC.S_ABOVE;\n  } // else target is vertically contained in root, see below\n\n  if (xView && yView) {\n    // diagonally out of vide\n    return [xView, yView];\n  } else if (xView) {\n    // horizontally out of vide\n    return [xView];\n  } else if (yView) {\n    // vertically out of vide\n    return [yView];\n  }\n\n  // The target is contained in the root bounds and yet isIntersecting was\n  // not true. This means that either:\n  //\n  // 1. It may be intersecting, but we didn't get an actual\n  //    IntersectionObserverEntry and we don't know if it's intersecting\n  //    or not\n  // 2. The target is inside a scrolling element that is _not_ being used as\n  //    the observer root, and the target has scrolled out of the scrollable\n  //    bounds but still inside the viewport\n  // 3. We're inside a cross-origin iFrame and the iFrame is partially or\n  //    fully not-intersecting\n\n  if (!intersection._isCrossOrigin) {\n    // This is case 1. or 2. => get the views relative to the closest\n    // scrollable ancestor relative to which it is _not_ intersecting, if\n    // any. If it's nested inside several scrolling elements, we'll end up\n    // looping over each one until we find the one for which the target is\n    // outside its box.\n    //\n    // It is too risky to use active isScrollable check here since we could be\n    // inside an onScroll handler, so just use passive.\n    const scrollingAncestor = getClosestScrollable(\n      useScrollingAncestor ?? intersection._target,\n    );\n\n    if (scrollingAncestor) {\n      return fetchViews(intersection, realtime, scrollingAncestor);\n    }\n  }\n\n  // Either case 3. (cross-origin iframe outside the viewport) or case 1. and\n  // the target is actually intersecting the root. Either way, it's to be\n  // considered in-view of its root.\n  return [MC.S_AT];\n};\n\nconst setViewCssProps = (\n  element: Element,\n  viewData: ViewData | undefined | null,\n) => {\n  const relative: Record<string, number> = viewData?.relative ?? {};\n  const props = {\n    top: relative.top,\n    bottom: relative.bottom,\n    left: relative.left,\n    right: relative.right,\n    [MC.S_WIDTH]: relative[MC.S_WIDTH],\n    [MC.S_HEIGHT]: relative[MC.S_HEIGHT],\n    hMiddle: relative.hMiddle,\n    vMiddle: relative.vMiddle,\n  };\n  setNumericStyleJsVars(element, props, { _prefix: \"r-\", _numDecimal: 4 }); // don't await here\n};\n\nconst fetchElement = async (\n  root: Element | null,\n  target: ViewTarget,\n): Promise<Element> => {\n  if (MH.isElement(target)) {\n    return target;\n  } else if (!MH.isString(target)) {\n    throw MH.usageError(\n      \"'target' must be an offset string or an HTMLElement | SVGElement | MathMLElement\",\n    );\n  }\n\n  const overlayOptions = getOverlayOptions(root, target);\n  return await createOverlay(overlayOptions);\n};\n\nconst getOverlayOptions = (\n  root: Element | null,\n  target: string,\n): OverlayOptions => {\n  const { reference, value } = parseScrollOffset(target);\n\n  let ovrDimension: \"width\" | \"height\";\n  if (reference === MC.S_TOP || reference === MC.S_BOTTOM) {\n    ovrDimension = MC.S_WIDTH;\n  } else if (reference === MC.S_LEFT || reference === MC.S_RIGHT) {\n    ovrDimension = MC.S_HEIGHT;\n  } else {\n    throw MH.usageError(`Invalid offset reference: '${reference}'`);\n  }\n\n  return {\n    parent: MH.isHTMLElement(root) ? root : undefined,\n    style: {\n      [reference]: value,\n      [ovrDimension]: \"100%\",\n    },\n  };\n};\n\nconst invokeCallback = (\n  callback: OnViewCallback,\n  element: Element,\n  viewData: ViewData,\n) => callback.invoke(element, MH.copyObject(viewData)).catch(logError);\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nexport * from \"@lisn/watchers/dom-watcher\";\nexport * from \"@lisn/watchers/gesture-watcher\";\nexport * from \"@lisn/watchers/layout-watcher\";\nexport * from \"@lisn/watchers/pointer-watcher\";\nexport * from \"@lisn/watchers/scroll-watcher\";\nexport * from \"@lisn/watchers/size-watcher\";\nexport * from \"@lisn/watchers/view-watcher\";\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nimport { settings } from \"@lisn/globals/settings\";\nsettings.autoWidgets = true;\n\nexport { settings } from \"@lisn/globals/settings\";\nexport * as watchers from \"@lisn/watchers/index\";\n","/**\n * ## Specification for the HTML API for widgets\n *\n * The following describes the general syntax when using the HTML API for\n * automatic creation of widgets based on data attributes\n * ({@link Settings.settings.autoWidgets | settings.autoWidgets} must be true.\n *\n * A widget specification should be given as a\n * `data-lisn-<WidgetName>=\"<WidgetConfList>\"` attribute.\n *\n * Alternatively, if using all default configurations, you can simply add the\n * `lisn-<WidgetName>` CSS class. Specifying a configuration using CSS classes\n * is not currently possible for widgets, only triggers.\n *\n * The general specification for a widget is of the form:\n *\n * ```\n * <WidgetConfList> ::= <WidgetConf> { \";\" <WidgetConf> }\n *\n * <WidgetConf> ::= [ <WidgetOption> { \"|\" <WidgetOption> } ]\n *\n * <WidgetOption> ::=\n *     <BooleanOptionName> [ \"=\" ( \"false\" | \"true\" ) ] |\n *     <OptionName> \"=\" <OptionValue>\n * ```\n *\n * **NOTE:**\n *\n * There can be 0 or more spaces around any of the separator characters.\n *\n * Not all widgets support multiple instances per single element and therefore\n * multiple configurations. Refer to the specific widget.\n *\n * The characters \"|\", \";\", \"=\" are reserved separators and cannot be used\n * literally as part of an option value.\n *\n * @module Widgets\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { settings } from \"@lisn/globals/settings\";\n\nimport { hasClass, getData } from \"@lisn/utils/css-alter\";\nimport { waitForInteractive } from \"@lisn/utils/dom-events\";\nimport { logWarn } from \"@lisn/utils/log\";\nimport { toArrayIfSingle } from \"@lisn/utils/misc\";\nimport { waitForDelay } from \"@lisn/utils/tasks\";\nimport { formatAsString, kebabToCamelCase, splitOn } from \"@lisn/utils/text\";\n\nimport {\n  CallbackHandler,\n  Callback,\n  wrapCallback,\n} from \"@lisn/modules/callback\";\nimport { newXWeakMap } from \"@lisn/modules/x-map\";\n\nimport { DOMWatcher } from \"@lisn/watchers/dom-watcher\";\n\nimport debug from \"@lisn/debug/debug\";\n\nexport class Widget {\n  /**\n   * Disables the functionality of the widget. What this means is specific to\n   * each widget.\n   */\n  readonly disable: () => Promise<void>;\n\n  /**\n   * Re-enables the functionality of the widget. What this means is specific to\n   * each widget.\n   */\n  readonly enable: () => Promise<void>;\n\n  /**\n   * Re-enables the widget if disabled, otherwise disables it.\n   */\n  readonly toggleEnable: () => Promise<void>;\n\n  /**\n   * The given handler will be called when the widget is disabled.\n   */\n  readonly onDisable: (handler: WidgetHandler) => void;\n\n  /**\n   * The given handler will be called when the widget is enabled.\n   */\n  readonly onEnable: (handler: WidgetHandler) => void;\n\n  /**\n   * Returns true if the widget is currently disabled.\n   */\n  readonly isDisabled: () => boolean;\n\n  /**\n   * Undoes all modifications to the element and returns it to its original state.\n   *\n   * You will need to recreate it if you want to enable its functionality again.\n   */\n  readonly destroy: () => Promise<void>;\n\n  /**\n   * The given handler will be called when the widget is destroyed.\n   */\n  readonly onDestroy: (handler: WidgetHandler) => void;\n\n  /**\n   * Returns true if the widget is destroyed.\n   */\n  readonly isDestroyed: () => boolean;\n\n  /**\n   * Returns the element passed to the widget constructor.\n   */\n  readonly getElement: () => Element;\n\n  /**\n   * Retrieve an existing widget by element and ID.\n   */\n  static get(element: Element, id: string): Widget | null {\n    return instances.get(element)?.get(id) ?? null;\n  }\n\n  /**\n   * **IMPORTANT:** If ID is given and there's already a widget with this ID on\n   * this element, it will be destroyed!\n   */\n  constructor(element: Element, config?: { id?: string }) {\n    const logger = debug\n      ? new debug.Logger({\n          name: `${this.constructor.name}-${formatAsString(element)}`,\n          logAtCreation: this,\n        })\n      : null;\n\n    const id = config?.id;\n    if (id) {\n      instances.get(element)?.get(id)?.destroy(); // don't await here\n      instances.sGet(element).set(id, this);\n    }\n\n    let isDisabled = false;\n    let isDestroyed = false;\n    let destroyPromise: Promise<void>;\n\n    const enableCallbacks = MH.newSet<WidgetCallback>();\n    const disableCallbacks = MH.newSet<WidgetCallback>();\n    const destroyCallbacks = MH.newSet<WidgetCallback>();\n\n    this.disable = async () => {\n      if (!isDisabled) {\n        debug: logger?.debug8(\"Disabling\");\n        isDisabled = true;\n\n        for (const callback of disableCallbacks) {\n          await callback.invoke(this);\n        }\n      }\n    };\n\n    this.enable = async () => {\n      if (!isDestroyed && isDisabled) {\n        debug: logger?.debug8(\"Enabling\");\n        isDisabled = false;\n\n        for (const callback of enableCallbacks) {\n          await callback.invoke(this);\n        }\n      }\n    };\n\n    this.toggleEnable = async () => {\n      if (!isDestroyed) {\n        await (isDisabled ? this.enable : this.disable)();\n      }\n    };\n\n    this.onDisable = (handler) => disableCallbacks.add(wrapCallback(handler));\n    this.onEnable = (handler) => enableCallbacks.add(wrapCallback(handler));\n\n    this.isDisabled = () => isDisabled;\n\n    this.destroy = () => {\n      if (!destroyPromise) {\n        destroyPromise = (async () => {\n          debug: logger?.debug8(\"Destroying\");\n          isDestroyed = true;\n          await this.disable();\n\n          for (const callback of destroyCallbacks) {\n            await callback.invoke(this);\n          }\n\n          enableCallbacks.clear();\n          disableCallbacks.clear();\n          destroyCallbacks.clear();\n\n          if (id) {\n            const elInstances = instances.get(element);\n            if (elInstances?.get(id) === this) {\n              MH.deleteKey(elInstances, id);\n              instances.prune(element);\n            }\n          }\n        })();\n      }\n\n      return destroyPromise;\n    };\n\n    this.onDestroy = (handler) => destroyCallbacks.add(wrapCallback(handler));\n\n    this.isDestroyed = () => isDestroyed;\n\n    this.getElement = () => element;\n  }\n}\n\nexport type WidgetCallbackArgs = [Widget];\nexport type WidgetCallback = Callback<WidgetCallbackArgs>;\nexport type WidgetHandler =\n  | WidgetCallback\n  | CallbackHandler<WidgetCallbackArgs>;\n\n/**\n * **NOTE:** If the function returns a widget or a list of widgets created for\n * the given element, then each one will be automatically destroyed if the\n * element is removed from the DOM.\n */\nexport type WidgetCreateFn<Config extends Record<string, unknown>> = (\n  element: Element,\n  config?: Config,\n) => Widget | Widget[] | null | Promise<Widget | Widget[] | null>;\n\n/**\n * @see {@link getWidgetConfig}.\n */\nexport type WidgetConfigValidatorObject<\n  Config extends Record<string, unknown>,\n> = {\n  [K in keyof Config]: (key: K, v: unknown) => Config[K];\n};\n\n/**\n * @see {@link getWidgetConfig}.\n */\nexport type WidgetConfigAsyncValidatorObject<\n  Config extends Record<string, unknown>,\n> = {\n  [K in keyof Config]: (key: K, v: unknown) => Config[K] | Promise<Config[K]>;\n};\n\n/**\n * @see {@link getWidgetConfig}.\n */\nexport type WidgetConfigValidatorFunc<Config extends Record<string, unknown>> =\n  (\n    element: Element,\n  ) =>\n    | WidgetConfigValidatorObject<Config>\n    | WidgetConfigAsyncValidatorObject<Config>;\n\n/**\n * @see {@link getWidgetConfig}.\n */\nexport type WidgetConfigValidator<Config extends Record<string, unknown>> =\n  | WidgetConfigValidatorObject<Config>\n  | WidgetConfigValidatorFunc<Config>;\n\n/**\n * Enables automatic setting up of a widget from an elements matching the given\n * selector.\n *\n * If {@link settings.autoWidgets} is true, nothing is done. Otherwise,\n * when an element matching the selector is added to the DOM, `newWidget` will\n * be called and it's expected to setup the widget.\n *\n * **IMPORTANT:** The widget that is returned by `newWidget` will be\n * automatically destroyed when the element that created them is removed from\n * the DOM.\n *\n * **IMPORTANT:** If a widget by that name is already registered, the current\n * call does nothing, even if the remaining arguments differ.\n *\n * @param name      The name of the widget. Should be in kebab-case.\n * @param newWidget Called for every element matching the widget selector.\n * @param configValidator\n *                  A validator object, or a function that returns such an\n *                  object, for all options supported by the widget. If\n *                  given, then the `newWidget` function will also be\n *                  passed a configuration object constructed from the\n *                  element's data attribute.\n * @param [options.selector]\n *                  The selector to match elements for. If not given, then\n *                  uses a default value of `[data-lisn-<name>], .lisn-<name>`\n * @param [options.supportsMultiple]\n *                  If true, and if `configValidator` is given, then the\n *                  value of the element's widget specific data attribute\n *                  will be split on \";\" and each one parsed individually\n *                  as a configuration. Then the `newWidget` function will\n *                  be called once for each configuration.\n */\nexport const registerWidget = async <Config extends Record<string, unknown>>(\n  name: string,\n  newWidget: WidgetCreateFn<Config>,\n  configValidator?: null | WidgetConfigValidator<Config>,\n  options?: {\n    selector?: string;\n    supportsMultiple?: boolean;\n  },\n) => {\n  if (registeredWidgets.has(name)) {\n    return;\n  }\n\n  registeredWidgets.add(name);\n\n  // init after DOM loaded so that the settings can be configured by the user\n  // straight after loading LISN.js\n  await waitForInteractive();\n\n  const prefixedName = MH.prefixName(name);\n  const selector = options?.selector || getDefaultWidgetSelector(prefixedName);\n\n  if (settings.autoWidgets) {\n    const domWatcher = DOMWatcher.reuse();\n    domWatcher.onMutation(\n      async (operation) => {\n        const element = MH.currentTargetOf(operation);\n        const thisConfigValidator = MH.isFunction(configValidator)\n          ? await configValidator(element)\n          : configValidator;\n\n        const widgets: Widget[] = [];\n        const configSpecs: string[] = [];\n        const dataAttr = getData(element, prefixedName);\n\n        if (options?.supportsMultiple) {\n          if (hasClass(element, prefixedName)) {\n            configSpecs.push(\"\");\n          }\n\n          if (dataAttr !== null) {\n            configSpecs.push(\n              ...(dataAttr ? splitOn(dataAttr, \";\", true) : [\"\"]),\n            );\n          }\n        } else {\n          configSpecs.push(dataAttr ?? \"\");\n        }\n\n        for (const spec of configSpecs) {\n          const config = thisConfigValidator\n            ? await fetchWidgetConfig(spec, thisConfigValidator)\n            : undefined;\n\n          const theseWidgets = await newWidget(element, config);\n          if (theseWidgets) {\n            widgets.push(...toArrayIfSingle(theseWidgets));\n          }\n        }\n\n        // auto-destroy on element remove\n        if (MH.lengthOf(widgets)) {\n          domWatcher.onMutation(\n            () => {\n              for (const w of widgets) {\n                w.destroy();\n              }\n            },\n            {\n              target: element,\n              categories: [MC.S_REMOVED],\n            },\n          );\n        }\n      },\n      {\n        selector,\n        categories: [MC.S_ADDED],\n      },\n    );\n  }\n};\n\n/**\n * Returns a configuration object from the given user input, which can be\n * either an object or a `<separator>` separated string of key=values.\n *\n * If `input` is a string, it must be of the format:\n *\n * ```\n * <UserConfigString> ::= <OptionSpec> { <Separator> <OptionSpec> }\n *\n * <OptionSpec> ::=\n *     <BooleanOptionName> [ \"=\" ( \"false\" | \"true\" ) ] |\n *     <OptionName> \"=\" <OptionValue>\n * ```\n *\n * By default, for widgets `<separator>` is \"|\".\n *\n * **NOTE:** If `input` is a string, option names will be converted from\n * kebab-case to camelCase.\n *\n * The given `validator` defines the shape of the returned object. It is called\n * for each entry _in the `validator` object_, with that key and the\n * corresponding value from the input configuration, as the two parameters.\n *\n * If a key is not found in the input, the value passed to the validating\n * function will be `undefined`.\n *\n * If the input is a string and a key has no value, the value passed to the\n * validating function will be an empty string `\"\"`.\n *\n * The final configuration contains all keys from the `validator` object with\n * the value that the validating function for each key returned.\n *\n * There are several built-in validating functions that you can make use of.\n *\n * @see {@link Utils.validateStrList}\n * @see {@link Utils.validateNumber}\n * @see {@link Utils.validateBoolean}\n * @see {@link Utils.validateString}\n * @see {@link Utils.validateBooleanOrString}\n */\nexport const getWidgetConfig = <Config extends Record<string, unknown>>(\n  input: Record<string, unknown> | string | null | undefined,\n  validator: WidgetConfigValidatorObject<Config>,\n  separator = \"|\",\n): Config => {\n  const config = {} as Config;\n  if (!(input instanceof Object)) {\n    input = toOptionsObject(input, separator);\n  }\n\n  for (const key in validator) {\n    config[key] = validator[key](key, input[key]);\n  }\n  return config;\n};\n\n/**\n * Like {@link getWidgetConfig} but it accepts an object whose validator\n * functions may return a promise.\n */\nexport const fetchWidgetConfig = async <Config extends Record<string, unknown>>(\n  input: Record<string, unknown> | string | null | undefined,\n  validator: WidgetConfigAsyncValidatorObject<Config>,\n  separator = \"|\",\n): Promise<Config> => {\n  const config = {} as Config;\n  const configPromises = getWidgetConfig<{\n    [K in keyof Config]: Config[K] | Promise<Config[K]>;\n  }>(input, validator, separator);\n\n  for (const key in configPromises) {\n    config[key] = await configPromises[key];\n  }\n\n  return config;\n};\n\n/**\n * @ignore\n * @internal\n */\nexport const getDefaultWidgetSelector = (prefix: string) =>\n  `.${prefix},[data-${prefix}]`;\n\n/**\n * @ignore\n * @internal\n */\nexport const fetchUniqueWidget = async <W extends Widget>(\n  name: string,\n  element: Element,\n  Type: { get: (element: Element) => W | null },\n): Promise<W | null> => {\n  let widget = Type.get(element);\n  if (!widget) {\n    await waitForDelay(0); // in case it's being processed now\n    widget = Type.get(element);\n\n    if (!widget) {\n      logWarn(`No ${name} widget for element ${formatAsString(element)}`);\n      return null;\n    }\n  }\n\n  return widget;\n};\n\nconst instances = newXWeakMap<Element, Map<string, Widget>>(() => MH.newMap());\nconst registeredWidgets = MH.newSet<string>();\n\n// --------------------\n\nconst toOptionsObject = (\n  input: string | null | undefined,\n  separator: string,\n) => {\n  const options: Record<string, string> = {};\n  for (const entry of MH.filter(\n    splitOn(input ?? \"\", separator, true),\n    (v) => !MH.isEmpty(v),\n  )) {\n    const [key, value] = splitOn(entry, /\\s*=\\s*/, true, 1);\n    options[kebabToCamelCase(key)] = value ?? \"\";\n  }\n  return options;\n};\n","/**\n * @module Actions\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { splitOn } from \"@lisn/utils/text\";\n\nimport { WidgetConfigValidator, fetchWidgetConfig } from \"@lisn/widgets/widget\";\n\n/**\n * @interface\n */\nexport type Action = {\n  do: () => void;\n  undo: () => void;\n  toggle: () => void;\n};\n\nexport type ActionCreateFn<Config extends Record<string, unknown>> = (\n  element: Element,\n  args: string[],\n  config?: Config,\n) => Action | Promise<Action>;\n\n/**\n * Registers the given action so that it can be parsed by\n * {@link Triggers.registerTrigger}.\n *\n * **IMPORTANT:** If an action by that name is already registered, the current\n * call does nothing, even if the remaining arguments differ.\n *\n * @param name      The name of the action. Should be in kebab-case.\n * @param newAction Called for every action specification for a trigger\n *                  parsed by {@link Triggers.registerTrigger}\n */\nexport const registerAction = <Config extends Record<string, unknown>>(\n  name: string,\n  newAction: ActionCreateFn<Config>,\n  configValidator?: null | WidgetConfigValidator<Config>,\n) => {\n  if (registeredActions.has(name)) {\n    return;\n  }\n\n  const newActionFromSpec = async (\n    element: Element,\n    argsAndOptions: string,\n  ) => {\n    const thisConfigValidator = MH.isFunction(configValidator)\n      ? await configValidator(element)\n      : configValidator;\n\n    const args: string[] = [];\n    const config = thisConfigValidator\n      ? await fetchWidgetConfig(argsAndOptions, thisConfigValidator, \",\")\n      : undefined;\n\n    for (const entry of splitOn(argsAndOptions, \",\", true)) {\n      if (entry) {\n        if (!MH.includes(entry, \"=\")) {\n          args.push(entry);\n        }\n      }\n    }\n\n    return newAction(element, args, config);\n  };\n\n  registeredActions.set(name, newActionFromSpec);\n};\n\n/**\n * Returns an {@link Action} registered under the given name and instantiated\n * with the given element and arguments and options parsed from the given string.\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *                If the given spec is not valid.\n */\nexport const fetchAction = async (\n  element: Element,\n  name: string,\n  argsAndOptions?: string,\n): Promise<Action> => {\n  const newActionFromSpec = registeredActions.get(name);\n  if (!newActionFromSpec) {\n    throw MH.usageError(`Unknown action '${name}'`);\n  }\n\n  return await newActionFromSpec(element, argsAndOptions ?? \"\");\n};\n\n// --------------------\n\nconst registeredActions = MH.newMap<\n  string,\n  (element: Element, spec: string) => Action | Promise<Action>\n>();\n","/**\n * @module Actions\n *\n * @categoryDescription Adding/removing class\n * {@link AddClass} and {@link RemoveClass} add or remove a list of CSS classes\n * to/from the given element.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\n\nimport {\n  addClasses,\n  removeClasses,\n  toggleClasses,\n} from \"@lisn/utils/css-alter\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\n/**\n * Adds or removes a list of CSS classes to/from the given element.\n *\n * **IMPORTANT:** When constructed, it removes all given classes from the\n * element as a form of initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"add-class\".\n * - Accepted string arguments: one or more CSS classes\n * - Accepted options: none\n *\n * @example\n * ```html\n * <div data-lisn-on-view=\"@add-class: clsA, clsB\"></div>\n * ```\n *\n * @category Adding/removing class\n */\nexport class AddClass implements Action {\n  /**\n   * Adds the classes given to the constructor.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Removes the classes given to the constructor.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Toggles each class given to the constructor.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\n      \"add-class\",\n      (element, classNames) => new AddClass(element, ...classNames),\n    );\n  }\n\n  constructor(element: Element, ...classNames: string[]) {\n    const { _add, _remove, _toggle } = getMethods(element, classNames);\n    _remove(); // initial state\n\n    this.do = _add;\n    this.undo = _remove;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n/**\n * Removes or adds a list of CSS classes to/from the given element.\n *\n * **IMPORTANT:** When constructed, it adds all given classes from the element\n * as a form of initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"remove-class\".\n * - Accepted string arguments: one or more CSS classes\n * - Accepted options: none\n *\n * @example\n * ```html\n * <div data-lisn-on-view=\"@remove-class: clsA, clsB\"></div>\n * ```\n *\n * @category Adding/removing class\n */\nexport class RemoveClass implements Action {\n  /**\n   * Removes the classes given to the constructor.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Adds the classes given to the constructor.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Toggles each class given to the constructor.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\n      \"remove-class\",\n      (element, classNames) => new RemoveClass(element, ...classNames),\n    );\n  }\n\n  constructor(element: Element, ...classNames: string[]) {\n    const { _add, _remove, _toggle } = getMethods(element, classNames);\n    _add(); // initial state\n\n    this.do = _remove;\n    this.undo = _add;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n// --------------------\n\nconst getMethods = (element: Element, classNames: string[]) => {\n  return {\n    _add: () => addClasses(element, ...classNames),\n    _remove: () => removeClasses(element, ...classNames),\n    _toggle: () => toggleClasses(element, ...classNames),\n  };\n};\n","/**\n * @module Actions\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  iterateAnimations,\n  resetCssAnimationsNow,\n} from \"@lisn/utils/animations\";\nimport {\n  hasClass,\n  addClassesNow,\n  removeClasses,\n  removeClassesNow,\n} from \"@lisn/utils/css-alter\";\nimport { isPageReady, waitForPageReady } from \"@lisn/utils/dom-events\";\nimport { formatAsString } from \"@lisn/utils/text\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\nimport debug from \"@lisn/debug/debug\";\nimport { LoggerInterface } from \"@lisn/debug/types\";\n\n/**\n * Plays or reverses all animations on the given element.\n *\n * It works with CSS or Web Animations.\n *\n * **IMPORTANT:** When constructed, it resets and pauses the animations as a\n * form of initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"animate\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <div data-lisn-on-view=\"@animate\"></div>\n * ```\n *\n * @category Animation\n */\nexport class Animate implements Action {\n  /**\n   * (Re)plays the animations forwards.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * (Re)plays the animations backwards.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Reverses the animations from its current direction.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"animate\", (element) => new Animate(element));\n  }\n\n  constructor(element: Element) {\n    const logger = debug\n      ? new debug.Logger({\n          name: `Animate-${formatAsString(element)}`,\n        })\n      : null;\n\n    // initial state is 0% and paused\n    animate(element, GO_FORWARD, logger, true);\n    let isFirst = true;\n\n    this.do = () => animate(element, GO_FORWARD, logger);\n    this.undo = () => animate(element, GO_BACKWARD, logger);\n    this[MC.S_TOGGLE] = () => {\n      const res = animate(element, isFirst ? GO_FORWARD : GO_TOGGLE, logger);\n      isFirst = false;\n      return res;\n    };\n  }\n}\n\n// --------------------\n\ntype AnimateDirection =\n  | typeof GO_FORWARD\n  | typeof GO_BACKWARD\n  | typeof GO_TOGGLE;\n\nconst GO_FORWARD = 0;\nconst GO_BACKWARD = 1;\nconst GO_TOGGLE = 2;\n\nconst animate = (\n  element: Element,\n  direction: AnimateDirection,\n  logger: LoggerInterface | null,\n  isInitial = false,\n) => {\n  debug: logger?.debug8(\"Animating element\");\n  return iterateAnimations(\n    element,\n    /* istanbul ignore next */ // jsdom doesn't support Web Animations\n    (animation) => setupAnimation(animation, direction, logger, isInitial),\n    (element) => setupAnimationLegacy(element, direction, logger, isInitial),\n    isInitial,\n  );\n};\n\n/* istanbul ignore next */ // jsdom doesn't support Web Animations\nconst setupAnimation = (\n  animation: Animation,\n  direction: AnimateDirection,\n  logger: LoggerInterface | null,\n  isInitial: boolean,\n) => {\n  const pauseTillReady = !isPageReady();\n  const isBackward = animation.playbackRate === -1;\n\n  debug: logger?.debug9(\"Setting up animation\", animation, {\n    direction,\n    isBackward,\n  });\n\n  if (\n    direction === GO_TOGGLE ||\n    (direction === GO_FORWARD && isBackward) ||\n    (direction === GO_BACKWARD && !isBackward)\n  ) {\n    debug: logger?.debug9(\"Reversing animation\", animation.playState);\n    animation.reverse();\n  } else if (animation.playState === \"paused\") {\n    debug: logger?.debug9(\"Playing animation\", animation.playState);\n    animation.play();\n  } else {\n    debug: logger?.debug9(\n      \"Animation has played or is playing already\",\n      animation.playState,\n    );\n  }\n\n  if (isInitial || pauseTillReady) {\n    debug: logger?.debug9(\"Pausing animation\", animation.playState);\n    animation.pause();\n\n    if (!isInitial) {\n      // we were only pausing until ready\n      /* istanbul ignore next */\n      waitForPageReady().then(() => {\n        debug: logger?.debug9(\"Restarting animation\", animation.playState);\n        animation.play();\n      });\n    }\n  }\n\n  // If the element is moved (including if wrapped, such as by the ViewTrigger),\n  // this will cancel CSS animations and replace them with new running ones\n  if (MH.isInstanceOf(animation, CSSAnimation)) {\n    const cancelHandler = (event: AnimationPlaybackEvent) =>\n      onAnimationCancel(event, animation, direction, logger, isInitial);\n\n    animation.addEventListener(MC.S_CANCEL, cancelHandler);\n    animation.addEventListener(\"finish\", () =>\n      animation.removeEventListener(MC.S_CANCEL, cancelHandler),\n    );\n  }\n};\n\n/* istanbul ignore next */ // jsdom doesn't support Web Animations\nconst onAnimationCancel = (\n  event: AnimationPlaybackEvent,\n  animation: CSSAnimation,\n  direction: AnimateDirection,\n  logger: LoggerInterface | null,\n  isInitial: boolean,\n) => {\n  // setup again the new animation\n  debug: logger?.debug9(\"Animation cancelled, re-setting up new one\");\n  const target = MH.targetOf(event);\n  if (!MH.isInstanceOf(target, Animation)) {\n    return;\n  }\n\n  const effect = target.effect;\n  if (!MH.isInstanceOf(effect, KeyframeEffect)) {\n    return;\n  }\n\n  for (const newAnimation of MH.targetOf(effect)?.getAnimations() || []) {\n    if (\n      MH.isInstanceOf(newAnimation, CSSAnimation) &&\n      newAnimation.animationName === animation.animationName\n    ) {\n      setupAnimation(newAnimation, direction, logger, isInitial);\n      break;\n    }\n  }\n};\n\nconst setupAnimationLegacy = (\n  element: Element,\n  direction: AnimateDirection,\n  logger: LoggerInterface | null,\n  isInitial: boolean,\n) => {\n  const isBackward = hasClass(element, MC.PREFIX_ANIMATE_REVERSE);\n  const isPaused = hasClass(element, MC.PREFIX_ANIMATE_PAUSE);\n\n  const pauseTillReady = !isPageReady();\n\n  const goBackwards =\n    direction === GO_BACKWARD || (direction === GO_TOGGLE && !isBackward);\n\n  const doPause = isInitial || pauseTillReady;\n\n  debug: logger?.debug9(\"Setting up legacy animations\", element, {\n    direction,\n    isBackward,\n    isPaused,\n    goBackwards,\n    doPause,\n  });\n\n  if (goBackwards === isBackward && doPause === isPaused) {\n    // nothing to do\n    debug: logger?.debug9(\"No need to reset or pause animation\");\n    return;\n  }\n\n  resetCssAnimationsNow(element);\n\n  removeClassesNow(element, MC.PREFIX_ANIMATE_PAUSE, MC.PREFIX_ANIMATE_REVERSE);\n  addClassesNow(\n    element,\n    ...(goBackwards ? [MC.PREFIX_ANIMATE_REVERSE] : []),\n    ...(doPause ? [MC.PREFIX_ANIMATE_PAUSE] : []),\n  );\n\n  if (!isInitial && pauseTillReady) {\n    waitForPageReady().then(() =>\n      removeClasses(element, MC.PREFIX_ANIMATE_PAUSE),\n    );\n  }\n};\n","/**\n * @module Actions\n *\n * @categoryDescription Animation\n * {@link AnimatePlay} and {@link AnimatePause} resume or pause all animations\n * on the given element. They work with CSS or Web Animations.\n *\n * {@link Actions.Animate | Animate} plays or reverses all animations on the\n * given element. It works with CSS or Web Animations.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\n\nimport {\n  iterateAnimations,\n  resetCssAnimationsNow,\n} from \"@lisn/utils/animations\";\nimport {\n  hasClass,\n  addClassesNow,\n  removeClassesNow,\n} from \"@lisn/utils/css-alter\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\n/**\n * Resumes or pauses all animations on the given element.\n *\n * It works with CSS or Web Animations.\n *\n * **IMPORTANT:** When constructed, it resets and pauses the animations as a\n * form of initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"animate-play\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <button id=\"btn\">Play/pause</button>\n * <div data-lisn-on-click=\"@animate-play +target=#btn\"></div>\n * ```\n *\n * @category Animation\n */\nexport class AnimatePlay implements Action {\n  /**\n   * Resumes the animations without resetting them.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Pauses the animations without resetting them.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Resumes the animations if paused, otherwise pauses them.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"animate-play\", (element) => new AnimatePlay(element));\n  }\n\n  constructor(element: Element) {\n    const { _play, _pause, _toggle } = getMethods(element);\n\n    // initial state is 0% and paused\n    animate(element, PAUSE, true);\n\n    this.do = _play;\n    this.undo = _pause;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n/**\n * Pauses or resumes all animations on the given element.\n *\n * It works with CSS or Web Animations.\n *\n * **IMPORTANT:** When constructed, it plays the animations as a form of\n * initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"animate-pause\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <button id=\"btn\">Play/pause</button>\n * <div data-lisn-on-click=\"@animate-pause +target=#btn\"></div>\n * ```\n *\n * @category Animation\n */\nexport class AnimatePause implements Action {\n  /**\n   * Pauses the animations without resetting them.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Resumes the animations without resetting them.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Resumes the animations if paused, otherwise pauses them.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"animate-pause\", (element) => new AnimatePause(element));\n  }\n\n  constructor(element: Element) {\n    const { _play, _pause, _toggle } = getMethods(element);\n\n    // Initial state is playing\n    _play();\n\n    this.do = _pause;\n    this.undo = _play;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n// --------------------\n\ntype AnimateAction = typeof PLAY | typeof PAUSE | typeof TOGGLE;\n\nconst PLAY = 0;\nconst PAUSE = 1;\nconst TOGGLE = 2;\n\nconst getMethods = (element: Element) => {\n  return {\n    _play: () => animate(element, PLAY),\n    _pause: () => animate(element, PAUSE),\n    _toggle: () => animate(element, TOGGLE),\n  };\n};\n\nconst animate = (\n  element: Element,\n  action: AnimateAction,\n  isInitial = false,\n) => {\n  return iterateAnimations(\n    element,\n    /* istanbul ignore next */ // jsdom doesn't support Web Animations\n    (animation) => {\n      const isPaused = animation.playState === \"paused\";\n      if (action === PLAY || (isPaused && action === TOGGLE)) {\n        animation.play();\n      } else {\n        animation.pause();\n      }\n    },\n    (element) => {\n      if (isInitial) {\n        resetCssAnimationsNow(element);\n      }\n\n      const isPaused = hasClass(element, MC.PREFIX_ANIMATE_PAUSE);\n      if (action === PLAY || (isPaused && action === TOGGLE)) {\n        removeClassesNow(element, MC.PREFIX_ANIMATE_PAUSE);\n      } else {\n        addClassesNow(element, MC.PREFIX_ANIMATE_PAUSE);\n      }\n    },\n    isInitial,\n  );\n};\n","/**\n * @module Actions\n *\n * @categoryDescription Showing/hiding elements\n * {@link Display} and {@link Undisplay} displays or \"undisplays\" (display:\n * none) the given element.\n *\n * {@link Actions.Show | Show} and {@link Actions.Hide | Hide} show or hide the\n * given element with a smooth fading transition.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\n\nimport {\n  displayElement,\n  displayElementNow,\n  undisplayElement,\n  undisplayElementNow,\n  toggleDisplayElement,\n} from \"@lisn/utils/css-alter\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\n/**\n * Displays or \"undisplays\" (display: none) the given element.\n *\n * **IMPORTANT:** When constructed, it adds `display: none` to the element as a\n * form of initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"display\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <button id=\"btn\">Display/undisplay</button>\n * <div data-lisn-on-click=\"@display +target=#btn\"></div>\n * ```\n *\n * @category Showing/hiding elements\n */\nexport class Display implements Action {\n  /**\n   * It reverts the element to its original `display` property.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Sets `display: none` on the element.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Displays the element if it's \"undisplayed\", otherwise \"undisplays\" it.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"display\", (element) => new Display(element));\n  }\n\n  constructor(element: Element) {\n    undisplayElementNow(element); // initial state\n\n    const { _display, _undisplay, _toggle } = getMethods(element);\n    this.do = _display;\n    this.undo = _undisplay;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n/**\n * \"Undisplays\" (display: none) or displays the given element.\n *\n * **IMPORTANT:** When constructed, it removes the `lisn-undisplay` class if\n * present on the element as a form of initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"undisplay\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <button id=\"btn\">Display/undisplay</button>\n * <div data-lisn-on-click=\"@undisplay +target=#btn\"></div>\n * ```\n *\n * @category Showing/hiding elements\n */\nexport class Undisplay implements Action {\n  /**\n   * Sets `display: none` on the element.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * It reverts the element to its original `display` property.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Displays the element if it's \"undisplayed\", otherwise \"undisplays\" it.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"undisplay\", (element) => new Undisplay(element));\n  }\n\n  constructor(element: Element) {\n    displayElementNow(element); // initial state\n\n    const { _display, _undisplay, _toggle } = getMethods(element);\n    this.do = _undisplay;\n    this.undo = _display;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n// --------------------\n\nconst getMethods = (element: Element) => {\n  return {\n    _display: async () => {\n      await displayElement(element); // ignore return val\n    },\n\n    _undisplay: async () => {\n      await undisplayElement(element); // ignore return val\n    },\n\n    _toggle: async () => {\n      await toggleDisplayElement(element); // ignore return val\n    },\n  };\n};\n","/**\n * @module Utils\n *\n * @categoryDescription DOM: Searching for reference elements\n * The functions allow you to find elements that match a given string\n * specification.\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { getData } from \"@lisn/utils/css-alter\";\nimport { waitForElement } from \"@lisn/utils/dom-events\";\nimport { logError } from \"@lisn/utils/log\";\n\n/**\n * Get the element that matches the given reference specification.\n *\n * The specification is of the form:\n *\n * ```\n * <FullSpec> ::=\n *     <Relation> \".\" <ClassName>  |\n *     <Relation> [\"-\" <ReferenceName>] |\n *     #<DOM_ID>\n *\n * <Relation> :==\n *     \"next\"  |\n *     \"prev\"  |\n *     \"this\"  |\n *     \"first\" |\n *     \"last\"\n * ```\n *\n * - `<DOM_ID>` is the unique ID of the element\n * - `<ClassName>` is a CSS class on the element\n * - `<ReferenceName>` is the value of the `data-lisn-ref` attribute on the\n *   element you are targeting. If not given, defaults to the value of the\n *   `data-lisn-ref` attribute on `thisElement`.\n *\n * There now follows an explanation of how \"next\", \"prev\", \"this\", \"first\" and\n * \"last\" search the DOM:\n * - \"next\": the tree is search in document order (depth first, then breadth),\n *   so the returned element could be a descendant of `thisElement`\n * - \"prev\": the tree is search in document order (depth first, then breadth),\n *   but excluding ancestors of `thisElement`, so the returned element is\n *   guaranteed to _not_ be an ancestor or descendant of `thisElement`.\n * - \"this\": if the given element itself matches the specification, it is\n *   returned, otherwise the closest ancestor of the given element that matches\n *   the specification\n * - \"first\": the first element matching; the tree is search in document order\n *   (depth first, then breadth).\n * - \"last\": the last element matching; the tree is search in document order\n *   (depth first, then breadth).\n *\n * @category DOM: Searching for reference elements\n *\n * @param thisElement The element to search relative to\n *\n * @throws {@link Errors.LisnUsageError | LisnUsageError}\n *                        If the specification is invalid or if thisElement is\n *                        not given for a specification of \"next\", \"prev\" or \"this\"\n */\nexport const getReferenceElement = (\n  spec: string,\n  thisElement: Element,\n): Element | null => {\n  if (!spec) {\n    return thisElement;\n  }\n\n  if (spec[0] === \"#\") {\n    // element ID\n    const referenceElement = MH.getElementById(spec.slice(1));\n    if (!referenceElement) {\n      return null;\n    }\n    return referenceElement;\n  }\n\n  const relation = [\"next\", \"prev\", \"this\", \"first\", \"last\"].find(\n    (p) => spec.startsWith(`${p}.`) || spec.startsWith(`${p}-`) || spec === p,\n  );\n\n  if (!relation) {\n    throw MH.usageError(`Invalid search specification '${spec}'`);\n  }\n\n  const rest = spec.slice(MH.lengthOf(relation));\n  const matchOp = rest.slice(0, 1);\n  let refOrCls = rest.slice(1);\n\n  let selector: string;\n  if (matchOp === \".\") {\n    selector = matchOp + refOrCls;\n  } else {\n    if (!refOrCls) {\n      refOrCls = getData(thisElement, PREFIX_REF) ?? \"\";\n    }\n\n    if (!refOrCls) {\n      throw MH.usageError(`No reference name in '${spec}'`);\n    }\n\n    selector = `[${DATA_REF}=\"${refOrCls}\"]`;\n  }\n\n  let referenceElement;\n  if (relation === \"first\") {\n    referenceElement = getFirstReferenceElement(selector);\n  } else if (relation === \"last\") {\n    referenceElement = getLastReferenceElement(selector);\n  } else {\n    if (relation === \"this\") {\n      referenceElement = getThisReferenceElement(selector, thisElement);\n    } else if (relation === \"next\") {\n      referenceElement = getNextReferenceElement(selector, thisElement);\n    } else if (relation === \"prev\") {\n      referenceElement = getPrevReferenceElement(selector, thisElement);\n    } else {\n      /* istanbul ignore next */ {\n        logError(MH.bugError(`Unhandled relation case ${relation}`));\n        return null;\n      }\n    }\n  }\n\n  if (!referenceElement) {\n    return null;\n  }\n\n  return referenceElement;\n};\n\n/**\n * Like {@link getReferenceElement} excepts if no element matches the\n * specification if will wait for at most the given time for such an element.\n *\n * @category DOM: Searching for reference elements\n */\nexport const waitForReferenceElement = (\n  spec: string,\n  thisElement: Element,\n  timeout = 200,\n) => waitForElement(() => getReferenceElement(spec, thisElement), timeout);\n\n// ----------------------------------------\n\nconst PREFIX_REF = MH.prefixName(\"ref\");\nconst DATA_REF = MH.prefixData(PREFIX_REF);\n\nconst getAllReferenceElements = (\n  selector: string,\n): NodeListOf<Element> | null => MH.docQuerySelectorAll(selector);\n\nconst getFirstReferenceElement = (selector: string): Element | null =>\n  MH.docQuerySelector(selector);\n\nconst getLastReferenceElement = (selector: string): Element | null => {\n  const allRefs = getAllReferenceElements(selector);\n  return (allRefs && allRefs[MH.lengthOf(allRefs) - 1]) || null;\n};\n\nconst getThisReferenceElement = (\n  selector: string,\n  thisElement: Element,\n): Element | null => thisElement.closest(selector);\n\nconst getNextReferenceElement = (selector: string, thisElement: Element) =>\n  getNextOrPrevReferenceElement(selector, thisElement, false);\n\nconst getPrevReferenceElement = (selector: string, thisElement: Element) =>\n  getNextOrPrevReferenceElement(selector, thisElement, true);\n\nconst getNextOrPrevReferenceElement = (\n  selector: string,\n  thisElement: Element,\n  goBackward: boolean,\n): Element | null => {\n  thisElement = getThisReferenceElement(selector, thisElement) ?? thisElement;\n\n  if (!MH.getDoc().contains(thisElement)) {\n    return null;\n  }\n\n  const allRefs = getAllReferenceElements(selector);\n  if (!allRefs) {\n    return null;\n  }\n\n  const numRefs = MH.lengthOf(allRefs);\n  let refIndex = goBackward ? numRefs - 1 : -1;\n  for (let i = 0; i < numRefs; i++) {\n    const currentIsAfter = MH.isNodeBAfterA(thisElement, allRefs[i]);\n\n    // As soon as we find either the starting element or the first element\n    // that follows it, stop iteration.\n    // - If we're looking for the previous reference, then take the previous\n    //   element in the iteration.\n    // - Otherwise, if the current element in the iteration is the same as the\n    //   starting one, then take either the next element in the iteration.\n    //   - Otherwise, (if the current element follows the starting one, as\n    //     would happen if the starting element was not in the list of matched\n    //     elements, take the current element in the iteration.\n    if (allRefs[i] === thisElement || currentIsAfter) {\n      refIndex = i + (goBackward ? -1 : currentIsAfter ? 0 : 1);\n      break;\n    }\n  }\n\n  return allRefs[refIndex] ?? null;\n};\n","/**\n * ## Specification for the HTML API for triggers\n *\n * The following describes the general syntax when using the HTML API and\n * automatic widgets\n * ({@link Settings.settings.autoWidgets | settings.autoWidgets} is true)\n * specifically for triggers and actions.\n *\n * A trigger specification should be given as a\n * `data-lisn-on-<TriggerName>=\"<TriggerSpecList>\"` attribute.\n * A fallback option of using a CSS class of the form\n * `lisn-on-<TriggerName>--<TriggerSpec>` is also supported but not recommended.\n *\n * The general specification for a trigger is of the form:\n *\n * ```\n * <TriggerSpecList> ::= <TriggerSpec> { \";\" <TriggerSpec> }\n *\n * <TriggerSpec> ::= [ <TriggerArg> { \",\" <TriggerArg> } ]\n *                   \"@\" <ActionSpec> { \"@\" <ActionSpec> }\n *                   { \"+\" <TriggerOption> }\n *\n * <TriggerOption> ::=\n *     <BooleanOptionName> [ \"=\" ( \"false\" | \"true\" ) ] |\n *     <OptionName> \"=\" <OptionValue>\n *\n * <ActionSpec> ::= <ActionName> [ \":\" <ActionArgOrOption> { \",\" <ActionArgOrOption> } ]\n *\n * <ActionArgOrOption> ::= <ActionArg> | <OptionName> \"=\" <OptionValue>\n * ```\n *\n * where `<TriggerArg>` is the particular trigger's main argument, which could\n * be required or optional (and not all triggers accept an argument). See each\n * trigger's specification for their arguments and options.\n *\n * Also refer to each action for their accepted arguments and/or options if any.\n *\n * **NOTE:**\n *\n * There can be 0 or more spaces around any of the separator characters.\n *\n * At least one action (with a preceding \"@\" character) is always required.\n *\n * The characters \";\", \",\", \"=\", \"@\", \"+\" and \":\" are reserved separators and\n * cannot be used literally as part of an argument or option value.\n *\n * @module Triggers\n *\n * @categoryDescription Manual run\n * {@link Trigger} is the base trigger class that you can extend when building\n * custom triggers and it also registers a trigger that needs to be run\n * manually (by e.g. the {@link Actions.Run | Run} action).\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { LisnUsageError } from \"@lisn/globals/errors\";\n\nimport { wrapCallback } from \"@lisn/modules/callback\";\n\nimport { getData } from \"@lisn/utils/css-alter\";\nimport { waitForReferenceElement } from \"@lisn/utils/dom-search\";\nimport { waitForDelay } from \"@lisn/utils/tasks\";\nimport { formatAsString, randId, splitOn } from \"@lisn/utils/text\";\nimport {\n  validateString,\n  validateNumber,\n  validateBoolean,\n} from \"@lisn/utils/validation\";\n\nimport { Action, fetchAction } from \"@lisn/actions/action\";\n\nimport {\n  Widget,\n  WidgetConfigValidator,\n  WidgetConfigValidatorFunc,\n  WidgetConfigAsyncValidatorObject,\n  registerWidget,\n  fetchWidgetConfig,\n} from \"@lisn/widgets/widget\";\n\nimport debug from \"@lisn/debug/debug\";\n\n/**\n * {@link Trigger} is the base trigger class that you can extend when building\n * custom triggers and it also registers a trigger that needs to be run\n * manually (by e.g. the {@link Actions.Run | Run} action).\n *\n * -------\n *\n * To use with auto-widgets (HTML API), see {@link registerTrigger} for the\n * specification.\n *\n * @example\n * Show the element 1000ms after the first time the trigger is run.\n *\n * ```html\n * <div data-lisn-on-run=\"@show +once +delay=1000\"></div>\n * ```\n *\n * @category Manual run\n */\nexport class Trigger extends Widget {\n  /**\n   * \"Do\"es all the {@link Action}s linked to the trigger.\n   */\n  readonly run: () => Promise<void>;\n\n  /**\n   * \"Undo\"es all the {@link Action}s linked to the trigger.\n   */\n  readonly reverse: () => Promise<void>;\n\n  /**\n   * \"Toggle\"s all the {@link Action}s linked to the trigger.\n   */\n  readonly toggle: () => Promise<void>;\n\n  /**\n   * Returns the trigger's actions.\n   */\n  readonly getActions: () => Action[];\n\n  /**\n   * Returns the trigger config.\n   */\n  readonly getConfig: () => TriggerConfig;\n\n  static get(element: Element, id: string): Trigger | null {\n    const instance = super.get(element, id);\n    if (MH.isInstanceOf(instance, Trigger)) {\n      return instance;\n    }\n    return null;\n  }\n\n  static register() {\n    registerTrigger(\n      \"run\",\n      (element, a, actions, config) => new Trigger(element, actions, config),\n      {},\n    );\n  }\n\n  /**\n   * If no actions are supplied, nothing is done.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the config is invalid.\n   */\n  constructor(element: Element, actions: Action[], config?: TriggerConfig) {\n    super(element, config);\n\n    const logger = debug\n      ? new debug.Logger({\n          name: `Trigger-${formatAsString(element)}`,\n          logAtCreation: { actions, config },\n        })\n      : null;\n\n    const once = config?.once ?? false;\n    const oneWay = config?.oneWay ?? false;\n    const delay = config?.delay ?? 0;\n    const doDelay = config?.doDelay ?? delay;\n    const undoDelay = config?.undoDelay ?? delay;\n\n    let lastCallId: string;\n    // false if next should be do; true if next should be undo.\n    // Used for determining delays only.\n    let toggleState = false;\n\n    const callActions = async (\n      delay: number,\n      callFn: (action: Action) => void,\n      newToggleState: boolean,\n    ) => {\n      if (this.isDisabled()) {\n        return;\n      }\n\n      const myCallId = randId();\n      lastCallId = myCallId;\n      debug: logger?.debug10(\n        `callActions [${myCallId}] (new toggle state ${newToggleState})`,\n        callFn,\n      );\n\n      if (delay) {\n        await waitForDelay(delay);\n        if (lastCallId !== myCallId) {\n          // overriden by subsequent call\n          debug: logger?.debug10(\n            `callActions [${myCallId}]: overriden by ${lastCallId}`,\n          );\n          return;\n        }\n      }\n\n      for (const action of actions) {\n        debug: logger?.debug10(`callActions [${myCallId}]`, action);\n        callFn(action);\n      }\n\n      toggleState = newToggleState;\n\n      if (toggleState && once) {\n        this.destroy();\n      }\n    };\n\n    const run = wrapCallback(() => {\n      callActions(\n        doDelay,\n        (action) => {\n          action.do();\n        },\n        true,\n      ); // don't await\n    });\n\n    const reverse = wrapCallback(() => {\n      if (!oneWay) {\n        callActions(\n          undoDelay,\n          (action) => {\n            action.undo();\n          },\n          false,\n        ); // don't await\n      }\n    });\n\n    const toggle = wrapCallback(() => {\n      callActions(\n        toggleState ? undoDelay : doDelay,\n        (action) => {\n          action[MC.S_TOGGLE]();\n        },\n        !toggleState,\n      ); // don't await\n    });\n\n    // ----------\n\n    this.onDestroy(() => {\n      debug: logger?.debug5(\"Removing callbacks\");\n      MH.remove(run);\n      MH.remove(reverse);\n      MH.remove(toggle);\n    });\n\n    this.run = run.invoke;\n    this.reverse = reverse.invoke;\n    this[MC.S_TOGGLE] = oneWay ? run.invoke : toggle.invoke;\n    this.getActions = () => [...actions]; // copy\n    this.getConfig = () => MH.copyObject(config);\n  }\n}\n\n/**\n * @interface\n */\nexport type TriggerConfig = {\n  /**\n   * An ID for the trigger so that it can be looked up by ID. It has to be\n   * unique for each element, but you can use the same ID on different\n   * elements.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * If true, the trigger will run at most once. This will result in the `run`\n   * or `toggle` methods removing all three of `run`, `reverse` and `toggle`\n   * when called, so that the actions are done at most once.\n   *\n   * @defaultValue false\n   */\n  once?: boolean;\n\n  /**\n   * If true, then the `reverse` method of the trigger will do nothing and the\n   * `toggle` method will always do the actions, i.e. will be equivalent to\n   * `run`.\n   *\n   * @defaultValue false\n   */\n  oneWay?: boolean;\n\n  /**\n   * Delay in milliseconds before doing, undoing or toggling actions.\n   *\n   * @defaultValue 0\n   */\n  delay?: number;\n\n  /**\n   * Delay in milliseconds before doing actions.\n   *\n   * @defaultValue {@link TriggerConfig.delay}\n   */\n  doDelay?: number;\n\n  /**\n   * Delay in milliseconds before undoing actions.\n   *\n   * @defaultValue {@link TriggerConfig.delay}\n   */\n  undoDelay?: number;\n\n  /**\n   * The element to instantiate all actions on this trigger for.\n   *\n   * @defaultValue The element on which the {@link Trigger} is defined\n   */\n  actOn?: Element;\n};\n\nexport type TriggerCreateFn<Config extends TriggerConfig> = (\n  element: Element,\n  args: string[],\n  actions: Action[],\n  config: Config,\n) => Trigger | Promise<Trigger>;\n\n/**\n * Registers the given trigger as a widget to be automatically configured for\n * all elements that have a trigger specification with the given name.\n *\n * A trigger specification can be given as a\n * `data-lisn-on-<TriggerName>=\"<TriggerSpec> { \";\" <TriggerSpec> }\"` attribute\n * or as one or more `lisn-on-<TriggerName>--<TriggerSpec>` classes.\n *\n * See the top of the {@link Triggers} page for an explanation of `<TriggerSpec>`.\n *\n * Using classes instead of attributes is not recommended and only available as\n * a fallback option.\n *\n * **IMPORTANT:** If a trigger by that name is already registered, the current\n * call does nothing, even if the remaining arguments differ.\n *\n * @param name       The name of the trigger. Should be in kebab-case.\n * @param newTrigger Called for every trigger specification on any element\n *                   that has one or more trigger specifications.\n * @param configValidator\n *                   A validator object, or a function that returns such an\n *                   object, for all options that are specific to the\n *                   trigger. Base options (in {@link TriggerConfig}) will\n *                   be parsed automatically and don't need to be handled by\n *                   `configValidator`.\n *                   If the parameter is a function, it will be called with\n *                   the element on which the trigger is being defined.\n *\n * @see {@link registerWidget}\n */\nexport const registerTrigger = <Config extends TriggerConfig = TriggerConfig>(\n  name: string,\n  newTrigger: TriggerCreateFn<Config>,\n  configValidator?: null | WidgetConfigValidator<Config>,\n) => {\n  const clsPref = MH.prefixName(`on-${name}`);\n\n  const newWidget = async (element: Element) => {\n    const widgets: Widget[] = [];\n    const baseConfigValidator = newBaseConfigValidator(element);\n    const thisConfigValidator = MH.isFunction(configValidator)\n      ? await configValidator(element)\n      : configValidator;\n\n    const allSpecs = splitOn(\n      getData(element, MH.prefixName(`on-${name}`)) ?? \"\",\n      TRIGGER_SEP,\n      true,\n    );\n\n    for (const cls of MH.classList(element)) {\n      if (cls.startsWith(`${clsPref}--`)) {\n        allSpecs.push(cls.slice(MH.lengthOf(clsPref) + 2));\n      }\n    }\n\n    for (const spec of allSpecs) {\n      const [tmp, configSpec] = splitOn(spec, OPTION_PREF_CHAR, true, 1);\n      const [argSpec, allActionSpecs] = splitOn(tmp, ACTION_PREF_CHAR, true, 1);\n\n      const args = MH.filterBlank(splitOn(argSpec, \",\", true)) || [];\n\n      const config = await fetchWidgetConfig(\n        configSpec,\n        MH.assign(\n          baseConfigValidator,\n          thisConfigValidator,\n        ) as WidgetConfigAsyncValidatorObject<Required<TriggerConfig> & Config>,\n        OPTION_PREF_CHAR,\n      );\n\n      const actionTarget = config.actOn ?? element;\n\n      const actions = [];\n      for (const actionSpec of splitOn(\n        allActionSpecs ?? \"\",\n        ACTION_PREF_CHAR,\n        true,\n      )) {\n        const [name, actionArgsAndOptions] = splitOn(\n          actionSpec,\n          ACTION_ARGS_PREF_CHAR,\n          true,\n          1,\n        );\n\n        try {\n          actions.push(\n            await fetchAction(actionTarget, name, actionArgsAndOptions ?? \"\"),\n          );\n        } catch (err) {\n          if (MH.isInstanceOf(err, LisnUsageError)) {\n            // fetchAction would have logged an error\n            continue;\n          }\n\n          throw err;\n        }\n      }\n\n      widgets.push(await newTrigger(element, args, actions, config));\n    }\n\n    return widgets;\n  };\n\n  registerWidget(name, newWidget, null, {\n    selector: `[class^=\"${clsPref}--\"],[class*=\" ${clsPref}--\"],[data-${clsPref}]`,\n  });\n};\n\n// --------------------\n\nconst TRIGGER_SEP = \";\";\nconst OPTION_PREF_CHAR = \"+\";\nconst ACTION_PREF_CHAR = \"@\";\nconst ACTION_ARGS_PREF_CHAR = \":\";\n\nconst newBaseConfigValidator: WidgetConfigValidatorFunc<TriggerConfig> = (\n  element,\n) => {\n  return {\n    id: validateString,\n    once: validateBoolean,\n    oneWay: validateBoolean,\n    delay: validateNumber,\n    doDelay: validateNumber,\n    undoDelay: validateNumber,\n    actOn: (key, value) =>\n      (MH.isLiteralString(value)\n        ? waitForReferenceElement(value, element)\n        : null) ?? undefined,\n  };\n};\n","/**\n * @module Actions\n *\n * @categoryDescription Controlling triggers\n * {@link Enable} and {@link Disable} enable or disable a list of triggers\n * defined on the given element.\n *\n * {@link Run} runs or reverses a list of triggers defined on the given\n * element.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { logWarn } from \"@lisn/utils/log\";\nimport { waitForDelay } from \"@lisn/utils/tasks\";\nimport { formatAsString } from \"@lisn/utils/text\";\n\nimport { Trigger } from \"@lisn/triggers/trigger\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\n/**\n * Enables or disables a list of triggers defined on the given element.\n *\n * **IMPORTANT:** When constructed, it disables all given triggers as a form of\n * initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n *   - Action name: \"enable\".\n *   - Accepted string arguments: one or more unique IDs of triggers defined on\n *     the given element\n *\n * @example\n * ```html\n * <button id=\"btn\">Enable/disable</button>\n * <button data-lisn-on-click=\"\n *         @enable=triggerA,triggerB +target=#btn\n *         @add-class=clsA +id=triggerA\n *      \"\n *      data-lisn-on-click=\"@add-class=clsB +id=triggerB\"\n * ></button>\n * ```\n *\n * @category Controlling triggers\n */\nexport class Enable implements Action {\n  /**\n   * Enables the triggers with IDs given to the constructor.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Disables the triggers with IDs given to the constructor.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Toggles the enabled state on each trigger given to the constructor.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"enable\", (element, ids) => new Enable(element, ...ids));\n  }\n\n  constructor(element: Element, ...ids: string[]) {\n    const { _enable, _disable, _toggleEnable } = getMethods(element, ids);\n    _disable(); // initial state\n\n    this.do = _enable;\n    this.undo = _disable;\n    this[MC.S_TOGGLE] = _toggleEnable;\n  }\n}\n\n/**\n * Disables or enables a list of triggers defined on the given element.\n *\n * **IMPORTANT:** When constructed, it enables all given triggers as a form of\n * initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n *   - Action name: \"disable\".\n *   - Accepted string arguments: one or more unique IDs of triggers defined on\n *     the given element\n *\n * @example\n * ```html\n * <button id=\"btn\">Enable/disable</button>\n * <button data-lisn-on-click=\"\n *         @disable=triggerA,triggerB +target=#btn\n *         @add-class=clsA +id=triggerA\n *      \"\n *      data-lisn-on-click=\"@add-class=clsB +id=triggerB\"\n * ></button>\n * ```\n *\n * @category Controlling triggers\n */\nexport class Disable implements Action {\n  /**\n   * Disables the triggers with IDs given to the constructor.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Enables the triggers with IDs given to the constructor.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Toggles the enabled state on each trigger given to the constructor.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"disable\", (element, ids) => new Disable(element, ...ids));\n  }\n\n  constructor(element: Element, ...ids: string[]) {\n    const { _enable, _disable, _toggleEnable } = getMethods(element, ids);\n    _enable(); // initial state\n\n    this.do = _disable;\n    this.undo = _enable;\n    this[MC.S_TOGGLE] = _toggleEnable;\n  }\n}\n\n/**\n * Runs or reverses a list of triggers defined on the given element.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n *   - Action name: \"run\".\n *   - Accepted string arguments: one or more unique IDs of triggers defined on\n *     the given element\n *\n * @example\n * ```html\n * <button data-lisn-on-click=\"\n *         @run=triggerA,triggerB\n *         @add-class=clsA +id=triggerA\n *      \"\n *      data-lisn-on-run=\"@add-class=clsB +id=triggerB\"\n * ></button>\n * ```\n *\n * @category Controlling triggers\n */\nexport class Run implements Action {\n  /**\n   * Runs the triggers with IDs given to the constructor.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Reverses the triggers with IDs given to the constructor.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Toggles the triggers with IDs given to the constructor.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"run\", (element, ids) => new Run(element, ...ids));\n  }\n\n  constructor(element: Element, ...ids: string[]) {\n    const { _run, _reverse, _toggle } = getMethods(element, ids);\n\n    this.do = _run;\n    this.undo = _reverse;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n// --------------------\n\nconst getMethods = (element: Element, ids: string[]) => {\n  const triggerPromises = getTriggers(element, ids);\n  const call = async (\n    method:\n      | \"enable\"\n      | \"disable\"\n      | \"toggleEnable\"\n      | \"run\"\n      | \"reverse\"\n      | \"toggle\",\n  ) => {\n    const triggers = await triggerPromises;\n    for (const trigger of triggers) {\n      trigger[method]();\n    }\n  };\n\n  return {\n    _enable: () => call(\"enable\"),\n    _disable: () => call(\"disable\"),\n    _toggleEnable: () => call(\"toggleEnable\"),\n    _run: () => call(\"run\"),\n    _reverse: () => call(\"reverse\"),\n    _toggle: () => call(MC.S_TOGGLE),\n  };\n};\n\nconst getTriggers = async (element: Element, ids: string[]) => {\n  const triggers: Trigger[] = [];\n  if (!MH.lengthOf(ids)) {\n    logWarn(\"At least 1 ID is required for enable action\");\n    return triggers;\n  }\n\n  for (const id of ids) {\n    let trigger = Trigger.get(element, id);\n    if (!trigger) {\n      await waitForDelay(0); // in case it's being processed now\n      trigger = Trigger.get(element, id);\n\n      if (!trigger) {\n        logWarn(\n          `No trigger with ID ${id} for element ${formatAsString(element)}`,\n        );\n        continue;\n      }\n    }\n\n    triggers.push(trigger);\n  }\n\n  return triggers;\n};\n","/**\n * @module Actions\n *\n * @categoryDescription Scrolling\n * {@link ScrollTo} scrolls to the given element or to the previous scroll\n * position.\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\nimport * as MC from \"@lisn/globals/minification-constants\";\n\nimport { CoordinateOffset } from \"@lisn/globals/types\";\n\nimport { waitForReferenceElement } from \"@lisn/utils/dom-search\";\nimport { omitKeys } from \"@lisn/utils/misc\";\nimport { validateNumber } from \"@lisn/utils/validation\";\n\nimport { ScrollWatcher } from \"@lisn/watchers/scroll-watcher\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\nimport { WidgetConfigValidatorFunc } from \"@lisn/widgets/widget\";\n\n/**\n * Scrolls to the given element or to the previous scroll position.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"scroll-to\".\n * - Accepted string arguments: none\n * - Accepted options:\n *   - `offsetX`: A number.\n *   - `offsetY`: A number.\n *   - `duration`: A number.\n *   - `scrollable`: A string element specification for an element (see\n *     {@link Utils.getReferenceElement | getReferenceElement}). Note that,\n *     unless it's a DOM ID, the specification is parsed relative to the\n *     element being acted on and not the element the trigger is defined on (in\n *     case you've used the `act-on` trigger option).\n *\n * **NOTE:** Do not place a + sign in front of the offset values (just omit it\n * if you want a positive offset). Otherwise it will be interpreted as a\n * trigger option.\n *\n * @example\n * When the user clicks the button, scroll the main scrolling element to\n * element's position:\n *\n * ```html\n * <button id=\"btn\">Scroll to/back</button>\n * <div data-lisn-on-click=\"@scroll-to +target=#btn\"></div>\n * ```\n *\n * @example\n * When the user clicks the button, scroll the main scrolling element to\n * element's position +10px down:\n *\n * ```html\n * <button id=\"btn\">Scroll to/back</button>\n * <div data-lisn-on-click=\"@scroll-to: offsetY=10 +target=#btn\"></div>\n * ```\n *\n * @example\n * When the user clicks the button, scroll the main scrolling element to\n * element's position 10px _down_ and 50px _left_, with a duration of 200ms:\n *\n * ```html\n * <button id=\"btn\">Scroll to/back</button>\n * <div data-lisn-on-click=\"@scroll-to: offsetY=10, offsetX=-50, duration=200 +target=#btn\"></div>\n * ```\n *\n * @example\n * When the user clicks the button, scroll the closest parent element with\n * class `scrollable` to the element's position:\n *\n * ```html\n * <button id=\"btn\">Scroll to/back</button>\n * <div class=\"scrollable\">\n *   <div data-lisn-on-click=\"@scroll-to: scrollable=this.scrollable +target=#btn\"></div>\n * </div>\n * ```\n *\n * @example\n * As above, but using `data-lisn-ref` attribute instead of class selector.\n *\n * ```html\n * <button id=\"btn\">Scroll to/back</button>\n * <div data-lisn-ref=\"scrollable\">\n *   <div data-lisn-on-click=\"@scroll-to: scrollable=this-scrollable +target=#btn\"></div>\n * </div>\n * ```\n *\n * @category Scrolling\n */\nexport class ScrollTo implements Action {\n  /**\n   * Scrolls the main scrolling element to the element's position.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Scrolls the main scrolling element to the last scroll position before the\n   * action was {@link do}ne. If the action had never been done, does nothing.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Scrolls the main scrolling element to the element's position, if it's not\n   * already there, or otherwise scrolls the main scrolling element to the\n   * previous saved scroll position.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\n      \"scroll-to\",\n      (element, args, config) => {\n        const offset = config\n          ? {\n              left: config.offsetX,\n              top: config.offsetY,\n            }\n          : undefined;\n\n        return new ScrollTo(element, {\n          offset,\n          duration: config?.duration,\n          scrollable: config?.scrollable,\n        });\n      },\n      newConfigValidator,\n    );\n  }\n\n  constructor(element: Element, config?: ScrollToConfig) {\n    const watcher = ScrollWatcher.reuse();\n    const { scrollable } = config ?? {};\n    let prevScrollTop = -1,\n      prevScrollLeft = -1;\n\n    this.do = async () => {\n      const current = await watcher.fetchCurrentScroll(scrollable);\n      prevScrollTop = current[MC.S_SCROLL_TOP];\n      prevScrollLeft = current[MC.S_SCROLL_LEFT];\n\n      const action = await watcher.scrollTo(element, config);\n      await action?.waitFor();\n    };\n\n    this.undo = async () => {\n      if (prevScrollTop !== -1) {\n        const action = await watcher.scrollTo(\n          {\n            top: prevScrollTop,\n            left: prevScrollLeft,\n          },\n          omitKeys(config ?? {}, { offset: true }), // no offset when undoing\n        );\n        await action?.waitFor();\n      }\n    };\n\n    this[MC.S_TOGGLE] = async () => {\n      const start = await watcher.fetchCurrentScroll(scrollable);\n\n      const canReverse = prevScrollTop !== -1;\n      let hasReversed = false;\n\n      // Try to scroll to the element, but if we're already close to it, then\n      // reverse to previous position if any.\n      const altTarget = {\n        top: () => {\n          hasReversed = true; // detect if we have reversed\n          return prevScrollTop;\n        },\n        left: prevScrollLeft,\n      };\n\n      const action = await watcher.scrollTo(\n        element,\n        MH.merge(\n          config,\n          canReverse\n            ? { altTarget } // no altOffset when reversing\n            : {},\n        ),\n      );\n      await action?.waitFor();\n\n      if (!hasReversed) {\n        // We've scrolled to the element, so save the starting position as the\n        // previous one.\n        prevScrollTop = start[MC.S_SCROLL_TOP];\n        prevScrollLeft = start[MC.S_SCROLL_LEFT];\n      }\n    };\n  }\n}\n\n/**\n * @interface\n * @category Scrolling\n */\nexport type ScrollToConfig = {\n  /**\n   * See {@link Utils.ScrollToOptions.offset}.\n   *\n   * @defaultValue undefined // none\n   */\n  offset?: CoordinateOffset;\n\n  /**\n   * The duration in milliseconds of the scroll animation.\n   *\n   * @defaultValue {@link ScrollWatcher} default\n   */\n  duration?: number;\n\n  /**\n   * The element that should be scrolled.\n   *\n   * @defaultValue {@link ScrollWatcher} default\n   */\n  scrollable?: Element;\n};\n\n// --------------------\n\nconst newConfigValidator: WidgetConfigValidatorFunc<{\n  offsetX: number;\n  offsetY: number;\n  duration: number | undefined;\n  scrollable?: Element;\n}> = (element) => {\n  return {\n    offsetX: (key, value) => validateNumber(key, value) ?? 0,\n    offsetY: (key, value) => validateNumber(key, value) ?? 0,\n    duration: (key, value) => validateNumber(key, value),\n    scrollable: (key, value) =>\n      (MH.isLiteralString(value)\n        ? waitForReferenceElement(value, element)\n        : null) ?? undefined,\n  };\n};\n","/**\n * @module Actions\n *\n * @categoryDescription Setting/deleting attributes\n * {@link SetAttribute} sets or deletes an attribute on the given element.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { waitForMutateTime } from \"@lisn/utils/dom-optimize\";\nimport { camelToKebabCase } from \"@lisn/utils/text\";\nimport { validateString } from \"@lisn/utils/validation\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\nimport { WidgetConfigValidatorObject } from \"@lisn/widgets/widget\";\n\n/**\n * Either sets or deletes an attribute, or toggles between two values of an\n * attribute, on the given element.\n *\n * **IMPORTANT:** When constructed, it sets all given attributes on the\n * element to their _OFF_ (undone) state as a form of initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"set-attribute\".\n * - Accepted string arguments: name of attribute\n * - Accepted options:\n *   - `on`: A string value for the attribute. Can be blank. Omit this option\n *     in order to have the attribute deleted when the action is done.\n *   - `off`: A string value for the attribute. Can be blank. Omit this option\n *     in order to have the attribute deleted when the action is undone.\n *\n * Note that with the HTML API you can only specify one attribute per action.\n * But of course you can add the same action multiple times per trigger. See\n * examples below.\n *\n * @example\n * This is an overview of the various combinations that you can use to set an\n * attribute to a non-empty value, a blank value or delete the attribute when\n * the action is either done or undone:\n *\n * | Specification                         | Value when done | Value when undone |\n * | ------------------------------------- | --------------- | ----------------- |\n * | @set-attr: attr, on=onVal, off=offVal | \"onVal\"         | \"offVal\"          |\n * | @set-attr: attr, on=value             | \"value\"         | _deleted_         |\n * | @set-attr: attr, off=value            | _deleted_       | \"value\"           |\n * | @set-attr: attr, on=                  | \"\"              | _deleted_         |\n * | @set-attr: attr, off=                 | _deleted_       | \"\"                |\n * | @set-attr: attr, on=value, off=       | \"value\"         | \"\"                |\n * | @set-attr: attr, on= , off=value      | \"\"              | \"value\"           |\n *\n * @example\n * This will set attribute `attrA` to `valueA-ON` and `attrB` to `valueB-ON`\n * when the element enters the viewport and set `attrA` to `valueA-OFF` and\n * `attrB` to `valueB-OFF` when it leaves the viewport.\n *\n * ```html\n * <div data-lisn-on-view=\"@set-attribute: attrA, on=valueA-ON, off=valueA-OFF\n *                         @set-attribute: attrB, on=valueB-ON, off=valueB-OFF\"\n * ></div>\n * ```\n *\n * @example\n * This will set attribute `attr` to `value` when the element enters the\n * viewport and _delete_ the attribute when it leaves the viewport.\n *\n * ```html\n * <div data-lisn-on-view=\"@set-attribute: attr, on=value\"></div>\n * ```\n *\n * @example\n * This will _delete_ attribute `attr` when the element enters the viewport and\n * set it to `value` when it leaves the viewport.\n *\n * ```html\n * <div data-lisn-on-view=\"@set-attribute: attr, off=value\"></div>\n * ```\n *\n * @example\n * This will set attribute `attr` to a blank value when the element enters the\n * viewport and _delete_ the attribute when it leaves the viewport.\n *\n * ```html\n * <div data-lisn-on-view=\"@set-attribute: attr, on=\"></div>\n * ```\n *\n * @example\n * This will _delete_ attribute `attr` when the element enters the viewport and\n * set it to a blank value when it leaves the viewport.\n *\n * ```html\n * <div data-lisn-on-view=\"@set-attribute: attr, off=\"></div>\n * ```\n *\n * @example\n * This will set attribute `attr` to `value` when the element enters the\n * viewport and set it to a blank value when it leaves the viewport.\n *\n * ```html\n * <div data-lisn-on-view=\"@set-attribute: attr, on=value, off=\"></div>\n * ```\n *\n * @example\n * This will set attribute `attr` to a blank value when the element enters the\n * viewport and set it to `value` when it leaves the viewport.\n *\n * ```html\n * <div data-lisn-on-view=\"@set-attribute: attr, on=, off=value\"></div>\n * ```\n *\n * @category Setting/deleting attributes\n */\nexport class SetAttribute implements Action {\n  /**\n   * Sets the attribute to its \"ON\" value, or deletes it if that value is null.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Sets the attribute to its \"OFF\" value, or deletes it if that value is null.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Toggles the attribute from its \"ON\" to \"OFF\" value or vice versa.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\n      \"set-attribute\",\n      (element, args, config) => {\n        return new SetAttribute(element, { [args[0]]: config ?? {} });\n      },\n      configValidator,\n    );\n  }\n\n  constructor(element: Element, attributes: Attributes) {\n    if (!attributes) {\n      throw MH.usageError(\"Attributes are required\");\n    }\n\n    let isOn = false;\n\n    const setAttrs = async (on: boolean) => {\n      isOn = on;\n\n      await waitForMutateTime();\n\n      for (const attr in attributes) {\n        const value = attributes[attr][on ? \"on\" : \"off\"];\n        const attrName = camelToKebabCase(attr);\n\n        if (MH.isNullish(value)) {\n          MH.delAttr(element, attrName);\n        } else {\n          MH.setAttr(element, attrName, value);\n        }\n      }\n    };\n\n    this.do = () => setAttrs(true);\n\n    this.undo = () => setAttrs(false);\n\n    this[MC.S_TOGGLE] = () => setAttrs(!isOn);\n\n    this.undo(); // initial state\n  }\n}\n\n/**\n * Each key in the object is an attribute name. The `on` value is set when the\n * action is done and the `off` value is set when the action is undone. To set\n * the attribute to an empty value, use an empty string. To _delete_ the\n * attribute, use `null` as the value or simply omit the relevant `on` or `off`\n * key.\n *\n * **IMPORTANT:** Attribute names in camelCase are converted to kebab-case.\n * E.g. `dataFooBar` will translate to `data-foo-bar`.\n *\n * @category Setting/deleting attributes\n */\nexport type Attributes = Record<\n  string,\n  { on?: string | null; off?: string | null }\n>;\n\n// --------------------\n\nconst configValidator: WidgetConfigValidatorObject<Attributes[string]> = {\n  on: validateString,\n  off: validateString,\n};\n","/**\n * @module Actions\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\n\nimport {\n  showElement,\n  hideElement,\n  toggleShowElement,\n  disableInitialTransition,\n} from \"@lisn/utils/css-alter\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\n/**\n * Shows or hides the given element with a smooth fading transition.\n *\n * **IMPORTANT:** When constructed, it will hide the element as a form of\n * initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"show\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <button id=\"btn\">Show/hide</button>\n * <div data-lisn-on-click=\"@show +target=#btn\"></div>\n * ```\n *\n * @category Showing/hiding elements\n */\nexport class Show implements Action {\n  /**\n   * Shows the element with a smooth fade in transition.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Hides the element with a smooth fade out transition.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Shows the element if it is hidden, hides it otherwise.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"show\", (element) => new Show(element));\n  }\n\n  constructor(element: Element) {\n    disableInitialTransition(element);\n    hideElement(element); // initial state\n\n    const { _show, _hide, _toggle } = getMethods(element);\n    this.do = _show;\n    this.undo = _hide;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n/**\n * Hides or shows the given element with a smooth fading transition.\n *\n * **IMPORTANT:** When constructed, it will remove any `lisn-hide` class from\n * the element as a form of initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"hide\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <button id=\"btn\">Show/hide</button>\n * <div data-lisn-on-click=\"@hide +target=#btn\"></div>\n * ```\n *\n * @category Showing/hiding elements\n */\nexport class Hide implements Action {\n  /**\n   * Hides the element with a smooth fade out transition.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Shows the element with a smooth fade in transition.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Shows the element if it is hidden, hides it otherwise.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"hide\", (element) => new Hide(element));\n  }\n\n  constructor(element: Element) {\n    disableInitialTransition(element);\n    showElement(element); // initial state\n\n    const { _show, _hide, _toggle } = getMethods(element);\n    this.do = _hide;\n    this.undo = _show;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n// --------------------\n\nconst getMethods = (element: Element) => {\n  return {\n    _show: async () => {\n      await showElement(element); // ignore return val\n    },\n\n    _hide: async () => {\n      await hideElement(element); // ignore return val\n    },\n\n    _toggle: async () => {\n      await toggleShowElement(element); // ignore return val\n    },\n  };\n};\n","/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { Position } from \"@lisn/globals/types\";\n\n/**\n * @category Validation\n */\nexport const isValidPosition = (position: string): position is Position =>\n  MH.includes(POSITIONS as readonly string[], position);\n\n/**\n * @category Validation\n */\nexport const isValidTwoFoldPosition = (\n  position: string,\n): position is `${Position}-${Position}` =>\n  position.match(TWO_FOLD_POSITION_REGEX) !== null;\n\n/**\n * @ignore\n * @internal\n */\nexport const POSITIONS = [\n  MC.S_TOP,\n  MC.S_BOTTOM,\n  MC.S_LEFT,\n  MC.S_RIGHT,\n] as const;\n\n// --------------------\n\nconst POSITIONS_OPTIONS_STR = \"(\" + POSITIONS.join(\"|\") + \")\";\n\nconst TWO_FOLD_POSITION_REGEX = RegExp(\n  `^${POSITIONS_OPTIONS_STR}-${POSITIONS_OPTIONS_STR}$`,\n);\n","/**\n * @module Widgets\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { settings } from \"@lisn/globals/settings\";\n\nimport { XYDirection, Position } from \"@lisn/globals/types\";\n\nimport {\n  disableInitialTransition,\n  hasClass,\n  addClasses,\n  addClassesNow,\n  removeClasses,\n  removeClassesNow,\n  getData,\n  getBooleanData,\n  setData,\n  setDataNow,\n  setBooleanData,\n  setBooleanDataNow,\n  unsetBooleanData,\n  unsetBooleanDataNow,\n  delData,\n  delDataNow,\n  setHasModal,\n  delHasModal,\n  getStyleProp,\n  setStyleProp,\n  delStyleProp,\n  getComputedStyleProp,\n  getMaxTransitionDuration,\n} from \"@lisn/utils/css-alter\";\nimport {\n  wrapElement,\n  wrapElementNow,\n  moveElement,\n  moveElementNow,\n  replaceElementNow,\n  getOrAssignID,\n} from \"@lisn/utils/dom-alter\";\nimport { waitForInteractive } from \"@lisn/utils/dom-events\";\nimport {\n  waitForMeasureTime,\n  waitForMutateTime,\n} from \"@lisn/utils/dom-optimize\";\nimport { isInlineTag } from \"@lisn/utils/dom-query\";\nimport { addEventListenerTo, removeEventListenerFrom } from \"@lisn/utils/event\";\nimport { logError } from \"@lisn/utils/log\";\nimport { keyWithMaxVal } from \"@lisn/utils/math\";\nimport { toBoolean, toArrayIfSingle } from \"@lisn/utils/misc\";\nimport { waitForDelay } from \"@lisn/utils/tasks\";\nimport { isValidPosition, isValidTwoFoldPosition } from \"@lisn/utils/position\";\nimport { fetchViewportSize } from \"@lisn/utils/size\";\nimport {\n  validateStrList,\n  validateBoolean,\n  validateBooleanOrString,\n  validateString,\n} from \"@lisn/utils/validation\";\n\nimport { wrapCallback } from \"@lisn/modules/callback\";\n\nimport { SizeWatcher, SizeData } from \"@lisn/watchers/size-watcher\";\nimport { ViewWatcher, ViewData } from \"@lisn/watchers/view-watcher\";\n\nimport {\n  Widget,\n  WidgetHandler,\n  WidgetCallback,\n  WidgetConfigValidator,\n  WidgetConfigValidatorObject,\n  registerWidget,\n  getWidgetConfig,\n  getDefaultWidgetSelector,\n} from \"@lisn/widgets/widget\";\n\n/* ********************\n * Base Openable\n * ********************/\n\nexport type OpenableCreateFn<Config extends Record<string, unknown>> = (\n  element: HTMLElement,\n  config?: Config,\n) => Openable;\n\n/**\n * Enables automatic setting up of an {@link Openable} widget from an\n * elements matching its content element selector (`[data-lisn-<name>]` or\n * `.lisn-<name>`).\n *\n * The name you specify here should generally be the same name you pass in\n * {@link OpenableProperties.name | options.name} to the\n * {@link Openable.constructor} but it does not need to be the same.\n *\n * @param name            The name of the openable. Should be in kebab-case.\n * @param newOpenable     Called for every element matching the selector.\n * @param configValidator A validator object, or a function that returns such\n *                        an object, for all options supported by the widget.\n *\n * @see {@link registerWidget}\n */\nexport const registerOpenable = <Config extends Record<string, unknown>>(\n  name: string,\n  newOpenable: OpenableCreateFn<Config>,\n  configValidator?: null | WidgetConfigValidator<Config>,\n) => {\n  registerWidget(\n    name,\n    (element, config) => {\n      if (MH.isHTMLElement(element)) {\n        if (!Openable.get(element)) {\n          return newOpenable(element, config);\n        }\n      } else {\n        logError(MH.usageError(\"Openable widget supports only HTMLElement\"));\n      }\n\n      return null;\n    },\n    configValidator,\n  );\n};\n\n/**\n * {@link Openable} is an abstract base class. You should not directly\n * instantiate it but can inherit it to create your own custom openable widget.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Openable}\n * widget, regardless of type, on a given element. Use {@link Openable.get} to\n * get an existing instance if any. If there is already an {@link Openable}\n * widget of any type on this element, it will be destroyed!\n *\n * @see {@link registerOpenable}\n */\nexport abstract class Openable extends Widget {\n  /**\n   * Opens the widget unless it is disabled.\n   */\n  readonly open: () => Promise<void>;\n\n  /**\n   * Closes the widget.\n   */\n  readonly close: () => Promise<void>;\n\n  /**\n   * Closes the widget if it is open, or opens it if it is closed (unless\n   * it is disabled).\n   */\n  readonly toggle: () => Promise<void>;\n\n  /**\n   * The given handler will be called when the widget is open.\n   *\n   * If it returns a promise, it will be awaited upon.\n   */\n  readonly onOpen: (handler: WidgetHandler) => void;\n\n  /**\n   * The given handler will be called when the widget is closed.\n   *\n   * If it returns a promise, it will be awaited upon.\n   */\n  readonly onClose: (handler: WidgetHandler) => void;\n\n  /**\n   * Returns true if the widget is currently open.\n   */\n  readonly isOpen: () => boolean;\n\n  /**\n   * Returns the root element created by us that wraps the original content\n   * element passed to the constructor. It is located in the content element's\n   * original place.\n   */\n  readonly getRoot: () => HTMLElement;\n\n  /**\n   * Returns the element that was found to be the container. It is the closest\n   * ancestor that has a `lisn-collapsible-container` class, or if no such\n   * ancestor then the immediate parent of the content element.\n   */\n  readonly getContainer: () => HTMLElement | null;\n\n  /**\n   * Returns the trigger elements, if any. Note that these may be wrappers\n   * around the original triggers passed.\n   */\n  readonly getTriggers: () => Element[];\n\n  /**\n   * Returns the trigger elements along with their configuration.\n   */\n  readonly getTriggerConfigs: () => Map<Element, OpenableTriggerConfig>;\n\n  /**\n   * Retrieve an existing widget by its content element or any of its triggers.\n   *\n   * If the element is already part of a configured {@link Openable} widget,\n   * the widget instance is returned. Otherwise `null`.\n   *\n   * Note that trigger elements are not guaranteed to be unique among openable\n   * widgets as the same element can be a trigger for multiple such widgets. If\n   * the element you pass is a trigger, then the last openable widget that was\n   * created for it will be returned.\n   */\n  static get(element: Element): Openable | null {\n    // We manage the instances here since we also map associated elements and\n    // not just the main content element that created the widget.\n    return instances.get(element) ?? null;\n  }\n\n  constructor(element: HTMLElement, properties: OpenableProperties) {\n    super(element);\n\n    const { isModal, isOffcanvas } = properties;\n\n    const openCallbacks = MH.newSet<WidgetCallback>();\n    const closeCallbacks = MH.newSet<WidgetCallback>();\n\n    let isOpen = false;\n\n    // ----------\n\n    const open = async () => {\n      if (this.isDisabled() || isOpen) {\n        return;\n      }\n\n      isOpen = true;\n\n      for (const callback of openCallbacks) {\n        await callback.invoke(this);\n      }\n\n      if (isModal) {\n        setHasModal();\n      }\n\n      await setBooleanData(root, PREFIX_IS_OPEN);\n    };\n\n    // ----------\n\n    const close = async () => {\n      if (this.isDisabled() || !isOpen) {\n        return;\n      }\n\n      isOpen = false;\n\n      for (const callback of closeCallbacks) {\n        await callback.invoke(this);\n      }\n\n      if (isModal) {\n        delHasModal();\n      }\n\n      if (isOffcanvas) {\n        scrollWrapperToTop(); // no need to await\n      }\n\n      await unsetBooleanData(root, PREFIX_IS_OPEN);\n    };\n\n    // ----------\n\n    const scrollWrapperToTop = async () => {\n      // Wait a bit before scrolling since the hiding of the element is animated.\n      // Assume no more than 1s animation time.\n      await waitForDelay(1000);\n      await waitForMeasureTime();\n      MH.elScrollTo(outerWrapper, {\n        top: 0,\n        left: 0,\n      });\n    };\n\n    // --------------------\n\n    this.open = open;\n    this.close = close;\n    this[MC.S_TOGGLE] = () => (isOpen ? close() : open());\n    this.onOpen = (handler) => openCallbacks.add(wrapCallback(handler));\n    this.onClose = (handler) => closeCallbacks.add(wrapCallback(handler));\n    this.isOpen = () => isOpen;\n    this.getRoot = () => root;\n    this.getContainer = () => container;\n    this.getTriggers = () => [...triggers.keys()];\n    this.getTriggerConfigs = () => MH.newMap([...triggers.entries()]);\n\n    this.onDestroy(() => {\n      openCallbacks.clear();\n      closeCallbacks.clear();\n    });\n\n    const { root, container, triggers, outerWrapper } = setupElements(\n      this,\n      element,\n      properties,\n    );\n  }\n}\n\n/**\n * Per-trigger based configuration. Can either be given as an object as the\n * value of the {@link OpenableProperties.triggers} map, or it can be set as a\n * string configuration in the `data-lisn-<name>-trigger` data attribute. See\n * {@link getWidgetConfig} for the syntax.\n *\n * @example\n * ```html\n * <div data-lisn-collapsible-trigger=\"auto-close\n *                                     | icon=right\n *                                     | icon-closed=arrow-down\n *                                     | icon-open=x\"\n * ></div>\n * ```\n *\n * @interface\n */\nexport type OpenableTriggerConfig = {\n  /**\n   * The DOM ID to set on the trigger. Will result in the trigger element, which\n   * could be a wrapper around the original element (as in the case of {@link\n   * Collapsible} you passed, getting this ID.\n   *\n   * **IMPORTANT:** If the trigger element already has an ID and is not being\n   * wrapped, then this will override the ID and it _won't_ be restored on destroy.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * Class name(s) for the trigger. Will result in the trigger element, which\n   * could be a wrapper around the original element you passed, getting these\n   * classes.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * Override the widget's {@link OpenableProperties.autoClose} for this trigger.\n   *\n   * @defaultValue undefined // Widget default\n   */\n  autoClose?: boolean;\n\n  /**\n   * Open the openable when this trigger is hovered.\n   *\n   * If the device is touch and {@link OpenableProperties.autoClose} is enabled,\n   * the widget will be closed shortly after the pointer leaves both the\n   * trigger and the root element.\n   *\n   * @defaultValue false\n   */\n  hover?: boolean;\n\n  /**\n   * Whether to prevent default click action.\n   *\n   * @defaultValue true\n   */\n  preventDefault?: boolean;\n\n  /**\n   * Override the widget's {@link CollapsibleConfig.icon} for this trigger.\n   *\n   * Currently only relevant for {@link Collapsible}s.\n   *\n   * @defaultValue undefined // Widget default\n   */\n  icon?: false | Position;\n\n  /**\n   * Override the widget's {@link CollapsibleConfig.iconClosed} for this\n   * trigger.\n   *\n   * Currently only relevant for {@link Collapsible}s.\n   *\n   * @defaultValue undefined // Widget default\n   */\n  iconClosed?: \"plus\" | `arrow-${XYDirection}`;\n\n  /**\n   * Override the widget's {@link CollapsibleConfig.iconOpen} for this\n   * trigger.\n   *\n   * Currently only relevant for {@link Collapsible}s.\n   *\n   * @defaultValue undefined // Widget default\n   */\n  iconOpen?: \"minus\" | \"x\" | `arrow-${XYDirection}`;\n};\n\n/**\n * @interface\n */\nexport type OpenableProperties = {\n  /**\n   * The name of the _type_ of the openable. Will set the class prefix to\n   * `lisn-<name>`.\n   */\n  name: string;\n\n  /**\n   * The DOM ID to set on the openable. Will result in the top-level root\n   * element that's created by us getting this ID.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * Class name(s) or a list of class names to set on the openable. Will result\n   * in the top-level root element that's created by us getting these classes.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * Whether to auto-close the widget on clicking outside the content element\n   * or on pressing Escape key. Furthermore, if any trigger opens the widget on\n   * {@link OpenableTriggerConfig.hover}, the widget will be closed when the\n   * pointer leaves both the trigger and the root.\n   *\n   * This is true by default for {@link Popup}, {@link Modal} and {@link Offcanvas}.\n   */\n  autoClose: boolean;\n\n  /**\n   * If true, then while the widget is open, the `document.body` will be set to\n   * `overflow: hidden`.\n   *\n   * This is true for {@link Modal}.\n   */\n  isModal: boolean;\n\n  /**\n   * If true, then the content element is assumed to be possibly scrollable and\n   * will be scrolled back to its top after the widget is closed.\n   *\n   * This is true for {@link Modal} and {@link Offcanvas}.\n   */\n  isOffcanvas: boolean;\n\n  /**\n   * Add a close button at the top right.\n   *\n   * This is true by default for {@link Modal} and {@link Offcanvas}.\n   */\n  closeButton: boolean;\n\n  /**\n   * The elements that open the widget when clicked on. You can also pass a map\n   * whose keys are the elements and values are {@link OpenableTriggerConfig}\n   * objects.\n   *\n   * If not given, then the elements that will be used as triggers are\n   * discovered in the following way (`<name>` is what is given as\n   * {@link name}):\n   * 1. If the content element has a `data-lisn-<name>-content-id` attribute,\n   *    then it must be a unique (for the current page) ID. In this case, the\n   *    trigger elements will be any element in the document that has a\n   *    `lisn-<name>-trigger` class or `data-lisn-<name>-trigger` attribute\n   *    and the same `data-lisn-<name>-content-id` attribute.\n   * 2. Otherwise, the closest ancestor that has a `lisn-<name>-container`\n   *    class, or if no such ancestor then the immediate parent of the content\n   *    element, is searched for any elements that have a `lisn-<name>-trigger`\n   *    class or `data-lisn-<name>-trigger` attribute and that do _not_ have a\n   *    `data-lisn-<name>-content-id` attribute, and that are _not_ children of\n   *    the content element.\n   *\n   * @defaultValue undefined\n   */\n  triggers?: Element[] | Map<Element, OpenableTriggerConfig | null>;\n\n  /**\n   * Whether to wrap each trigger in a new element.\n   *\n   * @defaultValue false\n   */\n  wrapTriggers?: boolean;\n\n  /**\n   * Hook to run once the widget is fully setup (which happens asynchronously).\n   *\n   * It is called during \"mutate time\". See {@link waitForMutateTime}.\n   *\n   * @defaultValue undefined\n   */\n  onSetup?: () => void;\n};\n\n/* ********************\n * Collapsible\n * ********************/\n\n/**\n * Configures the given element as a {@link Collapsible} widget.\n *\n * The Collapsible widget sets up the given element to be collapsed and\n * expanded upon activation. Activation can be done manually by calling\n * {@link open} or when clicking on any of the given\n * {@link CollapsibleConfig.triggers | triggers}.\n *\n * **NOTE:** The Collapsible widget always wraps each trigger element in\n * another element in order to allow positioning the icon, if any.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Openable}\n * widget, regardless of type, on a given element. Use {@link Openable.get} to\n * get an existing instance if any. If there is already an {@link Openable}\n * widget of any type on this element, it will be destroyed!\n *\n * -----\n *\n * You can use the following dynamic attributes or CSS properties in your\n * stylesheet:\n *\n * The following dynamic attributes are set on the root element that is created\n * by LISN and has a class `lisn-collapsible__root`:\n * - `data-lisn-is-open`: `\"true\"` or `\"false\"`\n * - `data-lisn-reverse`: `\"true\"` or `\"false\"`\n * - `data-lisn-orientation`: `\"horizontal\"` or `\"vertical\"`\n *\n * The following dynamic attributes are set on each trigger:\n * - `data-lisn-opens-on-hover: `\"true\"` or `\"false\"`\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-collapsible` class or `data-lisn-collapsible` attribute set on the\n *   element that holds the content of the collapsible\n * - `lisn-collapsible-trigger` class or `data-lisn-collapsible-trigger`\n *   attribute set on elements that should act as the triggers.\n *   If using a data attribute, you can configure the trigger via the value\n *   with a similar syntax to the configuration of the openable widget. For\n *   example:\n *   - Set the attribute to `\"hover\"` in order to have this trigger open the\n *     collapsible on hover _in addition to click_.\n *   - Set the attribute to `\"hover|auto-close\"` in order to have this trigger\n *     open the collapsible on hover but and override\n *     {@link CollapsibleConfig.autoClose} with true.\n *\n * When using auto-widgets, the elements that will be used as triggers are\n * discovered in the following way:\n * 1. If the content element has a `data-lisn-collapsible-content-id` attribute,\n *    then it must be a unique (for the current page) ID. In this case, the\n *    trigger elements will be any element in the document that has a\n *    `lisn-collapsible-trigger` class or `data-lisn-collapsible-trigger`\n *    attribute and the same `data-lisn-collapsible-content-id` attribute.\n * 2. Otherwise, the closest ancestor that has a `lisn-collapsible-container`\n *    class, or if no such ancestor then the immediate parent of the content\n *    element, is searched for any elements that have a\n *    `lisn-collapsible-trigger` class or `data-lisn-collapsible-trigger`\n *    attribute and that do _not_ have a `data-lisn-collapsible-content-id`\n *    attribute, and that are _not_ children of the content element.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This defines a simple collapsible with one trigger.\n *\n * ```html\n * <div>\n *   <div class=\"lisn-collapsible-trigger\">Expand</div>\n *   <div class=\"lisn-collapsible\">\n *     Some long content here...\n *   </div>\n * </div>\n * ```\n *\n * @example\n * This defines a collapsible that is partially visible when collapsed, and\n * where the trigger is in a different parent to the content.\n *\n * ```html\n * <div>\n *   <div data-lisn-collapsible-content-id=\"readmore\"\n *        data-lisn-collapsible=\"peek\">\n *     <p>\n *       Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis\n *       viverra faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus\n *       aliquet turpis. Diam potenti egestas dolor auctor nostra vestibulum.\n *       Tempus auctor quis turpis; pulvinar ante ultrices. Netus morbi\n *       imperdiet volutpat litora tellus turpis a. Sociosqu interdum sodales\n *       sapien nulla aptent pellentesque praesent. Senectus magnis\n *       pellentesque; dis porta justo habitant.\n *     </p>\n *\n *     <p>\n *       Imperdiet placerat habitant tristique turpis habitasse ligula pretium\n *       vehicula. Mauris molestie lectus leo aliquam condimentum elit fermentum\n *       tempus nisi. Eget mi vestibulum quisque enim himenaeos. Odio nascetur\n *       vel congue vivamus eleifend ut nascetur. Ultrices quisque non dictumst\n *       risus libero varius tincidunt vel. Suscipit netus maecenas imperdiet\n *       elementum donec maximus suspendisse luctus. Eu velit semper urna sem\n *       ullamcorper nisl turpis hendrerit. Gravida commodo nisl malesuada nibh\n *       ultricies scelerisque hendrerit tempus vehicula. Risus eleifend eros\n *       aliquam turpis elit ridiculus est class.\n *     </p>\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-collapsible-content-id=\"readmore\"\n *        class=\"lisn-collapsible-trigger\">\n *     Read more\n *   </div>\n * </div>\n * ```\n *\n * @example\n * As above, but with all other possible configuration settings set explicitly.\n *\n * ```html\n * <div>\n *   <div data-lisn-collapsible-content-id=\"readmore\"\n *        data-lisn-collapsible=\"peek=50px\n *                               | horizontal=false\n *                               | reverse=false\n *                               | auto-close\n *                               | icon=right\n *                               | icon-closed=arrow-up\"\n *                               | icon-open=arrow-down\">\n *     <p>\n *       Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis\n *       viverra faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus\n *       aliquet turpis. Diam potenti egestas dolor auctor nostra vestibulum.\n *       Tempus auctor quis turpis; pulvinar ante ultrices. Netus morbi\n *       imperdiet volutpat litora tellus turpis a. Sociosqu interdum sodales\n *       sapien nulla aptent pellentesque praesent. Senectus magnis\n *       pellentesque; dis porta justo habitant.\n *     </p>\n *\n *     <p>\n *       Imperdiet placerat habitant tristique turpis habitasse ligula pretium\n *       vehicula. Mauris molestie lectus leo aliquam condimentum elit fermentum\n *       tempus nisi. Eget mi vestibulum quisque enim himenaeos. Odio nascetur\n *       vel congue vivamus eleifend ut nascetur. Ultrices quisque non dictumst\n *       risus libero varius tincidunt vel. Suscipit netus maecenas imperdiet\n *       elementum donec maximus suspendisse luctus. Eu velit semper urna sem\n *       ullamcorper nisl turpis hendrerit. Gravida commodo nisl malesuada nibh\n *       ultricies scelerisque hendrerit tempus vehicula. Risus eleifend eros\n *       aliquam turpis elit ridiculus est class.\n *     </p>\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-collapsible-content-id=\"readmore\"\n *        class=\"lisn-collapsible-trigger\">\n *     Read more\n *   </div>\n * </div>\n * ```\n */\nexport class Collapsible extends Openable {\n  static register() {\n    registerOpenable(\n      WIDGET_NAME_COLLAPSIBLE,\n      (el, config) => new Collapsible(el, config),\n      collapsibleConfigValidator,\n    );\n  }\n\n  constructor(element: HTMLElement, config?: CollapsibleConfig) {\n    const isHorizontal = config?.horizontal;\n    const orientation = isHorizontal ? MC.S_HORIZONTAL : MC.S_VERTICAL;\n\n    const onSetup = () => {\n      // The triggers here are wrappers around the original which will be\n      // replaced by the original on destroy, so no need to clean up this.\n      for (const [\n        trigger,\n        triggerConfig,\n      ] of this.getTriggerConfigs().entries()) {\n        insertCollapsibleIcon(trigger, triggerConfig, this, config);\n        setDataNow(trigger, MC.PREFIX_ORIENTATION, orientation);\n      }\n    };\n\n    super(element, {\n      name: WIDGET_NAME_COLLAPSIBLE,\n      id: config?.id,\n      className: config?.className,\n      autoClose: config?.autoClose ?? false,\n      isModal: false,\n      isOffcanvas: false,\n      closeButton: false,\n      triggers: config?.triggers,\n      wrapTriggers: true,\n      onSetup,\n    });\n\n    const root = this.getRoot();\n    const wrapper = MH.childrenOf(root)[0];\n\n    setData(root, MC.PREFIX_ORIENTATION, orientation);\n    setBooleanData(root, PREFIX_REVERSE, config?.reverse ?? false);\n\n    // -------------------- Transitions\n    disableInitialTransition(element, 100);\n    disableInitialTransition(root, 100);\n    disableInitialTransition(wrapper, 100);\n\n    let disableTransitionTimer: ReturnType<typeof setTimeout> | null = null;\n    const tempEnableTransition = async () => {\n      await removeClasses(root, MC.PREFIX_TRANSITION_DISABLE);\n      await removeClasses(wrapper, MC.PREFIX_TRANSITION_DISABLE);\n\n      if (disableTransitionTimer) {\n        MH.clearTimer(disableTransitionTimer);\n      }\n\n      const transitionDuration = await getMaxTransitionDuration(root);\n      disableTransitionTimer = MH.setTimer(() => {\n        if (this.isOpen()) {\n          addClasses(root, MC.PREFIX_TRANSITION_DISABLE);\n          addClasses(wrapper, MC.PREFIX_TRANSITION_DISABLE);\n          disableTransitionTimer = null;\n        }\n      }, transitionDuration);\n    };\n\n    // Disable transitions except during open/close, so that resizing the\n    // window for example doesn't result in lagging width/height transition.\n    this.onOpen(tempEnableTransition);\n    this.onClose(tempEnableTransition);\n\n    // -------------------- Peek\n    const peek = config?.peek;\n    if (peek) {\n      (async () => {\n        let peekSize: string | null = null;\n        if (MH.isString(peek)) {\n          peekSize = peek;\n        } else {\n          peekSize = await getStyleProp(element, VAR_PEEK_SIZE);\n        }\n\n        addClasses(root, PREFIX_PEEK);\n        if (peekSize) {\n          setStyleProp(root, VAR_PEEK_SIZE, peekSize);\n        }\n      })();\n    }\n\n    // -------------------- Width in horizontal mode\n    if (isHorizontal) {\n      const updateWidth = async () => {\n        const width = await getComputedStyleProp(root, MC.S_WIDTH);\n        await setStyleProp(element, VAR_JS_COLLAPSIBLE_WIDTH, width);\n      };\n\n      MH.setTimer(updateWidth);\n\n      // Save its current width so that if it contains text, it does not\n      // \"collapse\" and end up super tall.\n      this.onClose(updateWidth);\n\n      this.onOpen(async () => {\n        // Update the content width before opening.\n        await updateWidth();\n\n        // Delete the fixed width property soon after opening to allow it to\n        // resize again while it's open.\n        waitForDelay(2000).then(() => {\n          if (this.isOpen()) {\n            delStyleProp(element, VAR_JS_COLLAPSIBLE_WIDTH);\n          }\n        });\n      });\n    }\n  }\n}\n\n/**\n * @interface\n */\nexport type CollapsibleConfig = {\n  /**\n   * The DOM ID to set on the collapsible. Will result in the top-level root\n   * element that's created by us getting this ID.\n   *\n   * Note, this does not replace or affect the\n   * `data-lisn-collapsible-content-id` attribute used to link triggers to the\n   * collapsible.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * Class name(s) or a list of class names to set on the collapsible. Will\n   * result in the top-level root element that's created by us getting these\n   * classes.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * The elements that open the widget when clicked on. You can also pass a map\n   * whose keys are the elements and values are {@link OpenableTriggerConfig}\n   * objects.\n   *\n   * If not given, then the elements that will be used as triggers are\n   * discovered in the following way:\n   * 1. If the content element has a `data-lisn-collapsible-content-id`\n   *    attribute, then it must be a unique (for the current page) ID. In this\n   *    case, the trigger elements will be any element in the document that\n   *    has a `lisn-collapsible-trigger` class or\n   *    `data-lisn-collapsible-trigger` attribute and the same\n   *    `data-lisn-collapsible-content-id` attribute.\n   * 2. Otherwise, the closest ancestor that has a `lisn-collapsible-container`\n   *    class, or if no such ancestor then the immediate parent of the content\n   *    element, is searched for any elements that have a\n   *    `lisn-collapsible-trigger` class or `data-lisn-collapsible-trigger`\n   *    attribute and that do _not_ have a `data-lisn-collapsible-content-id`\n   *    attribute, and that are _not_ children of the content element.\n   *\n   * @defaultValue undefined\n   */\n  triggers?: Element[] | Map<Element, OpenableTriggerConfig | null>;\n\n  /**\n   * Open sideways (to the right) instead of downwards (default).\n   *\n   * **IMPORTANT:** In horizontal mode the width of the content element should\n   * not be set (or be `auto`), but you can use `min-width` or `max-width` in\n   * your CSS if needed.\n   *\n   * @defaultValue false\n   */\n  horizontal?: boolean;\n\n  /**\n   * Open to the left if horizontal or upwards if vertical.\n   *\n   * @defaultValue false\n   */\n  reverse?: boolean;\n\n  /**\n   * If not false, part of the content will be visible when the collapsible is\n   * closed. The value can be any valid CSS width specification.\n   *\n   * If you set this to `true`, then the size of the peek window will be\n   * dictated by CSS. By default the size is 100px, but you can change this by\n   * setting `--lisn-peek-size` CSS property on the content element or any of\n   * its ancestors.\n   *\n   * Otherwise, if the value is a string, it must be a CSS length including units.\n   *\n   * @defaultValue false\n   */\n  peek?: boolean | string;\n\n  /**\n   * Automatically close the collapsible when clicking outside it or pressing\n   * Escape. Furthermore, if any trigger opens the widget on\n   * {@link OpenableTriggerConfig.hover}, the widget will be closed when the\n   * pointer leaves both the trigger and the root.\n   *\n   * @defaultValue false\n   */\n  autoClose?: boolean;\n\n  /**\n   * Add an icon to each trigger.\n   *\n   * If set to something other than `false`, then by default the icon in the\n   * closed state is a plus (+) and in the open state it's a minus (-), but\n   * this can be configured with {@link iconClosed} and {@link iconOpen}.\n   *\n   * @defaultValue false\n   */\n  icon?: false | Position;\n\n  /**\n   * Set the type of icon used on the trigger(s) in the closed state.\n   *\n   * Note that {@link icon} must be set to something other than `false`.\n   *\n   * @defaultValue \"plus\"\n   */\n  iconClosed?: \"plus\" | `arrow-${XYDirection}`;\n\n  /**\n   * Set the type of icon used on the trigger(s) in the open state.\n   *\n   * Note that {@link icon} must be set to something other than `false`.\n   *\n   * @defaultValue \"minus\";\n   */\n  iconOpen?: \"minus\" | \"x\" | `arrow-${XYDirection}`;\n};\n\n/* ********************\n * Popup\n * ********************/\n\n/**\n * Configures the given element as a {@link Popup} widget.\n *\n * The Popup widget sets up the given element to be hidden and open in a\n * floating popup upon activation. Activation can be done manually by calling\n * {@link open} or when clicking on any of the given\n * {@link PopupConfig.triggers | triggers}.\n *\n * **IMPORTANT:** The popup is positioned absolutely in its container and the\n * position is relative to the container. The container gets `width:\n * fit-content` by default but you can override this in your CSS. The popup\n * also gets a configurable `min-width` set.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Openable}\n * widget, regardless of type, on a given element. Use {@link Openable.get} to\n * get an existing instance if any. If there is already an {@link Openable}\n * widget of any type on this element, it will be destroyed!\n *\n * -----\n *\n * You can use the following dynamic attributes or CSS properties in your\n * stylesheet:\n *\n * The following dynamic attributes are set on the root element that is created\n * by LISN and has a class `lisn-popup__root`:\n * - `data-lisn-is-open`: `\"true\"` or `\"false\"`\n * - `data-lisn-place`: the actual position (top, bottom, left, top-left, etc)\n *\n * The following dynamic attributes are set on each trigger:\n * - `data-lisn-opens-on-hover: `\"true\"` or `\"false\"`\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-popup` class or `data-lisn-popup` attribute set on the element that\n *   holds the content of the popup\n * - `lisn-popup-trigger` class or `data-lisn-popup-trigger`\n *   attribute set on elements that should act as the triggers.\n *   If using a data attribute, you can configure the trigger via the value\n *   with a similar syntax to the configuration of the openable widget. For\n *   example:\n *   - Set the attribute to `\"hover\"` in order to have this trigger open the\n *     popup on hover _in addition to click_.\n *   - Set the attribute to `\"hover|auto-close=false\"` in order to have this\n *     trigger open the popup on hover but and override\n *     {@link PopupConfig.autoClose} with true.\n *\n * When using auto-widgets, the elements that will be used as triggers are\n * discovered in the following way:\n * 1. If the content element has a `data-lisn-popup-content-id` attribute, then\n *    it must be a unique (for the current page) ID. In this case, the trigger\n *    elements will be any element in the document that has a\n *    `lisn-popup-trigger` class or `data-lisn-popup-trigger` attribute and the\n *    same `data-lisn-popup-content-id` attribute.\n * 2. Otherwise, the closest ancestor that has a `lisn-popup-container` class,\n *    or if no such ancestor then the immediate parent of the content element,\n *    is searched for any elements that have a `lisn-popup-trigger` class or\n *    `data-lisn-popup-trigger` attribute and that do _not_ have a\n *    `data-lisn-popup-content-id` attribute, and that are _not_ children of\n *    the content element.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This defines a simple popup with one trigger.\n *\n * ```html\n * <div>\n *   <div class=\"lisn-popup-trigger\">Open</div>\n *   <div class=\"lisn-popup\">\n *     Some content here...\n *   </div>\n * </div>\n * ```\n *\n * @example\n * This defines a popup that has a close button, and where the trigger is in a\n * different parent to the content.\n *\n * ```html\n * <div>\n *   <div data-lisn-popup-content-id=\"popup\"\n *        data-lisn-popup=\"close-button\">\n *     Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis viverra\n *     faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus aliquet\n *     turpis. Diam potenti egestas dolor auctor nostra vestibulum. Tempus\n *     auctor quis turpis; pulvinar ante ultrices. Netus morbi imperdiet\n *     volutpat litora tellus turpis a. Sociosqu interdum sodales sapien nulla\n *     aptent pellentesque praesent. Senectus magnis pellentesque; dis porta\n *     justo habitant.\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-popup-content-id=\"popup\" class=\"lisn-popup-trigger\">\n *     Open\n *   </div>\n * </div>\n * ```\n *\n * @example\n * As above, but with all possible configuration settings set explicitly.\n *\n * ```html\n * <div>\n *   <div data-lisn-popup-content-id=\"popup\" class=\"lisn-popup-trigger\">\n *     Open\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-popup-content-id=\"popup\"\n *        data-lisn-popup=\"close-button | position=bottom | auto-close=false\">\n *     Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis viverra\n *     faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus aliquet\n *     turpis. Diam potenti egestas dolor auctor nostra vestibulum. Tempus\n *     auctor quis turpis; pulvinar ante ultrices. Netus morbi imperdiet\n *     volutpat litora tellus turpis a. Sociosqu interdum sodales sapien nulla\n *     aptent pellentesque praesent. Senectus magnis pellentesque; dis porta\n *     justo habitant.\n *   </div>\n * </div>\n * ```\n */\nexport class Popup extends Openable {\n  static register() {\n    registerOpenable(\n      WIDGET_NAME_POPUP,\n      (el, config) => new Popup(el, config),\n      popupConfigValidator,\n    );\n  }\n\n  constructor(element: HTMLElement, config?: PopupConfig) {\n    super(element, {\n      name: WIDGET_NAME_POPUP,\n      id: config?.id,\n      className: config?.className,\n      autoClose: config?.autoClose ?? true,\n      isModal: false,\n      isOffcanvas: false,\n      closeButton: config?.closeButton ?? false,\n      triggers: config?.triggers,\n    });\n\n    const root = this.getRoot();\n    const container = this.getContainer();\n\n    const position = config?.position || S_AUTO;\n    if (position !== S_AUTO) {\n      setData(root, MC.PREFIX_PLACE, position);\n    }\n\n    if (container && position === S_AUTO) {\n      // Automatic position\n      this.onOpen(async () => {\n        const [contentSize, containerView] = await MH.promiseAll([\n          SizeWatcher.reuse().fetchCurrentSize(element),\n          ViewWatcher.reuse().fetchCurrentView(container),\n        ]);\n\n        const placement = await fetchPopupPlacement(contentSize, containerView);\n        if (placement) {\n          await setData(root, MC.PREFIX_PLACE, placement);\n        }\n      });\n    }\n  }\n}\n\n/**\n * @interface\n */\nexport type PopupConfig = {\n  /**\n   * The DOM ID to set on the popup. Will result in the top-level root element\n   * that's created by us getting this ID.\n   *\n   * Note, this does not replace or affect the `data-lisn-popup-content-id`\n   * attribute used to link triggers to the popup.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * Class name(s) or a list of class names to set on the popup. Will result in\n   * the top-level root element that's created by us getting these classes.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * The elements that open the widget when clicked on. You can also pass a map\n   * whose keys are the elements and values are {@link OpenableTriggerConfig}\n   * objects.\n   *\n   * If not given, then the elements that will be used as triggers are\n   * discovered in the following way:\n   * 1. If the content element has a `data-lisn-popup-content-id` attribute,\n   *    then it must be a unique (for the current page) ID. In this case, the\n   *    trigger elements will be any element in the document that has a\n   *    `lisn-popup-trigger` class or `data-lisn-popup-trigger` attribute and\n   *    the same `data-lisn-popup-content-id` attribute.\n   * 2. Otherwise, the closest ancestor that has a `lisn-popup-container` class,\n   *    or if no such ancestor then the immediate parent of the content\n   *    element, is searched for any elements that have a `lisn-popup-trigger`\n   *    class or `data-lisn-popup-trigger` attribute and that do _not_ have a\n   *    `data-lisn-popup-content-id` attribute, and that are _not_ children of\n   *    the content element.\n   *\n   * @defaultValue undefined\n   */\n  triggers?: Element[] | Map<Element, OpenableTriggerConfig | null>;\n\n  /**\n   * Add a close button at the top right.\n   *\n   * @defaultValue false\n   */\n  closeButton?: boolean;\n\n  /**\n   * Specify the popup position _relative to its container_. Supported\n   * positions include `\"top\"`, `\"bottom\"`, `\"left\"`, `\"right\" `(which result\n   * on the popup being placed on top, bottom, etc, but center-aligned), or\n   * `\"top-left\"`, `\"left-top\"`, etc, as well as `\"auto\"`. If set to `\"auto\"`,\n   * then popup position will be based on the container position within the\n   * viewport at the time it's open.\n   *\n   * @defaultValue \"auto\"\n   */\n  position?: Position | `${Position}-${Position}` | \"auto\";\n\n  /**\n   * Automatically close the popup when clicking outside it or pressing Escape.\n   * Furthermore, if any trigger opens the widget on\n   * {@link OpenableTriggerConfig.hover}, the widget will be closed when the\n   * pointer leaves both the trigger and the root.\n   *\n   * @defaultValue true\n   */\n  autoClose?: boolean;\n};\n\n/* ********************\n * Modal\n * ********************/\n\n/**\n * Configures the given element as a {@link Modal} widget.\n *\n * The Modal widget sets up the given element to be hidden and open in a fixed\n * full-screen modal popup upon activation. Activation can be done manually by\n * calling {@link open} or when clicking on any of the given\n * {@link ModalConfig.triggers | triggers}.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Openable}\n * widget, regardless of type, on a given element. Use {@link Openable.get} to\n * get an existing instance if any. If there is already an {@link Openable}\n * widget of any type on this element, it will be destroyed!\n *\n * -----\n *\n * You can use the following dynamic attributes or CSS properties in your\n * stylesheet:\n *\n * The following dynamic attributes are set on the root element that is created\n * by LISN and has a class `lisn-modal__root`:\n * - `data-lisn-is-open`: `\"true\"` or `\"false\"`\n *\n * The following dynamic attributes are set on each trigger:\n * - `data-lisn-opens-on-hover: `\"true\"` or `\"false\"`\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-modal` class or `data-lisn-modal` attribute set on the element that\n *   holds the content of the modal\n * - `lisn-modal-trigger` class or `data-lisn-modal-trigger`\n *   attribute set on elements that should act as the triggers.\n *   If using a data attribute, you can configure the trigger via the value\n *   with a similar syntax to the configuration of the openable widget. For\n *   example:\n *   - Set the attribute to `\"hover\"` in order to have this trigger open the\n *     modal on hover _in addition to click_.\n *   - Set the attribute to `\"hover|auto-close=false\"` in order to have this\n *     trigger open the modal on hover but and override\n *     {@link ModalConfig.autoClose} with true.\n *\n * When using auto-widgets, the elements that will be used as triggers are\n * discovered in the following way:\n * 1. If the content element has a `data-lisn-modal-content-id` attribute, then\n *    it must be a unique (for the current page) ID. In this case, the trigger\n *    elements will be any element in the document that has a\n *    `lisn-modal-trigger` class or `data-lisn-modal-trigger` attribute and the\n *    same `data-lisn-modal-content-id` attribute.\n * 2. Otherwise, the closest ancestor that has a `lisn-modal-container` class,\n *    or if no such ancestor then the immediate parent of the content element,\n *    is searched for any elements that have a `lisn-modal-trigger` class or\n *    `data-lisn-modal-trigger` attribute and that do _not_ have a\n *    `data-lisn-modal-content-id` attribute, and that are _not_ children of\n *    the content element.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This defines a simple modal with one trigger.\n *\n * ```html\n * <div>\n *   <div class=\"lisn-modal-trigger\">Open</div>\n *   <div class=\"lisn-modal\">\n *     Some content here...\n *   </div>\n * </div>\n * ```\n *\n * @example\n * This defines a modal that doesn't automatically close on click outside or\n * Escape and, and that has several triggers in a different parent to the\n * content.\n *\n * ```html\n * <div>\n *   <div data-lisn-modal-content-id=\"modal\"\n *        data-lisn-modal=\"auto-close=false\">\n *     Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis viverra\n *     faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus aliquet\n *     turpis. Diam potenti egestas dolor auctor nostra vestibulum. Tempus\n *     auctor quis turpis; pulvinar ante ultrices. Netus morbi imperdiet\n *     volutpat litora tellus turpis a. Sociosqu interdum sodales sapien nulla\n *     aptent pellentesque praesent. Senectus magnis pellentesque; dis porta\n *     justo habitant.\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-modal-content-id=\"modal\" class=\"lisn-modal-trigger\">\n *     Open\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-modal-content-id=\"modal\" class=\"lisn-modal-trigger\">\n *     Another trigger\n *   </div>\n * </div>\n * ```\n *\n * @example\n * As above, but with all possible configuration settings set explicitly.\n *\n * ```html\n * <div>\n *   <div data-lisn-modal-content-id=\"modal\"\n *        data-lisn-modal=\"auto-close=false | close-button=true\">\n *     Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis viverra\n *     faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus aliquet\n *     turpis. Diam potenti egestas dolor auctor nostra vestibulum. Tempus\n *     auctor quis turpis; pulvinar ante ultrices. Netus morbi imperdiet\n *     volutpat litora tellus turpis a. Sociosqu interdum sodales sapien nulla\n *     aptent pellentesque praesent. Senectus magnis pellentesque; dis porta\n *     justo habitant.\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-modal-content-id=\"modal\" class=\"lisn-modal-trigger\">\n *     Open\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-modal-content-id=\"modal\" class=\"lisn-modal-trigger\">\n *     Another trigger\n *   </div>\n * </div>\n * ```\n */\nexport class Modal extends Openable {\n  static register() {\n    registerOpenable(\n      WIDGET_NAME_MODAL,\n      (el, config) => new Modal(el, config),\n      modalConfigValidator,\n    );\n  }\n\n  constructor(element: HTMLElement, config?: ModalConfig) {\n    super(element, {\n      name: WIDGET_NAME_MODAL,\n      id: config?.id,\n      className: config?.className,\n      autoClose: config?.autoClose ?? true,\n      isModal: true,\n      isOffcanvas: true,\n      closeButton: config?.closeButton ?? true,\n      triggers: config?.triggers,\n    });\n  }\n}\n\n/**\n * @interface\n */\nexport type ModalConfig = {\n  /**\n   * The DOM ID to set on the modal. Will result in the top-level root element\n   * that's created by us getting this ID.\n   *\n   * Note, this does not replace or affect the `data-lisn-modal-content-id`\n   * attribute used to link triggers to the modal.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * Class name(s) or a list of class names to set on the modal. Will result in\n   * the top-level root element that's created by us getting these classes.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * The elements that open the widget when clicked on. You can also pass a map\n   * whose keys are the elements and values are {@link OpenableTriggerConfig}\n   * objects.\n   *\n   * If not given, then the elements that will be used as triggers are\n   * discovered in the following way:\n   * 1. If the content element has a `data-lisn-modal-content-id` attribute,\n   *    then it must be a unique (for the current page) ID. In this case, the\n   *    trigger elements will be any element in the document that has a\n   *    `lisn-modal-trigger` class or `data-lisn-modal-trigger` attribute and\n   *    the same `data-lisn-modal-content-id` attribute.\n   * 2. Otherwise, the closest ancestor that has a `lisn-modal-container` class,\n   *    or if no such ancestor then the immediate parent of the content\n   *    element, is searched for any elements that have a `lisn-modal-trigger`\n   *    class or `data-lisn-modal-trigger` attribute and that do _not_ have a\n   *    `data-lisn-modal-content-id` attribute, and that are _not_ children of\n   *    the content element.\n   *\n   * @defaultValue undefined\n   */\n  triggers?: Element[] | Map<Element, OpenableTriggerConfig | null>;\n\n  /**\n   * Add a close button at the top right.\n   *\n   * @defaultValue true\n   */\n  closeButton?: boolean;\n\n  /**\n   * Automatically close the modal when clicking outside it or pressing Escape.\n   * Furthermore, if any trigger opens the widget on\n   * {@link OpenableTriggerConfig.hover}, the widget will be closed when the\n   * pointer leaves both the trigger and the root.\n   *\n   * If you set this to false, then you should ensure {@link closeButton} is\n   * enabled.\n   *\n   * @defaultValue true\n   */\n  autoClose?: boolean;\n};\n\n/* ********************\n * Offcanvas\n * ********************/\n\n/**\n * Configures the given element as a {@link Offcanvas} widget.\n *\n * The Offcanvas widget sets up the given element to be hidden and open in a\n * fixed overlay (non full-screen) upon activation. Activation can be done\n * manually by calling {@link open} or when clicking on any of the given\n * {@link OffcanvasConfig.triggers | triggers}.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Openable}\n * widget, regardless of type, on a given element. Use {@link Openable.get} to\n * get an existing instance if any. If there is already an {@link Openable}\n * widget of any type on this element, it will be destroyed!\n *\n * -----\n *\n * You can use the following dynamic attributes or CSS properties in your\n * stylesheet:\n *\n * The following dynamic attributes are set on the root element that is created\n * by LISN and has a class `lisn-offcanvas__root`:\n * - `data-lisn-is-open`: `\"true\"` or `\"false\"`\n * - `data-lisn-place`: the actual position `\"top\"`, `\"bottom\"`, `\"left\"` or\n *   `\"right\"`\n *\n * The following dynamic attributes are set on each trigger:\n * - `data-lisn-opens-on-hover: `\"true\"` or `\"false\"`\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-offcanvas` class or `data-lisn-offcanvas` attribute set on the\n *   element that holds the content of the offcanvas\n * - `lisn-offcanvas-trigger` class or `data-lisn-offcanvas-trigger`\n *   attribute set on elements that should act as the triggers.\n *   If using a data attribute, you can configure the trigger via the value\n *   with a similar syntax to the configuration of the openable widget. For\n *   example:\n *   - Set the attribute to `\"hover\"` in order to have this trigger open the\n *     offcanvas on hover _in addition to click_.\n *   - Set the attribute to `\"hover|auto-close=false\"` in order to have this\n *     trigger open the offcanvas on hover but and override\n *     {@link OffcanvasConfig.autoClose} with true.\n *\n * When using auto-widgets, the elements that will be used as triggers are\n * discovered in the following way:\n * 1. If the content element has a `data-lisn-offcanvas-content-id` attribute,\n *    then it must be a unique (for the current page) ID. In this case, the\n *    trigger elements will be any element in the document that has a\n *    `lisn-offcanvas-trigger` class or `data-lisn-offcanvas-trigger` attribute\n *    and the same `data-lisn-offcanvas-content-id` attribute.\n * 2. Otherwise, the closest ancestor that has a `lisn-offcanvas-container`\n *    class, or if no such ancestor then the immediate parent of the content\n *    element, is searched for any elements that have a\n *    `lisn-offcanvas-trigger` class or `data-lisn-offcanvas-trigger` attribute\n *    and that do _not_ have a `data-lisn-offcanvas-content-id`\n *    attribute, and that are _not_ children of the content element.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This defines a simple offcanvas with one trigger.\n *\n * ```html\n * <div>\n *   <div class=\"lisn-offcanvas-trigger\">Open</div>\n *   <div class=\"lisn-offcanvas\">\n *     Some content here...\n *   </div>\n * </div>\n * ```\n *\n * @example\n * This defines a offcanvas that doesn't automatically close on click outside\n * or Escape and, and that has several triggers in a different parent to the\n * content.\n *\n * ```html\n * <div>\n *   <div data-lisn-offcanvas-content-id=\"offcanvas\"\n *        data-lisn-offcanvas=\"auto-close=false\">\n *     Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis viverra\n *     faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus aliquet\n *     turpis. Diam potenti egestas dolor auctor nostra vestibulum. Tempus\n *     auctor quis turpis; pulvinar ante ultrices. Netus morbi imperdiet\n *     volutpat litora tellus turpis a. Sociosqu interdum sodales sapien nulla\n *     aptent pellentesque praesent. Senectus magnis pellentesque; dis porta\n *     justo habitant.\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-offcanvas-content-id=\"offcanvas\" class=\"lisn-offcanvas-trigger\">\n *     Open\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-offcanvas-content-id=\"offcanvas\" class=\"lisn-offcanvas-trigger\">\n *     Another trigger\n *   </div>\n * </div>\n * ```\n *\n * @example\n * As above, but with all possible configuration settings set explicitly.\n *\n * ```html\n * <div>\n *   <div data-lisn-offcanvas-content-id=\"offcanvas\"\n *        data-lisn-offcanvas=\"position=top | auto-close=false | close-button=true\">\n *     Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis viverra\n *     faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus aliquet\n *     turpis. Diam potenti egestas dolor auctor nostra vestibulum. Tempus\n *     auctor quis turpis; pulvinar ante ultrices. Netus morbi imperdiet\n *     volutpat litora tellus turpis a. Sociosqu interdum sodales sapien nulla\n *     aptent pellentesque praesent. Senectus magnis pellentesque; dis porta\n *     justo habitant.\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-offcanvas-content-id=\"offcanvas\" class=\"lisn-offcanvas-trigger\">\n *     Open\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-offcanvas-content-id=\"offcanvas\" class=\"lisn-offcanvas-trigger\">\n *     Another trigger\n *   </div>\n * </div>\n * ```\n */\nexport class Offcanvas extends Openable {\n  static register() {\n    registerOpenable(\n      WIDGET_NAME_OFFCANVAS,\n      (el, config) => new Offcanvas(el, config),\n      offcanvasConfigValidator,\n    );\n  }\n\n  constructor(element: HTMLElement, config?: OffcanvasConfig) {\n    super(element, {\n      name: WIDGET_NAME_OFFCANVAS,\n      id: config?.id,\n      className: config?.className,\n      autoClose: config?.autoClose ?? true,\n      isModal: false,\n      isOffcanvas: true,\n      closeButton: config?.closeButton ?? true,\n      triggers: config?.triggers,\n    });\n\n    const position = config?.position || MC.S_RIGHT;\n    setData(this.getRoot(), MC.PREFIX_PLACE, position);\n  }\n}\n\n/**\n * @interface\n */\nexport type OffcanvasConfig = {\n  /**\n   * The DOM ID to set on the offcanvas. Will result in the top-level root\n   * element that's created by us getting this ID.\n   *\n   * Note, this does not replace or affect the `data-lisn-offcanvas-content-id`\n   * attribute used to link triggers to the offcanvas.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * Class name(s) or a list of class names to set on the offcanvas. Will result\n   * in the top-level root element that's created by us getting these classes.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * The elements that open the widget when clicked on. You can also pass a map\n   * whose keys are the elements and values are {@link OpenableTriggerConfig}\n   * objects.\n   *\n   * If not given, then the elements that will be used as triggers are\n   * discovered in the following way:\n   * 1. If the content element has a `data-lisn-offcanvas-content-id` attribute,\n   *    then it must be a unique (for the current page) ID. In this case, the\n   *    trigger elements will be any element in the document that has a\n   *    `lisn-offcanvas-trigger` class or `data-lisn-offcanvas-trigger`\n   *    attribute and the same `data-lisn-offcanvas-content-id` attribute.\n   * 2. Otherwise, the closest ancestor that has a `lisn-offcanvas-container`\n   *    class, or if no such ancestor then the immediate parent of the content\n   *    element, is searched for any elements that have a\n   *    `lisn-offcanvas-trigger` class or `data-lisn-offcanvas-trigger`\n   *    attribute and that do _not_ have a `data-lisn-offcanvas-content-id`\n   *    attribute, and that are _not_ children of the content element.\n   *\n   * @defaultValue undefined\n   */\n  triggers?: Element[] | Map<Element, OpenableTriggerConfig | null>;\n\n  /**\n   * Specify the offcanvas position. Supported positions are top, bottom, left,\n   * right.\n   *\n   * @defaultValue \"right\"\n   */\n  position?: Position;\n\n  /**\n   * Add a close button at the top right.\n   *\n   * @defaultValue true\n   */\n  closeButton?: boolean;\n\n  /**\n   * Automatically close the offcanvas when clicking outside it or pressing\n   * Escape. Furthermore, if any trigger opens the widget on\n   * {@link OpenableTriggerConfig.hover}, the widget will be closed when the\n   * pointer leaves both the trigger and the root.\n   *\n   * @defaultValue true\n   */\n  autoClose?: boolean;\n};\n\n// ------------------------------\n\ntype ElementsCollection = {\n  content: HTMLElement;\n  root: HTMLElement;\n  container: HTMLElement | null;\n  outerWrapper: HTMLElement;\n  triggers: Map<Element, OpenableTriggerConfig>;\n};\n\nconst instances = MH.newWeakMap<Element, Openable>();\n\nconst WIDGET_NAME_COLLAPSIBLE = \"collapsible\";\nconst WIDGET_NAME_POPUP = \"popup\";\nconst WIDGET_NAME_MODAL = \"modal\";\nconst WIDGET_NAME_OFFCANVAS = \"offcanvas\";\n\nconst PREFIX_CLOSE_BTN = MH.prefixName(\"close-button\");\nconst PREFIX_IS_OPEN = MH.prefixName(\"is-open\");\nconst PREFIX_REVERSE = MH.prefixName(MC.S_REVERSE);\nconst PREFIX_PEEK = MH.prefixName(\"peek\");\nconst PREFIX_OPENS_ON_HOVER = MH.prefixName(\"opens-on-hover\");\nconst PREFIX_LINE = MH.prefixName(\"line\");\nconst PREFIX_ICON_POSITION = MH.prefixName(\"icon-position\");\nconst PREFIX_TRIGGER_ICON = MH.prefixName(\"trigger-icon\");\nconst PREFIX_ICON_WRAPPER = MH.prefixName(\"icon-wrapper\");\nconst S_AUTO = \"auto\";\nconst S_ARIA_EXPANDED = MC.ARIA_PREFIX + \"expanded\";\nconst S_ARIA_MODAL = MC.ARIA_PREFIX + \"modal\";\nconst VAR_PEEK_SIZE = MH.prefixCssVar(\"peek-size\");\nconst VAR_JS_COLLAPSIBLE_WIDTH = MH.prefixCssJsVar(\"collapsible-width\");\nconst MIN_CLICK_TIME_AFTER_HOVER_OPEN = 1000;\nconst S_ARROW_UP =\n  `${MC.S_ARROW}-${MC.S_UP}` as `${typeof MC.S_ARROW}-${typeof MC.S_UP}`;\nconst S_ARROW_DOWN =\n  `${MC.S_ARROW}-${MC.S_DOWN}` as `${typeof MC.S_ARROW}-${typeof MC.S_DOWN}`;\nconst S_ARROW_LEFT =\n  `${MC.S_ARROW}-${MC.S_LEFT}` as `${typeof MC.S_ARROW}-${typeof MC.S_LEFT}`;\nconst S_ARROW_RIGHT =\n  `${MC.S_ARROW}-${MC.S_RIGHT}` as `${typeof MC.S_ARROW}-${typeof MC.S_RIGHT}`;\n\nconst ARROW_TYPES = [\n  S_ARROW_UP,\n  S_ARROW_DOWN,\n  S_ARROW_LEFT,\n  S_ARROW_RIGHT,\n] as const;\n\nconst ICON_CLOSED_TYPES = [\"plus\", ...ARROW_TYPES] as const;\nconst ICON_OPEN_TYPES = [\"minus\", \"x\", ...ARROW_TYPES] as const;\ntype IconCloseType = (typeof ICON_CLOSED_TYPES)[number];\ntype IconOpenType = (typeof ICON_OPEN_TYPES)[number];\n\nconst isValidIconClosed = (value: string): value is IconCloseType =>\n  MH.includes(ICON_CLOSED_TYPES, value);\n\nconst isValidIconOpen = (value: string): value is IconOpenType =>\n  MH.includes(ICON_OPEN_TYPES, value);\n\nconst triggerConfigValidator: WidgetConfigValidatorObject<OpenableTriggerConfig> =\n  {\n    id: validateString,\n    className: (key, value) => validateStrList(key, toArrayIfSingle(value)),\n    autoClose: validateBoolean,\n    icon: (key, value) =>\n      value && toBoolean(value) === false\n        ? false\n        : validateString(key, value, isValidPosition),\n    iconClosed: (key, value) => validateString(key, value, isValidIconClosed),\n    iconOpen: (key, value) => validateString(key, value, isValidIconOpen),\n    hover: validateBoolean,\n  };\n\nconst collapsibleConfigValidator: WidgetConfigValidatorObject<CollapsibleConfig> =\n  {\n    id: validateString,\n    className: (key, value) => validateStrList(key, toArrayIfSingle(value)),\n    horizontal: validateBoolean,\n    reverse: validateBoolean,\n    peek: validateBooleanOrString,\n    autoClose: validateBoolean,\n    icon: (key, value) =>\n      toBoolean(value) === false\n        ? false\n        : validateString(key, value, isValidPosition),\n    iconClosed: (key, value) => validateString(key, value, isValidIconClosed),\n    iconOpen: (key, value) => validateString(key, value, isValidIconOpen),\n  };\n\nconst popupConfigValidator: WidgetConfigValidatorObject<PopupConfig> = {\n  id: validateString,\n  className: (key, value) => validateStrList(key, toArrayIfSingle(value)),\n  closeButton: validateBoolean,\n  position: (key, value) =>\n    validateString(\n      key,\n      value,\n      (v) => v === S_AUTO || isValidPosition(v) || isValidTwoFoldPosition(v),\n    ),\n  autoClose: validateBoolean,\n};\n\nconst modalConfigValidator: WidgetConfigValidatorObject<ModalConfig> = {\n  id: validateString,\n  className: (key, value) => validateStrList(key, toArrayIfSingle(value)),\n  closeButton: validateBoolean,\n  autoClose: validateBoolean,\n};\n\nconst offcanvasConfigValidator: WidgetConfigValidatorObject<OffcanvasConfig> = {\n  id: validateString,\n  className: (key, value) => validateStrList(key, toArrayIfSingle(value)),\n  closeButton: validateBoolean,\n  position: (key, value) => validateString(key, value, isValidPosition),\n  autoClose: validateBoolean,\n};\n\nconst getPrefixedNames = (name: string) => {\n  const pref = MH.prefixName(name);\n  return {\n    _root: `${pref}__root`,\n    _overlay: `${pref}__overlay`, // only used for modal/offcanvas\n    _innerWrapper: `${pref}__inner-wrapper`,\n    _outerWrapper: `${pref}__outer-wrapper`,\n    _content: `${pref}__content`,\n    _container: `${pref}__container`,\n    _trigger: `${pref}__trigger`,\n    // Use different classes for styling to the ones used for auto-discovering\n    // elements, so that re-creating existing widgets can correctly find the\n    // elements to be used by the new widget synchronously before the current\n    // one is destroyed.\n    _containerForSelect: `${pref}-container`,\n    _triggerForSelect: `${pref}-trigger`,\n    _contentId: `${pref}-content-id`,\n  };\n};\n\nconst findContainer = (content: Element, cls: string) => {\n  const currWidget = instances.get(content);\n  // If there's an existing widget that we're about to destroy, the content\n  // element will be wrapped in several elements and won't be restored until\n  // the next mutate time. In that case, to correctly determine the container\n  // element, use the current widget's root element, which is located in the\n  // content element's original place.\n  let childRef = currWidget?.getRoot() ?? content;\n  if (!MH.parentOf(childRef)) {\n    // The current widget is not yet initialized (i.e. we are re-creating it\n    // immediately after it was constructed)\n    childRef = content;\n  }\n\n  // Find the content container\n  let container: HTMLElement | null = childRef.closest(`.${cls}`);\n  if (!container) {\n    container = MH.parentOf(childRef);\n  }\n\n  return container;\n};\n\nconst findTriggers = (\n  content: Element,\n  prefixedNames: ReturnType<typeof getPrefixedNames>,\n) => {\n  const container = findContainer(content, prefixedNames._containerForSelect);\n  // jsdom does not like the below selector when suffixed by [data-*] or :not()...\n  // const triggerSelector = `:is(.${prefixedNames._triggerForSelect},[data-${prefixedNames._triggerForSelect}])`;\n  // So use this:\n  const getTriggerSelector = (suffix: string) =>\n    `.${prefixedNames._triggerForSelect}${suffix},` +\n    `[data-${prefixedNames._triggerForSelect}]${suffix}`;\n\n  const contentId = getData(content, prefixedNames._contentId);\n  let triggers: Element[] = [];\n\n  if (contentId) {\n    triggers = [\n      ...MH.docQuerySelectorAll(\n        getTriggerSelector(`[data-${prefixedNames._contentId}=\"${contentId}\"]`),\n      ),\n    ];\n  } else if (container) {\n    triggers = [\n      ...MH.arrayFrom(\n        MH.querySelectorAll(\n          container,\n          getTriggerSelector(`:not([data-${prefixedNames._contentId}])`),\n        ),\n      ).filter((t) => !content.contains(t)),\n    ];\n  }\n\n  return triggers;\n};\n\nconst getTriggersFrom = (\n  content: Element,\n  inputTriggers:\n    | Element[]\n    | Map<Element, OpenableTriggerConfig | null>\n    | undefined,\n  wrapTriggers: boolean,\n  prefixedNames: ReturnType<typeof getPrefixedNames>,\n) => {\n  const triggerMap = MH.newMap<Element, OpenableTriggerConfig>();\n\n  inputTriggers = inputTriggers || findTriggers(content, prefixedNames);\n\n  const addTrigger = (\n    trigger: Element,\n    triggerConfig: OpenableTriggerConfig,\n  ) => {\n    if (wrapTriggers) {\n      const wrapper = MH.createElement(\n        isInlineTag(MH.tagName(trigger)) ? \"span\" : \"div\",\n      );\n      wrapElement(trigger, { wrapper, ignoreMove: true }); // no need to await\n      trigger = wrapper;\n    }\n\n    triggerMap.set(trigger, triggerConfig);\n  };\n\n  if (MH.isArray(inputTriggers)) {\n    for (const trigger of inputTriggers) {\n      addTrigger(\n        trigger,\n        getWidgetConfig(\n          getData(trigger, prefixedNames._triggerForSelect),\n          triggerConfigValidator,\n        ),\n      );\n    }\n  } else if (MH.isInstanceOf(inputTriggers, Map)) {\n    for (const [trigger, triggerConfig] of inputTriggers.entries()) {\n      addTrigger(\n        trigger,\n        getWidgetConfig(triggerConfig, triggerConfigValidator),\n      );\n    }\n  }\n\n  return triggerMap;\n};\n\nconst setupElements = (\n  widget: Openable,\n  content: HTMLElement,\n  properties: OpenableProperties,\n): ElementsCollection => {\n  const prefixedNames = getPrefixedNames(properties.name);\n  const container = findContainer(content, prefixedNames._containerForSelect);\n\n  const wrapTriggers = properties.wrapTriggers ?? false;\n  const triggers = getTriggersFrom(\n    content,\n    properties.triggers,\n    wrapTriggers,\n    prefixedNames,\n  );\n\n  // Create two wrappers\n  const innerWrapper = MH.createElement(\"div\");\n  addClasses(innerWrapper, prefixedNames._innerWrapper);\n\n  const outerWrapper = wrapElementNow(innerWrapper);\n\n  // Setup the root element.\n  // For off-canvas types we need another wrapper to serve as the root and we\n  // need a placeholder element to save the content's original position so it\n  // can be restored on destroy.\n  // Otherwise use outerWrapper for root and insert the root where the content\n  // was.\n  let root: HTMLElement;\n  let placeholder: HTMLElement;\n  if (properties.isOffcanvas) {\n    addClasses(outerWrapper, prefixedNames._outerWrapper);\n    root = wrapElementNow(outerWrapper);\n    placeholder = MH.createElement(\"div\");\n\n    const overlay = MH.createElement(\"div\");\n    addClasses(overlay, prefixedNames._overlay);\n    moveElement(overlay, { to: root });\n  } else {\n    // Otherwise use the outer wrapper as the root\n    root = placeholder = outerWrapper;\n  }\n\n  if (properties.id) {\n    root.id = properties.id;\n  }\n\n  if (properties.className) {\n    addClassesNow(root, ...toArrayIfSingle(properties.className));\n  }\n\n  unsetBooleanData(root, PREFIX_IS_OPEN);\n  const domID = getOrAssignID(root, properties.name);\n\n  if (properties.isModal) {\n    MH.setAttr(root, MC.S_ROLE, \"dialog\");\n    MH.setAttr(root, S_ARIA_MODAL);\n  }\n\n  addClasses(root, prefixedNames._root);\n  disableInitialTransition(root);\n\n  // Add a close button?\n  if (properties.closeButton) {\n    const closeBtn = MH.createButton(\"Close\");\n    addClasses(closeBtn, PREFIX_CLOSE_BTN);\n\n    // If autoClose is true, it will be closed on click anyway, because the\n    // close button is outside the content.\n    addEventListenerTo(closeBtn, MC.S_CLICK, () => {\n      widget.close();\n    });\n\n    moveElement(closeBtn, { to: properties.isOffcanvas ? root : innerWrapper });\n  }\n\n  // Transfer the relevant classes/data attrs from content to root element, so\n  // that our CSS can work without :has.\n  // This won't cause forced layout since the root is not yet attached to the\n  // DOM.\n  for (const cls of [\n    settings.lightThemeClassName,\n    settings.darkThemeClassName,\n  ]) {\n    if (hasClass(content, cls)) {\n      addClasses(root, cls);\n    }\n  }\n\n  const elements = {\n    content,\n    root,\n    container,\n    outerWrapper,\n    triggers,\n  };\n\n  // -------------------- Close / destroy hooks\n  widget.onClose(async () => {\n    for (const trigger of triggers.keys()) {\n      delData(trigger, PREFIX_OPENS_ON_HOVER);\n      MH.unsetAttr(trigger, S_ARIA_EXPANDED);\n      await unsetBooleanData(trigger, PREFIX_IS_OPEN);\n    }\n  });\n\n  widget.onDestroy(async () => {\n    await waitForMutateTime();\n\n    replaceElementNow(placeholder, content, { ignoreMove: true });\n    moveElementNow(root); // remove\n    removeClassesNow(content, prefixedNames._content);\n\n    if (container) {\n      removeClassesNow(container, prefixedNames._container);\n    }\n\n    for (const [trigger, triggerConfig] of triggers.entries()) {\n      MH.delAttr(trigger, MC.S_ARIA_CONTROLS);\n      MH.delAttr(trigger, S_ARIA_EXPANDED);\n\n      delDataNow(trigger, PREFIX_OPENS_ON_HOVER);\n      delDataNow(trigger, PREFIX_IS_OPEN);\n\n      removeClassesNow(\n        trigger,\n        prefixedNames._trigger,\n        ...(triggerConfig?.className || []),\n      );\n\n      if (trigger.id === triggerConfig?.id) {\n        trigger.id = \"\";\n      }\n\n      if (wrapTriggers) {\n        replaceElementNow(trigger, MH.childrenOf(trigger)[0], {\n          ignoreMove: true,\n        });\n      }\n    }\n\n    triggers.clear();\n\n    for (const el of [content, ...triggers.keys()]) {\n      if (instances.get(el) === widget) {\n        MH.deleteKey(instances, el);\n      }\n    }\n  });\n\n  // -------------------- SETUP\n  // Save the elements so we can lookup the instance\n  const currWidget = instances.get(content);\n  for (const el of [content, ...triggers.keys()]) {\n    instances.set(el, widget);\n  }\n\n  // Wait for the DOMWatcher to be active, which may not be before interactive.\n  waitForInteractive()\n    .then(currWidget?.destroy)\n    .then(waitForMutateTime)\n    .then(() => {\n      if (widget.isDestroyed()) {\n        return;\n      }\n\n      addClassesNow(content, prefixedNames._content);\n\n      if (container) {\n        addClassesNow(container, prefixedNames._container);\n      }\n\n      if (properties.isOffcanvas) {\n        moveElementNow(root, {\n          to: MH.getBody(),\n          ignoreMove: true,\n        });\n      }\n\n      // Move the placeholder element to before the content and then move\n      // content into inner wrapper.\n      moveElementNow(placeholder, {\n        // for not-offcanvas it's also the root\n        to: content,\n        position: \"before\",\n        ignoreMove: true,\n      });\n\n      moveElementNow(content, { to: innerWrapper, ignoreMove: true });\n\n      // Setup the triggers\n      for (const [trigger, triggerConfig] of triggers.entries()) {\n        MH.setAttr(trigger, MC.S_ARIA_CONTROLS, domID);\n        MH.unsetAttr(trigger, S_ARIA_EXPANDED);\n\n        setBooleanDataNow(\n          trigger,\n          PREFIX_OPENS_ON_HOVER,\n          triggerConfig[MC.S_HOVER],\n        );\n        unsetBooleanDataNow(trigger, PREFIX_IS_OPEN);\n\n        addClassesNow(\n          trigger,\n          prefixedNames._trigger,\n          ...(triggerConfig?.className || []),\n        );\n\n        if (triggerConfig?.id) {\n          trigger.id = triggerConfig.id;\n        }\n      }\n\n      setupListeners(widget, elements, properties, prefixedNames);\n\n      if (properties.onSetup) {\n        properties.onSetup();\n      }\n    });\n\n  return elements;\n};\n\nconst setupListeners = (\n  widget: Openable,\n  elements: ElementsCollection,\n  properties: OpenableProperties,\n  prefixedNames: ReturnType<typeof getPrefixedNames>,\n) => {\n  const { content, root, triggers } = elements;\n  const doc = MH.getDoc();\n\n  let hoverTimeOpened = 0;\n  let isPointerOver = false;\n  let activeTrigger: Element | null = null;\n\n  // ----------\n\n  const isTrigger = (element: Element) =>\n    MH.includes(\n      MH.arrayFrom(triggers.keys()),\n      element.closest(getDefaultWidgetSelector(prefixedNames._trigger)),\n    );\n\n  const shouldPreventDefault = (trigger: Element) =>\n    triggers.get(trigger)?.preventDefault ?? true;\n\n  const usesHover = (trigger: Element) => triggers.get(trigger)?.hover;\n\n  const usesAutoClose = (trigger: Element | null) =>\n    (trigger ? triggers.get(trigger)?.autoClose : null) ?? properties.autoClose;\n\n  // ----------\n\n  const toggleTrigger = (event: Event, openIt?: boolean) => {\n    const trigger = MH.currentTargetOf(event);\n    if (MH.isElement(trigger)) {\n      if (shouldPreventDefault(trigger)) {\n        MH.preventDefault(event);\n      }\n\n      // If a click was fired shortly after opening on hover, ignore\n      if (\n        openIt !== false && // not explicitly asked to close\n        widget.isOpen() &&\n        MH.timeSince(hoverTimeOpened) < MIN_CLICK_TIME_AFTER_HOVER_OPEN\n      ) {\n        return;\n      }\n\n      if (openIt ?? !widget.isOpen()) {\n        // open it\n        activeTrigger = trigger;\n        MH.setAttr(trigger, S_ARIA_EXPANDED); // will be unset on close\n        setBooleanData(trigger, PREFIX_IS_OPEN); // will be unset on close\n\n        widget.open(); // no need to await\n\n        if (usesAutoClose(trigger)) {\n          if (usesHover(trigger)) {\n            addEventListenerTo(root, MC.S_POINTERENTER, setIsPointerOver);\n            addEventListenerTo(root, MC.S_POINTERLEAVE, pointerLeft);\n          }\n\n          // auto-close listeners setup by the onOpen handler below\n        }\n      } else {\n        widget.close(); // out onClose handler below will remove listeners\n      }\n    }\n  };\n\n  // ----------\n\n  const setIsPointerOver = () => {\n    isPointerOver = true;\n  };\n\n  // ----------\n\n  const unsetIsPointerOver = (event: Event) => {\n    // Keep it set to true if this is a touch pointer type; otherwise unset\n    isPointerOver = isPointerOver && MH.isTouchPointerEvent(event);\n  };\n\n  // ----------\n\n  const pointerEntered = (event: Event) => {\n    setIsPointerOver();\n    if (!widget.isOpen()) {\n      hoverTimeOpened = MH.timeNow();\n      toggleTrigger(event, true);\n    }\n  };\n\n  // ----------\n\n  const pointerLeft = (event: Event) => {\n    unsetIsPointerOver(event);\n    const trigger = MH.currentTargetOf(event);\n    if (MH.isElement(trigger) && usesAutoClose(trigger)) {\n      MH.setTimer(\n        () => {\n          if (!isPointerOver) {\n            widget.close();\n          }\n        },\n        // use a delay that allows the mouse to move from trigger to content\n        // without closing it\n        // TODO make this user-configurable\n        properties.isOffcanvas ? 300 : 50,\n      );\n    }\n  };\n\n  // ----------\n\n  const closeIfEscape = (event: Event) => {\n    if ((event as KeyboardEvent).key === \"Escape\") {\n      widget.close(); // no need to await\n    }\n  };\n\n  // ----------\n\n  const closeIfClickOutside = (event: Event) => {\n    const target = MH.targetOf(event);\n    if (\n      target === doc ||\n      (MH.isElement(target) &&\n        !content.contains(target) && // outside content\n        !isTrigger(target)) // handled by pointer watcher\n    ) {\n      widget.close();\n    }\n  };\n\n  // ----------\n\n  const maybeSetupAutoCloseListeners = (\n    trigger: Element | null,\n    remove: boolean,\n  ) => {\n    if (usesAutoClose(trigger)) {\n      const addOrRemove = remove ? removeEventListenerFrom : addEventListenerTo;\n\n      addOrRemove(doc, \"keyup\", closeIfEscape);\n\n      // Add a short delay so that we don't catch the bubbling of the click event\n      // that opened the widget.\n      MH.setTimer(() => addOrRemove(doc, MC.S_CLICK, closeIfClickOutside), 100);\n\n      if (trigger && usesHover(trigger)) {\n        addOrRemove(trigger, MC.S_POINTERLEAVE, pointerLeft);\n      }\n    }\n  };\n\n  // ----------\n\n  const setupOrCleanup = (remove: boolean) => {\n    const addOrRemove = remove ? removeEventListenerFrom : addEventListenerTo;\n\n    for (const [trigger, triggerConfig] of triggers.entries()) {\n      // Always setup click listeners\n      addOrRemove(trigger, MC.S_CLICK, toggleTrigger);\n\n      if (triggerConfig[MC.S_HOVER]) {\n        addOrRemove(trigger, MC.S_POINTERENTER, pointerEntered);\n      }\n    }\n  };\n\n  // ----------\n\n  setupOrCleanup(false);\n\n  widget.onOpen(() => {\n    maybeSetupAutoCloseListeners(activeTrigger, false); // setup listeners if relevant\n  });\n\n  widget.onClose(() => {\n    hoverTimeOpened = 0;\n    isPointerOver = false;\n\n    removeEventListenerFrom(root, MC.S_POINTERENTER, setIsPointerOver);\n    removeEventListenerFrom(root, MC.S_POINTERLEAVE, pointerLeft);\n\n    maybeSetupAutoCloseListeners(activeTrigger, true); // remove listeners if any\n    activeTrigger = null;\n  });\n\n  widget.onDestroy(() => {\n    setupOrCleanup(true); // remove\n  });\n};\n\n// COLLAPSIBLE ------------------------------\n\nconst insertCollapsibleIcon = (\n  trigger: Element,\n  triggerConfig: OpenableTriggerConfig,\n  widget: Collapsible,\n  widgetConfig: CollapsibleConfig | undefined,\n) => {\n  const iconPosition = triggerConfig.icon ?? widgetConfig?.icon;\n  const iconClosed =\n    (triggerConfig.iconClosed ?? widgetConfig?.iconClosed) || \"plus\";\n  const iconOpen =\n    (triggerConfig.iconOpen ?? widgetConfig?.iconOpen) || \"minus\";\n\n  if (iconPosition) {\n    addClasses(trigger, PREFIX_ICON_WRAPPER);\n    setData(trigger, PREFIX_ICON_POSITION, iconPosition);\n\n    const icon = MH.createElement(\"span\");\n    setDataNow(icon, PREFIX_TRIGGER_ICON, iconClosed);\n\n    for (let l = 0; l < 2; l++) {\n      const line = MH.createElement(\"span\");\n      addClassesNow(line, PREFIX_LINE);\n      moveElementNow(line, { to: icon });\n    }\n\n    moveElement(icon, { to: trigger, ignoreMove: true });\n\n    widget.onOpen(() => {\n      if (getBooleanData(trigger, PREFIX_IS_OPEN)) {\n        setData(icon, PREFIX_TRIGGER_ICON, iconOpen);\n      }\n    });\n\n    widget.onClose(() => {\n      setData(icon, PREFIX_TRIGGER_ICON, iconClosed);\n    });\n  }\n};\n\n// POPUP ------------------------------\n\nconst fetchPopupPlacement = async (\n  contentSize: SizeData,\n  containerView: ViewData,\n) => {\n  const containerPosition = containerView.relative;\n  const containerTop = containerPosition[MC.S_TOP];\n  const containerBottom = containerPosition[MC.S_BOTTOM];\n  const containerLeft = containerPosition[MC.S_LEFT];\n  const containerRight = containerPosition[MC.S_RIGHT];\n  const containerHMiddle = containerPosition.hMiddle;\n  const containerVMiddle = containerPosition.vMiddle;\n  const vpSize = await fetchViewportSize();\n  const popupWidth = contentSize.border[MC.S_WIDTH] / vpSize[MC.S_WIDTH];\n  const popupHeight = contentSize.border[MC.S_HEIGHT] / vpSize[MC.S_HEIGHT];\n\n  // - Find the maximum of these quantities:\n  //   - containerTop - popupHeight:\n  //     the space on top if placed on top-(left|right|)\n  //   - 1 - (containerBottom + popupHeight):\n  //     the space on bottom be if placed on bottom-(left|right|)\n  //   - containerLeft - popupWidth:\n  //     the space on left if placed on left-(top|bottom|)\n  //   - 1 - (containerRight + popupWidth):\n  //     the space on right if placed on right-(top|bottom|)\n  //\n  // This determines the main placement: top|bottom|left|right\n\n  // Then to determine secondary alignment:\n  // - For top/bottom placement, determine horizontal alignment:\n  //   - Find the maximum of these quantities:\n  //     - 1 - (containerLeft + popupWidth):\n  //       the space on right if left-aligned\n  //     - containerRight - popupWidth:\n  //       the space on left if right-aligned\n  //     - min(\n  //           containerHMiddle - popupWidth / 2,\n  //           1 - (containerHMiddle + popupWidth / 2),\n  //       ):\n  //       the minimum of the space on either left or right if center-aligned\n  //\n  // - For left/right placement, determine vertical alignment:\n  //   - Find the maximum of these quantities:\n  //     - 1 - (containerTop + popupHeight):\n  //       the space on bottom if top-aligned\n  //     - containerBottom - popupHeight:\n  //       the space on top if bottom-aligned\n  //     - min(\n  //           containerVMiddle - popupHeight / 2,\n  //           1 - (containerVMiddle + popupHeight / 2),\n  //       ):\n  //       the minimum of the space on either top or bottom if center-aligned\n\n  const placementVars = {\n    top: containerTop - popupHeight,\n    bottom: 1 - (containerBottom + popupHeight),\n    left: containerLeft - popupWidth,\n    right: 1 - (containerRight + popupWidth),\n  };\n\n  const placement = keyWithMaxVal(placementVars);\n  if (placement === undefined) {\n    // container must be out-view and so left/right are NaN\n    return;\n  }\n  let finalPlacement = placement;\n\n  let alignmentVars;\n  switch (placement) {\n    case MC.S_TOP:\n    case MC.S_BOTTOM:\n      alignmentVars = {\n        left: 1 - (containerLeft + popupWidth),\n        right: containerRight - popupWidth,\n        middle: MH.min(\n          containerHMiddle - popupWidth / 2,\n          1 - (containerHMiddle + popupWidth / 2),\n        ),\n      };\n      break;\n\n    case MC.S_LEFT:\n    case MC.S_RIGHT:\n      alignmentVars = {\n        top: 1 - (containerTop + popupHeight),\n        bottom: containerBottom - popupHeight,\n        middle: MH.min(\n          containerVMiddle - popupHeight / 2,\n          1 - (containerVMiddle + popupHeight / 2),\n        ),\n      };\n      break;\n\n    default:\n      return;\n  }\n\n  const alignment = keyWithMaxVal(alignmentVars);\n  if (alignment !== \"middle\") {\n    finalPlacement += \"-\" + alignment;\n  }\n\n  return finalPlacement;\n};\n","/**\n * @module Actions\n *\n * @categoryDescription Controlling openables\n * {@link Open} opens or closes the {@link Openable} widget setup for the given\n * element.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\n\nimport { Openable } from \"@lisn/widgets/openable\";\nimport { fetchUniqueWidget } from \"@lisn/widgets/widget\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\n/**\n * Opens or closes the {@link Openable} widget setup for the given element.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"open\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <div class=\"lisn-modal\" data-lisn-on-view=\"@open +reference=top:50%\"></div>\n * ```\n *\n * @category Controlling openables\n */\nexport class Open implements Action {\n  /**\n   * Opens the Openable widget setup for the element.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Closes the Openable widget setup for the element.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Toggles the Openable widget setup for the element.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"open\", (element) => new Open(element));\n  }\n\n  constructor(element: Element) {\n    const open = (widget: Openable | null) => widget?.open();\n    const close = (widget: Openable | null) => widget?.close();\n    const toggle = (widget: Openable | null) => widget?.toggle();\n\n    const widgetPromise = fetchUniqueWidget(\"openable\", element, Openable);\n\n    this.do = () => widgetPromise.then(open);\n    this.undo = () => widgetPromise.then(close);\n    this[MC.S_TOGGLE] = () => widgetPromise.then(toggle);\n  }\n}\n","/**\n * @module Widgets\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  Direction,\n  GestureDevice,\n  CommaSeparatedStr,\n} from \"@lisn/globals/types\";\n\nimport {\n  disableInitialTransition,\n  addClasses,\n  removeClassesNow,\n  getData,\n  setData,\n  setBooleanData,\n  delDataNow,\n  getComputedStyleProp,\n  setStyleProp,\n  delStylePropNow,\n} from \"@lisn/utils/css-alter\";\nimport {\n  waitForMeasureTime,\n  waitForMutateTime,\n} from \"@lisn/utils/dom-optimize\";\nimport { getVisibleContentChildren } from \"@lisn/utils/dom-query\";\nimport { addEventListenerTo, removeEventListenerFrom } from \"@lisn/utils/event\";\nimport { isValidInputDevice } from \"@lisn/utils/gesture\";\nimport { toInt } from \"@lisn/utils/math\";\nimport { toBoolean } from \"@lisn/utils/misc\";\nimport { getClosestScrollable } from \"@lisn/utils/scroll\";\nimport { formatAsString } from \"@lisn/utils/text\";\nimport {\n  validateStrList,\n  validateNumber,\n  validateString,\n  validateBoolean,\n} from \"@lisn/utils/validation\";\n\nimport { wrapCallback } from \"@lisn/modules/callback\";\n\nimport {\n  GestureWatcher,\n  OnGestureOptions,\n  GestureData,\n} from \"@lisn/watchers/gesture-watcher\";\nimport { ScrollWatcher, ScrollOptions } from \"@lisn/watchers/scroll-watcher\";\nimport { SizeWatcher, SizeData } from \"@lisn/watchers/size-watcher\";\nimport { ViewWatcher } from \"@lisn/watchers/view-watcher\";\n\nimport {\n  Widget,\n  WidgetConfigValidatorObject,\n  WidgetCallback,\n  WidgetHandler,\n  registerWidget,\n  getDefaultWidgetSelector,\n} from \"@lisn/widgets/widget\";\n\nimport debug from \"@lisn/debug/debug\";\n\n/**\n * Configures the given element as a {@link Pager} widget.\n *\n * The Pager widget sets up the elements that make up its pages to be overlayed\n * on top of each other with only one of them visible at a time. When a user\n * performs a scroll-like gesture (see {@link GestureWatcher}), the pages are\n * flicked through: gestures, whose direction is down (or left) result in the\n * next page being shown, otherwise the previous.\n *\n * The widget should have more than one page.\n *\n * Optionally, the widget can have a set of \"switch\" elements and a set of\n * \"toggle\" elements which correspond one-to-one to each page. Switches go to\n * the given page and toggles toggle the enabled/disabled state of the page.\n *\n * **IMPORTANT:** Unless the {@link PagerConfig.style} is set to \"carousel\", the\n * page elements will be positioned absolutely, and therefore the pager likely\n * needs to have an explicit height. If you enable\n * {@link PagerConfig.fullscreen}, then the element will get `height: 100vh`\n * set. Otherwise, you need to set its height in your CSS.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Pager}\n * widget on a given element. Use {@link Pager.get} to get an existing\n * instance if any. If there is already a widget instance, it will be destroyed!\n *\n * -----\n *\n * You can use the following dynamic attributes or CSS properties in your\n * stylesheet:\n *\n * The following dynamic attributes are set on the pager element:\n * - `data-lisn-orientation`: `\"horizontal\"` or `\"vertical\"`\n * - `data-lisn-use-parallax`: `\"true\"` or `\"false\"`\n * - `data-lisn-total-pages`: the number of pages\n * - `data-lisn-visible-pages`: **for carousel only** the number of visible pages;\n *   can be fractional if {@link PagerConfig.peek} is enabled\n * - `data-lisn-current-page`: the current page number\n * - `data-lisn-current-page-is-last`: `\"true\"` or `\"false\"`\n * - `data-lisn-current-page-is-first-enabled`: `\"true\"` or `\"false\"`\n * - `data-lisn-current-page-is-last-enabled`: `\"true\"` or `\"false\"`\n *\n * The following dynamic CSS properties are also set on the pager element's style:\n * - `--lisn-js--total-pages`: the number of pages\n * - `--lisn-js--visible-pages`: **for carousel only** the number of visible pages\n * - `--lisn-js--current-page`: the current page number\n *\n * The following dynamic attributes are set on each page, toggle or switch element:\n * - `data-lisn-page-state`: `\"current\"`, `\"next\"`, `\"covered\"` or `\"disabled\"`\n * - `data-lisn-page-number`: the corresponding page's number\n *\n * The following analogous dynamic CSS properties are also set on each page,\n * toggle or switch element's style:\n * - `--lisn-js--page-number`: the corresponding page's number\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-pager` class or `data-lisn-pager` attribute set on the container\n *   element that constitutes the pager\n * - `lisn-pager-page` class or `data-lisn-pager-page` attribute set on\n *   elements that should act as the pages.\n * - `lisn-pager-toggle` class or `data-lisn-pager-toggle` attribute set on\n *   elements that should act as the toggles.\n * - `lisn-pager-switch` class or `data-lisn-pager-switch` attribute set on\n *   elements that should act as the switches.\n *\n * When using auto-widgets, the elements that will be used as pages are\n * discovered in the following way:\n * 1. The top-level element that constitutes the widget is searched for any\n *    elements that contain the `lisn-pager-page` class or\n *    `data-lisn-pager-page` attribute. They do not have to be immediate\n *    children of the root element, but they **should** all be siblings.\n * 2. If there are no such elements, all of the immediate children of the\n *    widget element except any `script` or `style` elements are taken as the\n *    pages.\n *\n * The toggles and switches are descendants of the top-level element that\n * constitutes the widget, that contain the\n * `lisn-pager-toggle`/`lisn-pager-switch` class or `data-lisn-pager-toggle`/\n * `data-lisn-pager-switch` attribute. They do not have to be immediate\n * children of the root element.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This defines a simple pager with default settings.\n *\n * ```html\n * <div class=\"lisn-pager\">\n *   <div>Vertical: Page 1</div>\n *   <div>Vertical: Page 2</div>\n *   <div>Vertical: Page 3</div>\n *   <div>Vertical: Page 4</div>\n * </div>\n * ```\n *\n * @example\n * As above but with all settings explicitly set to their default (`false`).\n *\n * ```html\n * <div data-lisn-pager=\"fullscreen=false | parallax=false | horizontal=false\">\n *   <div>Vertical: Page 1</div>\n *   <div>Vertical: Page 2</div>\n *   <div>Vertical: Page 3</div>\n *   <div>Vertical: Page 4</div>\n * </div>\n * ```\n *\n * @example\n * This defines a pager with custom settings.\n *\n * ```html\n * <div data-lisn-pager=\"fullscreen | parallax | horizontal | gestures=false\">\n *   <div>Horizontal: Page 1</div>\n *   <div>Horizontal: Page 2</div>\n *   <div>Horizontal: Page 3</div>\n *   <div>Horizontal: Page 4</div>\n * </div>\n * ```\n *\n * @example\n * This defines a pager with custom settings, as well as toggle and switch buttons.\n *\n * ```html\n * <div data-lisn-pager=\"fullscreen | parallax | horizontal | gestures=false\">\n *   <div>\n *     <div data-lisn-pager-page>Horizontal: Page 1</div>\n *     <div data-lisn-pager-page>Horizontal: Page 2</div>\n *     <div data-lisn-pager-page>Horizontal: Page 3</div>\n *     <div data-lisn-pager-page>Horizontal: Page 4</div>\n *   </div>\n *\n *   <div>\n *     <button data-lisn-pager-toggle>Toggle page 1</button>\n *     <button data-lisn-pager-toggle>Toggle page 2</button>\n *     <button data-lisn-pager-toggle>Toggle page 3</button>\n *     <button data-lisn-pager-toggle>Toggle page 4</button>\n *   </div>\n *\n *   <div>\n *     <button data-lisn-pager-switch>Go to page 1</button>\n *     <button data-lisn-pager-switch>Go to page 2</button>\n *     <button data-lisn-pager-switch>Go to page 3</button>\n *     <button data-lisn-pager-switch>Go to page 4</button>\n *   </div>\n * </div>\n * ```\n */\nexport class Pager extends Widget {\n  /**\n   * Advances the widget's page by 1. If the current page is the last one,\n   * nothing is done, unless {@link PagerConfig.fullscreen} is true in which\n   * case the pager's scrollable ancestor will be scrolled down/right\n   * (depending on the gesture direction).\n   */\n  readonly nextPage: () => Promise<void>;\n\n  /**\n   * Reverses the widget's page by 1. If the current page is the first one,\n   * nothing is done, unless {@link PagerConfig.fullscreen} is true in which\n   * case the pager's scrollable ancestor will be scrolled up/left\n   * (depending on the gesture direction).\n   */\n  readonly prevPage: () => Promise<void>;\n\n  /**\n   * Advances the widget to the given page. Note that page numbers start at 1.\n   *\n   * If this page is disabled, nothing is done.\n   */\n  readonly goToPage: (pageNum: number) => Promise<void>;\n\n  /**\n   * Disables the given page number. Note that page numbers start at 1.\n   *\n   * The page will be skipped during transitioning to previous/next.\n   *\n   * If the page is the current one, then the current page will be switched to\n   * the previous one (that's not disabled), or if this is the first enabled\n   * page, then it will switch to the next one that's not disabled.\n   *\n   * If this is the last enabled page, nothing is done.\n   */\n  readonly disablePage: (pageNum: number) => Promise<void>;\n\n  /**\n   * Re-enables the given page number. Note that page numbers start at 1.\n   */\n  readonly enablePage: (pageNum: number) => Promise<void>;\n\n  /**\n   * Re-enables the given page if it is disabled, otherwise disables it. Note\n   * that page numbers start at 1.\n   */\n  readonly togglePage: (pageNum: number) => Promise<void>;\n\n  /**\n   * Returns true if the given page number is disabled. Note that page\n   * numbers start at 1.\n   */\n  readonly isPageDisabled: (pageNum: number) => boolean;\n\n  /**\n   * Returns the current page.\n   */\n  readonly getCurrentPage: () => Element;\n\n  /**\n   * Returns the previous page, before the last transition.\n   *\n   * If there has been no change of page, returns the first page, same as\n   * {@link getCurrentPageNum}.\n   */\n  readonly getPreviousPage: () => Element;\n\n  /**\n   * Returns the number of the current page. Note that numbers start at 1.\n   */\n  readonly getCurrentPageNum: () => number;\n\n  /**\n   * Returns the number of the previous page, before the last transition. Note\n   * that numbers start at 1.\n   *\n   * If there has been no change of page, returns the number of the first page,\n   * same as {@link getCurrentPageNum}.\n   */\n  readonly getPreviousPageNum: () => number;\n\n  /**\n   * The given handler will be called whenever there is a change of page. It\n   * will be called after the current page number is updated internally (so\n   * {@link getPreviousPageNum} and {@link getCurrentPageNum} will return the\n   * updated numbers), but before the page transition styles are updated.\n   *\n   * If the handler returns a promise, it will be awaited upon.\n   */\n  readonly onTransition: (handler: WidgetHandler) => void;\n\n  /**\n   * Returns the page elements.\n   */\n  readonly getPages: () => Element[];\n\n  /**\n   * Returns the toggle elements if any.\n   */\n  readonly getToggles: () => Element[];\n\n  /**\n   * Returns the switch elements if any.\n   */\n  readonly getSwitches: () => Element[];\n\n  static get(element: Element): Pager | null {\n    const instance = super.get(element, DUMMY_ID);\n    if (MH.isInstanceOf(instance, Pager)) {\n      return instance;\n    }\n    return null;\n  }\n\n  static register() {\n    registerWidget(\n      WIDGET_NAME,\n      (element, config) => {\n        if (!Pager.get(element)) {\n          return new Pager(element, config);\n        }\n        return null;\n      },\n      configValidator,\n    );\n  }\n\n  /**\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If there are less than 2 pages given or found, or if any\n   *                page is not a descendant of the main pager element.\n   */\n  constructor(element: Element, config?: PagerConfig) {\n    const destroyPromise = Pager.get(element)?.destroy();\n    super(element, { id: DUMMY_ID });\n\n    const pages = config?.pages || [];\n    const toggles = config?.toggles || [];\n    const switches = config?.switches || [];\n    const nextPrevSwitch = {\n      _next: config?.nextSwitch ?? null,\n      _prev: config?.prevSwitch ?? null,\n    };\n\n    const pageSelector = getDefaultWidgetSelector(PREFIX_PAGE__FOR_SELECT);\n    const toggleSelector = getDefaultWidgetSelector(PREFIX_TOGGLE__FOR_SELECT);\n    const switchSelector = getDefaultWidgetSelector(PREFIX_SWITCH__FOR_SELECT);\n    const nextSwitchSelector = getDefaultWidgetSelector(\n      PREFIX_NEXT_SWITCH__FOR_SELECT,\n    );\n    const prevSwitchSelector = getDefaultWidgetSelector(\n      PREFIX_PREV_SWITCH__FOR_SELECT,\n    );\n\n    if (!MH.lengthOf(pages)) {\n      pages.push(...MH.querySelectorAll(element, pageSelector));\n\n      if (!MH.lengthOf(pages)) {\n        pages.push(\n          ...getVisibleContentChildren(element).filter(\n            (e) => !e.matches(switchSelector),\n          ),\n        );\n      }\n    }\n\n    if (!MH.lengthOf(toggles)) {\n      toggles.push(...MH.querySelectorAll(element, toggleSelector));\n    }\n\n    if (!MH.lengthOf(switches)) {\n      switches.push(...MH.querySelectorAll(element, switchSelector));\n    }\n\n    if (!nextPrevSwitch._next) {\n      nextPrevSwitch._next = MH.querySelector(element, nextSwitchSelector);\n    }\n\n    if (!nextPrevSwitch._prev) {\n      nextPrevSwitch._prev = MH.querySelector(element, prevSwitchSelector);\n    }\n\n    const numPages = MH.lengthOf(pages);\n    if (numPages < 2) {\n      throw MH.usageError(\"Pager must have more than 1 page\");\n    }\n\n    for (const page of pages) {\n      if (!element.contains(page) || page === element) {\n        throw MH.usageError(\"Pager's pages must be its descendants\");\n      }\n    }\n\n    const components = {\n      _pages: pages,\n      _toggles: toggles,\n      _switches: switches,\n      _nextPrevSwitch: nextPrevSwitch,\n    };\n\n    const methods = getMethods(this, components, element, config);\n\n    (destroyPromise || MH.promiseResolve()).then(() => {\n      if (this.isDestroyed()) {\n        return;\n      }\n\n      init(this, element, components, config, methods);\n    });\n\n    this.nextPage = () => methods._nextPage();\n    this.prevPage = () => methods._prevPage();\n    this.goToPage = (pageNum) => methods._goToPage(pageNum);\n    this.disablePage = methods._disablePage;\n    this.enablePage = methods._enablePage;\n    this.togglePage = methods._togglePage;\n    this.isPageDisabled = methods._isPageDisabled;\n    this.getCurrentPage = methods._getCurrentPage;\n    this.getPreviousPage = methods._getPreviousPage;\n    this.getCurrentPageNum = methods._getCurrentPageNum;\n    this.getPreviousPageNum = methods._getPreviousPageNum;\n    this.onTransition = methods._onTransition;\n\n    this.getPages = () => [...pages];\n    this.getSwitches = () => [...switches];\n    this.getToggles = () => [...toggles];\n  }\n}\n\n/**\n * @interface\n */\nexport type PagerConfig = {\n  /**\n   * The elements that will make up the pages.\n   *\n   * They do not have to be immediate children of the root element, but they\n   * should all be siblings.\n   *\n   * The widget should have more than one page.\n   *\n   * If this is not specified, then\n   * 1. The top-level element that constitutes the widget is searched for any\n   *    elements that contain the `lisn-pager-page` class or the\n   *    `data-lisn-pager-page` attribute, and these are used as pages.\n   * 2. If there are no such elements, all of the immediate children of the\n   *    widget element (other than `script` and `style` elements) are taken as\n   *    the pages.\n   *\n   * **IMPORTANT:** Unless the {@link style} is set to \"carousel\", the page\n   * elements will be positioned absolutely, and therefore the pager likely\n   * needs to have an explicit height. If you enable {@link fullscreen}, then\n   * the element will get `height: 100vh` set. Otherwise, you need to set its\n   * height in your CSS.\n   *\n   * @defaultValue undefined\n   */\n  pages?: Element[];\n\n  /**\n   * If given, these elements should match one-to-one the page elements.\n   *\n   * Each toggle element will be assigned a click listener that toggles the\n   * enabled/disabled state of the page.\n   *\n   * If this is not specified, then the top-level element that constitutes the\n   * widget is searched for any elements that contain the `lisn-pager-toggle`\n   * class or the `data-lisn-pager-toggle` attribute, and these are used as\n   * toggles.\n   *\n   * @defaultValue undefined\n   */\n  toggles?: Element[];\n\n  /**\n   * If given, these elements should match one-to-one the page elements.\n   *\n   * Each toggle element will be assigned a click listener that switches the\n   * pager to the page.\n   *\n   * If this is not specified, then the top-level element that constitutes the\n   * widget is searched for any elements that contain the `lisn-pager-switch`\n   * class or the `data-lisn-pager-switch` attribute, and these are used as\n   * switches.\n   *\n   * @defaultValue undefined\n   */\n  switches?: Element[];\n\n  /**\n   * This element will be assigned a click listener that goes to the next page.\n   *\n   * If this is not given, then the top-level element that constitutes the\n   * widget is searched for the first element that contains the\n   * `lisn-pager-next-switch` class or the `data-lisn-pager-next-switch`\n   * attribute, and this is used.\n   *\n   * @defaultValue undefined\n   */\n  nextSwitch?: Element;\n\n  /**\n   * This element will be assigned a click listener that goes to the previous\n   * page.\n   *\n   * If this is not given, then the top-level element that constitutes the\n   * widget is searched for the first element that contains the\n   * `lisn-pager-prev-switch` class or the `data-lisn-pager-prev-switch`\n   * attribute, and this is used.\n   *\n   * @defaultValue undefined\n   */\n  prevSwitch?: Element;\n\n  /**\n   * Set the initial page number.\n   *\n   * @defaultValue 1\n   */\n  initialPage?: number;\n\n  /**\n   * Set the style of the widget. This determines the basic CSS applied.\n   *\n   * When importing the stylesheets in your project, if not using the full\n   * stylesheet (lisn.css) you can import either pager.css which contains all\n   * three pager styles, or only `pager-<style>.css`.\n   *\n   * **NOTE:** The base css only includes the minimum required for positioning\n   * and transitioning pages. The switches and toggles are intentionally not\n   * styled for flexibility. You should style those in your CSS.\n   *\n   * **IMPORTANT:** Unless the {@link style} is set to \"carousel\", the page\n   * elements will be positioned absolutely, and therefore the pager likely\n   * needs to have an explicit height. If you enable {@link fullscreen}, then\n   * the element will get `height: 100vh` set. Otherwise, you need to set its\n   * height in your CSS.\n   *\n   * @since v1.1.0\n   *\n   * @defaultValue \"slider\"\n   */\n  style?: \"slider\" | \"carousel\" | \"tabs\";\n\n  /**\n   * Only relevant is {@link style} is \"carousel\".\n   *\n   * The *minimum* page height (or width in {@link horizontal} mode) in pixels.\n   * This will determine the number of visible slides at any one width of the\n   * pager. Pages will still grow to fill the size of the carousel itself.\n   *\n   * @since Introduced in v1.1.0.\n   *\n   * @defaultValue 300\n   */\n  pageSize?: number;\n\n  /**\n   * Only relevant is {@link style} is \"carousel\".\n   *\n   * Whether to show a bit of the upcoming and/or previous pages that are\n   * hidden when not all fit.\n   *\n   * @since Introduced in v1.1.0.\n   *\n   * @defaultValue false\n   */\n  peek?: boolean;\n\n  /**\n   * If true, then:\n   * - if the pager {@link style} is \"slider\", the pager's height will be set\n   *   to the viewport height (100vh)\n   * - the pager's scrolling ancestor will be scrolled to the top of the pager\n   *   when 30% of it is in view\n   * - scrolling beyond the first or last page will initiate scroll up/left or\n   *   down/right the pager's scrolling ancestor in order to allow \"leaving\"\n   *   the pager\n   *\n   * Note that except in \"carousel\" {@link style} the pager's pages will be\n   * positioned absolutely, and so if you do _not_ enable this option, you will\n   * need to manually set the height of the page parent element via CSS.\n   *\n   * @defaultValue false\n   */\n  fullscreen?: boolean;\n\n  /**\n   * Only relevant is {@link style} is \"slider\" (default) or \"carousel\".\n   *\n   * Use a parallax effect for switching pages.\n   *\n   * @defaultValue false\n   */\n  parallax?: boolean;\n\n  /**\n   * Only relevant is {@link style} is \"slider\" (default) or \"carousel\".\n   *\n   * Transition pages sideways instead of vertically.\n   *\n   * @defaultValue false\n   */\n  horizontal?: boolean;\n\n  /**\n   * Transition pages upon user scroll-like and drag-like gestures via the\n   * given {@link GestureDevice}s. If set to true, then gestures using all\n   * device types are supported.\n   *\n   * Note that drag gesture is only supported by the \"pointer\" device and also\n   * the \"pointer\" device only supports drag gestures, so if you want to\n   * disable drag gestures, simply pass \"wheel,key,touch\" as this option.\n   *\n   * @defaultValue true\n   */\n  useGestures?: boolean | CommaSeparatedStr<GestureDevice> | GestureDevice[];\n\n  /**\n   * If true, then pages will be advanced backwards/forwards regardless if the\n   * gesture direction is horizontal or vertical.\n   *\n   * If false then, a gesture will go to the next page only if its direction is\n   * down if {@link horizontal} is false/right if {@link horizontal} is true,\n   * and to the previous page only if the gesture direction is up if\n   * {@link horizontal} is false/left if {@link horizontal} is true.\n   *\n   * **IMPORTANT:**\n   * If {@link fullscreen}, {@link preventDefault} and\n   * {@link alignGestureDirection} are all true, then the pager's scrollable\n   * parent must be scrollable in the same direction as the pager orientation,\n   * otherwise automatic scroll beyond the last/first page won't work.\n   *\n   * @defaultValue false\n   */\n  alignGestureDirection?: boolean;\n\n  /**\n   * Whether to prevent the default action for events that would result in\n   * gestures.\n   *\n   * **NOTE:**\n   * If true (default), then all events that originate from a device given in\n   * {@link useGestures} and that could result in a gesture will be prevented\n   * regardless of their direction and whether {@link alignGestureDirection} is\n   * true.\n   *\n   * @defaultValue true\n   */\n  preventDefault?: boolean;\n};\n\n// --------------------\n\ntype Components = {\n  _pages: Element[];\n  _toggles: Element[];\n  _switches: Element[];\n  _nextPrevSwitch: { _next: Element | null; _prev: Element | null };\n};\n\n// Swiping on some trackpads results in \"trailing\" wheel events sent for some\n// while which results in multiple pages being advanced in a short while. So we\n// limit how often pages can be advanced.\nconst MIN_TIME_BETWEEN_WHEEL = 1000;\n\nconst S_CURRENT = \"current\";\nconst S_ARIA_CURRENT = MC.ARIA_PREFIX + S_CURRENT;\nconst S_COVERED = \"covered\";\nconst S_NEXT = \"next\";\nconst S_TOTAL_PAGES = \"total-pages\";\nconst S_VISIBLE_PAGES = \"visible-pages\";\nconst S_CURRENT_PAGE = \"current-page\";\nconst S_PAGE_NUMBER = \"page-number\";\nconst WIDGET_NAME = \"pager\";\nconst PREFIXED_NAME = MH.prefixName(WIDGET_NAME);\nconst PREFIX_ROOT = `${PREFIXED_NAME}__root`;\nconst PREFIX_PAGE_CONTAINER = `${PREFIXED_NAME}__page-container`;\n\n// Use different classes for styling items to the one used for auto-discovering\n// them, so that re-creating existing widgets can correctly find the items to\n// be used by the new widget synchronously before the current one is destroyed.\nconst PREFIX_PAGE = `${PREFIXED_NAME}__page`;\nconst PREFIX_PAGE__FOR_SELECT = `${PREFIXED_NAME}-page`;\nconst PREFIX_TOGGLE__FOR_SELECT = `${PREFIXED_NAME}-toggle`;\nconst PREFIX_SWITCH__FOR_SELECT = `${PREFIXED_NAME}-switch`;\nconst PREFIX_NEXT_SWITCH__FOR_SELECT = `${PREFIXED_NAME}-next-switch`;\nconst PREFIX_PREV_SWITCH__FOR_SELECT = `${PREFIXED_NAME}-prev-switch`;\n\nconst PREFIX_STYLE = `${PREFIXED_NAME}-style`;\nconst PREFIX_IS_FULLSCREEN = MH.prefixName(\"is-fullscreen\");\nconst PREFIX_USE_PARALLAX = MH.prefixName(\"use-parallax\");\nconst PREFIX_TOTAL_PAGES = MH.prefixName(S_TOTAL_PAGES);\nconst PREFIX_VISIBLE_PAGES = MH.prefixName(S_VISIBLE_PAGES);\nconst PREFIX_CURRENT_PAGE = MH.prefixName(S_CURRENT_PAGE);\nconst PREFIX_CURRENT_PAGE_IS_LAST = `${PREFIX_CURRENT_PAGE}-is-last`;\nconst PREFIX_CURRENT_PAGE_IS_FIRST_ENABLED = `${PREFIX_CURRENT_PAGE}-is-first-enabled`;\nconst PREFIX_CURRENT_PAGE_IS_LAST_ENABLED = `${PREFIX_CURRENT_PAGE_IS_LAST}-enabled`;\nconst PREFIX_PAGE_STATE = MH.prefixName(\"page-state\");\nconst PREFIX_PAGE_NUMBER = MH.prefixName(S_PAGE_NUMBER);\nconst VAR_CURRENT_PAGE = MH.prefixCssJsVar(S_CURRENT_PAGE);\nconst VAR_TOTAL_PAGES = MH.prefixCssJsVar(S_TOTAL_PAGES);\nconst VAR_VISIBLE_PAGES = MH.prefixCssJsVar(S_VISIBLE_PAGES);\nconst VAR_VISIBLE_GAPS = MH.prefixCssJsVar(\"visible-gaps\");\nconst VAR_TRANSLATED_PAGES = MH.prefixCssJsVar(\"translated-pages\");\nconst VAR_TRANSLATED_GAPS = MH.prefixCssJsVar(\"translated-gaps\");\nconst VAR_PAGE_NUMBER = MH.prefixCssJsVar(S_PAGE_NUMBER);\n\n// Only one Pager widget per element is allowed, but Widget requires a\n// non-blank ID.\nconst DUMMY_ID = PREFIXED_NAME;\n\nconst SUPPORTED_STYLES = [\"slider\", \"carousel\", \"tabs\"] as const;\ntype PagerStyle = (typeof SUPPORTED_STYLES)[number];\n\nconst isValidStyle = (value: string): value is PagerStyle =>\n  MH.includes(SUPPORTED_STYLES, value);\n\nconst configValidator: WidgetConfigValidatorObject<PagerConfig> = {\n  initialPage: validateNumber,\n  style: (key, value) => validateString(key, value, isValidStyle),\n  pageSize: validateNumber,\n  peek: validateBoolean,\n  fullscreen: validateBoolean,\n  parallax: validateBoolean,\n  horizontal: validateBoolean,\n  useGestures: (key, value) => {\n    if (MH.isNullish(value)) {\n      return undefined;\n    }\n\n    const bool = toBoolean(value);\n    if (bool !== null) {\n      return bool;\n    }\n\n    return (\n      validateStrList(\n        \"useGestures\",\n        validateString(key, value),\n        isValidInputDevice,\n      ) || true\n    );\n  },\n  alignGestureDirection: validateBoolean,\n  preventDefault: validateBoolean,\n};\n\nconst fetchClosestScrollable = (element: Element) =>\n  waitForMeasureTime().then(\n    () => getClosestScrollable(element, { active: true }) ?? undefined,\n  );\n\nconst setPageNumber = (components: Components, pageNum: number) => {\n  let lastPromise: Promise<void> = MH.promiseResolve();\n  for (const el of [\n    components._pages[pageNum - 1],\n    components._toggles[pageNum - 1],\n    components._switches[pageNum - 1],\n  ] as const) {\n    if (el) {\n      setData(el, PREFIX_PAGE_NUMBER, pageNum + \"\");\n      lastPromise = setStyleProp(el, VAR_PAGE_NUMBER, pageNum + \"\");\n    }\n  }\n\n  return lastPromise;\n};\n\nconst setPageState = async (\n  components: Components,\n  pageNum: number,\n  state: string,\n) => {\n  for (const el of [\n    components._pages[pageNum - 1],\n    components._toggles[pageNum - 1],\n    components._switches[pageNum - 1],\n  ] as const) {\n    if (el) {\n      await setData(el, PREFIX_PAGE_STATE, state);\n    }\n  }\n};\n\nconst setCurrentPage = (\n  pagerEl: Element,\n  pageNumbers: {\n    _current: number;\n    _total: number;\n  },\n  isPageDisabled: (pageNum: number) => boolean,\n) => {\n  let isFirstEnabled = true;\n  let isLastEnabled = true;\n  for (let n = 1; n <= pageNumbers._total; n++) {\n    if (!isPageDisabled(n)) {\n      if (n < pageNumbers._current) {\n        isFirstEnabled = false;\n      } else if (n > pageNumbers._current) {\n        isLastEnabled = false;\n      }\n    }\n  }\n\n  setStyleProp(pagerEl, VAR_CURRENT_PAGE, pageNumbers._current + \"\");\n  setData(pagerEl, PREFIX_CURRENT_PAGE, pageNumbers._current + \"\");\n  setBooleanData(\n    pagerEl,\n    PREFIX_CURRENT_PAGE_IS_LAST,\n    pageNumbers._current === pageNumbers._total,\n  );\n  setBooleanData(pagerEl, PREFIX_CURRENT_PAGE_IS_FIRST_ENABLED, isFirstEnabled);\n  return setBooleanData(\n    pagerEl,\n    PREFIX_CURRENT_PAGE_IS_LAST_ENABLED,\n    isLastEnabled,\n  );\n};\n\nconst init = (\n  widget: Pager,\n  element: Element,\n  components: Components,\n  config: PagerConfig | undefined,\n  methods: ReturnType<typeof getMethods>,\n) => {\n  const logger = debug\n    ? new debug.Logger({\n        name: `Pager-${formatAsString(element)}`,\n        logAtCreation: config,\n      })\n    : null;\n\n  const pages = components._pages;\n  const toggles = components._toggles;\n  const switches = components._switches;\n  const nextSwitch = components._nextPrevSwitch._next;\n  const prevSwitch = components._nextPrevSwitch._prev;\n  const pageContainer = MH.parentOf(pages[0]);\n\n  let initialPage = toInt(config?.initialPage ?? 1);\n  const pagerStyle = config?.style || \"slider\";\n  const isCarousel = pagerStyle === \"carousel\";\n  const minPageSize = config?.pageSize ?? 300;\n  const enablePeek = config?.peek ?? false;\n  const isFullscreen = config?.fullscreen ?? false;\n  const isParallax = config?.parallax ?? false;\n  const isHorizontal = config?.horizontal ?? false;\n  const orientation = isHorizontal ? MC.S_HORIZONTAL : MC.S_VERTICAL;\n  const useGestures = config?.useGestures ?? true;\n  const alignGestureDirection = config?.alignGestureDirection ?? false;\n  const preventDefault = config?.preventDefault ?? true;\n\n  const scrollWatcher = ScrollWatcher.reuse();\n  const sizeWatcher = isCarousel\n    ? SizeWatcher.reuse({ resizeThreshold: 10 })\n    : null;\n  const gestureWatcher = useGestures ? GestureWatcher.reuse() : null;\n  const viewWatcher = isFullscreen\n    ? ViewWatcher.reuse({ rootMargin: \"0px\", threshold: 0.3 })\n    : null;\n\n  const recalculateCarouselProps = async (t?: Element, data?: SizeData) => {\n    if (data) {\n      // there's been a resize\n      const gap =\n        MH.parseFloat(await getComputedStyleProp(element, \"gap\")) || 0;\n      const containerSize =\n        data.content[isHorizontal ? MC.S_WIDTH : MC.S_HEIGHT];\n\n      const getNumVisiblePages = (addPeek = false) =>\n        (numVisiblePages = MH.max(\n          1, // at least 1\n          MH.min(\n            MH.floor(\n              (containerSize + gap - (addPeek ? 0.5 * minPageSize : 0)) /\n                (minPageSize + gap),\n            ),\n            numPages, // and at most total number\n          ),\n        ));\n\n      numVisiblePages = getNumVisiblePages();\n      if (enablePeek && numVisiblePages < numPages) {\n        // Not all pages fit now and we will add a \"peek\" from the pages on the\n        // edge.\n        // Re-calculate with peek added in case the resultant page size when we\n        // add the \"peek\" will make it smaller than the min.\n        numVisiblePages = getNumVisiblePages(true);\n      }\n\n      debug: logger?.debug8(\"Pager resized\", {\n        gap,\n        containerSize,\n        numVisiblePages,\n      });\n    } // otherwise just a page transition\n\n    const currPageNum = widget.getCurrentPageNum();\n    const prevPageNum = widget.getPreviousPageNum();\n    const numHidden = numPages - numVisiblePages;\n    const hasPeek = enablePeek && numVisiblePages < numPages;\n\n    // centre the current page as much as possible\n    let visibleStart = currPageNum - (numVisiblePages - 1) / 2;\n    let isAtEdge = false;\n\n    if (visibleStart >= numHidden + 1) {\n      visibleStart = numHidden + 1;\n      isAtEdge = true;\n    } else if (visibleStart <= 1) {\n      visibleStart = 1;\n      isAtEdge = true;\n    }\n\n    let numTranslated = 0;\n    if (hasPeek) {\n      numTranslated = MH.max(0, visibleStart - 1 - (isAtEdge ? 0.5 : 0.25));\n    } else {\n      numTranslated =\n        (prevPageNum > currPageNum ? MH.floor : MH.ceil)(visibleStart) - 1;\n    }\n\n    const numVisibleGaps = !hasPeek\n      ? numVisiblePages - 1\n      : isAtEdge || numVisiblePages % 2 === 0\n        ? numVisiblePages\n        : numVisiblePages + 1;\n\n    const fractionalNumVisiblePages = hasPeek\n      ? numVisiblePages + 0.5\n      : numVisiblePages;\n\n    debug: logger?.debug8(\"Carousel calculations\", {\n      currPageNum,\n      prevPageNum,\n      visibleStart,\n      isAtEdge,\n      numVisiblePages,\n      numVisibleGaps,\n      numTranslated,\n    });\n\n    setData(element, PREFIX_VISIBLE_PAGES, fractionalNumVisiblePages + \"\");\n    setStyleProp(element, VAR_VISIBLE_PAGES, fractionalNumVisiblePages + \"\");\n    setStyleProp(element, VAR_VISIBLE_GAPS, numVisibleGaps + \"\");\n    setStyleProp(element, VAR_TRANSLATED_PAGES, numTranslated + \"\");\n    setStyleProp(element, VAR_TRANSLATED_GAPS, MH.floor(numTranslated) + \"\");\n  };\n\n  const getGestureOptions = (\n    directions: Direction | Direction[] | undefined,\n  ): OnGestureOptions => {\n    return {\n      devices: MH.isBoolean(useGestures) // i.e. true; if it's false, then gestureWatcher is null\n        ? undefined // all devices\n        : useGestures,\n      intents: [MC.S_DRAG, MC.S_SCROLL],\n      directions,\n      deltaThreshold: 25,\n      preventDefault,\n    };\n  };\n\n  const scrollToPager = async () => {\n    scrollWatcher.scrollTo(element, {\n      scrollable: await fetchClosestScrollable(element),\n    });\n  };\n\n  const transitionOnGesture = (target: EventTarget, data: GestureData) => {\n    const swapDirection = data.intent === MC.S_DRAG;\n\n    if (MH.includes([MC.S_LEFT, MC.S_UP], data.direction)) {\n      (swapDirection ? methods._nextPage : methods._prevPage)(data);\n    } else {\n      (swapDirection ? methods._prevPage : methods._nextPage)(data);\n    }\n  };\n\n  const addWatchers = () => {\n    gestureWatcher?.onGesture(\n      element,\n      transitionOnGesture,\n      getGestureOptions(\n        alignGestureDirection\n          ? isHorizontal\n            ? [MC.S_LEFT, MC.S_RIGHT]\n            : [MC.S_UP, MC.S_DOWN]\n          : undefined, // all directions\n      ),\n    );\n\n    sizeWatcher?.onResize(recalculateCarouselProps, { target: element });\n    viewWatcher?.onView(element, scrollToPager, { views: \"at\" });\n  };\n\n  const removeWatchers = () => {\n    gestureWatcher?.offGesture(element, transitionOnGesture);\n    sizeWatcher?.offResize(recalculateCarouselProps, element);\n    viewWatcher?.offView(element, scrollToPager);\n  };\n\n  const getPageNumForEvent = (event: Event) => {\n    const target = MH.currentTargetOf(event);\n    return MH.isElement(target)\n      ? toInt(getData(target, PREFIX_PAGE_NUMBER))\n      : 0;\n  };\n\n  const toggleClickListener = (event: Event) => {\n    const pageNum = getPageNumForEvent(event);\n    methods._togglePage(pageNum);\n  };\n\n  const switchClickListener = (event: Event) => {\n    const pageNum = getPageNumForEvent(event);\n    methods._goToPage(pageNum);\n  };\n\n  const nextSwitchClickListener = () => methods._nextPage();\n  const prevSwitchClickListener = () => methods._prevPage();\n\n  // SETUP ------------------------------\n\n  widget.onDisable(removeWatchers);\n  widget.onEnable(addWatchers);\n\n  widget.onDestroy(async () => {\n    await waitForMutateTime();\n    delDataNow(element, MC.PREFIX_ORIENTATION);\n    delDataNow(element, PREFIX_STYLE);\n    delDataNow(element, PREFIX_IS_FULLSCREEN);\n    delDataNow(element, PREFIX_USE_PARALLAX);\n    delDataNow(element, PREFIX_CURRENT_PAGE);\n    delDataNow(element, PREFIX_CURRENT_PAGE_IS_LAST);\n    delDataNow(element, PREFIX_CURRENT_PAGE_IS_FIRST_ENABLED);\n    delDataNow(element, PREFIX_CURRENT_PAGE_IS_LAST_ENABLED);\n    delDataNow(element, PREFIX_TOTAL_PAGES);\n    delDataNow(element, PREFIX_VISIBLE_PAGES);\n    delStylePropNow(element, VAR_CURRENT_PAGE);\n    delStylePropNow(element, VAR_TOTAL_PAGES);\n    delStylePropNow(element, VAR_VISIBLE_PAGES);\n    delStylePropNow(element, VAR_VISIBLE_GAPS);\n    delStylePropNow(element, VAR_TRANSLATED_PAGES);\n    delStylePropNow(element, VAR_TRANSLATED_GAPS);\n\n    for (let idx = 0; idx < MH.lengthOf(pages); idx++) {\n      removeClassesNow(pages[idx], PREFIX_PAGE);\n\n      for (const [el, listener] of [\n        [pages[idx], null],\n        [toggles[idx], toggleClickListener],\n        [switches[idx], switchClickListener],\n      ] as const) {\n        if (el) {\n          delDataNow(el, PREFIX_PAGE_STATE);\n          delDataNow(el, PREFIX_PAGE_NUMBER);\n          delStylePropNow(el, VAR_PAGE_NUMBER);\n          if (listener) {\n            removeEventListenerFrom(el, MC.S_CLICK, listener);\n          }\n        }\n      }\n\n      MH.delAttr(pages[idx], S_ARIA_CURRENT);\n    }\n\n    if (nextSwitch) {\n      removeEventListenerFrom(nextSwitch, MC.S_CLICK, nextSwitchClickListener);\n    }\n\n    if (prevSwitch) {\n      removeEventListenerFrom(prevSwitch, MC.S_CLICK, prevSwitchClickListener);\n    }\n\n    removeClassesNow(element, PREFIX_ROOT);\n    if (pageContainer) {\n      removeClassesNow(pageContainer, PREFIX_PAGE_CONTAINER);\n    }\n  });\n\n  if (isCarousel) {\n    widget.onTransition(() => recalculateCarouselProps());\n  }\n\n  addWatchers();\n  addClasses(element, PREFIX_ROOT);\n  if (pageContainer) {\n    addClasses(pageContainer, PREFIX_PAGE_CONTAINER);\n  }\n\n  const numPages = MH.lengthOf(pages);\n  let numVisiblePages = numPages;\n\n  setData(element, MC.PREFIX_ORIENTATION, orientation);\n  setData(element, PREFIX_STYLE, pagerStyle);\n  setBooleanData(element, PREFIX_IS_FULLSCREEN, isFullscreen);\n  setBooleanData(element, PREFIX_USE_PARALLAX, isParallax);\n  setData(element, PREFIX_TOTAL_PAGES, numPages + \"\");\n  setStyleProp(element, VAR_TOTAL_PAGES, (numPages || 1) + \"\");\n\n  for (const page of pages) {\n    disableInitialTransition(page);\n    addClasses(page, PREFIX_PAGE);\n  }\n\n  for (let idx = 0; idx < numPages; idx++) {\n    setPageNumber(components, idx + 1);\n    setPageState(components, idx + 1, S_NEXT);\n\n    for (const [el, listener] of [\n      [toggles[idx], toggleClickListener],\n      [switches[idx], switchClickListener],\n    ] as const) {\n      if (el) {\n        addEventListenerTo(el, MC.S_CLICK, listener);\n      }\n    }\n  }\n\n  if (nextSwitch) {\n    addEventListenerTo(nextSwitch, MC.S_CLICK, nextSwitchClickListener);\n  }\n\n  if (prevSwitch) {\n    addEventListenerTo(prevSwitch, MC.S_CLICK, prevSwitchClickListener);\n  }\n\n  if (initialPage < 1 || initialPage > numPages) {\n    initialPage = 1;\n  }\n  methods._goToPage(initialPage);\n};\n\nconst getMethods = (\n  widget: Pager,\n  components: Components,\n  element: Element,\n  config: PagerConfig | undefined,\n) => {\n  const pages = components._pages;\n  const scrollWatcher = ScrollWatcher.reuse();\n  const isFullscreen = config?.fullscreen;\n  const disabledPages: Record<number, boolean> = {};\n  const callbacks = MH.newSet<WidgetCallback>();\n\n  const fetchScrollOptions = async (): Promise<ScrollOptions> => ({\n    scrollable: await fetchClosestScrollable(element),\n    // default amount is already 100%\n    asFractionOf: \"visible\",\n    weCanInterrupt: true,\n  });\n\n  let currPageNum = -1;\n  let lastPageNum = -1;\n  let lastTransition = 0;\n\n  const canTransition = (gestureData?: GestureData) => {\n    if (widget.isDisabled()) {\n      return false;\n    }\n\n    if (gestureData?.device !== MC.S_WHEEL) {\n      return true;\n    }\n\n    const timeNow = MH.timeNow();\n    if (timeNow - lastTransition > MIN_TIME_BETWEEN_WHEEL) {\n      lastTransition = timeNow;\n      return true;\n    }\n\n    return false;\n  };\n\n  const goToPage = async (pageNum: number, gestureData?: GestureData) => {\n    pageNum = toInt(pageNum, -1);\n    if (pageNum === currPageNum || !canTransition(gestureData)) {\n      return;\n    }\n\n    const numPages = MH.lengthOf(pages);\n\n    if (\n      (currPageNum === 1 && pageNum === 0) ||\n      (currPageNum === numPages && pageNum === numPages + 1)\n    ) {\n      // next/prev page beyond last/first\n      if (isFullscreen) {\n        scrollWatcher.scroll(\n          pageNum\n            ? gestureData?.direction === MC.S_RIGHT\n              ? MC.S_RIGHT\n              : MC.S_DOWN\n            : gestureData?.direction === MC.S_LEFT\n              ? MC.S_LEFT\n              : MC.S_UP,\n          await fetchScrollOptions(),\n        ); // no need to await\n      }\n\n      return;\n    }\n\n    if (isPageDisabled(pageNum) || pageNum < 1 || pageNum > numPages) {\n      // invalid or disabled\n      return;\n    }\n\n    lastPageNum = currPageNum > 0 ? currPageNum : pageNum;\n    currPageNum = pageNum;\n\n    for (const callback of callbacks) {\n      await callback.invoke(widget);\n    }\n\n    MH.delAttr(pages[lastPageNum - 1], S_ARIA_CURRENT);\n    for (\n      let n = lastPageNum;\n      n !== currPageNum;\n      currPageNum < lastPageNum ? n-- : n++\n    ) {\n      if (!isPageDisabled(n)) {\n        setPageState(\n          components,\n          n,\n          currPageNum < lastPageNum ? S_NEXT : S_COVERED,\n        );\n      }\n    }\n\n    setCurrentPage(\n      element,\n      { _current: currPageNum, _total: numPages },\n      isPageDisabled,\n    );\n    MH.setAttr(pages[currPageNum - 1], S_ARIA_CURRENT);\n    await setPageState(components, currPageNum, S_CURRENT);\n  };\n\n  const nextPage = async (gestureData?: GestureData) => {\n    let targetPage = currPageNum + 1;\n    while (isPageDisabled(targetPage)) {\n      targetPage++;\n    }\n\n    return goToPage(targetPage, gestureData);\n  };\n\n  const prevPage = async (gestureData?: GestureData) => {\n    let targetPage = currPageNum - 1;\n    while (isPageDisabled(targetPage)) {\n      targetPage--;\n    }\n\n    return goToPage(targetPage, gestureData);\n  };\n\n  const isPageDisabled = (pageNum: number) => disabledPages[pageNum] === true;\n\n  const disablePage = async (pageNum: number) => {\n    pageNum = toInt(pageNum);\n    if (widget.isDisabled() || pageNum < 1 || pageNum > MH.lengthOf(pages)) {\n      return;\n    }\n\n    // set immediately for toggle to work without awaiting on it\n    disabledPages[pageNum] = true;\n\n    if (pageNum === currPageNum) {\n      await prevPage();\n\n      if (pageNum === currPageNum) {\n        // was the first enabled one\n        await nextPage();\n\n        if (pageNum === currPageNum) {\n          // was the only enabled one\n          disabledPages[pageNum] = false;\n          return;\n        }\n      }\n    }\n\n    setCurrentPage(\n      element,\n      { _current: currPageNum, _total: MH.lengthOf(pages) },\n      isPageDisabled,\n    );\n    await setPageState(components, pageNum, MC.S_DISABLED);\n  };\n\n  const enablePage = async (pageNum: number) => {\n    pageNum = toInt(pageNum);\n    if (widget.isDisabled() || !isPageDisabled(pageNum)) {\n      return;\n    }\n\n    // set immediately for toggle to work without awaiting on it\n    disabledPages[pageNum] = false;\n\n    setCurrentPage(\n      element,\n      { _current: currPageNum, _total: MH.lengthOf(pages) },\n      isPageDisabled,\n    );\n    await setPageState(\n      components,\n      pageNum,\n      pageNum < currPageNum ? S_COVERED : S_NEXT,\n    );\n  };\n\n  const togglePage = (pageNum: number) =>\n    isPageDisabled(pageNum) ? enablePage(pageNum) : disablePage(pageNum);\n\n  const onTransition = (handler: WidgetHandler) =>\n    callbacks.add(wrapCallback(handler));\n\n  return {\n    _nextPage: nextPage,\n    _prevPage: prevPage,\n    _goToPage: goToPage,\n    _disablePage: disablePage,\n    _enablePage: enablePage,\n    _togglePage: togglePage,\n    _isPageDisabled: isPageDisabled,\n    _getCurrentPage: () => pages[currPageNum - 1],\n    _getPreviousPage: () => pages[lastPageNum - 1],\n    _getCurrentPageNum: () => (MH.lengthOf(pages) > 0 ? currPageNum : 0),\n    _getPreviousPageNum: () => (MH.lengthOf(pages) > 0 ? lastPageNum : 0),\n    _onTransition: onTransition,\n  };\n};\n","/**\n * @module Actions\n *\n * @categoryDescription Controlling pagers\n * {@link NextPage} and {@link PrevPage} advance or reverse the {@link Pager}\n * widget setup for the given element.\n *\n * {@link GoToPage} sets the {@link Pager} to the given page or toggles to the\n * last saved one.\n *\n * {@link EnablePage} and {@link DisablePage} enable or disable the given page\n * of the {@link Pager} widget setup for the given element.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { toInt } from \"@lisn/utils/math\";\n\nimport { Pager } from \"@lisn/widgets/pager\";\nimport { fetchUniqueWidget } from \"@lisn/widgets/widget\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\n/**\n * Advances or reverses the {@link Pager} widget setup for the given element.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"next-page\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <div class=\"lisn-pager\" data-lisn-on-click=\"@next-page +target=#myNextButton\"></div>\n * <button id=\"myNextButton\"></button>\n * ```\n *\n * @category Controlling pagers\n */\nexport class NextPage implements Action {\n  /**\n   * Advances the pager by one page.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Reverses the pager by one page.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Undoes the last action: reverses the pager if {@link do} was last called\n   * or advances it otherwise.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"next-page\", (element) => new NextPage(element));\n  }\n\n  constructor(element: Element) {\n    let toggleState = false;\n    const { _nextPage, _prevPage } = getMethods(element);\n\n    this.do = () => {\n      toggleState = true;\n      return _nextPage();\n    };\n\n    this.undo = () => {\n      toggleState = false;\n      return _prevPage();\n    };\n\n    this[MC.S_TOGGLE] = () => {\n      const method = toggleState ? _prevPage : _nextPage;\n      toggleState = !toggleState;\n      return method();\n    };\n  }\n}\n\n/**\n * Reverses or advances the {@link Pager} widget setup for the given element.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"prev-page\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <div class=\"lisn-pager\" data-lisn-on-click=\"@prev-page +target=#myPrevButton\"></div>\n * <button id=\"myPrevButton\"></button>\n * ```\n *\n * @category Controlling pagers\n */\nexport class PrevPage implements Action {\n  /**\n   * Reverses the pager by one page.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Advances the pager by one page.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Undoes the last action: advances the pager if {@link do} was last called\n   * or reverses it otherwise.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"prev-page\", (element) => new PrevPage(element));\n  }\n\n  constructor(element: Element) {\n    let toggleState = false;\n    const { _nextPage, _prevPage } = getMethods(element);\n\n    this.do = () => {\n      toggleState = true;\n      return _prevPage();\n    };\n\n    this.undo = () => {\n      toggleState = false;\n      return _nextPage();\n    };\n\n    this[MC.S_TOGGLE] = () => {\n      const method = toggleState ? _nextPage : _prevPage;\n      toggleState = !toggleState;\n      return method();\n    };\n  }\n}\n\n/**\n * Goes to a given page, or to the last one beforehand, of the {@link Pager}\n * widget setup for the given element.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"go-to-page\".\n * - Accepted string arguments: the number of the target page\n * - Accepted options: none\n *\n * @example\n * ```html\n * <div class=\"lisn-pager\" data-lisn-on-click=\"@go-to-page:2 +target=#myGoToButton\"></div>\n * <button id=\"myGoToButton\"></button>\n * ```\n *\n * @category Controlling pagers\n */\nexport class GoToPage implements Action {\n  /**\n   * Goes to the page number given to the constructor. Numbers start at 1.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Goes to the last saved page number before the action was {@link do}ne. If\n   * the action had never been done, does nothing.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Goes to the page number given to the constructor, or if already at this\n   * number, goes to the last saved page if any. Numbers start at 1.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\n      \"go-to-page\",\n      (element, args) => new GoToPage(element, toInt(args[0])),\n    );\n  }\n\n  constructor(element: Element, pageNum: number) {\n    if (!pageNum) {\n      throw MH.usageError(\"Target page is required\");\n    }\n\n    const { _goToPage } = getMethods(element);\n\n    this.do = () => _goToPage(pageNum);\n    this.undo = () => _goToPage(-1);\n    this[MC.S_TOGGLE] = () => _goToPage(pageNum, -1);\n  }\n}\n\n/**\n * Enables or disables the given page of the {@link Pager} widget setup for the\n * given element.\n *\n * **IMPORTANT:** When constructed, it disables the given page as a form of\n * initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"enable-page\".\n * - Accepted string arguments: the number of the target page\n * - Accepted options: none\n *\n * @example\n * ```html\n * <div class=\"lisn-pager\" data-lisn-on-click=\"@enable-page:2 +target=#myEnableButton\"></div>\n * <button id=\"myEnableButton\"></button>\n * ```\n *\n * @category Controlling pagers\n */\nexport class EnablePage implements Action {\n  /**\n   * Enables the page number given to the constructor. Numbers start at 1.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Disables the page number given to the constructor. Numbers start at 1.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Enables the page number given to the constructor, if it is disabled,\n   * otherwise disables it. Numbers start at 1.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\n      \"enable-page\",\n      (element, args) => new EnablePage(element, toInt(args[0])),\n    );\n  }\n\n  constructor(element: Element, pageNum: number) {\n    if (!pageNum) {\n      throw MH.usageError(\"Target page number is required\");\n    }\n\n    const { _enablePage, _disablePage, _togglePage } = getMethods(element);\n    _disablePage(pageNum); // initial state\n\n    this.do = () => _enablePage(pageNum);\n    this.undo = () => _disablePage(pageNum);\n    this[MC.S_TOGGLE] = () => _togglePage(pageNum);\n  }\n}\n\n/**\n * Disables or enables the given page of the {@link Pager} widget setup for the\n * given element.\n *\n * **IMPORTANT:** When constructed, it enables the given page as a form of\n * initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"disable-page\".\n * - Accepted string arguments: the number of the target page\n * - Accepted options: none\n *\n * @example\n * ```html\n * <button id=\"myDisableButton\"></button>\n * <div class=\"lisn-pager\" data-lisn-on-click=\"@disable-page:2 +target=#myDisableButton\"></div>\n * ```\n *\n * @category Controlling pagers\n */\nexport class DisablePage implements Action {\n  /**\n   * Disables the page number given to the constructor. Numbers start at 1.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Enables the page number given to the constructor. Numbers start at 1.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Disables the page number given to the constructor, if it is enabled,\n   * otherwise enables it. Numbers start at 1.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\n      \"disable-page\",\n      (element, args) => new DisablePage(element, toInt(args[0])),\n    );\n  }\n\n  constructor(element: Element, pageNum: number) {\n    if (!pageNum) {\n      throw MH.usageError(\"Target page number is required\");\n    }\n\n    const { _enablePage, _disablePage, _togglePage } = getMethods(element);\n    _enablePage(pageNum); // initial state\n\n    this.do = () => _disablePage(pageNum);\n    this.undo = () => _enablePage(pageNum);\n    this[MC.S_TOGGLE] = () => _togglePage(pageNum);\n  }\n}\n\n// --------------------\n\nconst getMethods = (element: Element) => {\n  let lastPageNum: number | null | undefined = null;\n\n  const nextPage = (widget: Pager | null) => widget?.nextPage();\n  const prevPage = (widget: Pager | null) => widget?.prevPage();\n\n  const goToPage = async (\n    widget: Pager | null,\n    pageNum: number,\n    altPageNum: number | null,\n  ) => {\n    const currentNum = widget?.getCurrentPageNum();\n    let targetNum: number | null | undefined =\n      currentNum === pageNum ? altPageNum : pageNum;\n    if (targetNum === -1) {\n      targetNum = lastPageNum;\n    }\n\n    if (targetNum) {\n      if (pageNum !== -1) {\n        // save the current number unless this is \"undo\"\n        lastPageNum = currentNum;\n      }\n\n      await widget?.goToPage(targetNum);\n    }\n  };\n\n  const enablePage = (widget: Pager | null, pageNum: number) =>\n    widget?.enablePage(pageNum);\n  const disablePage = (widget: Pager | null, pageNum: number) =>\n    widget?.disablePage(pageNum);\n  const togglePage = (widget: Pager | null, pageNum: number) =>\n    widget?.togglePage(pageNum);\n\n  const widgetPromise = fetchUniqueWidget(\"pager\", element, Pager);\n\n  return {\n    _nextPage: () => widgetPromise.then(nextPage),\n    _prevPage: () => widgetPromise.then(prevPage),\n\n    _goToPage: (pageNum: number, altPageNum: number | null = null) =>\n      widgetPromise.then((w) => goToPage(w, pageNum, altPageNum)),\n\n    _enablePage: (pageNum: number) =>\n      widgetPromise.then((w) => enablePage(w, pageNum)),\n    _disablePage: (pageNum: number) =>\n      widgetPromise.then((w) => disablePage(w, pageNum)),\n    _togglePage: (pageNum: number) =>\n      widgetPromise.then((w) => togglePage(w, pageNum)),\n  };\n};\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nexport * from \"@lisn/actions/add-class\";\nexport * from \"@lisn/actions/animate\";\nexport * from \"@lisn/actions/animate-play\";\nexport * from \"@lisn/actions/display\";\nexport * from \"@lisn/actions/trigger\";\nexport * from \"@lisn/actions/scroll-to\";\nexport * from \"@lisn/actions/set-attribute\";\nexport * from \"@lisn/actions/show\";\nexport * from \"@lisn/actions/open\";\nexport * from \"@lisn/actions/pager\";\n\nexport * from \"@lisn/actions/action\";\n","/**\n * @module Triggers\n *\n * @categoryDescription Input\n * {@link CheckTrigger} allows you to run actions when the user checks a target\n * checkbox input element, and undo those actions when they uncheck the checkbox.\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { waitForReferenceElement } from \"@lisn/utils/dom-search\";\nimport { addEventListenerTo, removeEventListenerFrom } from \"@lisn/utils/event\";\n\nimport { Action } from \"@lisn/actions/action\";\n\nimport {\n  registerTrigger,\n  Trigger,\n  TriggerConfig,\n} from \"@lisn/triggers/trigger\";\n\nimport { WidgetConfigValidatorFunc } from \"@lisn/widgets/widget\";\n\n/**\n * {@link CheckTrigger} allows you to run actions when the user checks a target\n * checkbox input element, and undo those actions when they uncheck the checkbox.\n *\n * -------\n *\n * To use with auto-widgets (HTML API), see {@link registerTrigger} for the\n * specification.\n *\n * - Arguments: none\n * - Additional trigger options: none\n *   - `target`: A string element specification.\n *     See {@link Utils.getReferenceElement | getReferenceElement}.\n *\n * @example\n * Add classes `active` and `checked` when the user checks the checkbox,\n * remove them when unchecked.\n *\n * ```html\n * <input type=\"checkbox\" data-lisn-on-check=\"@add-class=active,checked\"/>\n * ```\n *\n * @example\n * As above, but using a CSS class instead of data attribute:\n *\n * ```html\n * <input type=\"checkbox\" class=\"lisn-on-check--@add-class=active,checked\"/>\n * ```\n *\n * @example\n * Play the animations on the element each time the user checks the next\n * element with class `checkbox` (do nothing when it's unchecked).\n *\n * ```html\n * <div data-lisn-on-check=\"@animate +one-way +target=next.checkbox\"></div>\n * <input type=\"checkbox\" class=\"checkbox\"/>\n * ```\n *\n * @example\n * Add class `used` the first time the user checks the next element with class\n * `checkbox`, and play or reverse the animations 200ms after each time the\n * user toggles the reference checkbox.\n *\n * ```html\n * <div data-lisn-on-check=\"@add-class=used +once ;\n *                          @animate +delay=200 +target=next.checkbox\"\n * ></div>\n * <input type=\"checkbox\" class=\"checkbox\"/>\n * ```\n *\n * @example\n * When the user checks the next element with class `checkbox` then add classes `c1`\n * and `c2` to the element (that the trigger is defined on) and enable trigger\n * `my-trigger` defined on this same element; undo all of that when the user unchecks\n * the reference checkbox.\n *\n * ```html\n * <div data-lisn-on-check=\"@add-class=c1,c2 @enable=my-trigger +target=next.checkbox\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n * ></div>\n * <input type=\"checkbox\" class=\"checkbox\"/>\n * ```\n *\n * @example\n * As above, but using `data-lisn-ref` attribute instead of class selector.\n *\n * ```html\n * <div data-lisn-on-check=\"@add-class=c1,c2 @enable=my-trigger +target=next-checkbox\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n * ></div>\n * <input type=\"checkbox\" data-lisn-ref=\"checkbox\"/>\n * ```\n *\n * @category Input\n */\nexport class CheckTrigger extends Trigger {\n  readonly getConfig: () => CheckTriggerConfig;\n\n  static register() {\n    registerTrigger(\n      \"check\",\n      (element, args, actions, config) =>\n        new CheckTrigger(element, actions, config),\n      newConfigValidator,\n    );\n  }\n\n  /**\n   * If no actions are supplied, nothing is done.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the config is invalid.\n   */\n  constructor(\n    element: Element,\n    actions: Action[],\n    config?: CheckTriggerConfig,\n  ) {\n    super(element, actions, config);\n    this.getConfig = () => MH.copyObject(config);\n\n    if (!MH.lengthOf(actions)) {\n      return;\n    }\n\n    const target = MH.targetOf(config) ?? element;\n\n    if (!MH.isInstanceOf(target, HTMLInputElement)) {\n      return;\n    }\n\n    const onToggle = () => (target.checked ? this.run() : this.reverse());\n\n    addEventListenerTo(target, \"change\", onToggle);\n\n    this.onDestroy(() => {\n      removeEventListenerFrom(target, \"change\", onToggle);\n    });\n  }\n}\n\n/**\n * @category Input\n * @interface\n */\nexport type CheckTriggerConfig = TriggerConfig & {\n  /**\n   * The target to use for the hover action.\n   *\n   * @defaultValue The element on which the {@link Trigger} is defined\n   */\n  target?: Element;\n};\n\n// --------------------\n\nconst newConfigValidator: WidgetConfigValidatorFunc<CheckTriggerConfig> = (\n  element,\n) => {\n  return {\n    target: (key, value) =>\n      (MH.isLiteralString(value)\n        ? waitForReferenceElement(value, element)\n        : null) ?? undefined,\n  };\n};\n","/**\n * @module Triggers\n *\n * @categoryDescription Pointer\n * {@link ClickTrigger} allows you to run actions when a user clicks a target\n * element (first time and every other time, i.e. odd number of click), and undo\n * those actions when a user clicks the target element again (or every even\n * number of clicks). It always acts as a toggle.\n *\n * {@link PressTrigger} allows you to run actions when the user presses and\n * holds a pointing device (or their finger) on a target element, and undo those\n * actions when they release their pointing device or lift their finger off.\n *\n * {@link HoverTrigger} allows you to run actions when the user hovers overs a\n * target element, and undo those actions when their pointing device moves off\n * the target. On touch devices it acts just like {@link PressTrigger}.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { waitForReferenceElement } from \"@lisn/utils/dom-search\";\nimport { omitKeys } from \"@lisn/utils/misc\";\nimport { validateBoolean } from \"@lisn/utils/validation\";\n\nimport {\n  PointerWatcher,\n  OnPointerHandler,\n} from \"@lisn/watchers/pointer-watcher\";\n\nimport { Action } from \"@lisn/actions/action\";\n\nimport {\n  registerTrigger,\n  Trigger,\n  TriggerConfig,\n} from \"@lisn/triggers/trigger\";\n\nimport { WidgetConfigValidatorFunc } from \"@lisn/widgets/widget\";\n\n/**\n * {@link ClickTrigger} allows you to run actions when a user clicks a target\n * element (first time and every other time, i.e. odd number of click), and\n * undo them when a user clicks the target element again (or every even number\n * of clicks). It always acts as a toggle.\n *\n * -------\n *\n * To use with auto-widgets (HTML API), see {@link registerTrigger} for the\n * specification.\n *\n * - Arguments: none\n * - Additional trigger options: none\n *   - `target`: A string element specification.\n *     See {@link Utils.getReferenceElement | getReferenceElement}.\n *   - `prevent-default`: A boolean.\n *   - `prevent-select`: A boolean.\n *\n * @example\n * Add classes `active` and `toggled-on` when the user clicks the element\n * (first time and every other time, i.e. odd number of click), remove them\n * when clicked again (or even number of click);\n *\n * ```html\n * <div data-lisn-on-click=\"@add-class=active,toggled-on\"></div>\n * ```\n *\n * @example\n * As above, but using a CSS class instead of data attribute:\n *\n * ```html\n * <div class=\"lisn-on-click--@add-class=active,toggled-on\"></div>\n * ```\n *\n * @example\n * Play the animations on the element 1000ms after the first time the user\n * clicks it.\n *\n * ```html\n * <div data-lisn-on-click=\"@animate +once +delay=1000\"></div>\n * ```\n *\n * @example\n * Add class `visited` the first time the user clicks the element, and play or\n * reverse the animations on the element 1000ms after each time the user clicks\n * it.\n *\n * ```html\n * <div data-lisn-on-click=\"@add-class=visited +once ;\n *                          @animate +delay=1000\"\n * ></div>\n * ```\n *\n * @example\n * When the user clicks the next element with class `box` then add classes `c1`\n * and `c2` to the element (that the trigger is defined on) and enable trigger\n * `my-trigger` defined on this same element; undo all of that on even number\n * of clicks on the reference box element.\n *\n * ```html\n * <div data-lisn-on-click=\"@add-class=c1,c2 @enable=my-trigger +target=next.box\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n * ></div>\n * <div class=\"box\"></div>\n * ```\n *\n * @example\n * As above, but using `data-lisn-ref` attribute instead of class selector.\n *\n * ```html\n * <div data-lisn-on-click=\"@add-class=c1,c2 @enable=my-trigger +target=next-box\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n * ></div>\n * <div data-lisn-ref=\"box\"></div>\n * ```\n *\n * @category Pointer\n */\nexport class ClickTrigger extends Trigger {\n  readonly getConfig: () => PointerTriggerConfig;\n\n  static register() {\n    registerTrigger(\n      MC.S_CLICK,\n      (element, args, actions, config) =>\n        new ClickTrigger(element, actions, config),\n      newConfigValidator,\n    );\n  }\n\n  /**\n   * If no actions are supplied, nothing is done.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the config is invalid.\n   */\n  constructor(\n    element: Element,\n    actions: Action[],\n    config?: PointerTriggerConfig,\n  ) {\n    super(element, actions, config);\n    this.getConfig = () => MH.copyObject(config);\n\n    setupWatcher(this, element, actions, config, MC.S_CLICK);\n  }\n}\n\n/**\n * {@link PressTrigger} allows you to run actions when the user presses and\n * holds a pointing device (or their finger) on a target element, and undo\n * those actions when they release their pointing device or lift their finger\n * off.\n *\n * -------\n *\n * To use with auto-widgets (HTML API), see {@link registerTrigger} for the\n * specification.\n *\n * - Arguments: none\n * - Additional trigger options: none\n *   - `target`: A string element specification.\n *     See {@link Utils.getReferenceElement | getReferenceElement}.\n *   - `prevent-default`: boolean\n *   - `prevent-select`: boolean\n *\n * @example\n * Add classes `active` and `pressed` when the user presses and holds (with\n * mouse, finger or any pointer) the element, remove them when they release\n * the mouse.\n *\n * ```html\n * <div data-lisn-on-press=\"@add-class=active,pressed\"></div>\n * ```\n *\n * @example\n * As above, but using a CSS class instead of data attribute:\n *\n * ```html\n * <div class=\"lisn-on-press--@add-class=active,pressed\"></div>\n * ```\n *\n * @example\n * Play the animations on the element 1000ms after the first time the user\n * presses on the element it.\n *\n * ```html\n * <div data-lisn-on-press=\"@animate +once +delay=1000\"></div>\n * ```\n *\n * @example\n * Add class `pressed` the first time the user presses on the element, and\n * play the animations on the element while the user is pressing on the element\n * with a delay of 100ms, reverse the animations as soon as the user releases\n * the mouse.\n *\n * ```html\n * <div data-lisn-on-click=\"@add-class=pressed +once ;\n *                          @animate +do-delay=100\"\n * ></div>\n * ```\n *\n * @example\n * When the user presses and holds the next element with class `box` then add\n * classes `c1` and `c2` to the element (that the trigger is defined on) and\n * enable trigger `my-trigger` defined on this same element; undo all of that\n * when they release the mouse (or lift their finger/pointer device) from the\n * reference box element.\n *\n * ```html\n * <div data-lisn-on-press=\"@add-class=c1,c2 @enable=my-trigger +target=next.box\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n * ></div>\n * <div class=\"box\"></div>\n * ```\n *\n * @example\n * As above, but using `data-lisn-ref` attribute instead of class selector.\n *\n * ```html\n * <div data-lisn-on-press=\"@add-class=c1,c2 @enable=my-trigger +target=next-box\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n * ></div>\n * <div data-lisn-ref=\"box\"></div>\n * ```\n *\n * @category Pointer\n */\nexport class PressTrigger extends Trigger {\n  readonly getConfig: () => PointerTriggerConfig;\n\n  static register() {\n    registerTrigger(\n      MC.S_PRESS,\n      (element, args, actions, config) =>\n        new PressTrigger(element, actions, config),\n      newConfigValidator,\n    );\n  }\n\n  /**\n   * If no actions are supplied, nothing is done.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the config is invalid.\n   */\n  constructor(\n    element: Element,\n    actions: Action[],\n    config?: PointerTriggerConfig,\n  ) {\n    super(element, actions, config);\n    this.getConfig = () => MH.copyObject(config);\n\n    setupWatcher(this, element, actions, config, MC.S_PRESS);\n  }\n}\n\n/**\n * {@link HoverTrigger} allows you to run actions when the user hovers overs\n * a target element, and undo those actions when their pointing device moves\n * off the target. On touch devices it acts just like {@link PressTrigger}.\n *\n * -------\n *\n * To use with auto-widgets (HTML API), see {@link registerTrigger} for the\n * specification.\n *\n * - Arguments: none\n * - Additional trigger options: none\n *   - `target`: A string element specification.\n *     See {@link Utils.getReferenceElement | getReferenceElement}.\n *   - `prevent-default`: boolean\n *   - `prevent-select`: boolean\n *\n * @example\n * Add classes `active` and `hovered` when the user hovers over the element,\n * remove them otherwise.\n *\n * ```html\n * <div data-lisn-on-hover=\"@add-class=active,hovered\"></div>\n * ```\n *\n * @example\n * As above, but using a CSS class instead of data attribute:\n *\n * ```html\n * <div class=\"lisn-on-press--@add-class=active,hovered\"></div>\n * ```\n *\n * @example\n * Play the animations on the element 1000ms after the first time the user\n * hovers over the element it.\n *\n * ```html\n * <div data-lisn-on-hover=\"@animate +once +delay=1000\"></div>\n * ```\n *\n * @example\n * Add class `hovered` the first time the user hovers over the element, and\n * play the animations on the element while the user is hovering over the\n * element with a delay of 100ms, reverse the animations as soon as the user\n * mouse leaves the element.\n *\n * ```html\n * <div data-lisn-on-click=\"@add-class=hovered +once ;\n *                          @animate +do-delay=100\"\n * ></div>\n * ```\n *\n * @example\n * When the user hovers over the next element with class `box` then add classes\n * `c1` and `c2` to the element (that the trigger is defined on) and enable\n * trigger `my-trigger` defined on this same element; undo all of that when\n * their pointing device (or finger) moves off the reference element.\n *\n * ```html\n * <div data-lisn-on-hover=\"@add-class=c1,c2 @enable=my-trigger +target=next.box\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n * ></div>\n * <div class=\"box\"></div>\n * ```\n *\n * @example\n * As above, but using `data-lisn-ref` attribute instead of class selector.\n *\n * ```html\n * <div data-lisn-on-hover=\"@add-class=c1,c2 @enable=my-trigger +target=next-box\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n * ></div>\n * <div data-lisn-ref=\"box\"></div>\n * ```\n *\n * @category Pointer\n */\nexport class HoverTrigger extends Trigger {\n  readonly getConfig: () => PointerTriggerConfig;\n\n  static register() {\n    registerTrigger(\n      MC.S_HOVER,\n      (element, args, actions, config) =>\n        new HoverTrigger(element, actions, config),\n      newConfigValidator,\n    );\n  }\n\n  /**\n   * If no actions are supplied, nothing is done.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the config is invalid.\n   */\n  constructor(\n    element: Element,\n    actions: Action[],\n    config?: PointerTriggerConfig,\n  ) {\n    super(element, actions, config);\n    this.getConfig = () => MH.copyObject(config);\n\n    setupWatcher(this, element, actions, config, MC.S_HOVER);\n  }\n}\n\n/**\n * @category Pointer\n * @interface\n */\nexport type PointerTriggerConfig = TriggerConfig & {\n  /**\n   * The target to use for the hover action.\n   *\n   * @defaultValue The element on which the {@link Trigger} is defined\n   */\n  target?: Element;\n\n  /**\n   * See {@link Watchers/PointerWatcher.OnPointerOptions | OnPointerOptions}.\n   *\n   * @defaultValue {@link PointerWatcher} default, false\n   */\n  preventDefault?: boolean;\n\n  /**\n   * See {@link Watchers/PointerWatcher.OnPointerOptions | OnPointerOptions}.\n   *\n   * @defaultValue {@link PointerWatcher} default, true\n   */\n  preventSelect?: boolean;\n};\n\n// --------------------\n\nconst newConfigValidator: WidgetConfigValidatorFunc<PointerTriggerConfig> = (\n  element,\n) => {\n  return {\n    target: (key, value) =>\n      (MH.isLiteralString(value)\n        ? waitForReferenceElement(value, element)\n        : null) ?? undefined,\n    preventDefault: validateBoolean,\n    preventSelect: validateBoolean,\n  };\n};\n\nconst setupWatcher = (\n  widget: ClickTrigger | HoverTrigger | PressTrigger,\n  element: Element,\n  actions: Action[],\n  config: PointerTriggerConfig | undefined,\n  action: \"click\" | \"hover\" | \"press\",\n) => {\n  if (!MH.lengthOf(actions)) {\n    return;\n  }\n\n  config ??= {};\n  const target = MH.targetOf(config) ?? element;\n\n  // For clicks use the trigger's own toggle function so that it remembers ITS\n  // state rather than the odd/even clicks. Otherwise if the trigger is\n  // disabled, then clicking will \"swap\" the state.\n  let startHandler: OnPointerHandler;\n  let endHandler: OnPointerHandler;\n  if (action === MC.S_CLICK) {\n    startHandler = endHandler = widget[MC.S_TOGGLE];\n  } else {\n    startHandler = widget.run;\n    endHandler = widget.reverse;\n  }\n\n  PointerWatcher.reuse().onPointer(\n    target,\n    startHandler,\n    endHandler,\n    MH.merge(\n      {\n        actions: action,\n      },\n      omitKeys(config, { target: null }),\n    ),\n  );\n};\n","/**\n * @module Triggers\n *\n * @categoryDescription Layout\n * {@link LayoutTrigger} allows you to run actions when the viewport or a\n * target element's width or aspect ratio matches a given specification, and\n * undo those actions when the target's width or aspect ratio no longer\n * matches.\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  DeviceSpec,\n  Device,\n  AspectRatioSpec,\n  AspectRatio,\n} from \"@lisn/globals/types\";\n\nimport { waitForReferenceElement } from \"@lisn/utils/dom-search\";\nimport {\n  isValidDeviceList,\n  isValidAspectRatioList,\n  getOtherDevices,\n  getOtherAspectRatios,\n} from \"@lisn/utils/layout\";\nimport { validateStringRequired } from \"@lisn/utils/validation\";\n\nimport { Action } from \"@lisn/actions/action\";\n\nimport { LayoutWatcher } from \"@lisn/watchers/layout-watcher\";\n\nimport {\n  registerTrigger,\n  Trigger,\n  TriggerConfig,\n} from \"@lisn/triggers/trigger\";\n\nimport { WidgetConfigValidatorFunc } from \"@lisn/widgets/widget\";\n\n/**\n * {@link LayoutTrigger} allows you to run actions when the viewport or a\n * target element's width or aspect ratio matches a given specification, and\n * undo those actions when the target's width or aspect ratio no longer\n * matches.\n *\n * -------\n *\n * To use with auto-widgets (HTML API), see {@link registerTrigger} for the\n * specification.\n *\n * - Arguments (required): A single {@link DeviceSpec} or\n *   {@link AspectRatioSpec}. In this case you can use a dash (\"-\") instead of\n *   space if needed (for example if using CSS classes instead of data\n *   attributes), e.g. \"min-tablet\" instead of \"min tablet\".\n *\n * - Additional trigger options:\n *   - `root`: A string element specification. See\n *     {@link Utils.getReferenceElement | getReferenceElement}.\n *\n * @example\n * Show the element when the window width matches \"tablet\" breakpoint, hide\n * otherwise:\n *\n * ```html\n * <div data-lisn-on-layout=\"tablet @show\"></div>\n * ```\n *\n * @example\n * As above, but using a CSS class instead of data attribute:\n *\n * ```html\n * <div class=\"lisn-on-layout--tablet@show\"></div>\n * ```\n *\n * @example\n * Show the element 1000ms after the window width matches \"tablet\" breakpoint,\n * hide otherwise:\n *\n * ```html\n * <div data-lisn-on-layout=\"tablet @show +delay=1000\"></div>\n * ```\n *\n * @example\n * Add class `tablet` when the window width is at least \"tablet\", hide\n * otherwise:\n *\n * ```html\n * <div data-lisn-on-layout=\"min tablet @add-class=tablet\"></div>\n * ```\n *\n * @example\n * Add class `mobile` when the window width is \"mobile\" or mobile-wide, add\n * class `tablet`, when it's \"tablet\" and so on; undo that otherwise:\n *\n * ```html\n * <div data-lisn-on-layout=\"max mobile-wide @add-class=mobile ;\n *                           tablet @add-class=tablet ;\n *                           desktop @add-class=desktop\"\n * ></div>\n * ```\n *\n * @example\n * Show the element when window width is at least \"mobile-wide\" and at most\n * \"tablet\", hide otherwise:\n *\n * ```html\n * <div data-lisn-on-layout=\"mobile-wide to tablet @show\"></div>\n * ```\n *\n * @example\n * When the aspect ratio of the next element with class `box` is square, then\n * add classes `c1` and `c2` to the element (that the trigger is defined on) and\n * enable trigger `my-trigger` defined on this same element; undo all of that\n * otherwise (on other aspect ratios of the reference root):\n *\n * ```html\n * <div data-lisn-on-layout=\"square @add-class=c1,c2 @enable=my-trigger +root=next.box\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n * ></div>\n * <div class=\"box\"></div>\n * ```\n *\n * @example\n * As above, but using `data-lisn-ref` attribute instead of class selector.\n *\n * ```html\n * <div data-lisn-on-layout=\"square @add-class=c1,c2 @enable=my-trigger +root=next-box\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n * ></div>\n * <div data-lisn-ref=\"box\"></div>\n *\n * @category Layout\n */\nexport class LayoutTrigger extends Trigger {\n  readonly getConfig: () => LayoutTriggerConfig;\n\n  static register() {\n    registerTrigger(\n      \"layout\",\n      (element, args, actions, config) => {\n        return new LayoutTrigger(\n          element,\n          actions,\n          MH.assign(config, {\n            layout: validateStringRequired(\n              \"layout\",\n              MH.strReplace(\n                MH.strReplace(args[0] ?? \"\", /(min|max)-/g, \"$1 \"),\n                /-to-/g,\n                \" to \",\n              ),\n              (value) =>\n                isValidDeviceList(value) || isValidAspectRatioList(value),\n            ),\n          }),\n        );\n      },\n      newConfigValidator,\n    );\n  }\n\n  /**\n   * If no actions are supplied, nothing is done.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the config is invalid.\n   */\n  constructor(\n    element: Element,\n    actions: Action[],\n    config: LayoutTriggerConfig,\n  ) {\n    const layout = config?.layout ?? \"\";\n    if (!layout) {\n      throw MH.usageError(\"'layout' is required\");\n    }\n\n    super(element, actions, config);\n    this.getConfig = () => MH.copyObject(config);\n\n    if (!MH.lengthOf(actions)) {\n      return;\n    }\n\n    let devices: DeviceSpec | Device[] = [];\n    let aspectRatios: AspectRatioSpec | AspectRatio[] = [];\n    let otherDevices: Device[] = [];\n    let otherAspectRatios: AspectRatio[] = [];\n\n    if (isValidDeviceList(layout)) {\n      devices = layout;\n      otherDevices = getOtherDevices(layout);\n    } else {\n      aspectRatios = layout;\n      otherAspectRatios = getOtherAspectRatios(layout);\n    }\n\n    const root = config.root;\n    const watcher = LayoutWatcher.reuse({ root });\n\n    watcher.onLayout(this.run, { devices, aspectRatios });\n\n    if (MH.lengthOf(otherDevices) || MH.lengthOf(otherAspectRatios)) {\n      watcher.onLayout(this.reverse, {\n        devices: otherDevices,\n        aspectRatios: otherAspectRatios,\n      });\n    }\n  }\n}\n\n/**\n * @category Layout\n * @interface\n */\nexport type LayoutTriggerConfig = TriggerConfig & {\n  /**\n   * The {@link DeviceSpec} or {@link AspectRatioSpec} to use. Required.\n   * See {@link Watchers/LayoutWatcher.OnLayoutOptions | OnLayoutOptions} for\n   * accepted formats.\n   *\n   * Actions will be \"done\" when the layout of the root matches the given spec\n   * and \"undone\" otherwise.\n   */\n  layout: DeviceSpec | Device[] | AspectRatioSpec | AspectRatio[];\n\n  /**\n   * The root to use for the {@link LayoutWatcher}.\n   * See {@link Watchers/LayoutWatcher.LayoutWatcherConfig | LayoutWatcherConfig}\n   *\n   * @defaultValue {@link LayoutWatcher} default, the viewport\n   */\n  root?: HTMLElement | null;\n};\n\n// --------------------\n\nconst newConfigValidator: WidgetConfigValidatorFunc<\n  Omit<LayoutTriggerConfig, \"layout\">\n> = (element) => {\n  return {\n    root: async (key, value) => {\n      const root = MH.isLiteralString(value)\n        ? await waitForReferenceElement(value, element)\n        : undefined;\n      if (root && !MH.isHTMLElement(root)) {\n        throw MH.usageError(\"root must be HTMLElement\");\n      }\n      return root;\n    },\n  };\n};\n","/**\n * @module Triggers\n *\n * @categoryDescription Load\n * {@link LoadTrigger} allows you to run actions once when the page is loaded.\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { waitForPageReady } from \"@lisn/utils/dom-events\";\n\nimport { Action } from \"@lisn/actions/action\";\n\nimport {\n  registerTrigger,\n  Trigger,\n  TriggerConfig,\n} from \"@lisn/triggers/trigger\";\n\n/**\n * {@link LoadTrigger} allows you to run actions one when the page is loaded.\n *\n * -------\n *\n * To use with auto-widgets (HTML API), see {@link registerTrigger} for the\n * specification.\n *\n * - Arguments: none\n * - Additional trigger options: none\n *\n * @example\n * Scroll to the given element when the page is loaded:\n *\n * ```html\n * <div data-lisn-on-load=\":scroll-to\"></div>\n * ```\n *\n * @example\n * Scroll to 100px above the given element 500ms after the page is loaded:\n *\n * ```html\n * <div data-lisn-on-load=\"@scroll-to=0,-100 +delay=500\"></div>\n * ```\n *\n * @example\n * Scroll to 100px above the given element 500ms after the page is loaded, and\n * play animations defined on it 500ms later (1000ms after it's loaded):\n *\n * ```html\n * <div data-lisn-on-load=\"@scroll-to=0,-100 +delay=500 ;\n *                         @animate +delay=1000\"\n * ></div>\n * ```\n *\n * @category Load\n */\nexport class LoadTrigger extends Trigger {\n  readonly getConfig: () => TriggerConfig;\n\n  static register() {\n    registerTrigger(\n      \"load\",\n      (element, args, actions, config) =>\n        new LoadTrigger(element, actions, config),\n    );\n  }\n\n  /**\n   * If no actions are supplied, nothing is done.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the config is invalid.\n   */\n  constructor(element: Element, actions: Action[], config: TriggerConfig) {\n    super(element, actions, config);\n    this.getConfig = () => MH.copyObject(config);\n\n    if (!MH.lengthOf(actions)) {\n      return;\n    }\n\n    waitForPageReady().then(this.run);\n  }\n}\n","/**\n * @module Triggers\n *\n * @categoryDescription Scroll\n * {@link ScrollTrigger} allows you to run actions when the user scrolls a\n * target element (or the main scrollable element) in a given direction, and\n * undo those actions when they scroll in the opposite direction.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  XYDirection,\n  CommaSeparatedStr,\n  ScrollTarget,\n} from \"@lisn/globals/types\";\n\nimport {\n  getOppositeXYDirections,\n  isValidXYDirection,\n} from \"@lisn/utils/directions\";\nimport { waitForReferenceElement } from \"@lisn/utils/dom-search\";\nimport { validateStrList, validateNumber } from \"@lisn/utils/validation\";\n\nimport { Action } from \"@lisn/actions/action\";\n\nimport { ScrollWatcher } from \"@lisn/watchers/scroll-watcher\";\n\nimport {\n  registerTrigger,\n  Trigger,\n  TriggerConfig,\n} from \"@lisn/triggers/trigger\";\n\nimport { WidgetConfigValidatorFunc } from \"@lisn/widgets/widget\";\n\n/**\n * {@link ScrollTrigger} allows you to run actions when the user scrolls a\n * target element (or the main scrollable element) in a given direction, and\n * undo those actions when they scroll in the opposite direction.\n *\n * -------\n *\n * To use with auto-widgets (HTML API), see {@link registerTrigger} for the\n * specification.\n *\n * - Arguments (optional): One or more (comma-separated) scroll directions.\n *   Note that if you do not specify any directions, then the trigger will just\n *   run once, on any scroll.\n * - Additional trigger options:\n *   - `scrollable`: A string element specification.\n *      See {@link Utils.getReferenceElement | getReferenceElement}.\n *   - `threshold`: A number.\n *\n * @example\n * Show the element when the user scrolls the page up, hide when scrolling\n * down. User scrolling left or right not trigger the action. See\n * {@link getOppositeXYDirections}:\n *\n * ```html\n * <div data-lisn-on-scroll=\"up @show\"></div>\n * ```\n *\n * @example\n * As above, but using a CSS class instead of data attribute:\n *\n * ```html\n * <div class=\"lisn-on-scroll--up@show\"></div>\n * ```\n *\n * @example\n * Show the element 1000ms after the first time the user scrolls the page up:\n *\n * ```html\n * <div data-lisn-on-scroll=\"up @show +once +delay=1000\"></div>\n * ```\n *\n * @example\n * Add class `scrolled` the first time the user scrolls the page in any\n * direction (note that the `once` option is implied here), and show the\n * element 1000ms after each time the user scrolls the page up, hide it as soon\n * as they scroll down:\n *\n * ```html\n * <div data-lisn-on-scroll=\"@add-class=scrolled ;\n *                           up @show +do-delay=1000\"\n * ></div>\n * ```\n *\n * @example\n * When the user scrolls up or down the closest ancestor with class `section`,\n * then add classes `c1` and `c2` and enable trigger `my-trigger` defined on\n * this same element; undo all of that when scrolling right or left:\n *\n * ```html\n * <div class=\"section\">\n *   <div data-lisn-on-scroll=\"up,down @add-class=c1,c2 @enable=my-trigger +scrollable=this.section\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n *   ></div>\n *</div>\n * ```\n *\n * @example\n * As above, but using `data-lisn-ref` attribute instead of class selector.\n *\n * ```html\n * <div data-lisn-ref=\"section\">\n *   <div data-lisn-on-scroll=\"up,down @add-class=c1,c2 @enable=my-trigger +scrollable=this-section\"\n *      data-lisn-on-run=\"@show +id=my-trigger\"\n *   ></div>\n *</div>\n * ```\n *\n * @category Scroll\n */\nexport class ScrollTrigger extends Trigger {\n  readonly getConfig: () => ScrollTriggerConfig;\n\n  static register() {\n    registerTrigger(\n      MC.S_SCROLL,\n      (element, args, actions, config) => {\n        return new ScrollTrigger(\n          element,\n          actions,\n          MH.assign(config, {\n            directions: validateStrList(\"directions\", args, isValidXYDirection),\n          }),\n        );\n      },\n      newConfigValidator,\n    );\n  }\n\n  /**\n   * If no actions are supplied, nothing is done.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the config is invalid.\n   */\n  constructor(\n    element: Element,\n    actions: Action[],\n    config?: ScrollTriggerConfig,\n  ) {\n    config ??= {};\n\n    let directions = config.directions;\n    if (!directions) {\n      config.once = true;\n      directions = [MC.S_UP, MC.S_DOWN, MC.S_LEFT, MC.S_RIGHT];\n    }\n\n    super(element, actions, config);\n    this.getConfig = () => MH.copyObject(config);\n\n    if (!MH.lengthOf(actions)) {\n      return;\n    }\n\n    const watcher = ScrollWatcher.reuse();\n    const scrollable = config.scrollable;\n    const threshold = config.threshold;\n\n    const oppositeDirections = directions\n      ? getOppositeXYDirections(directions)\n      : [];\n\n    watcher.onScroll(this.run, {\n      directions,\n      scrollable,\n      threshold,\n    });\n\n    if (MH.lengthOf(oppositeDirections)) {\n      watcher.onScroll(this.reverse, {\n        directions: oppositeDirections,\n        scrollable,\n        threshold,\n      });\n    }\n  }\n}\n\n/**\n * @category Scroll\n * @interface\n */\nexport type ScrollTriggerConfig = TriggerConfig & {\n  /**\n   * The {@link XYDirection}s to use as the trigger.\n   * See also {@link Watchers/ScrollWatcher.OnScrollOptions | OnScrollOptions}\n   *\n   * Actions will be \"done\" when the scroll direction is one of the given ones\n   * and \"undone\" when it's the opposite direction. E.g. for \"up\" the opposite\n   * is \"down\".\n   */\n  directions?: CommaSeparatedStr<XYDirection> | XYDirection[];\n\n  /**\n   * The scrolling element target to use for the ScrollWatcher.\n   * See {@link Watchers/ScrollWatcher.OnScrollOptions | OnScrollOptions}\n   *\n   * @defaultValue {@link ScrollWatcher} default, the main scrolling element\n   */\n  scrollable?: ScrollTarget;\n\n  /**\n   * The scroll threshold to pass to the {@link ScrollWatcher}.\n   * See also {@link Watchers/ScrollWatcher.OnScrollOptions | OnScrollOptions}\n   *\n   * @defaultValue {@link ScrollWatcher} default\n   */\n  threshold?: number;\n};\n\n// --------------------\n\nconst newConfigValidator: WidgetConfigValidatorFunc<\n  Omit<ScrollTriggerConfig, \"directions\">\n> = (element) => {\n  return {\n    scrollable: (key, value) =>\n      (MH.isLiteralString(value)\n        ? waitForReferenceElement(value, element)\n        : null) ?? undefined,\n    threshold: validateNumber,\n  };\n};\n","/**\n * @module Triggers\n *\n * @categoryDescription View\n * {@link ViewTrigger} allows you to run actions when the viewport's scroll\n * position relative to a given target or offset from top/bottom/left/right is\n * one of the matching \"views\" (at/above/below/left/right), and undo those\n * actions when the viewport's \"view\" is not matching.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { ViewTarget, View, CommaSeparatedStr } from \"@lisn/globals/types\";\n\nimport { hasClass } from \"@lisn/utils/css-alter\";\nimport { insertGhostClone, tryWrap } from \"@lisn/utils/dom-alter\";\nimport { waitForReferenceElement } from \"@lisn/utils/dom-search\";\nimport { formatAsString } from \"@lisn/utils/text\";\nimport {\n  validateStrList,\n  validateString,\n  validateNumList,\n} from \"@lisn/utils/validation\";\nimport {\n  getOppositeViews,\n  isValidView,\n  isValidScrollOffset,\n} from \"@lisn/utils/views\";\n\nimport { Action } from \"@lisn/actions/action\";\nimport { Animate } from \"@lisn/actions/animate\";\nimport { AnimatePlay } from \"@lisn/actions/animate-play\";\n\nimport { ViewWatcher } from \"@lisn/watchers/view-watcher\";\n\nimport {\n  registerTrigger,\n  Trigger,\n  TriggerConfig,\n} from \"@lisn/triggers/trigger\";\n\nimport { WidgetConfigValidatorFunc } from \"@lisn/widgets/widget\";\n\nimport debug from \"@lisn/debug/debug\";\n\n/**\n * {@link ViewTrigger} allows you to run actions when the viewport's scroll\n * position relative to a given target or offset from top/bottom/left/right is\n * one of the matching \"views\" (at/above/below/left/right), and undo those\n * actions when the viewport's \"view\" is not matching.\n *\n * -------\n *\n * To use with auto-widgets (HTML API), see {@link registerTrigger} for the\n * specification.\n *\n * - Arguments (optional): One or more (comma-separated) {@link View}s.\n *   Default is \"at\".\n * - Additional trigger options:\n *   - `target`: A string element specification for an element (see\n *     {@link Utils.getReferenceElement | getReferenceElement}) or a\n *     {@link Types.ScrollOffset | ScrollOffset}.\n *   - `root`: A string element specification. See\n *     {@link Utils.getReferenceElement | getReferenceElement}.\n *   - `rootMargin`: A string.\n *   - `threshold`: A number or list (comma-separated) of numbers.\n *\n * @example\n * Show the element when it's in the viewport, hide otherwise.\n *\n * ```html\n * <div data-lisn-on-view=\"at @show\"></div>\n * ```\n *\n * @example\n * Same as above. \"views\" is optional and defaults to \"at\".\n *\n * ```html\n * <div data-lisn-on-view=\"@show\"></div>\n * ```\n *\n * @example\n * As above but using a CSS class instead of data attribute:\n *\n * ```html\n * <div class=\"lisn-on-view--@show\"></div>\n * ```\n *\n * @example\n * Show the element 1000ms after the first time it enters the viewport.\n *\n * ```html\n * <div data-lisn-on-view=\"@show +once +delay=1000\"></div>\n * ```\n *\n * @example\n * Add class `seen` the first time the element enters the viewport, and play\n * the animations defined on it 1000ms after each time it enters the viewport,\n * reverse the animations as soon as it goes out of view.\n *\n * ```html\n * <div data-lisn-on-view=\"@add-class=seen +once ;\n *                         @animate +do-delay=1000\"\n * ></div>\n * ```\n *\n * @example\n * Add class `seen` when the viewport is at or below the element (element\n * above viewport), remove it when the viewport is above the element.\n * Element going to the left or right of the viewport will not trigger the\n * action. See {@link getOppositeViews}:\n *\n * ```html\n * <div data-lisn-on-view=\"at,below @add-class=seen\"></div>\n * ```\n *\n * @example\n * Add class `cls` when the viewport is above or to the left the element\n * (element below or to the right of the viewport), remove it when the\n * viewport is either at, below or to the right of the element.\n *\n * ```html\n * <div data-lisn-on-view=\"above,left @add-class=cls\"></div>\n * ```\n *\n * @example\n * Hide the element when the viewport is above the next element with class\n * `section`, show it when the viewport is below or at the target element.\n *\n * ```html\n * <div data-lisn-on-view=\"above @hide +target=next.section\"></div>\n * <div class=\"section\"></div>\n * ```\n *\n * @example\n * As above, but using `data-lisn-ref` attribute instead of class selector.\n *\n * ```html\n * <div data-lisn-on-view=\"above @hide +target=next-section\"></div>\n * <div data-lisn-ref=\"section\"></div>\n * ```\n *\n * @example\n * Open the {@link Widgets.Openable | Openable} widget configured for this\n * element when the viewport is 75% down from the top of the page.\n *\n * ```html\n * <div data-lisn-on-view=\"@open +target=top:75%\"></div>\n * ```\n *\n * @category View\n */\nexport class ViewTrigger extends Trigger {\n  readonly getConfig: () => ViewTriggerConfig;\n\n  static register() {\n    registerTrigger(\n      \"view\",\n      (element, args, actions, config) => {\n        return new ViewTrigger(\n          element,\n          actions,\n          MH.assign(config, {\n            views: validateStrList(\"views\", args, isValidView),\n          } as const),\n        );\n      },\n      newConfigValidator,\n    );\n  }\n\n  /**\n   * If no actions are supplied, nothing is done.\n   *\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If the config is invalid.\n   */\n  constructor(element: Element, actions: Action[], config?: ViewTriggerConfig) {\n    super(element, actions, config);\n\n    const logger = debug\n      ? new debug.Logger({\n          name: `ViewTrigger-${formatAsString(element)}`,\n        })\n      : null;\n\n    this.getConfig = () => MH.copyObject(config);\n\n    if (!MH.lengthOf(actions)) {\n      return;\n    }\n\n    const watcher = ViewWatcher.reuse({\n      root: config?.root,\n      rootMargin: config?.rootMargin?.replace(/,/g, \" \"),\n      threshold: config?.threshold,\n    });\n\n    const target = config?.target ?? element;\n    const views = config?.views || MC.S_AT;\n    const oppositeViews = getOppositeViews(views);\n\n    const setupWatcher = (target: ViewTarget) => {\n      if (!MH.lengthOf(oppositeViews)) {\n        debug: logger?.debug6(\"Trigger can never be reversed, running now\");\n        // The action is never undone\n        this.run();\n      } else {\n        debug: logger?.debug6(\"Setting up trigger\", views, oppositeViews);\n        watcher.onView(target, this.run, { views });\n        watcher.onView(target, this.reverse, { views: oppositeViews });\n      }\n    };\n\n    // See comment in globals/settings under contentWrappingAllowed\n    let willAnimate = false;\n    for (const action of actions) {\n      if (\n        MH.isInstanceOf(action, Animate) ||\n        MH.isInstanceOf(action, AnimatePlay)\n      ) {\n        willAnimate = true;\n        break;\n      }\n    }\n\n    if (willAnimate) {\n      setupRepresentative(element).then(setupWatcher);\n    } else {\n      setupWatcher(target);\n    }\n  }\n}\n\n/**\n * @category View\n * @interface\n */\nexport type ViewTriggerConfig = TriggerConfig & {\n  /**\n   * The {@link View} to use as the trigger.\n   * See also {@link Watchers/ViewWatcher.OnViewOptions | OnViewOptions}\n   *\n   * Actions will be \"done\" when the view matches the given spec and \"undone\"\n   * otherwise. What the opposite views are depends on the given view. E.g. for\n   * \"at\", opposites are all the other ones;  for \"above\", the opposite ones\n   * are \"at\" and \"below\"; for \"at,above\" opposite is \"below\", etc.\n   *\n   * @defaultValue \"at\"\n   */\n  views?: CommaSeparatedStr<View> | View[];\n\n  /**\n   * The target to use for the ViewWatcher. It can be a string offset\n   * specification.\n   * See {@link Watchers/ViewWatcher.OnViewOptions | OnViewOptions}\n   *\n   * @defaultValue The element on which the {@link ViewTrigger} is defined\n   */\n  target?: ViewTarget;\n\n  /**\n   * The root to pass to the {@link ViewWatcher}.\n   * See also {@link Watchers/ViewWatcher.ViewWatcherConfig | ViewWatcherConfig}\n   *\n   * @defaultValue {@link ViewWatcher} default\n   */\n  root?: Element | null;\n\n  /**\n   * The root margin to pass to the {@link ViewWatcher}.\n   * See also {@link Watchers/ViewWatcher.ViewWatcherConfig | ViewWatcherConfig}\n   *\n   * It can be either space-separated or comma-separated.\n   *\n   * @defaultValue {@link ViewWatcher} default\n   */\n  rootMargin?: string;\n\n  /**\n   * The threshold to pass to the {@link ViewWatcher}.\n   * See also {@link Watchers/ViewWatcher.ViewWatcherConfig | ViewWatcherConfig}\n   *\n   * @defaultValue {@link ViewWatcher} default\n   */\n  threshold?: number | number[];\n};\n\n// ----------\n\nconst newConfigValidator: WidgetConfigValidatorFunc<\n  Omit<ViewTriggerConfig, \"views\">\n> = (element) => {\n  return {\n    target: (key, value) =>\n      MH.isLiteralString(value) && isValidScrollOffset(value)\n        ? value\n        : ((MH.isLiteralString(value)\n            ? waitForReferenceElement(value, element)\n            : null) ?? undefined),\n    root: (key, value) =>\n      (MH.isLiteralString(value)\n        ? waitForReferenceElement(value, element)\n        : null) ?? undefined,\n    rootMargin: validateString,\n    threshold: (key, value) => validateNumList(key, value),\n  };\n};\n\nconst setupRepresentative = async (element: Element): Promise<Element> => {\n  let target: Element | null = await tryWrap(element);\n  if (!target) {\n    // Not allowed to wrap. Create a dummy hidden clone that's not animated and\n    // position it absolutely in a wrapper of size 0 that's inserted just\n    // before the actual element, so that the hidden clone overlaps the actual\n    // element's regular (pre-transformed) position.\n\n    const prev = element.previousElementSibling;\n    const prevChild = MH.childrenOf(prev)[0];\n    if (\n      prev &&\n      hasClass(prev, MC.PREFIX_WRAPPER) &&\n      prevChild &&\n      hasClass(prevChild, MC.PREFIX_GHOST)\n    ) {\n      // Already cloned by a previous animate action?\n      target = prevChild;\n    } else {\n      target = (await insertGhostClone(element))._clone;\n    }\n  }\n\n  return target;\n};\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nexport * from \"@lisn/triggers/check-trigger\";\nexport * from \"@lisn/triggers/pointer-trigger\";\nexport * from \"@lisn/triggers/layout-trigger\";\nexport * from \"@lisn/triggers/load-trigger\";\nexport * from \"@lisn/triggers/scroll-trigger\";\nexport * from \"@lisn/triggers/trigger\";\nexport * from \"@lisn/triggers/view-trigger\";\n\nexport * from \"@lisn/triggers/trigger\";\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nimport \"@lisn/bundle-essentials\"; // side effects\n\nimport { omitKeys } from \"@lisn/utils/misc\";\nimport * as _actions from \"@lisn/actions/index\";\nimport * as triggers from \"@lisn/triggers/index\";\n\nexport * from \"@lisn/bundle-essentials\";\n\n// --- remove widget specific actions\nexport const actions = omitKeys(_actions, {\n  Open: true,\n  NextPage: true,\n  PrevPage: true,\n  GoToPage: true,\n  EnablePage: true,\n  DisablePage: true,\n} as const);\n\nexport * as triggers from \"@lisn/triggers/index\";\n\nactions.AddClass.register();\nactions.RemoveClass.register();\nactions.AnimatePlay.register();\nactions.AnimatePause.register();\nactions.Animate.register();\nactions.Display.register();\nactions.Undisplay.register();\nactions.ScrollTo.register();\nactions.SetAttribute.register();\nactions.Show.register();\nactions.Hide.register();\nactions.Enable.register();\nactions.Disable.register();\nactions.Run.register();\n\ntriggers.LayoutTrigger.register();\ntriggers.LoadTrigger.register();\ntriggers.CheckTrigger.register();\ntriggers.ClickTrigger.register();\ntriggers.PressTrigger.register();\ntriggers.HoverTrigger.register();\ntriggers.ScrollTrigger.register();\ntriggers.Trigger.register();\ntriggers.ViewTrigger.register();\n","/**\n * @module Widgets\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { hideElement } from \"@lisn/utils/css-alter\";\nimport { hideAndRemoveElement } from \"@lisn/utils/dom-alter\";\nimport { waitForPageReady } from \"@lisn/utils/dom-events\";\nimport { validateString, validateNumber } from \"@lisn/utils/validation\";\n\nimport { DOMWatcher, OnMutationOptions } from \"@lisn/watchers/dom-watcher\";\n\nimport {\n  Widget,\n  WidgetConfigValidatorObject,\n  registerWidget,\n} from \"@lisn/widgets/widget\";\n\n/**\n * Configures the given element as an {@link AutoHide} widget.\n *\n * The AutoHide widget automatically hides (and optionally removes) the given\n * element, or children of it that match a given selector, after a certain\n * delay.\n *\n * It executes these actions every time the matching element(s) have a change\n * of attribute or appear (are inserted) into the DOM.\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-auto-hide` class or `data-lisn-auto-hide` attribute\n * - `lisn-auto-remove` class or `data-lisn-auto-remove` attribute (enables\n *   {@link AutoHideConfig.remove})\n *\n * **NOTE:** This widget supports multiple instances per element, you can\n * specify multiple widget configurations, separated with \";\".\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This will automatically hide (with class `lisn-hide`) the element 3 seconds\n * (default delay) after it is inserted into the DOM or after it gets any\n * attributes changed on it (for example that might show it again).\n *\n * ```html\n * <div class=\"lisn-auto-hide\">\n *   Automatically hidden in 3s.\n * </div>\n * ```\n *\n * @example\n * This will automatically hide and then remove the element 3 seconds (default\n * delay) after it is inserted into the DOM.\n *\n * ```html\n * <div class=\"lisn-auto-remove\">\n *   Automatically hidden and removed in 3s.\n * </div>\n * ```\n *\n * @example\n * This will automatically\n * - hide `p` elements with class `message` 2 seconds after they are inserted\n *   or changed\n * - hide `p` elements with class `warning` 5 seconds after they are inserted\n *   or changed; and it will save that particular {@link AutoHide} widget with\n *   ID `myID` so that it can be looked up using {@link AutoHide.get}\n * - remove `p` elements with class `disposable` 3 seconds (default delay)\n *   after they are inserted or changed\n *\n * ```html\n * <div data-lisn-auto-hide=\"selector=p.message delay=2000 ;\n *                           selector=p.warning delay=5000 id=myID\"\n *      data-lisn-auto-remove=\"selector=p.disposable\">\n *   <p>Some text, this will stay.</p>\n *   <p class=\"message\">\n *     Automatically hidden in 2s.\n *   </p>\n *   <p class=\"warning\">\n *     Automatically hidden in 5s.\n *   </p>\n *   <p class=\"disposable\">\n *     Automatically hidden and removed in 3s.\n *   </p>\n * </div>\n * ```\n */\nexport class AutoHide extends Widget {\n  static get(element: Element, id: string): AutoHide | null {\n    const instance = super.get(element, id);\n    if (MH.isInstanceOf(instance, AutoHide)) {\n      return instance;\n    }\n    return null;\n  }\n\n  static register() {\n    for (const [name, remove] of [\n      [WIDGET_NAME_HIDE, false],\n      [WIDGET_NAME_REMOVE, true],\n    ] as const) {\n      registerWidget(\n        name,\n        (element, config) => {\n          return new AutoHide(element, config);\n        },\n        newConfigValidator(remove),\n        { supportsMultiple: true },\n      );\n    }\n  }\n\n  constructor(element: Element, config?: AutoHideConfig) {\n    super(element, config);\n\n    const selector = config?.selector;\n\n    const watcher = DOMWatcher.create({\n      root: element,\n      subtree: selector ? true : false,\n    });\n\n    // Watch for attribute change on this element, and for relevant children\n    // being added/changed\n    const watcherOptions: OnMutationOptions = selector\n      ? {\n          selector: selector,\n          categories: [MC.S_ADDED, MC.S_ATTRIBUTE],\n          [MC.S_SKIP_INITIAL]: true,\n        }\n      : {\n          categories: [MC.S_ATTRIBUTE],\n          [MC.S_SKIP_INITIAL]: true,\n        };\n\n    const hideOrRemoveEl = config?.remove ? hideAndRemoveElement : hideElement;\n\n    const hideRelevant = () => {\n      if (this.isDisabled()) {\n        return;\n      }\n\n      const targetElements = selector\n        ? MH.querySelectorAll(element, selector)\n        : [element];\n\n      for (const elem of targetElements) {\n        hideOrRemoveEl(elem, config?.delay ?? DEFAULT_DELAY);\n      }\n    };\n\n    const addWatcher = () => watcher.onMutation(hideRelevant, watcherOptions);\n\n    const removeWatcher = () => watcher.offMutation(hideRelevant);\n\n    // ------------------------------\n\n    // Don't hide/remove before the page is loaded\n    waitForPageReady().then(() => {\n      // Hide initially\n      if (this.isDestroyed()) {\n        return;\n      }\n\n      hideRelevant();\n      addWatcher();\n    });\n\n    this.onDisable(removeWatcher);\n    this.onEnable(() => {\n      hideRelevant();\n      addWatcher();\n    });\n  }\n}\n\n/**\n * @interface\n */\nexport type AutoHideConfig = {\n  /**\n   * An ID for the widget so that it can be looked up by element and ID using\n   * {@link AutoHide.get}. It has to be unique for each element, but you can\n   * use the same ID on different elements.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * If true, the matched elements are removed from the DOM instead of just\n   * hidden.\n   *\n   * @defaultValue false\n   */\n  remove?: boolean;\n\n  /**\n   * If given, then the elements to be hidden/removed are selected using the\n   * given `selector` starting at the container element. If not given, then\n   * the container element itself is the target to be hidden/removed.\n   *\n   * E.g. if `selector` is `p.message`, then any newly added/changed `<p>`\n   * elements with class `message` nested under the container element will be\n   * auto-hidden/removed.\n   *\n   * @defaultValue undefined\n   */\n  selector?: string;\n\n  /**\n   * How long to wait before hiding or removing the matched elements.\n   *\n   * @defaultValue 3000\n   */\n  delay?: number;\n};\n\n// ------------------------------\n\nconst WIDGET_NAME_HIDE = \"auto-hide\";\nconst WIDGET_NAME_REMOVE = \"auto-remove\";\n\nconst DEFAULT_DELAY = 3000;\n\nconst newConfigValidator = (\n  autoRemove: boolean,\n): WidgetConfigValidatorObject<AutoHideConfig> => {\n  return {\n    id: validateString,\n    remove: () => autoRemove,\n    selector: validateString,\n    delay: validateNumber,\n  };\n};\n","/**\n * @module Widgets\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  displayElement,\n  undisplayElement,\n  addClasses,\n  removeClasses,\n  setHasModal,\n  delHasModal,\n} from \"@lisn/utils/css-alter\";\nimport { moveElement, hideAndRemoveElement } from \"@lisn/utils/dom-alter\";\nimport { waitForElement, waitForPageReady } from \"@lisn/utils/dom-events\";\nimport { validateBoolean } from \"@lisn/utils/validation\";\n\nimport {\n  Widget,\n  WidgetConfigValidatorObject,\n  registerWidget,\n} from \"@lisn/widgets/widget\";\n\n/**\n * Configures the given element as a {@link PageLoader} widget.\n *\n * The page loader is a full-page spinner. You would almost certainly use this\n * only once, to hide the page before it's loaded.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link PageLoader}\n * widget on a given element. Use {@link PageLoader.get} to get an existing\n * instance if any. If there is already a widget instance, it will be destroyed!\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-page-loader` class or `data-lisn-page-loader` attribute set on\n *   the element that constitutes the widget. The element should be empty.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This will create a page loader using the JavaScript API.\n *\n * This will work even if\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}) is false\n *\n * ```html\n * <!-- LISN should be loaded beforehand -->\n * <script>\n *   LISN.widgets.PageLoader.enableMain();\n * </script>\n * ```\n *\n * @example\n * This will create a page loader using an existing element with default\n * {@link PageLoaderConfig}.\n *\n * ```html\n * <div class=\"lisn-page-loader\"></div>\n * ```\n *\n * @example\n * As above but with custom settings.\n *\n * ```html\n * <div data-lisn-page-loader=\"auto-remove=false\"></div>\n * ```\n */\nexport class PageLoader extends Widget {\n  /**\n   * If element is omitted, returns the instance created by {@link enableMain}\n   * if any.\n   */\n  static get(element?: Element): PageLoader | null {\n    if (!element) {\n      return mainWidget;\n    }\n\n    const instance = super.get(element, DUMMY_ID);\n    if (MH.isInstanceOf(instance, PageLoader)) {\n      return instance;\n    }\n    return null;\n  }\n\n  static register() {\n    registerWidget(\n      WIDGET_NAME,\n      (element, config) => {\n        if (!PageLoader.get(element)) {\n          return new PageLoader(element, config);\n        }\n        return null;\n      },\n      configValidator,\n    );\n  }\n\n  /**\n   * Creates a new element, inserts it into the document body and configures it\n   * as a {@link PageLoader}.\n   */\n  static enableMain(config?: PageLoaderConfig) {\n    const loader = MH.createElement(\"div\");\n    const widget = new PageLoader(loader, config);\n    widget.onDestroy(() => {\n      if (mainWidget === widget) {\n        mainWidget = null;\n      }\n      return moveElement(loader);\n    });\n\n    waitForElement(MH.getBody).then((body) => {\n      if (!widget.isDestroyed()) {\n        moveElement(loader, { to: body });\n      }\n    });\n\n    mainWidget = widget;\n    return widget;\n  }\n\n  constructor(element: Element, config?: PageLoaderConfig) {\n    const destroyPromise = PageLoader.get(element)?.destroy();\n    super(element, { id: DUMMY_ID });\n\n    (destroyPromise || MH.promiseResolve()).then(() => {\n      if (this.isDestroyed()) {\n        return;\n      }\n\n      addClasses(element, PREFIX_ROOT);\n\n      const spinner = MH.createElement(\"div\");\n      addClasses(spinner, PREFIX_SPINNER);\n\n      moveElement(spinner, { to: element });\n      waitForElement(MH.getBody).then(setHasModal); // we could be init before body\n\n      if (config?.autoRemove ?? true) {\n        waitForPageReady()\n          .then(() => hideAndRemoveElement(element))\n          .then(this.destroy);\n      }\n\n      this.onDisable(() => {\n        undisplayElement(element);\n        if (!MH.docQuerySelector(`.${PREFIX_ROOT}`)) {\n          delHasModal();\n        }\n      });\n\n      this.onEnable(async () => {\n        await displayElement(element);\n      });\n\n      this.onDestroy(async () => {\n        moveElement(spinner); // remove\n        await removeClasses(element, PREFIX_ROOT);\n        await displayElement(element); // revert undisplay by onDisable\n      });\n    });\n  }\n}\n\n/**\n * @interface\n */\nexport type PageLoaderConfig = {\n  /**\n   * Whether to automatically hide and remove the loader when the page is\n   * ready (see {@link waitForPageReady}.\n   *\n   * @defaultValue true\n   */\n  autoRemove?: boolean;\n};\n\n// --------------------\n\nconst WIDGET_NAME = \"page-loader\";\nconst PREFIXED_NAME = MH.prefixName(WIDGET_NAME);\nconst PREFIX_ROOT = `${PREFIXED_NAME}__root`;\nconst PREFIX_SPINNER = MH.prefixName(\"spinner\");\n// Only one PageLoader widget per element is allowed, but Widget requires a\n// non-blank ID.\n// In fact, it doesn't make much sense to have more than 1 page loader on the\n// whole page, but we support it, hence use a class rather than a DOM ID.\nconst DUMMY_ID = PREFIXED_NAME;\nlet mainWidget: PageLoader | null = null;\n\nconst configValidator: WidgetConfigValidatorObject<PageLoaderConfig> = {\n  autoRemove: validateBoolean,\n};\n","/**\n * @module Widgets\n */\n\n// This widget finds optimal widths of flexbox children so that their heights\n// are equal or as close as possible to each other. It takes into account\n// whether they contain text (and possibly other elements, but not images) or\n// images.\n//\n// NOTE:\n//  - We assume that a given flexbox child is either a \"text container\" and\n//    contains only text and other non-image elements (such as buttons), or is\n//    an \"image container\" and contains only images.\n//  - We also assume that all the text inside a text container is the same\n//    font size as the font size of the text container.\n//\n// ~~~~~~ BACKGROUND: analysis for one text container and one image container ~~~~~~\n//\n// A text box has a fixed area, its height decreasing as width increases.\n// Whereas an image has a fixed aspect ratio, its height increasing as width\n// increases.\n//\n// We want to find an optimal configuration at which the text container (which\n// can include other elements apart from text) and image heights are equal, or\n// if not possible, at which they are as close as possible to each other while\n// satisfying as best as possible these \"guidelines\" (constraints that are not\n// enforced), based on visual appeal:\n//   - minGap, minimum gap between each item\n//   - maxWidthR, maximum ratio between the width of the widest child and the\n//     narrowest child\n//   - maxFreeR, maximum free space in the container as a percentage of its\n//     total width\n//\n// Then we set flex-basis as the optimal width (making sure this is disabled\n// when the flex direction is column). This allows for fluid width if the user\n// to configure shrink or wrap on the flexbox using CSS.\n//\n// ~~~~~~ FORMULAE: text and image width as a function of their height ~~~~~~\n//\n// For a given height, h, the widths of the text and image are:\n//\n//                 txtArea\n//   txtW(h) =  \n//              h - txtExtraH\n//\n//   imgW(h) = imgAspectR * h\n//\n// where txtExtraH comes from buttons and other non-text elements inside the\n// text container, whose height is treated as fixed (not changing with width).\n//\n// ~~~~~~ PLOT: total width as a function of height ~~~~~~\n//\n// The sum of the widths of image and text varies with their height, h, as:\n//\n//   w(h) = txtW(h) + imgW(h)\n//\n//              txtArea\n//        =    +  imgAspectR * h\n//           h - txtExtraH\n//\n//\n//       w(h)\n//        ^\n//        | |              .\n//        | .             .\n//        |  .           .\n// flexW  +   .         .\n//        |    .       .\n//        |     .    .\n//        |       -\n//        |\n//        ||||> h\n//            h1  h0    h2\n//\n//\n// ~~~~~~ FORMULAE: height at which total width is minimum ~~~~~~\n//\n// The minimum of the function w(h) is at h = h0\n//\n//               txtArea  \n//   h0 = sqrt|  | + txtExtraH\n//             imgAspectR \n//\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n//\n// The widths of image and text container at height = h0 are:\n//\n//   txtW(h0) = sqrt( txtArea * imgAspectR )\n//\n//   imgW(h0) = sqrt( txtArea * imgAspectR ) + imgAspectR * txtExtraH\n//            = txtW(h0) + imgAspectR * txtExtraH\n//\n// - NOTE: at if txtExtraH is 0 (i.e. the container has only text), then\n//   their widths are equal at h0; otherwise the image is wider\n//\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n//\n// There are zero, one or two values of h at which w(h) equals the flexbox\n// width, flexW. Labelled h1 and h2 above.\n//\n// ~~~~~~ FORMULAE: height at which total width is equal to flexbox width ~~~~~~\n//\n// The heights at which the sum of the widths, w(h) equals exactly flexW are:\n//\n//          -b  sqrt( b^2 - 4ac )\n//   h2/1 = \n//                  2a\n//\n// where:\n// a = imgAspectR\n// b = - ( (imgAspectR * txtExtraH) + flexW )\n// c = txtArea + (txtExtraH * flexW)\n//\n// If h1 and h2 are real, then h1 <= h0 <= h2, as shown in plot above.\n//\n// ~~~~~~ SCENARIOS: free space or overflow in the flexbox ~~~~~~\n//\n// Whether there is a solution to the above equation, i.e. whether h1 and h2\n// are real, depends on which scenario we have:\n//\n// 1. If flexW = w(h0), then h1 = h2 = h0\n// 2. If flexW < w(h0), then there is no exact solution, i.e. it's impossible\n//    to fit the text and image inside the flexbox and have them equal heights;\n//    there is overflow even at h0\n// 3. If flexW > w(h0) (as in the graph above), then at h0 there is free space\n//    in the flexbox and we can choose any height between h1 and h2\n//\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n//\n// The widths h0, h1 and h2 represent the following visual configuration:\n//   - h0: intermediate height, maximum free space in the container;\n//   - h1: minimum height (i.e. wide text and small image), no free space in\n//     the container;\n//   - h2: maximum height (i.e. narrow text and large image), no free space in\n//     the container;\n//\n// ~~~~~~ THEREFORE: approach ~~~~~~\n//\n// 1. If flexW = w(h0), i.e. h1 = h2 = h0:\n//    => we choose h0 as the height\n// 2. If flexW < w(h0), i.e. it's impossible to fit the text and image inside\n//    the flexbox and have them equal heights:\n//    => we still choose h0 as the height as that gives the least amount of\n//       overflow; user-defined CSS can control whether the items will be\n//       shrunk, the flexbox will wrap or overflow\n// 3. If flexW > w(h0), i.e. at h0 there is free space in the flexbox:\n//    => choose a height between h1 and h2 that best fits with the guidelines\n//       maxWidthR and maxFreeR\n//\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n//\n// In scenario 3 we can look at the guidelines, maxWidthR and maxFreeR.\n//\n// ~~~~~~ GUIDELINE: maxWidthR ~~~~~~\n//\n// ~~~~~~ FORMULAE: height at which text and image width are equal ~~~~~~\n//\n// The width of the text and image container are equal at height hR0:\n//\n//         txtExtraH + sqrt( txtExtraH^2  +  4 * (h0 - txtExtraH)^2 )\n// hR0  =  \n//                                    2\n//\n// ~~~~~~ FORMULAE: height at which text to image width is maxWidthR ~~~~~~\n//\n// For heights < hR0, i.e. text becomes wider than the image, at some point the\n// ratio of text width to image width becomes maxWidthR. This happens at hR1.\n//\n//                                          4 * (h0 - txtExtraH)^2 \n//         txtExtraH + sqrt| txtExtraH^2  +   |\n//                                                 maxWidthR       \n// hR1  =  \n//                                    2\n//\n// ~~~~~~ FORMULAE: height at which image to text width is maxWidthR ~~~~~~\n//\n// For heights > hR0, i.e. text becomes narrower than the image, at some point\n// the ratio of image width to text width becomes maxWidthR. This happens at hR2.\n//\n//         txtExtraH + sqrt( txtExtraH^2  +  4 * maxWidthR * (h0 - txtExtraH)^2 )\n// hR2  =  \n//                                        2\n//\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n//\n// NOTE:\n// - hR1 <= hR0 <= hR2 && hR0 <= h0\n// - hR0, hR1 and hR2 are the first (larger) roots of the quadratic equation\n//   with coefficients:\n//     a = imgAspectR * R\n//     b = - imgAspectR * txtExtraH * R\n//     c = - textArea\n//   where R = 1 gives hR0, R = maxWidthR gives hR1 and R = 1 / maxWidthR gives hR2\n// - The smaller roots of the equation should be negative, so we ignore them\n//\n// ~~~~~~ GUIDELINE: maxFreeR ~~~~~~\n//\n// ~~~~~~ FORMULAE: free space in flexbox relative to its width ~~~~~~\n//\n// The percentage of free space in the container is:\n//\n//           flexW - w(h)\n// freeR  =  \n//              flexW\n//\n//\n//                             txtArea\n//                flexW  -    - imgAspectR * h\n//                          h - txtExtraH\n//             =  \n//                                flexW\n//\n// ~~~~~~ FORMULAE: height at which relative free space is maxFreeR ~~~~~~\n//\n// This would be equal to maxFreeR at hF1 and hF2:\n//\n//          -b  sqrt( b^2 - 4ac )\n//   hF2/1 = \n//                  2a\n//\n// where:\n// a = imgAspectR\n// b = - ( (imgAspectR * txtExtraH) + ( flexW * (1 - maxFreeR) ) )\n// c = txtArea + ( txtExtraH * flexW * (1 - maxFreeR) )\n//\n// If hF1 and hF2 are real, then h1 < hF1 <= h0 <= hF2 < h2.\n//\n// ~~~~~~ THEREFORE: choosing a height in scenario 3 ~~~~~~\n//\n// So in scenario 3 we can choose any height h between\n//\n//   max(h1, hR1, hF1)  and  min(h2, hR2, hF2)\n//\n// Note, it's possible that max(h1, hR1, hF1) is greater than min(h2, hR2, hF2),\n// e.g. if hF1 > hR2 or hR1 > hF2.\n//\n// This will make the text and image equal height, fitting in the flexbox, and\n// if possible, satisfying both maxFreeR and maxWidthR.\n//\n// Here we choose the smallest height possible, which would result in the\n// larger ratio between text width and image width, but it will satisfy the\n// constraints maxFreeR and maxWidthR, so that is ok.\n//\n// ~~~~~~ GENERALISING: for more than one text and/or image container ~~~~~~\n//\n// We can generalise the above in order to find an approximate solution for the\n// case of multiple text or image containers (an exact solution would require\n// solving a polynomial of degree equal to the number of elements).\n//\n// If we imaging putting all text in one container and all images in another\n// container we are back at the above exact solutions for a single text and\n// image container.\n//\n// We can solve for the following parameters:\n// - txtArea:    total text area\n//               = sum_i(txtArea_i)\n//\n// - txtExtraH:  weighted average extra height\n//               = sum_i(txtExtraH_i * txtArea_i) / txtArea\n//\n// - imgAspectR: total image aspect ratio (for horizontally laid out image\n//               containers)\n//               = sum_i(imgAspectR_i)\n//\n// ~~~~~~ CASE 1: only images containers ~~~~~~\n// If we have only image containers, we solve for the optimal height as follows:\n//\n//   flexW = imgAspectR * h\n//\n//                   flexW\n//   => hIdeal  =  \n//                 imgAspectR\n//\n// ~~~~~~ CASE 2: only text containers ~~~~~~\n// If we have only text containers, we solve for the optimal height as follows:\n//\n//                  txtArea\n//   flexW  =  \n//             hIdeal - txtExtraH\n//\n//                 txtArea\n//   => hIdeal  =    +  txtExtraH\n//                  flexW\n//\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n// Once we've found the optimal height h, we calculate the individual widths of\n// the flexbox children as:\n//\n//                  txtArea_i\n//   txtW_i(h) =  \n//                h - txtExtraH_i\n//\n//   imgW_i(h) = imgAspectR_i * h\n//\n// ~~~~~~ IMPLEMENTATION ~~~~~~\n//\n// We go through the flexbox children and determine whether a child is a \"text\n// container\" or an \"image container\".\n//\n// For image containers, we measure the width and height and calculate the\n// aspect ratio using these.\n//\n// For text containers, we measure their width and height. We calculate the\n// text area by measuring the size of all children of the text container that\n// are deemed to contain only text (or if the entire text container is deemed\n// to contain only text, then we take its size). Then we sum the areas of\n// all such text-only boxes.\n//\n// To determine the extra height in the text container, we take the total\n// height of all text-only boxes inside it, and we subtract that from its\n// measured height.\n//\n// NOTE:\n// - This does not work if the flexbox children are set to align stretch,\n//   because in such cases there would be free vertical space in the container\n//   that shouldn't be counted.\n// - If the flexbox children or any of their descendants have paddings and\n//   margins, then this calculation would only work if the paddings/margins\n//   inside text containers are absolute and only on top and bottom, and\n//   paddings/margins inside image containers are in percentages and only on\n//   descendants of the image container. Otherwise the image aspect ratio and the\n//   extra text height would not be constant, and there may be extra width in\n//   the text container. It is very tricky to take all of this into account. So\n//   we ignore such cases and assume constant image aspect ratio and constant\n//   text area and text container extra height.\n//\n// We use resize observers to get the size of relevant elements and\n// re-calculate as needed.\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { settings } from \"@lisn/globals/settings\";\n\nimport {\n  addClasses,\n  removeClasses,\n  getData,\n  setData,\n  delData,\n  setNumericStyleJsVars,\n  getComputedStyleProp,\n} from \"@lisn/utils/css-alter\";\nimport { getVisibleContentChildren } from \"@lisn/utils/dom-query\";\nimport { logError } from \"@lisn/utils/log\";\nimport { isValidNum, toNumWithBounds, quadraticRoots } from \"@lisn/utils/math\";\nimport { formatAsString } from \"@lisn/utils/text\";\nimport { validateNumber } from \"@lisn/utils/validation\";\n\nimport { SizeWatcher, SizeData } from \"@lisn/watchers/size-watcher\";\n\nimport {\n  Widget,\n  WidgetConfigValidatorObject,\n  registerWidget,\n  getDefaultWidgetSelector,\n} from \"@lisn/widgets/widget\";\n\nimport { LoggerInterface } from \"@lisn/debug/types\";\n\nimport debug from \"@lisn/debug/debug\";\n\n/**\n * Configures the given element as a {@link SameHeight} widget.\n *\n * The SameHeight widget sets up the given element as a flexbox and sets the\n * flex basis of its components so that their heights are as close as possible\n * to each other. It tracks their size (see {@link SizeWatcher}) and\n * continually updates the basis as needed.\n *\n * When calculating the best flex basis that would result in equal heights,\n * SameHeight determines whether a flex child is mostly text or mostly images\n * since the height of these scales in opposite manner with their width.\n * Therefore, the components of the widget should contain either mostly text or\n * mostly images.\n *\n * The widget should have more than one item and the items must be immediate\n * children of the container element.\n *\n * SameHeight tries to automatically determine if an item is mostly text or\n * mostly images based on the total display text content, but you can override\n * this in two ways:\n * 1. By passing a map of elements as {@link SameHeightConfig.items | items}\n *    instead of an array, and setting the value for each to either `\"text\"` or\n *    `\"image\"`\n * 2. By setting the `data-lisn-same-height-item` attribute to `\"text\"` or\n *   `\"image\"` on the children. **NOTE** however that when auto-discovering the\n *   items (i.e. when you have not explicitly passed a list/map of items), if\n *   you set the `data-lisn-same-height-item` attribute on _any_ child you must\n *   also add this attribute to all other children that are to be used by the\n *   widget. Other children (that don't have this attribute) will be ignored\n *   and assumed to be either zero-size or position absolute/fixed.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link SameHeight}\n * widget on a given element. Use {@link SameHeight.get} to get an existing\n * instance if any. If there is already a widget instance, it will be destroyed!\n *\n * **IMPORTANT:** The element you pass will be set to `display: flex` and its\n * children will get `box-sizing: border-box` and continually updated\n * `flex-basis` style. You can add additional CSS to the element or its\n * children if you wish. For example you may wish to set `flex-wrap: wrap` on\n * the element and a `min-width` on the children.\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see {@link settings.autoWidgets}), the\n * following CSS classes or data attributes are recognized:\n * - `lisn-same-height` class or `data-lisn-same-height` attribute set on the\n *   container element that constitutes the widget\n *\n * When using auto-widgets, the elements that will be used as items are\n * discovered in the following way:\n * 1. The immediate children of the top-level element that constitutes the\n *    widget that have the `lisn-same-height-item` class or\n *    `data-lisn-same-height-item` attribute are taken.\n * 2. If none of the root's children have this class or attribute, then all of\n *    the immediate children of the widget element except any `script` or\n *    `style` elements are taken as the items.\n *\n * See below examples for what values you can use set for the data attribute\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This defines a simple SameHeight widget with one text and one image child.\n *\n * ```html\n * <div class=\"lisn-same-height\">\n *   <div>\n *     <p>\n *       Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n *       eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n *       minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n *       aliquip ex ea commodo consequat. Duis aute irure dolor in\n *       reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n *       pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n *       culpa qui officia deserunt mollit anim id est laborum.\n *     </p>\n *   </div>\n *\n *   <div>\n *     <img\n *       src=\"https://www.wikipedia.org/portal/wikipedia.org/assets/img/Wikipedia-logo-v2@1.5x.png\"\n *     />\n *   </div>\n * </div>\n * ```\n *\n * @example\n * This defines a SameHeight widget with the flexbox children specified\n * explicitly (and one ignored), as well as having all custom settings.\n *\n * ```html\n * <div data-lisn-same-height=\"diff-tolerance=20\n *                             | resize-threshold=10\n *                             | debounce-window=50\n *                             | min-gap=50\n *                             | max-free-r=0.2\n *                             | max-width-r=3.2\">\n *   <div>Example ignored child</div>\n *\n *   <div data-lisn-same-height-item><!-- Will be detected as text anyway -->\n *     <p>\n *       Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n *       eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n *       minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n *       aliquip ex ea commodo consequat. Duis aute irure dolor in\n *       reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n *       pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n *       culpa qui officia deserunt mollit anim id est laborum.\n *     </p>\n *   </div>\n *\n *   <!-- Explicitly set to image type, though it will be detected as such -->\n *   <div data-lisn-same-height-item=\"image\">\n *     <img\n *       src=\"https://www.wikipedia.org/portal/wikipedia.org/assets/img/Wikipedia-logo-v2@1.5x.png\"\n *     />\n *   </div>\n *\n *   <!-- Explicitly set to text type, because it will NOT be detected as such (text too short). -->\n *   <div data-lisn-same-height-item=\"text\">\n *     <p>\n *       Lorem ipsum dolor sit amet, consectetur adipiscing elit.\n *     </p>\n *   </div>\n * </div>\n * ```\n */\nexport class SameHeight extends Widget {\n  /**\n   * Switches the flexbox to vertical (column) mode.\n   *\n   * You can alternatively do this by setting the\n   * `data-lisn-orientation=\"vertical\"` attribute on the element at any time.\n   *\n   * You can do this for example as part of a trigger:\n   *\n   * @example\n   * ```html\n   * <div class=\"lisn-same-height\"\n   *      data-lisn-on-layout=\"max-mobile-wide:set-attribute=data-lisn-orientation#vertical\">\n   *      <!-- ... children -->\n   * </div>\n   * ```\n   */\n  readonly toColumn: () => Promise<void>;\n\n  /**\n   * Switches the flexbox back to horizontal (row) mode, which is the default.\n   *\n   * You can alternatively do this by deleting the\n   * `data-lisn-orientation` attribute on the element, or setting it to\n   * `\"horizontal\"` at any time.\n   */\n  readonly toRow: () => Promise<void>;\n\n  /**\n   * Returns the elements used as the flex children.\n   */\n  readonly getItems: () => Element[];\n\n  /**\n   * Returns a map of the elements used as the flex children with their type.\n   */\n  readonly getItemConfigs: () => Map<Element, \"text\" | \"image\">;\n\n  /**\n   * If the element is already configured as a SameHeight widget, the widget\n   * instance is returned. Otherwise null.\n   */\n  static get(containerElement: Element): SameHeight | null {\n    const instance = super.get(containerElement, DUMMY_ID);\n    if (MH.isInstanceOf(instance, SameHeight)) {\n      return instance;\n    }\n    return null;\n  }\n\n  static register() {\n    registerWidget(\n      WIDGET_NAME,\n      (element, config) => {\n        if (MH.isHTMLElement(element)) {\n          if (!SameHeight.get(element)) {\n            return new SameHeight(element, config);\n          }\n        } else {\n          logError(\n            MH.usageError(\n              \"Only HTMLElement is supported for SameHeight widget\",\n            ),\n          );\n        }\n        return null;\n      },\n      configValidator,\n    );\n  }\n\n  constructor(containerElement: HTMLElement, config?: SameHeightConfig) {\n    const destroyPromise = SameHeight.get(containerElement)?.destroy();\n    super(containerElement, { id: DUMMY_ID });\n\n    const items = getItemsFrom(containerElement, config?.items);\n\n    if (MH.sizeOf(items) < 2) {\n      throw MH.usageError(\"SameHeight must have more than 1 item\");\n    }\n\n    for (const item of items.keys()) {\n      if (MH.parentOf(item) !== containerElement) {\n        throw MH.usageError(\n          \"SameHeight's items must be its immediate children\",\n        );\n      }\n    }\n\n    fetchConfig(containerElement, config).then((fullConfig) => {\n      (destroyPromise || MH.promiseResolve()).then(() => {\n        if (this.isDestroyed()) {\n          return;\n        }\n\n        init(this, containerElement, items, fullConfig);\n      });\n    });\n\n    this.toColumn = () =>\n      setData(containerElement, MC.PREFIX_ORIENTATION, MC.S_VERTICAL);\n\n    this.toRow = () => delData(containerElement, MC.PREFIX_ORIENTATION);\n\n    this.getItems = () => [...items.keys()];\n    this.getItemConfigs = () => MH.newMap([...items.entries()]);\n  }\n}\n\n/**\n * @interface\n */\nexport type SameHeightConfig = {\n  /**\n   * The elements that will make up the items. They **MUST** be immediate\n   * children of the container element.\n   *\n   * The widget should have more than one item.\n   *\n   * If this is not specified, then\n   * 1. The immediate children of the top-level element that constitutes the\n   *    widget that have the `lisn-same-height-item` class or\n   *    `data-lisn-same-height-item` attribute are taken.\n   * 2. If none of the root's children have this class or attribute, then all of\n   *    the immediate children of the widget element except any `script` or\n   *    `style` elements are taken as the items.\n   */\n  items?: Element[] | Map<Element, \"image\" | \"text\">;\n\n  /**\n   * After setting the flex basis of the children and their size updates, in\n   * case the resultant height differs from the predicted calculated one by\n   * `diffTolerance` in pixels, then the calculations are re-run using the new\n   * sizes. Calculations are re-run at most once only.\n   *\n   * Differences between the predicted and resultant height would happen if the\n   * children contain a mixture of text and images or if there are margins or\n   * paddings that don't scale in the same way as the content.\n   *\n   * @defaultValue {@link settings.sameHeightDiffTolerance}\n   */\n  diffTolerance?: number;\n\n  /**\n   * The `resizeThreshold` to pass to the {@link SizeWatcher}.\n   *\n   * @defaultValue {@link settings.sameHeightResizeThreshold}\n   */\n  resizeThreshold?: number;\n\n  /**\n   * The `debounceWindow` to pass to the {@link SizeWatcher}.\n   *\n   * @defaultValue {@link settings.sameHeightDebounceWindow}\n   */\n  debounceWindow?: number;\n\n  /**\n   * Minimum gap between the flex items. Note that setting this to 0 while at\n   * the same time setting `flex-wrap` to `wrap` (or `wrap-reverse`) on the\n   * element may lead to premature/unnecessary wrapping.\n   *\n   * Note that this is not strictly enforced, and is only used in finding\n   * optimal height based on other constraints. If you want to enforce this gap,\n   * set it as a `column-gap` CSS rule.\n   *\n   * @defaultValue The effective `column-gap` on the container element style or\n   *               if none, {@link settings.sameHeightMinGap}\n   */\n  minGap?: number;\n\n  /**\n   * Maximum ratio between the free space in the flex container and its total\n   * width. You can set this to a negative number to disable this restriction.\n   *\n   * It has to be < 1. Otherwise it is invalid and disables this restriction.\n   *\n   * Note that this is not strictly enforced, and is only used in finding\n   * optimal height based on other constraints.\n   *\n   * @defaultValue {@link settings.sameHeightMaxFreeR}\n   */\n  maxFreeR?: number;\n\n  /**\n   * Maximum ratio between the width of the widest item and the narrowest item.\n   * You can set this to 0 or a negative number to disable this restriction.\n   *\n   * It has to be >= 1. Otherwise it is invalid and disables this restriction.\n   *\n   * Note that this is not strictly enforced, and is only used in finding\n   * optimal height based on other constraints.\n   *\n   * @defaultValue {@link settings.sameHeightMaxWidthR}\n   */\n  maxWidthR?: number;\n};\n\n// ------------------------------\n\ntype SameHeightConfigInternal = {\n  _minGap: number;\n  _diffTolerance: number;\n  _resizeThreshold: number;\n  _debounceWindow: number;\n  _maxFreeR: number;\n  _maxWidthR: number;\n};\n\ntype ItemProperties = {\n  _type: \"\" | \"image\" | \"text\";\n  _width: number;\n  _height: number;\n  _aspectR: number;\n  _area: number;\n  _extraH: number;\n  _components: Element[];\n};\n\ntype AverageMeasurements = {\n  _tArea: number;\n  _tExtraH: number;\n  _imgAR: number;\n  _flexW: number;\n  _nItems: number;\n};\n\nconst WIDGET_NAME = \"same-height\";\nconst PREFIXED_NAME = MH.prefixName(WIDGET_NAME);\nconst PREFIX_ROOT = `${PREFIXED_NAME}__root`;\n\n// Use different classes for styling items to the one used for auto-discovering\n// them, so that re-creating existing widgets can correctly find the items to\n// be used by the new widget synchronously before the current one is destroyed.\nconst PREFIX_ITEM = `${PREFIXED_NAME}__item`;\nconst PREFIX_ITEM__FOR_SELECT = `${PREFIXED_NAME}-item`;\n\nconst S_TEXT = \"text\";\nconst S_IMAGE = \"image\";\n\n// Only one SameHeight widget per element is allowed, but Widget requires a\n// non-blank ID.\nconst DUMMY_ID = PREFIXED_NAME;\n\n// We consider elements that have text content of at least <MIN_CHARS_FOR_TEXT>\n// characters to be text.\nconst MIN_CHARS_FOR_TEXT = 100;\n\nconst configValidator: WidgetConfigValidatorObject<SameHeightConfig> = {\n  diffTolerance: validateNumber,\n  resizeThreshold: validateNumber,\n  [MC.S_DEBOUNCE_WINDOW]: validateNumber,\n  minGap: validateNumber,\n  maxFreeR: validateNumber,\n  maxWidthR: validateNumber,\n};\n\nconst isText = (element: Element) =>\n  getData(element, PREFIX_ITEM__FOR_SELECT) === S_TEXT ||\n  (getData(element, PREFIX_ITEM__FOR_SELECT) !== S_IMAGE &&\n    MH.isHTMLElement(element) &&\n    MH.lengthOf(element.innerText) >= MIN_CHARS_FOR_TEXT);\n\nconst areImagesLoaded = (element: Element) => {\n  for (const img of element.querySelectorAll(\"img\")) {\n    // Don't rely on img.complete since sometimes this returns false even\n    // though the image is loaded and has a size. Just check the size.\n    if (\n      img.naturalWidth === 0 ||\n      img.width === 0 ||\n      img.naturalHeight === 0 ||\n      img.height === 0\n    ) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nconst fetchConfig = async (\n  containerElement: HTMLElement,\n  userConfig: SameHeightConfig | undefined,\n): Promise<SameHeightConfigInternal> => {\n  const colGapStr = await getComputedStyleProp(containerElement, \"column-gap\");\n  const minGap = getNumValue(\n    MH.strReplace(colGapStr, /px$/, \"\"),\n    settings.sameHeightMinGap,\n  );\n\n  return {\n    _minGap: toNumWithBounds(userConfig?.minGap ?? minGap, { min: 0 }, 10),\n    _maxFreeR: toNumWithBounds(\n      userConfig?.maxFreeR ?? settings.sameHeightMaxFreeR,\n      { min: 0, max: 0.9 },\n      -1,\n    ),\n    _maxWidthR: toNumWithBounds(\n      userConfig?.maxWidthR ?? settings.sameHeightMaxWidthR,\n      { min: 1 },\n      -1,\n    ),\n    _diffTolerance:\n      userConfig?.diffTolerance ?? settings.sameHeightDiffTolerance,\n    _resizeThreshold:\n      userConfig?.resizeThreshold ?? settings.sameHeightResizeThreshold,\n    _debounceWindow:\n      userConfig?.debounceWindow ?? settings.sameHeightDebounceWindow,\n  };\n};\n\nconst getNumValue = (strValue: string | null, defaultValue: number): number => {\n  const num = strValue ? MH.parseFloat(strValue) : NaN;\n  return MH.isNaN(num) ? defaultValue : num;\n};\n\nconst findItems = (containerElement: HTMLElement) => {\n  const items = [\n    ...MH.querySelectorAll(\n      containerElement,\n      getDefaultWidgetSelector(PREFIX_ITEM__FOR_SELECT),\n    ),\n  ];\n\n  if (!MH.lengthOf(items)) {\n    items.push(...getVisibleContentChildren(containerElement));\n  }\n\n  return items;\n};\n\nconst getItemsFrom = (\n  containerElement: HTMLElement,\n  inputItems: Element[] | Map<Element, \"image\" | \"text\"> | undefined,\n) => {\n  const itemMap = MH.newMap<Element, \"image\" | \"text\">();\n\n  inputItems = inputItems || findItems(containerElement);\n\n  const addItem = (item: Element, itemType?: \"text\" | \"image\") => {\n    itemType = itemType || (isText(item) ? S_TEXT : S_IMAGE);\n    itemMap.set(item, itemType);\n  };\n\n  if (MH.isArray(inputItems)) {\n    for (const item of inputItems) {\n      addItem(item);\n    }\n  } else if (MH.isInstanceOf(inputItems, Map)) {\n    for (const [item, itemType] of inputItems.entries()) {\n      addItem(item, itemType);\n    }\n  }\n\n  return itemMap;\n};\n\nconst init = (\n  widget: SameHeight,\n  containerElement: HTMLElement,\n  items: Map<Element, \"image\" | \"text\">,\n  config: SameHeightConfigInternal,\n) => {\n  const logger = debug\n    ? new debug.Logger({\n        name: `SameHeight-${formatAsString(containerElement)}`,\n      })\n    : null;\n\n  const diffTolerance = config._diffTolerance;\n  const debounceWindow = config._debounceWindow;\n\n  const sizeWatcher = SizeWatcher.reuse({\n    [MC.S_DEBOUNCE_WINDOW]: debounceWindow,\n    resizeThreshold: config._resizeThreshold,\n  });\n\n  const allItems = MH.newMap<Element, ItemProperties>();\n\n  let callCounter = 0;\n  let isFirstTime = true;\n  let lastOptimalHeight = 0;\n  let hasScheduledReset = false;\n  let counterTimeout: ReturnType<typeof setTimeout> | null = null;\n\n  // ----------\n\n  const resizeHandler = (element: Element, sizeData: SizeData) => {\n    // Since the SizeWatcher calls us once for every element, we batch the\n    // re-calculations so they are done once in every cycle.\n    // Allow the queue of ResizeObserverEntry in the SizeWatcher to be\n    // emptied, and therefore to ensure we have the latest size for all\n    // elements.\n    if (!hasScheduledReset) {\n      debug: logger?.debug7(\"Scheduling calculations\", callCounter);\n      hasScheduledReset = true;\n\n      MH.setTimer(() => {\n        hasScheduledReset = false;\n\n        if (callCounter > 1) {\n          debug: logger?.debug7(\"Already re-calculated once, skipping\");\n          callCounter = 0;\n          return;\n        }\n\n        callCounter++;\n        if (counterTimeout) {\n          MH.clearTimer(counterTimeout);\n        }\n\n        const measurements = calculateMeasurements(\n          containerElement,\n          allItems,\n          isFirstTime,\n          logger,\n        );\n\n        const height = measurements\n          ? getOptimalHeight(measurements, config, logger)\n          : null;\n\n        if (height && MH.abs(lastOptimalHeight - height) > diffTolerance) {\n          // Re-set widths again. We may be called again in the next cycle if\n          // the change in size exceeds the resizeThreshold.\n          lastOptimalHeight = height;\n          isFirstTime = false;\n          setWidths(height); // no need to await\n\n          // If we are _not_ called again in the next cycle (just after\n          // debounceWindow), then reset the counter. It means the resultant\n          // change in size did not exceed the SizeWatcher threshold.\n          counterTimeout = MH.setTimer(() => {\n            callCounter = 0;\n          }, debounceWindow + 50);\n        } else {\n          // Done, until the next time elements are resized\n          callCounter = 0;\n        }\n      }, 0);\n    }\n\n    // Save the size of the item\n    const properties = allItems.get(element);\n    if (!properties) {\n      logError(MH.bugError(\"Got SizeWatcher call for unknown element\"));\n      return;\n    }\n\n    properties._width =\n      sizeData.border[MC.S_WIDTH] || sizeData.content[MC.S_WIDTH];\n    properties._height =\n      sizeData.border[MC.S_HEIGHT] || sizeData.content[MC.S_HEIGHT];\n\n    debug: logger?.debug7(\"Got size\", element, properties);\n  };\n\n  // ----------\n\n  const observeAll = () => {\n    isFirstTime = true;\n\n    for (const element of allItems.keys()) {\n      sizeWatcher.onResize(resizeHandler, { target: element });\n    }\n  };\n\n  // ----------\n\n  const unobserveAll = () => {\n    for (const element of allItems.keys()) {\n      sizeWatcher.offResize(resizeHandler, element);\n    }\n  };\n\n  // ----------\n\n  const setWidths = (height: number) => {\n    for (const [element, properties] of allItems.entries()) {\n      if (MH.parentOf(element) === containerElement) {\n        const width = getWidthAtH(element, properties, height);\n        debug: logger?.debug9(\n          \"Setting width property\",\n          element,\n          properties,\n          width,\n        );\n        setNumericStyleJsVars(\n          element,\n          { sameHeightW: width },\n          { _units: \"px\" },\n        );\n      }\n    }\n  };\n\n  // SETUP ------------------------------\n\n  widget.onDisable(unobserveAll);\n  widget.onEnable(observeAll);\n\n  widget.onDestroy(async () => {\n    for (const element of allItems.keys()) {\n      if (MH.parentOf(element) === containerElement) {\n        // delete the property and attribute\n        await setNumericStyleJsVars(element, { sameHeightW: NaN });\n        await removeClasses(element, PREFIX_ITEM);\n      }\n    }\n\n    allItems.clear();\n\n    await removeClasses(containerElement, PREFIX_ROOT);\n  });\n\n  // Find all relevant items: the container, its direct children and the\n  // top-level text only elements.\n  const getProperties = (itemType: \"\" | \"image\" | \"text\"): ItemProperties => {\n    return {\n      _type: itemType,\n      _width: NaN,\n      _height: NaN,\n      _aspectR: NaN,\n      _area: NaN,\n      _extraH: NaN,\n      _components: [],\n    };\n  };\n\n  allItems.set(containerElement, getProperties(\"\"));\n\n  for (const [item, itemType] of items.entries()) {\n    addClasses(item, PREFIX_ITEM);\n\n    const properties: ItemProperties = getProperties(itemType);\n    allItems.set(item, properties);\n\n    if (itemType === S_TEXT) {\n      properties._components = getTextComponents(item);\n      for (const child of properties._components) {\n        allItems.set(child, getProperties(\"\"));\n      }\n    }\n  }\n\n  addClasses(containerElement, PREFIX_ROOT);\n  observeAll();\n};\n\n/**\n * Find the top-level text-only elements that are descendants of the given one.\n */\nconst getTextComponents = (element: Element): Element[] => {\n  const components: Element[] = [];\n  for (const child of getVisibleContentChildren(element)) {\n    if (isText(child)) {\n      components.push(child);\n    } else {\n      components.push(...getTextComponents(child));\n    }\n  }\n\n  return components;\n};\n\nconst calculateMeasurements = (\n  containerElement: HTMLElement,\n  allItems: Map<Element, ItemProperties>,\n  isFirstTime: boolean,\n  logger: LoggerInterface | null,\n): AverageMeasurements | null => {\n  if (getData(containerElement, MC.PREFIX_ORIENTATION) === MC.S_VERTICAL) {\n    debug: logger?.debug8(\"In vertical mode\");\n    return null;\n  }\n\n  debug: logger?.debug7(\"Calculating measurements\");\n  // initial values\n  let tArea = NaN,\n    tExtraH = 0,\n    imgAR = NaN,\n    flexW = NaN,\n    nItems = 0;\n\n  for (const [element, properties] of allItems.entries()) {\n    const width = properties._width;\n    const height = properties._height;\n\n    if (element === containerElement) {\n      flexW = width;\n      nItems = MH.lengthOf(getVisibleContentChildren(element));\n\n      //\n    } else if (properties._type === S_TEXT) {\n      let thisTxtArea = 0,\n        thisTxtExtraH = 0;\n      const components = properties._components;\n\n      if (MH.lengthOf(components)) {\n        for (const component of properties._components) {\n          const cmpProps = allItems.get(component);\n          if (cmpProps) {\n            thisTxtArea += cmpProps._width * cmpProps._height;\n          } else {\n            logError(MH.bugError(\"Text component not observed\"));\n          }\n        }\n        thisTxtExtraH = height - thisTxtArea / width;\n      } else {\n        thisTxtArea = width * height;\n      }\n\n      properties._area = thisTxtArea;\n      properties._extraH = thisTxtExtraH;\n\n      tArea = (tArea || 0) + thisTxtArea;\n      tExtraH += thisTxtExtraH;\n\n      //\n    } else if (properties._type === S_IMAGE) {\n      if (isFirstTime && !areImagesLoaded(element)) {\n        debug: logger?.debug8(\"Images not loaded\");\n        return null;\n      }\n\n      const thisAspectR = width / height;\n      imgAR = (imgAR || 0) + thisAspectR;\n      properties._aspectR = thisAspectR;\n\n      //\n    } else {\n      // skip grandchildren (text components), here\n      continue;\n    }\n\n    debug: logger?.debug8(\"Examined\", properties, {\n      tArea,\n      tExtraH,\n      imgAR,\n      flexW,\n    });\n  }\n\n  return {\n    _tArea: tArea,\n    _tExtraH: tExtraH,\n    _imgAR: imgAR,\n    _flexW: flexW,\n    _nItems: nItems,\n  };\n};\n\nconst getWidthAtH = (\n  element: Element,\n  properties: ItemProperties,\n  targetHeight: number,\n): number =>\n  properties._type === S_TEXT\n    ? properties._area / (targetHeight - (properties._extraH || 0))\n    : properties._aspectR * targetHeight;\n\nconst getOptimalHeight = (\n  measurements: AverageMeasurements,\n  config: SameHeightConfigInternal,\n  logger: LoggerInterface | null,\n) => {\n  const tArea = measurements._tArea;\n  const tExtraH = measurements._tExtraH;\n  const imgAR = measurements._imgAR;\n  const flexW =\n    measurements._flexW - (measurements._nItems - 1) * config._minGap;\n  const maxFreeR = config._maxFreeR;\n  const maxWidthR = config._maxWidthR;\n\n  debug: logger?.debug8(\"Getting optimal height\", measurements, config);\n\n  // CASE 1: No text items\n  if (MH.isNaN(tArea)) {\n    debug: logger?.debug8(\"No text items\");\n    if (!imgAR) {\n      debug: logger?.debug8(\"Images not loaded\");\n      return NaN;\n    }\n\n    return flexW / imgAR;\n  }\n\n  // CASE 2: No images\n  if (MH.isNaN(imgAR)) {\n    debug: logger?.debug8(\"No images\");\n    return tArea / flexW + tExtraH;\n  }\n\n  if (!imgAR || !tArea) {\n    debug: logger?.debug8(\n      \"Expected both images and text, but no imgAR or tArea\",\n    );\n    return NaN;\n  }\n\n  const h0 = MH.sqrt(tArea / imgAR) + tExtraH;\n\n  // heights satisfying w(h) === flexW\n  const [h2, h1] = quadraticRoots(\n    imgAR,\n    -(imgAR * tExtraH + flexW),\n    tArea + tExtraH * flexW,\n  );\n\n  // heights satisfying maxWidthR\n  let hR0 = NaN,\n    hR1 = NaN,\n    hR2 = NaN;\n  if (maxWidthR > 0) {\n    hR0 = quadraticRoots(imgAR, -imgAR * tExtraH, -tArea)[0];\n\n    hR1 = quadraticRoots(\n      imgAR * maxWidthR,\n\n      -imgAR * tExtraH * maxWidthR,\n      -tArea,\n    )[0];\n\n    hR2 = quadraticRoots(\n      imgAR / maxWidthR,\n      (-imgAR * tExtraH) / maxWidthR,\n      -tArea,\n    )[0];\n  }\n\n  // heights satisfying maxFreeR\n  let hF2 = NaN,\n    hF1 = NaN;\n  if (maxFreeR >= 0) {\n    [hF2, hF1] = quadraticRoots(\n      imgAR,\n      -(imgAR * tExtraH + flexW * (1 - maxFreeR)),\n      tArea + tExtraH * flexW * (1 - maxFreeR),\n    );\n  }\n\n  // limits on constraints\n  const hConstr1 = MH.max(...MH.filter([h1, hR1, hF1], (v) => isValidNum(v)));\n  const hConstr2 = MH.min(...MH.filter([h2, hR2, hF2], (v) => isValidNum(v)));\n\n  // text and image widths at h0\n  const tw0 = tArea / (h0 - tExtraH);\n  const iw0 = h0 * imgAR;\n\n  // free space at h0\n  const freeSpace0 = flexW - tw0 - iw0;\n\n  debug: logger?.debug8(\"Optimal height calculations\", config, measurements, {\n    h0,\n    h1,\n    h2,\n    hR0,\n    hR1,\n    hR2,\n    hF1,\n    hF2,\n    hConstr1,\n    hConstr2,\n    tw0,\n    iw0,\n    freeSpace0,\n  });\n\n  // ~~~~ Some sanity checks\n  // If any of then is NaN, the comparison would be false, so we don't need to\n  // check.\n  // Also, we round the difference to 0.1 pixels to account for rounding\n  // errors during calculations.\n  if (!h0 || h0 <= 0) {\n    debug: logger?.debug1(\"Invalid calculation: Invalid h0\");\n  } else if (isValidNum(h1) !== isValidNum(h2)) {\n    debug: logger?.debug1(\n      \"Invalid calculation: One and only one of h1 or h2 is real\",\n    );\n  } else if (isValidNum(hR1) !== isValidNum(hR2)) {\n    debug: logger?.debug1(\n      \"Invalid calculation: One and only one of hR1 or hR2 is real\",\n    );\n  } else if (isValidNum(hF1) !== isValidNum(hF2)) {\n    debug: logger?.debug1(\n      \"Invalid calculation: One and only one of hF1 or hF2 is real\",\n    );\n  } else if (h1 - h0 > 0.1) {\n    debug: logger?.debug1(\"Invalid calculation: h1 > h0\");\n  } else if (h0 - h2 > 0.1) {\n    debug: logger?.debug1(\"Invalid calculation: h0 > h2\");\n  } else if (hR0 - h0 > 0.1) {\n    debug: logger?.debug1(\"Invalid calculation: hR0 > h0\");\n  } else if (hR1 - hR0 > 0.1) {\n    debug: logger?.debug1(\"Invalid calculation: hR1 > hR0\");\n  } else if (hR0 - hR2 > 0.1) {\n    debug: logger?.debug1(\"Invalid calculation: hR0 > hR2\");\n  } else if (hF1 - hF2 > 0.1) {\n    debug: logger?.debug1(\"Invalid calculation: hF1 > hF2\");\n  } else if (h1 - hF1 > 0.1) {\n    debug: logger?.debug1(\"Invalid calculation: h1 > hF1\");\n  } else if (hF2 - h2 > 0.1) {\n    debug: logger?.debug1(\"Invalid calculation: hF2 > h2\");\n  } else {\n    // Choose a height\n    if (freeSpace0 <= 0) {\n      // scenario 1 or 2\n      return h0;\n    } else {\n      // scenario 3\n      return MH.min(hConstr1, hConstr2);\n    }\n  }\n\n  logError(\n    MH.bugError(\"Invalid SameHeight calculations\"),\n    measurements,\n    config,\n  );\n  return NaN; // sanity checks failed\n};\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nexport const isTouchScreen = () =>\n  MH.hasDOM() ? matchMedia(\"(any-pointer: coarse)\").matches : false;\n\n/**\n * @since v1.2.0\n */\nexport const supportsSticky = () =>\n  MH.hasDOM()\n    ? typeof CSS !== \"undefined\" && CSS.supports(\"position\", \"sticky\")\n    : false;\n\n/**\n * @since v1.2.0\n */\nexport const isInQuirksMode = () =>\n  MH.hasDOM() ? document.compatMode === \"BackCompat\" : false;\n\n/**\n * @since v1.2.0\n */\nexport const isMobile = () =>\n  MH.hasDOM()\n    ? MH.userAgent.match(\n        /Mobile|Android|Silk\\/|Kindle|BlackBerry|Opera Mini|Opera Mobi/,\n      ) !== null\n    : false;\n","/**\n * @module Widgets\n */\n\n// [TODO v2]: Instead of wrapping children and changing which element is the\n// actual scrollable (and having to mapScrollable, etc), use the provided\n// element as the scrolling one but wrap IT (not its children) and insert the\n// scrollbars before it. Then remove, \"id\" and \"className\" config options.\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { settings } from \"@lisn/globals/settings\";\n\nimport { Position } from \"@lisn/globals/types\";\n\nimport { supportsSticky, isMobile, isInQuirksMode } from \"@lisn/utils/browser\";\nimport {\n  showElement,\n  hideElement,\n  displayElement,\n  undisplayElement,\n  hasClass,\n  addClasses,\n  addClassesNow,\n  removeClasses,\n  removeClassesNow,\n  getData,\n  setData,\n  setBooleanData,\n  setBooleanDataNow,\n  setDataNow,\n  delData,\n  delDataNow,\n  getComputedStyleProp,\n  getComputedStylePropNow,\n  setStyleProp,\n  setNumericStyleJsVars,\n} from \"@lisn/utils/css-alter\";\nimport {\n  moveElementNow,\n  moveElement,\n  isAllowedToWrap,\n  getContentWrapper,\n  wrapChildren,\n  unwrapContentNow,\n  getOrAssignID,\n} from \"@lisn/utils/dom-alter\";\nimport {\n  waitForMeasureTime,\n  waitForMutateTime,\n} from \"@lisn/utils/dom-optimize\";\nimport {\n  addEventListenerTo,\n  removeEventListenerFrom,\n  preventSelect,\n} from \"@lisn/utils/event\";\nimport { logError, logWarn } from \"@lisn/utils/log\";\nimport { toArrayIfSingle } from \"@lisn/utils/misc\";\nimport {\n  isScrollable,\n  getDefaultScrollingElement,\n  getClientWidthNow,\n  getClientHeightNow,\n  mapScrollable,\n  unmapScrollable,\n  tryGetMainScrollableElement,\n  ScrollAction,\n} from \"@lisn/utils/scroll\";\nimport { formatAsString } from \"@lisn/utils/text\";\nimport {\n  validateStrList,\n  validateNumber,\n  validateBoolean,\n  validateString,\n} from \"@lisn/utils/validation\";\n\nimport { ScrollWatcher, ScrollData } from \"@lisn/watchers/scroll-watcher\";\nimport { SizeWatcher, SizeData } from \"@lisn/watchers/size-watcher\";\n\nimport {\n  Widget,\n  WidgetConfigValidatorObject,\n  registerWidget,\n} from \"@lisn/widgets/widget\";\n\nimport debug from \"@lisn/debug/debug\";\n\n/**\n * Configures the given element, which must be scrollable, to use a\n * {@link Scrollbar}.\n *\n * The Scrollbar widget is a customizable alternative to the native\n * scrollbars (vertical and horizontal). You can position each of the two\n * scrollbars on any of the four sides of the element, make them automatically\n * hide after certain time of inactivity, style them as a traditional handle\n * scrollbar or a percentage fill progress bar and so on.\n *\n * It is also itself draggable/clickable so it _can_ be used to scroll the\n * element similar to the native scrollbar. The drag/click functionality can be\n * disabled too.\n *\n * **NOTE:** If you have disabled the {@link Widgets.PageLoader | PageLoader}\n * and have left {@link ScrollbarConfig.hideNative} ON, but are seeing the\n * native scrollbars just for a fraction of a second at the beginning of the\n * page load, you may want to manually add `lisn-hide-scroll` class on the\n * scrollable element to make sure the scrollbars are hidden as soon as\n * possible (before the scrollbar widget has time to initialize.\n *\n * **IMPORTANT:** If you are using the Scrollbar on an element other than the\n * main scrollable element, it's highly recommended to\n * {@link settings.contentWrappingAllowed | enable content wrapping} (it is\n * enabled by default). Otherwise, Scrollbar will rely on position: sticky. If\n * you want to instead manually create the wrappers yourself, ensure your\n * structure is as follows:\n * ```html\n * <div class=\"scrollable\"><!-- Element you instantiate as Scrollbar -->\n *   <div class=\"lisn-scrollbar__content\"><!-- Optional wrapper to avoid relying on sticky -->\n *     <div class=\"lisn-wrapper\"><!-- Optional wrapper to enable efficient scroll tracking -->\n *       <!-- YOUR CONTENT -->\n *     </div>\n *   </div>\n * </div>\n * ```\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Scrollbar}\n * widget on a given element. Use {@link Scrollbar.get} to get an existing\n * instance if any. If there is already a widget instance, it will be destroyed!\n *\n * -----\n *\n * You can use the following dynamic attributes or CSS properties in your\n * stylesheet:\n *\n * The following dynamic attributes are set on the element:\n * - `data-lisn-has-scrollbar-top`: `\"true\"` or `\"false\"`\n * - `data-lisn-has-scrollbar-bottom`: `\"true\"` or `\"false\"`\n * - `data-lisn-has-scrollbar-left`: `\"true\"` or `\"false\"`\n * - `data-lisn-has-scrollbar-right`: `\"true\"` or `\"false\"`\n *\n * The following dynamic attributes are set on each progressbar element:\n * - `data-lisn-orientation`: `\"horizontal\"` or `\"vertical\"`\n * - `data-lisn-place`: `\"top\"`, `\"bottom\"`, `\"left\"` or `\"right\"`\n * - `data-lisn-draggable`: `\"true\"` or `\"false\"`\n * - `data-lisn-clickable`: `\"true\"` or `\"false\"`\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see {@link settings.autoWidgets}), the\n * following CSS classes or data attributes are recognized:\n * - `lisn-scrollbar` class or `data-lisn-scrollbar` attribute set on the\n *   scrollable element that you want to enable custom scrollbars for\n *\n * See below examples for what values you can use set for the data attribute\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This will create custom scrollbars for\n * {@link settings.mainScrollableElementSelector | the main scrolling element}.\n *\n * This will work even if {@link settings.autoWidgets}) is false\n *\n * ```html\n * <!-- LISN should be loaded beforehand -->\n * <script>\n *   // You can also just customise global default settings:\n *   // LISN.settings.scrollbarPositionV = \"top\";\n *   // LISN.settings.scrollbarAutoHide = 3000;\n *   // LISN.settings.scrollbarUseHandle = true;\n *\n *   LISN.widgets.Scrollbar.enableMain({\n *     position: \"top\",\n *     autoHide: 3000,\n *     useHandle: true\n *   });\n * </script>\n * ```\n *\n * @example\n * This will create custom scrollbars for a custom scrolling element (i.e. one\n * with overflow \"auto\" or \"scroll\").\n *\n * ```html\n * <div class=\"scrolling lisn-scrollbar\">\n *   <!-- content here... -->\n * </div>\n * ```\n *\n * @example\n * As above but with custom settings.\n *\n * ```html\n * <div\n *   class=\"scrolling\"\n *   data-lisn-scrollbar=\"hide-native=false\n *                        | positionH=top\n *                        | positionV=left\n *                        | auto-hide=2000\n *                        | click-scroll=false\n *                        | drag-scroll=false\n *                        | use-handle=false\n *                        \">\n *   <!-- content here... -->\n * </div>\n * ```\n */\nexport class Scrollbar extends Widget {\n  /**\n   * Returns the actual scrollable element us which, unless the scrollable you\n   * passed to the constructor is the\n   * {@link settings.mainScrollableElementSelector | the main scrolling element}\n   * or unless\n   * {@link settings.contentWrappingAllowed | you've disabled content wrapping},\n   * this will be a new element created by us that is a descendant of the\n   * original element you passed.\n   */\n  readonly getScrollable: () => Element;\n\n  /**\n   * If element is omitted, returns the instance created by {@link enableMain}\n   * if any.\n   */\n  static get(scrollable?: Element): Scrollbar | null {\n    if (!scrollable) {\n      return mainWidget;\n    }\n\n    if (scrollable === MH.getDocElement()) {\n      scrollable = MH.getBody();\n    }\n\n    const instance = super.get(scrollable, DUMMY_ID);\n    if (MH.isInstanceOf(instance, Scrollbar)) {\n      return instance;\n    }\n    return null;\n  }\n\n  /**\n   * Enables scrollbars on the\n   * {@link settings.mainScrollableElementSelector | the main scrolling element}.\n   *\n   * **NOTE:** It returns a Promise to a widget because it will wait for the\n   * main scrollable element to be present in the DOM if not already.\n   */\n  static async enableMain(config?: ScrollbarConfig) {\n    // [TODO v2]: enableMain should be synchronous and the constructor should\n    // wait for the scrollable, allowing users who want to use the main\n    // scrollable to just pass null/undefined/window. Then getScrollable should\n    // return null or the actual scrollable if available + add fetchScrollable\n    // to return a Promise.\n    const scrollable = await ScrollWatcher.fetchMainScrollableElement();\n    const widget = new Scrollbar(scrollable, config);\n    widget.onDestroy(() => {\n      if (mainWidget === widget) {\n        mainWidget = null;\n      }\n    });\n\n    mainWidget = widget;\n    return widget;\n  }\n\n  static register() {\n    registerWidget(\n      WIDGET_NAME,\n      (element, config) => {\n        if (MH.isHTMLElement(element)) {\n          if (!Scrollbar.get(element)) {\n            return new Scrollbar(element, config);\n          }\n        } else {\n          logError(\n            MH.usageError(\"Only HTMLElement is supported for Scrollbar widget\"),\n          );\n        }\n        return null;\n      },\n      configValidator,\n    );\n  }\n\n  /**\n   * Note that passing `document.body` is considered equivalent to\n   * `document.documentElement`.\n   */\n  constructor(scrollable: HTMLElement, config?: ScrollbarConfig) {\n    if (scrollable === MH.getDocElement()) {\n      scrollable = MH.getBody();\n    }\n\n    const destroyPromise = Scrollbar.get(scrollable)?.destroy();\n    super(scrollable, { id: DUMMY_ID });\n\n    const props = getScrollableProps(scrollable);\n    const ourScrollable = props.scrollable;\n\n    (destroyPromise || MH.promiseResolve()).then(async () => {\n      if (this.isDestroyed()) {\n        return;\n      }\n\n      init(this, scrollable, props, config);\n    });\n\n    this.getScrollable = () => ourScrollable;\n  }\n}\n\n/**\n * @interface\n */\nexport type ScrollbarConfig = {\n  /**\n   * The DOM ID to set on the\n   * {@link Scrollbar.getScrollable | scrollable element}. Will result in the\n   * scrollable element getting this ID. This is useful if the scrollable is a\n   * wrapper created by us and you want it to be assigned an ID.\n   *\n   * **IMPORTANT:** If the scrollable is the\n   * {@link settings.mainScrollableElementSelector | the main scrolling element}\n   * or {@link settings.contentWrappingAllowed | if you've disabled content wrapping},\n   * then the scrollable element provided as the widget element will _not_ have\n   * its content wrapped and will remain the actual scrollable. In this case,\n   * its ID will be set to this, so if it already has an ID, it will be\n   * overridden with this value.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * A class name or a list of class names to set on the\n   * {@link Scrollbar.getScrollable | scrollable element}. Will result in the\n   * scrollable element getting these classes. This is useful if the scrollable\n   * is a wrapper created by us and you want it to be assigned classes.\n   *\n   * See explanation for {@link id}.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * Hide the native scroll bar.\n   *\n   * Note that the LISN scrollbar is itself draggable/clickable so it\n   * _can_ be used to scroll the element similar to the native scrollbar.\n   *\n   * @defaultValue {@link settings.scrollbarHideNative}\n   */\n  hideNative?: boolean;\n\n  /**\n   * Whether to enable also on mobile and tablet devices. Detection is based on\n   * user agent.\n   *\n   * @defaultValue {@link settings.scrollbarOnMobile}\n   */\n  onMobile?: boolean;\n\n  /**\n   * Where to place the scrollbar that tracks the horizontal scroll.\n   *\n   * It does not need to be a horizontal position; it can for example be \"left\"\n   * or \"right\".\n   *\n   * @defaultValue {@link settings.scrollbarPositionH}\n   */\n  positionH?: Position;\n\n  /**\n   * Where to place the scrollbar that tracks the vertical scroll.\n   *\n   * It does not need to be a vertical position; it can for example be \"top\"\n   * or \"bottom\".\n   *\n   * @defaultValue {@link settings.scrollbarPositionV}\n   */\n  positionV?: Position;\n\n  /**\n   * Auto-hide the scrollbar when there's no scrolling happening for the given\n   * number of milliseconds.\n   *\n   * Set to 0 or a negative value to disable hiding.\n   *\n   * @defaultValue {@link settings.scrollbarAutoHide}\n   */\n  autoHide?: number;\n\n  /**\n   * Whether to scroll the element when a user clicks anywhere on the\n   * scrollbar.\n   *\n   * @defaultValue {@link settings.scrollbarClickScroll}\n   */\n  clickScroll?: boolean;\n\n  /**\n   * Whether to scroll the element when a user drags the handle (if\n   * {@link useHandle}) or drags along anywhere on the scrollbar (if _not_\n   * {@link useHandle}).\n   *\n   * @defaultValue {@link settings.scrollbarDragScroll}\n   */\n  dragScroll?: boolean;\n\n  /**\n   * Whether to use a traditional fixed-length handle (like the native\n   * scrollbar) to indicate the position or the default style of a fill (that\n   * starts at the beginning and ends at the scroll fraction).\n   *\n   * @defaultValue {@link settings.scrollbarUseHandle}\n   */\n  useHandle?: boolean;\n};\n\n// --------------------\n\nconst WIDGET_NAME = \"scrollbar\";\nconst PREFIXED_NAME = MH.prefixName(WIDGET_NAME);\n// Only one Scrollbar widget per element is allowed, but Widget\n// requires a non-blank ID.\nconst DUMMY_ID = PREFIXED_NAME;\nconst PREFIX_ROOT = `${PREFIXED_NAME}__root`;\nconst PREFIX_CONTAINER = `${PREFIXED_NAME}__container`;\nconst PREFIX_CONTENT = `${PREFIXED_NAME}__content`;\nconst PREFIX_BAR = `${PREFIXED_NAME}__bar`;\nconst PREFIX_WRAPPER = `${PREFIXED_NAME}__wrapper`;\nconst PREFIX_FILL = `${PREFIXED_NAME}__fill`;\nconst PREFIX_SPACER = `${PREFIXED_NAME}__spacer`;\nconst PREFIX_HANDLE = `${PREFIXED_NAME}__handle`;\nconst PREFIX_DRAGGABLE = MH.prefixName(\"draggable\");\nconst PREFIX_CLICKABLE = MH.prefixName(\"clickable\");\nconst PREFIX_HAS_WRAPPER = MH.prefixName(\"has-wrapper\");\nconst PREFIX_ALLOW_COLLAPSE = MH.prefixName(\"allow-collapse\");\nconst PREFIX_HAS_V_SCROLL = MH.prefixName(\"has-v-scroll\");\nconst PREFIX_HAS_SCROLLBAR = MH.prefixName(\"has-scrollbar\");\nconst PREFIX_HIDE_SCROLL = MH.prefixName(\"hide-scroll\");\n\nconst S_SET_POINTER_CAPTURE = \"setPointerCapture\";\nconst S_RELEASE_POINTER_CAPTURE = \"releasePointerCapture\";\nconst S_ARIA_VALUENOW = MC.ARIA_PREFIX + \"valuenow\";\nconst S_SCROLLBAR = \"scrollbar\";\n\nlet mainWidget: Scrollbar | null = null;\n\nconst configValidator: WidgetConfigValidatorObject<ScrollbarConfig> = {\n  id: validateString,\n  className: validateStrList,\n  hideNative: validateBoolean,\n  onMobile: validateBoolean,\n  positionH: validateString,\n  positionV: validateString,\n  autoHide: validateNumber,\n  clickScroll: validateBoolean,\n  dragScroll: validateBoolean,\n  useHandle: validateBoolean,\n};\n\nconst getScrollableProps = (containerElement: HTMLElement) => {\n  // If main scrollable element doesn't exist yet, then the containerElement\n  // passed can't be it anyway, so no need to use fetchMainScrollableElement.\n  const mainScrollableElement = tryGetMainScrollableElement();\n\n  const body = MH.getBody();\n  const defaultScrollable = getDefaultScrollingElement();\n\n  const isBody = containerElement === body;\n  const isMainScrollable =\n    (isBody ? defaultScrollable : containerElement) === mainScrollableElement;\n\n  const root: HTMLElement = isMainScrollable\n    ? mainScrollableElement\n    : isBody\n      ? defaultScrollable\n      : containerElement;\n\n  // check if we're using body in quirks mode\n  const isBodyInQuirks = isBody && isInQuirksMode();\n\n  const allowedToWrap = isAllowedToWrap(containerElement);\n  const barParent = isMainScrollable ? body : containerElement;\n  const hasVScroll = isScrollable(root, { axis: \"y\" });\n\n  let contentWrapper: HTMLElement | null = null;\n  let supported = true;\n  let hasExistingWrapper = true;\n\n  if (!isMainScrollable && !isBody) {\n    // we need to wrap if possible\n    contentWrapper = getContentWrapper(containerElement, {\n      _classNames: [PREFIX_CONTENT],\n    });\n    hasExistingWrapper = !MH.isNullish(contentWrapper);\n\n    if (!contentWrapper) {\n      const warnMsgPrefix =\n        \"Scrollbar on elements other than \" +\n        \"the main scrollable when content wrapping is \" +\n        \"disabled relies on position: sticky\";\n\n      if (allowedToWrap) {\n        // we'll wrap later, but create the wrapper now as it will be the actual\n        // scrollable\n        contentWrapper = MH.createElement(\"div\");\n      } else if (supportsSticky()) {\n        logWarn(`${warnMsgPrefix}, is experimental and may not work properly.`);\n      } else {\n        logError(`${warnMsgPrefix}, but this browser does not support sticky.`);\n        supported = false;\n      }\n    }\n  }\n\n  const needsSticky =\n    !isMainScrollable && !allowedToWrap && !hasExistingWrapper;\n\n  return {\n    supported,\n    isMainScrollable,\n    isBody,\n    isBodyInQuirks,\n    root,\n    scrollable: contentWrapper ?? root,\n    barParent,\n    contentWrapper,\n    hasExistingWrapper,\n    needsSticky,\n    hasVScroll,\n  };\n};\n\nconst init = (\n  widget: Scrollbar,\n  containerElement: HTMLElement,\n  props: ReturnType<typeof getScrollableProps>,\n  config: ScrollbarConfig | undefined,\n) => {\n  const {\n    supported,\n    isMainScrollable,\n    isBody,\n    isBodyInQuirks,\n    root,\n    scrollable,\n    barParent,\n    contentWrapper,\n    hasExistingWrapper,\n    needsSticky,\n    hasVScroll,\n  } = props;\n\n  const logger = debug\n    ? new debug.Logger({\n        name: `Scrollbar-${formatAsString(root)}`,\n        logAtCreation: { props, config },\n      })\n    : null;\n\n  // config\n  const onMobile = config?.onMobile ?? settings.scrollbarOnMobile ?? false;\n  const hideNative =\n    config?.hideNative ?? settings.scrollbarHideNative ?? false;\n  const positionH = config?.positionH || settings.scrollbarPositionH;\n  const positionV = config?.positionV || settings.scrollbarPositionV;\n  const autoHideDelay = config?.autoHide ?? settings.scrollbarAutoHide;\n  const clickScroll = config?.clickScroll ?? settings.scrollbarClickScroll;\n  const dragScroll =\n    config?.dragScroll ?? settings.scrollbarDragScroll ?? false;\n  const useHandle = config?.useHandle ?? settings.scrollbarUseHandle ?? false;\n\n  if (isMobile() && !onMobile) {\n    return;\n  }\n\n  // Ensure scroll tracking that will be setup on the original element uses the\n  // new scrollable we create.\n  // XXX TODO But this still breaks any existing scroll tracking\n  mapScrollable(root, scrollable);\n\n  // ----------\n\n  const newScrollbar = (wrapper: Element, position: string) => {\n    const barIsHorizontal = position === MC.S_TOP || position === MC.S_BOTTOM;\n\n    const scrollbar = MH.createElement(\"div\");\n    addClassesNow(scrollbar, PREFIX_BAR);\n    setDataNow(\n      scrollbar,\n      MC.PREFIX_ORIENTATION,\n      barIsHorizontal ? MC.S_HORIZONTAL : MC.S_VERTICAL,\n    );\n    setDataNow(scrollbar, MC.PREFIX_PLACE, position);\n\n    if (clickScroll || dragScroll) {\n      MH.setAttr(scrollbar, MC.S_ROLE, S_SCROLLBAR);\n      MH.setAttr(scrollbar, MC.S_ARIA_CONTROLS, scrollDomID);\n    }\n\n    const fill = MH.createElement(\"div\");\n    addClassesNow(fill, useHandle ? PREFIX_SPACER : PREFIX_FILL);\n\n    let handle: Element | null = null;\n    if (useHandle) {\n      handle = MH.createElement(\"div\");\n      addClassesNow(handle, PREFIX_HANDLE);\n      setBooleanDataNow(handle, PREFIX_DRAGGABLE, dragScroll);\n    }\n\n    setBooleanDataNow(scrollbar, PREFIX_DRAGGABLE, dragScroll && !useHandle);\n    setBooleanDataNow(scrollbar, PREFIX_CLICKABLE, clickScroll);\n\n    moveElementNow(fill, { to: scrollbar });\n\n    if (handle) {\n      moveElementNow(handle, { to: scrollbar });\n    }\n    moveElementNow(scrollbar, { to: wrapper });\n\n    return {\n      _bar: scrollbar,\n      _handle: handle,\n      _fill: fill,\n    };\n  };\n\n  // ----------\n\n  const setProgress = async (scrollData: ScrollData, tracksH: boolean) => {\n    const scrollbar = tracksH ? scrollbarH : scrollbarV;\n    const hasBarPrefix = `${PREFIX_HAS_SCROLLBAR}-${tracksH ? positionH : positionV}`;\n\n    const completeFraction = tracksH\n      ? scrollData[MC.S_SCROLL_LEFT_FRACTION]\n      : scrollData[MC.S_SCROLL_TOP_FRACTION];\n\n    const viewFraction = tracksH\n      ? scrollData[MC.S_CLIENT_WIDTH] / scrollData[MC.S_SCROLL_WIDTH]\n      : scrollData[MC.S_CLIENT_HEIGHT] / scrollData[MC.S_SCROLL_HEIGHT];\n\n    debug: logger?.debug9(\"Updating progress\", {\n      tracksH,\n      completeFraction,\n      viewFraction,\n    });\n\n    MH.setAttr(\n      scrollbar,\n      S_ARIA_VALUENOW,\n      MH.round(completeFraction * 100) + \"\",\n    );\n\n    setNumericStyleJsVars(\n      scrollbar,\n      { viewFr: viewFraction, completeFr: completeFraction },\n      { _numDecimal: 4 },\n    );\n\n    const scrollAxis = tracksH ? \"x\" : \"y\";\n    if (isScrollable(scrollable, { axis: scrollAxis }) && viewFraction < 1) {\n      setBooleanData(containerElement, hasBarPrefix);\n      displayElement(scrollbar);\n    } else {\n      delData(containerElement, hasBarPrefix);\n      undisplayElement(scrollbar);\n    }\n  };\n\n  // ----------\n\n  const updateProgress = (target: Element, scrollData: ScrollData) => {\n    setProgress(scrollData, true);\n    setProgress(scrollData, false);\n\n    if (!isMainScrollable && !isBody) {\n      setBoxMeasureProps(containerElement);\n    }\n\n    if (autoHideDelay > 0) {\n      showElement(wrapper).then(() => hideElement(wrapper, autoHideDelay));\n    }\n  };\n\n  const updatePropsOnResize = (target: Element, sizeData: SizeData) => {\n    setBoxMeasureProps(containerElement);\n    setNumericStyleJsVars(\n      containerElement,\n      { barHeight: sizeData.border[MC.S_HEIGHT] },\n      { _units: \"px\", _numDecimal: 2 },\n    );\n  };\n\n  // ----------\n\n  let isDragging = false;\n  let lastOffset = 0;\n  let lastTargetFraction = 0;\n  let scrollAction: ScrollAction | null;\n\n  const onClickOrDrag = async (event: Event, tracksH: boolean) => {\n    MH.preventDefault(event);\n    const scrollbar = tracksH ? scrollbarH : scrollbarV;\n    const handle = tracksH ? handleH : handleV;\n\n    const target = MH.targetOf(event);\n    if (!MH.isMouseEvent(event) || !MH.isHTMLElement(target)) {\n      return;\n    }\n\n    const eventType = event.type;\n\n    const isClick =\n      eventType === MC.S_POINTERDOWN || eventType === MC.S_MOUSEDOWN;\n    const isHandleClick =\n      isClick && useHandle && hasClass(target, PREFIX_HANDLE);\n    const startsDrag = isClick && dragScroll && (isHandleClick || !useHandle);\n\n    if (startsDrag) {\n      isDragging = true;\n      setOrReleasePointerCapture(event, scrollbar, S_SET_POINTER_CAPTURE);\n    }\n\n    debug: logger?.debug10(\"Click or drag\", {\n      eventType,\n      isClick,\n      isHandleClick,\n      isDragging,\n      startsDrag,\n    });\n\n    if ((!isClick && !isDragging) || (isClick && !startsDrag && !clickScroll)) {\n      // - Either moving pointer when no drag scroll has been started OR\n      // - Clicking when no drag is allowed in the context of the click and no\n      //   click scroll is allowed either\n      return;\n    }\n\n    await waitForMeasureTime();\n    const barIsHorizontal = isHorizontal(scrollbar);\n\n    const barLength = barIsHorizontal\n      ? scrollbar[MC.S_CLIENT_WIDTH]\n      : scrollbar[MC.S_CLIENT_HEIGHT];\n\n    const currScrollOffset = tracksH\n      ? scrollable[MC.S_SCROLL_LEFT]\n      : scrollable[MC.S_SCROLL_TOP];\n\n    const maxScrollOffset = tracksH\n      ? scrollable[MC.S_SCROLL_WIDTH] - getClientWidthNow(scrollable)\n      : scrollable[MC.S_SCROLL_HEIGHT] - getClientHeightNow(scrollable);\n\n    // Get click offset relative to the scrollbar regardless of what the\n    // event target is and what transforms is has applied.\n    const rect = MH.getBoundingClientRect(scrollbar);\n    const offset = barIsHorizontal\n      ? event.clientX - rect.left\n      : event.clientY - rect.top;\n\n    debug: logger?.debug10(\"Pointer offset\", offset);\n\n    if (offset === lastOffset) {\n      return;\n    }\n\n    const deltaOffset = isClick ? offset : offset - lastOffset;\n    lastOffset = offset;\n\n    if (!isClick && useHandle) {\n      // Dragging the handle\n      const handleLength = handle\n        ? MH.parseFloat(\n            getComputedStylePropNow(\n              handle,\n              barIsHorizontal ? MC.S_WIDTH : MC.S_HEIGHT,\n            ),\n          )\n        : 0;\n\n      lastTargetFraction =\n        lastTargetFraction + deltaOffset / (barLength - (handleLength || 0));\n    } else if (isHandleClick) {\n      // Starting a handle drag\n      lastTargetFraction = currScrollOffset / maxScrollOffset;\n    } else {\n      // Clicking or dragging on the bar -> scroll to the offset under the pointer\n      lastTargetFraction = offset / barLength;\n    }\n\n    if (isHandleClick || (isClick && !clickScroll)) {\n      return;\n    }\n\n    const targetScrollOffset = lastTargetFraction * maxScrollOffset;\n    const targetCoordinates = tracksH\n      ? { left: targetScrollOffset }\n      : { top: targetScrollOffset };\n\n    debug: logger?.debug10(\"Scroll target offset\", {\n      lastTargetFraction,\n      targetCoordinates,\n    });\n\n    if (isClick) {\n      // smooth scroll\n      scrollAction = await scrollWatcher.scrollTo(targetCoordinates, {\n        scrollable,\n        weCanInterrupt: true,\n      });\n    } else {\n      scrollAction?.cancel();\n      scrollAction = null;\n      MH.elScrollTo(scrollable, targetCoordinates);\n    }\n  };\n\n  // ----------\n\n  const onRelease = (event: Event, tracksH: boolean) => {\n    const scrollbar = tracksH ? scrollbarH : scrollbarV;\n    setOrReleasePointerCapture(event, scrollbar, S_RELEASE_POINTER_CAPTURE);\n\n    isDragging = false;\n    scrollAction = null;\n  };\n\n  const onClickOrDragH = (event: Event) => onClickOrDrag(event, true);\n  const onClickOrDragV = (event: Event) => onClickOrDrag(event, false);\n  const onReleaseH = (event: Event) => onRelease(event, true);\n  const onReleaseV = (event: Event) => onRelease(event, false);\n\n  // ----------\n\n  const maybeSetNativeHidden = () => {\n    if (hideNative) {\n      addClasses(scrollable, PREFIX_HIDE_SCROLL);\n      if (isBodyInQuirks) {\n        addClasses(MH.getDocElement(), PREFIX_HIDE_SCROLL);\n      }\n    }\n  };\n\n  const setNativeShown = () => {\n    removeClasses(scrollable, PREFIX_HIDE_SCROLL);\n    if (isBodyInQuirks) {\n      removeClasses(MH.getDocElement(), PREFIX_HIDE_SCROLL);\n    }\n  };\n\n  // ----------\n\n  const addWatchers = () => {\n    // Track scroll in any direction as well as changes in border or content size\n    // of the element and its contents.\n    scrollWatcher.trackScroll(updateProgress, {\n      threshold: 0,\n      scrollable,\n    });\n\n    // Track changes in content or border size of the container element which\n    // would also detect changes in its padding.\n    sizeWatcher.onResize(updatePropsOnResize, {\n      target: containerElement,\n      threshold: 0,\n    });\n  };\n\n  const removeWatchers = () => {\n    scrollWatcher.noTrackScroll(updateProgress, scrollable);\n    sizeWatcher.offResize(updatePropsOnResize, containerElement);\n  };\n\n  // SETUP ------------------------------\n\n  if (!supported) {\n    setNativeShown();\n    return;\n  }\n\n  const scrollWatcher = ScrollWatcher.reuse({ [MC.S_DEBOUNCE_WINDOW]: 0 });\n  const sizeWatcher = SizeWatcher.reuse({ [MC.S_DEBOUNCE_WINDOW]: 0 });\n\n  if (!isMainScrollable && !isBody) {\n    addClasses(containerElement, PREFIX_CONTAINER);\n  }\n\n  setBooleanData(containerElement, PREFIX_ALLOW_COLLAPSE, !isMobile());\n  setBooleanData(containerElement, PREFIX_HAS_WRAPPER, !!contentWrapper);\n  setBooleanData(\n    containerElement,\n    PREFIX_HAS_V_SCROLL,\n    !!contentWrapper && hasVScroll,\n  );\n\n  // Wrap children if needed\n  if (contentWrapper && !hasExistingWrapper) {\n    wrapChildren(containerElement, {\n      wrapper: contentWrapper,\n      ignoreMove: true,\n    }); // no need to await here\n    addClasses(contentWrapper, PREFIX_CONTENT);\n  }\n\n  maybeSetNativeHidden();\n\n  const origDomID = scrollable.id;\n  if (config?.id) {\n    scrollable.id = config.id;\n  }\n\n  if (config?.className) {\n    addClasses(scrollable, ...toArrayIfSingle(config.className));\n  }\n\n  const scrollDomID = // for ARIA\n    clickScroll || dragScroll ? getOrAssignID(scrollable, S_SCROLLBAR) : \"\";\n\n  addClasses(barParent, PREFIX_ROOT);\n\n  const wrapper = MH.createElement(\"div\");\n  preventSelect(wrapper);\n  addClasses(wrapper, MC.PREFIX_NO_TOUCH_ACTION);\n  addClasses(wrapper, PREFIX_WRAPPER);\n\n  if (isBody || isMainScrollable) {\n    setData(wrapper, MC.PREFIX_POSITION, MC.S_FIXED);\n  } else if (needsSticky) {\n    setData(wrapper, MC.PREFIX_POSITION, MC.S_STICKY);\n  }\n\n  const { _bar: scrollbarH, _handle: handleH } = newScrollbar(\n    wrapper,\n    positionH,\n  );\n  const { _bar: scrollbarV, _handle: handleV } = newScrollbar(\n    wrapper,\n    positionV,\n  );\n\n  moveElement(wrapper, {\n    to: barParent,\n    position: \"prepend\",\n  });\n\n  addWatchers();\n\n  // Track clicking and dragging on the two scrollbars\n  if (dragScroll) {\n    addEventListenerTo(scrollbarH, MC.S_POINTERMOVE, onClickOrDragH);\n    addEventListenerTo(scrollbarV, MC.S_POINTERMOVE, onClickOrDragV);\n\n    addEventListenerTo(scrollbarH, MC.S_POINTERUP, onReleaseH);\n    addEventListenerTo(scrollbarV, MC.S_POINTERUP, onReleaseV);\n  }\n\n  if (dragScroll || clickScroll) {\n    addEventListenerTo(scrollbarH, MC.S_POINTERDOWN, onClickOrDragH);\n    addEventListenerTo(scrollbarV, MC.S_POINTERDOWN, onClickOrDragV);\n  }\n\n  widget.onDisable(() => {\n    removeWatchers();\n    undisplayElement(scrollbarH);\n    undisplayElement(scrollbarV);\n    setNativeShown();\n  });\n\n  widget.onEnable(() => {\n    addWatchers();\n    displayElement(scrollbarH);\n    displayElement(scrollbarV);\n    maybeSetNativeHidden();\n  });\n\n  widget.onDestroy(async () => {\n    unmapScrollable(root);\n\n    scrollable.id = origDomID;\n    if (config?.className) {\n      removeClasses(scrollable, ...toArrayIfSingle(config.className));\n    }\n\n    await waitForMutateTime();\n    if (contentWrapper && !hasExistingWrapper) {\n      unwrapContentNow(contentWrapper, [PREFIX_CONTENT]);\n    }\n\n    moveElementNow(wrapper); // remove\n\n    if (dragScroll) {\n      removeEventListenerFrom(scrollbarH, MC.S_POINTERMOVE, onClickOrDragH);\n      removeEventListenerFrom(scrollbarV, MC.S_POINTERMOVE, onClickOrDragV);\n\n      removeEventListenerFrom(scrollbarH, MC.S_POINTERUP, onReleaseH);\n      removeEventListenerFrom(scrollbarV, MC.S_POINTERUP, onReleaseV);\n    }\n\n    if (dragScroll || clickScroll) {\n      removeEventListenerFrom(scrollbarH, MC.S_POINTERDOWN, onClickOrDragH);\n      removeEventListenerFrom(scrollbarV, MC.S_POINTERDOWN, onClickOrDragV);\n    }\n\n    removeClassesNow(barParent, PREFIX_ROOT);\n    removeClassesNow(containerElement, PREFIX_CONTAINER);\n\n    for (const position of [MC.S_TOP, MC.S_BOTTOM, MC.S_LEFT, MC.S_RIGHT]) {\n      delDataNow(containerElement, `${PREFIX_HAS_SCROLLBAR}-${position}`);\n    }\n\n    delDataNow(containerElement, PREFIX_ALLOW_COLLAPSE);\n    delDataNow(containerElement, PREFIX_HAS_WRAPPER);\n    delDataNow(containerElement, PREFIX_HAS_V_SCROLL);\n  });\n};\n\nconst isHorizontal = (scrollbar: Element) =>\n  getData(scrollbar, MC.PREFIX_ORIENTATION) === MC.S_HORIZONTAL;\n\nconst setBoxMeasureProps = async (element: HTMLElement) => {\n  for (const side of [MC.S_TOP, MC.S_RIGHT, MC.S_BOTTOM, MC.S_LEFT]) {\n    for (const key of [`padding-${side}`, `border-${side}-width`]) {\n      const padding = await getComputedStyleProp(element, key);\n      setStyleProp(element, MH.prefixCssJsVar(key), padding);\n    }\n  }\n};\n\nconst setOrReleasePointerCapture = (\n  event: Event,\n  scrollbar: Element,\n  method: \"setPointerCapture\" | \"releasePointerCapture\",\n) => {\n  if (MH.isPointerEvent(event) && method in scrollbar) {\n    scrollbar[method](event.pointerId);\n  }\n};\n","/**\n * @module Widgets\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { ScrollOffset } from \"@lisn/globals/types\";\n\nimport {\n  showElement,\n  hideElement,\n  displayElement,\n  displayElementNow,\n  undisplayElement,\n  disableInitialTransition,\n  addClassesNow,\n  removeClassesNow,\n  setDataNow,\n  setBooleanDataNow,\n  delDataNow,\n  getParentFlexDirection,\n} from \"@lisn/utils/css-alter\";\nimport {\n  replaceElementNow,\n  wrapElementNow,\n  moveElement,\n  moveElementNow,\n  insertArrow,\n} from \"@lisn/utils/dom-alter\";\nimport { waitForElement } from \"@lisn/utils/dom-events\";\nimport { waitForMutateTime } from \"@lisn/utils/dom-optimize\";\nimport { waitForReferenceElement } from \"@lisn/utils/dom-search\";\nimport { addEventListenerTo, removeEventListenerFrom } from \"@lisn/utils/event\";\nimport { validateString } from \"@lisn/utils/validation\";\nimport { isValidScrollOffset } from \"@lisn/utils/views\";\n\nimport { ScrollWatcher } from \"@lisn/watchers/scroll-watcher\";\nimport { ViewWatcher } from \"@lisn/watchers/view-watcher\";\n\nimport {\n  Widget,\n  WidgetConfigValidatorFunc,\n  registerWidget,\n} from \"@lisn/widgets/widget\";\n\n/**\n * Configures the given element as a {@link ScrollToTop} widget.\n *\n * The ScrollToTop widget adds a scroll-to-top button in the lower right corder\n * of the screen (can be changed to bottom left) which scrolls smoothly (and\n * more slowly than the native scroll) back to the top.\n *\n * The button is only shown when the scroll offset from the top is more than a\n * given configurable amount.\n *\n * **IMPORTANT:** When configuring an existing element as the button (i.e. using\n * `new ScrollToTop` or auto-widgets, rather than {@link ScrollToTop.enableMain}):\n * - if using\n *   {@link Settings.settings.mainScrollableElementSelector | the main scrolling element}\n *   as the scrollable, the button element will have it's CSS position set to `fixed`;\n * - otherwise, if using a custom scrollable element, the button element may be\n *   moved in the DOM tree in order to position it on top of the scrollable\n * If you don't want the button element changed in any way, then consider using\n * the {@link Triggers.ClickTrigger | ClickTrigger} with a\n * {@link Actions.ScrollTo | ScrollTo} action.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link ScrollToTop}\n * widget on a given element. Use {@link ScrollToTop.get} to get an existing\n * instance if any. If there is already a widget instance, it will be destroyed!\n *\n * -----\n *\n * You can use the following dynamic attributes or CSS properties in your\n * stylesheet:\n *\n * The following dynamic attributes are set on the element:\n * - `data-lisn-place`: `\"left\"` or `\"right\"`\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-scroll-to-top` class or `data-lisn-scroll-to-top` attribute set on\n *   the element that constitutes the widget. The element should be empty.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This will create a scroll-to-top button using the JavaScript API.\n *\n * This will work even if\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}) is false.\n *\n * ```html\n * <!-- LISN should be loaded beforehand -->\n * <script>\n *   LISN.widgets.ScrollToTop.enableMain({\n *     position: \"left\",\n *     offset: \"top: 300vh\"\n *   });\n * </script>\n * ```\n *\n * You can customise the offset show/hide trigger via CSS as well as long as\n * {@link ScrollToTopConfig.offset} is left at its default value which uses\n * this CSS property:\n *\n * ```html\n * <style type=\"text/css\" media=\"screen\">\n *   :root {\n *     --lisn-scroll-to-top--offset: 300vh;\n *   }\n * </style>\n * ```\n *\n * @example\n * This will configure the given element as a scroll-to-top button for the main\n * scrolling element using an existing element for the button with default\n * {@link ScrollToTopConfig}.\n *\n * ```html\n * <button class=\"lisn-scroll-to-top\"></button>\n * ```\n * @example\n * As above but with custom settings.\n *\n * ```html\n * <button data-lisn-scroll-to-top=\"position=left | offset=top:300vh\"></button>\n * ```\n *\n * @example\n * This will configure the given element as a scroll-to-top button for a custom\n * scrolling element (i.e. one with overflow \"auto\" or \"scroll\").\n *\n * ```html\n * <div id=\"scrollable\">\n *   <!-- content here... -->\n * </div>\n * <button data-lisn-scroll-to-top=\"scrollable=#scrollable\"></button>\n * ```\n *\n * @example\n * As above, but using a reference specification with a class name to find the\n * scrollable.\n *\n * ```html\n * <div class=\"scrollable\">\n *   <!-- content here... -->\n * </div>\n * <button data-lisn-scroll-to-top=\"scrollable=prev.scrollable\"></button>\n * ```\n *\n * @example\n * As above but with all custom settings.\n *\n * ```html\n * <div class=\"scrollable\">\n *   <!-- content here... -->\n * </div>\n * <button data-lisn-scroll-to-top=\"scrollable=prev.scrollable\n *                               | position=left\n *                               | offset=top:300vh\n * \"></button>\n * ```\n */\nexport class ScrollToTop extends Widget {\n  /**\n   * If element is omitted, returns the instance created by {@link enableMain}\n   * if any.\n   */\n  static get(element?: Element): ScrollToTop | null {\n    if (!element) {\n      return mainWidget;\n    }\n\n    const instance = super.get(element, DUMMY_ID);\n    if (MH.isInstanceOf(instance, ScrollToTop)) {\n      return instance;\n    }\n    return null;\n  }\n\n  static register() {\n    registerWidget(\n      WIDGET_NAME,\n      (element, config) => {\n        if (!ScrollToTop.get(element)) {\n          return new ScrollToTop(element, config);\n        }\n        return null;\n      },\n      newConfigValidator,\n    );\n  }\n\n  /**\n   * Creates a new button element, inserts it into the document body and\n   * configures it as a {@link ScrollToTop}.\n   */\n  static enableMain(config?: ScrollToTopConfig) {\n    const button = MH.createButton(\"Back to top\");\n    const widget = new ScrollToTop(button, config);\n    widget.onDestroy(() => {\n      if (mainWidget === widget) {\n        mainWidget = null;\n      }\n      return moveElement(button);\n    });\n\n    waitForElement(MH.getBody).then((body) => {\n      if (!widget.isDestroyed()) {\n        moveElement(button, { to: body });\n      }\n    });\n\n    mainWidget = widget;\n    return widget;\n  }\n\n  constructor(element: Element, config?: ScrollToTopConfig) {\n    const destroyPromise = ScrollToTop.get(element)?.destroy();\n    super(element, { id: DUMMY_ID });\n\n    const offset: ScrollOffset =\n      config?.offset ||\n      `${MC.S_TOP}: var(${MH.prefixCssVar(\"scroll-to-top--offset\")}, 200vh)`;\n    const position: \"left\" | \"right\" = config?.position || MC.S_RIGHT;\n    const scrollable = config?.scrollable;\n    const hasCustomScrollable =\n      scrollable &&\n      scrollable !== MH.getDocElement() &&\n      scrollable !== MH.getBody();\n\n    const scrollWatcher = ScrollWatcher.reuse();\n    const viewWatcher = ViewWatcher.reuse(\n      hasCustomScrollable ? { root: scrollable } : {},\n    );\n\n    const clickListener = () =>\n      scrollWatcher.scrollTo({ top: 0, left: 0 }, { scrollable });\n\n    let arrow: Element;\n    let placeholder: Element;\n    let root = element;\n\n    const showIt = () => {\n      showElement(root);\n    };\n\n    const hideIt = () => {\n      hideElement(root);\n    };\n\n    // SETUP ------------------------------\n\n    (destroyPromise || MH.promiseResolve()).then(async () => {\n      const flexDirection = scrollable\n        ? await getParentFlexDirection(scrollable)\n        : null;\n\n      await waitForMutateTime();\n      if (this.isDestroyed()) {\n        return;\n      }\n\n      if (hasCustomScrollable) {\n        // Add a placeholder to restore its position on destroy.\n        placeholder = MH.createElement(\"div\");\n        moveElementNow(placeholder, {\n          to: element,\n          position: \"before\",\n          ignoreMove: true,\n        });\n\n        // Then move it to immediately after the scrollable.\n        // If the parent is a horizontal flexbox and position is left, then\n        // we need to insert it before the scrollable.\n        const shouldInsertBefore =\n          flexDirection === \"column-reverse\" ||\n          (position === MC.S_LEFT && flexDirection === \"row\") ||\n          (position === MC.S_RIGHT && flexDirection === \"row-reverse\");\n\n        moveElementNow(element, {\n          to: scrollable,\n          position: shouldInsertBefore ? \"before\" : \"after\",\n          ignoreMove: true,\n        });\n\n        // Wrap the button.\n        root = wrapElementNow(element, { wrapper: \"div\", ignoreMove: true });\n      }\n\n      disableInitialTransition(root);\n      addClassesNow(root, PREFIX_ROOT);\n      addClassesNow(element, PREFIX_BTN);\n      setBooleanDataNow(root, PREFIX_FIXED, !hasCustomScrollable);\n      setDataNow(root, MC.PREFIX_PLACE, position);\n\n      arrow = insertArrow(element, MC.S_UP);\n\n      hideIt(); // initial\n\n      addEventListenerTo(element, MC.S_CLICK, clickListener);\n\n      viewWatcher.onView(offset, showIt, {\n        views: [MC.S_AT, MC.S_BELOW],\n      });\n\n      viewWatcher.onView(offset, hideIt, {\n        views: [MC.S_ABOVE],\n      });\n\n      this.onDisable(() => {\n        undisplayElement(root);\n      });\n\n      this.onEnable(() => {\n        displayElement(root);\n      });\n\n      this.onDestroy(async () => {\n        await waitForMutateTime();\n        removeEventListenerFrom(element, MC.S_CLICK, clickListener);\n\n        removeClassesNow(root, PREFIX_ROOT);\n        removeClassesNow(element, PREFIX_BTN);\n        delDataNow(root, PREFIX_FIXED);\n        delDataNow(root, MC.PREFIX_PLACE);\n        displayElementNow(root); // revert undisplay by onDisable\n\n        if (arrow) {\n          moveElementNow(arrow); // remove\n        }\n\n        if (root !== element) {\n          // Unwrap the button.\n          replaceElementNow(root, element, { ignoreMove: true });\n        }\n\n        if (placeholder) {\n          // Move it back into its original position.\n          replaceElementNow(placeholder, element, { ignoreMove: true });\n        }\n\n        viewWatcher.offView(offset, showIt);\n        viewWatcher.offView(offset, hideIt);\n      });\n    });\n  }\n}\n\n/**\n * @interface\n */\nexport type ScrollToTopConfig = {\n  /**\n   * The button will be shown when the scroll top offset of the page is below\n   * the given value, and hidden otherwise. Accepts a colon-separated key:value\n   * string where the key is \"top\" or \"bottom\" (or if your page scrolls\n   * horizontally, then use \"left\" or \"right\"), and the value can be any valid\n   * CSS length specification, e.g. \"top: 200vh\" or \"top: var(--offset, 50%)\".\n   *\n   * Alternatively, you set the `--lisn-scroll-to-top--offset` CSS variable on\n   * the document root, which is used by the default value.\n   *\n   * @defaultValue \"top: var(--lisn-scroll-to-top--offset, 200vh)\"\n   */\n  offset?: ScrollOffset;\n\n  /**\n   * The horizontal position of the scroll-to-top button.\n   *\n   * @defaultValue \"right\"\n   */\n  position?: \"left\" | \"right\";\n\n  /**\n   * The element that should be scrolled.\n   *\n   * @defaultValue {@link ScrollWatcher} default\n   */\n  scrollable?: Element;\n};\n\n// --------------------\n\nconst WIDGET_NAME = \"scroll-to-top\";\nconst PREFIXED_NAME = MH.prefixName(WIDGET_NAME);\n// Only one ScrollToTop widget per element is allowed, but Widget requires a\n// non-blank ID.\nconst DUMMY_ID = PREFIXED_NAME;\nconst PREFIX_ROOT = `${PREFIXED_NAME}__root`;\nconst PREFIX_BTN = `${PREFIXED_NAME}__btn`;\nconst PREFIX_FIXED = MH.prefixName(\"fixed\");\n\nlet mainWidget: ScrollToTop | null = null;\n\nconst newConfigValidator: WidgetConfigValidatorFunc<ScrollToTopConfig> = (\n  element,\n) => {\n  return {\n    offset: (key, value) => validateString(key, value, isValidScrollOffset),\n    position: (key, value) =>\n      validateString(key, value, (v) => v === MC.S_LEFT || v === MC.S_RIGHT),\n    scrollable: (key, value) =>\n      (MH.isLiteralString(value)\n        ? waitForReferenceElement(value, element)\n        : null) ?? undefined,\n  };\n};\n","/**\n * @module Widgets\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  addClasses,\n  removeClasses,\n  getBooleanData,\n  setBooleanData,\n  unsetBooleanData,\n  delData,\n  copyStyle,\n  setNumericStyleJsVars,\n} from \"@lisn/utils/css-alter\";\nimport { moveElement, swapElements, cloneElement } from \"@lisn/utils/dom-alter\";\nimport { waitForMeasureTime } from \"@lisn/utils/dom-optimize\";\nimport { getVisibleContentChildren } from \"@lisn/utils/dom-query\";\nimport {\n  addEventListenerTo,\n  removeEventListenerFrom,\n  preventSelect,\n  undoPreventSelect,\n} from \"@lisn/utils/event\";\nimport { toInt } from \"@lisn/utils/math\";\nimport { validateString } from \"@lisn/utils/validation\";\n\nimport { wrapCallback } from \"@lisn/modules/callback\";\n\nimport {\n  Widget,\n  WidgetConfigValidatorObject,\n  WidgetCallback,\n  WidgetHandler,\n  registerWidget,\n  getDefaultWidgetSelector,\n} from \"@lisn/widgets/widget\";\n\n/**\n * Configures the given element as a {@link Sortable} widget.\n *\n * The Sortable widget allows the user to reorder elements by dragging and\n * dropping. It works on touch devices as well. However, it does not yet\n * support automatic scrolling when dragging beyond edge of screen on mobile\n * devices. For this, you may want to use\n * {@link https://github.com/SortableJS/Sortable | SortableJS} instead.\n *\n * The widget should have more than one draggable item.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Sortable}\n * widget on a given element. Use {@link Sortable.get} to get an existing\n * instance if any. If there is already a widget instance, it will be destroyed!\n *\n * -----\n *\n * You can use the following dynamic attributes or CSS properties in your\n * stylesheet:\n *\n * The following dynamic attributes are set on each item element:\n * - `data-lisn-is-draggable`: `\"true\"` or `\"false\"` (false if the item is disabled)\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-sortable` class or `data-lisn-sortable` attribute set on the\n *   container element that constitutes the sortable container\n * - `lisn-sortable-item` class or `data-lisn-sortable-item` attribute set on\n *   elements that should act as the items.\n *\n * When using auto-widgets, the elements that will be used as items are\n * discovered in the following way:\n * 1. The top-level element that constitutes the widget is searched for any\n *    elements that contain the `lisn-sortable-item` class or\n *    `data-lisn-sortable-item` attribute. They do not have to be immediate\n *    children of the root element.\n * 2. If there are no such elements, all of the immediate children of the\n *    widget element (other than `script` and `style` elements) are taken as\n *    the items.\n *\n * @example\n * ```html\n * <div class=\"lisn-sortable\">\n *   <div class=\"box\">Item 1</div>\n *   <div class=\"box\">Item 2</div>\n *   <div class=\"box\">Item 3</div>\n *   <div class=\"box\">Item 4</div>\n * </div>\n * ```\n */\nexport class Sortable extends Widget {\n  /**\n   * Disables the given item number. Note that item numbers start at 1.\n   *\n   * @param currentOrder If false (default), the item numbers refer to the\n   *                     original order. If true, they refer to the current\n   *                     document order.\n   */\n  readonly disableItem: (\n    itemNum: number,\n    currentOrder?: boolean,\n  ) => Promise<void>;\n\n  /**\n   * Re-enables the given item number. Note that item numbers start at 1.\n   *\n   * @param currentOrder If false (default), the item numbers refer to the\n   *                     original order. If true, they refer to the current\n   *                     document order.\n   */\n  readonly enableItem: (\n    itemNum: number,\n    currentOrder?: boolean,\n  ) => Promise<void>;\n\n  /**\n   * Re-enables the given item number if it is disabled, otherwise disables it.\n   * Note that item numbers start at 1.\n   *\n   * @param currentOrder If false (default), the item numbers refer to the\n   *                     original order. If true, they refer to the current\n   *                     document order.\n   */\n  readonly toggleItem: (\n    itemNum: number,\n    currentOrder?: boolean,\n  ) => Promise<void>;\n\n  /**\n   * Returns true if the given item number is disabled. Note that item numbers\n   * start at 1.\n   *\n   * @param currentOrder If false (default), the item numbers refer to the\n   *                     original order. If true, they refer to the current\n   *                     document order.\n   */\n  readonly isItemDisabled: (itemNum: number, currentOrder?: boolean) => boolean;\n\n  /**\n   * The given handler will be called whenever the user moves an item to\n   * another position. It will be called after the item is moved so\n   * {@link getItems} called with `currentOrder = true` will return the updated\n   * order.\n   *\n   * If the handler returns a promise, it will be awaited upon.\n   */\n  readonly onMove: (handler: WidgetHandler) => void;\n\n  /**\n   * Returns the item elements.\n   *\n   * @param currentOrder If false (default), returns the items in the\n   *                     original order. If true, they are returned in the\n   *                     current document order.\n   */\n  readonly getItems: (currentOrder?: boolean) => Element[];\n\n  static get(element: Element): Sortable | null {\n    const instance = super.get(element, DUMMY_ID);\n    if (MH.isInstanceOf(instance, Sortable)) {\n      return instance;\n    }\n    return null;\n  }\n\n  static register() {\n    registerWidget(\n      WIDGET_NAME,\n      (element, config) => {\n        if (!Sortable.get(element)) {\n          return new Sortable(element, config);\n        }\n        return null;\n      },\n      configValidator,\n    );\n  }\n\n  /**\n   * @throws {@link Errors.LisnUsageError | LisnUsageError}\n   *                If there are less than 2 items given or found.\n   */\n  constructor(element: Element, config?: SortableConfig) {\n    const destroyPromise = Sortable.get(element)?.destroy();\n    super(element, { id: DUMMY_ID });\n\n    const items = config?.items || [];\n    if (!MH.lengthOf(items)) {\n      items.push(\n        ...MH.querySelectorAll(\n          element,\n          getDefaultWidgetSelector(PREFIX_ITEM__FOR_SELECT),\n        ),\n      );\n\n      if (!MH.lengthOf(items)) {\n        items.push(...MH.querySelectorAll(element, `[${MC.S_DRAGGABLE}]`));\n\n        if (!MH.lengthOf(items)) {\n          items.push(...getVisibleContentChildren(element));\n        }\n      }\n    }\n\n    if (MH.lengthOf(items) < 2) {\n      throw MH.usageError(\"Sortable must have more than 1 item\");\n    }\n\n    const methods = getMethods(this, items, config);\n\n    (destroyPromise || MH.promiseResolve()).then(() => {\n      if (this.isDestroyed()) {\n        return;\n      }\n\n      init(this, element, items, methods);\n    });\n\n    this.disableItem = methods._disableItem;\n    this.enableItem = methods._enableItem;\n    this.toggleItem = methods._toggleItem;\n    this.isItemDisabled = methods._isItemDisabled;\n    this.onMove = methods._onMove;\n\n    this.getItems = (currentOrder = false) =>\n      currentOrder ? methods._getSortedItems() : [...items];\n  }\n}\n\n/**\n * @interface\n */\nexport type SortableConfig = {\n  /**\n   * The elements that will be used as the draggable items.\n   *\n   * The widget should have more than one draggable item.\n   *\n   * If this is not specified, then\n   * 1. The top-level element that constitutes the widget is searched for any\n   *    elements that contain the class `lisn-sortable-item`. They do not\n   *    have to be immediate children of the root element.\n   * 2. If there are no such elements, all of the immediate children of the\n   *    widget element (other than `script` and `style` elements) are taken as\n   *    the items.\n   */\n  items?: Element[];\n\n  /**\n   * Whether to move the dragged item to before/after the drop target, or swap\n   * it with the drop target.\n   *\n   * Note that the moving/swapping action is being done as the user is dragging\n   * as soon as they drag over another item, so in order to achieve a swap\n   * effect, the user needs to be able to drag an item from one location to\n   * another without the path of the mouse crossing over all in-between items.\n   *\n   * @defaultValue \"move\";\n   */\n  mode?: \"move\" | \"swap\";\n};\n\n// --------------------\n\nconst WIDGET_NAME = \"sortable\";\nconst PREFIXED_NAME = MH.prefixName(WIDGET_NAME);\nconst PREFIX_IS_DRAGGABLE = MH.prefixName(\"is-draggable\");\n\n// Use different classes for styling items to the one used for auto-discovering\n// them, so that re-creating existing widgets can correctly find the items to\n// be used by the new widget synchronously before the current one is destroyed.\nconst PREFIX_ITEM = `${PREFIXED_NAME}__item`;\nconst PREFIX_ITEM__FOR_SELECT = `${PREFIXED_NAME}-item`;\n\nconst PREFIX_FLOATING_CLONE = `${PREFIXED_NAME}__ghost`;\n\n// Only one Sortable widget per element is allowed, but Widget requires a\n// non-blank ID.\nconst DUMMY_ID = PREFIXED_NAME;\n\nconst configValidator: WidgetConfigValidatorObject<SortableConfig> = {\n  mode: (key, value) =>\n    validateString(key, value, (v) => v === \"swap\" || v === \"move\"),\n};\n\nconst touchMoveOptions = { passive: false, capture: true };\n\nconst isItemDraggable = (item: Element) =>\n  getBooleanData(item, PREFIX_IS_DRAGGABLE);\n\nconst init = (\n  widget: Sortable,\n  element: Element,\n  items: Element[],\n  methods: ReturnType<typeof getMethods>,\n) => {\n  let currentDraggedItem: Element | null = null;\n  let floatingClone: Element | null = null;\n  let ignoreCancel = false;\n  let grabOffset = [0, 0];\n\n  const setIgnoreCancel = () => (ignoreCancel = true);\n\n  const onDragStart = (event: Event) => {\n    const currTarget = MH.currentTargetOf(event);\n\n    if (\n      MH.isElement(currTarget) &&\n      isItemDraggable(currTarget) &&\n      MH.isMouseEvent(event)\n    ) {\n      currentDraggedItem = currTarget;\n      MH.setAttr(currTarget, MC.S_DRAGGABLE);\n\n      if (MH.isTouchPointerEvent(event)) {\n        const target = MH.targetOf(event);\n        if (MH.isElement(target)) {\n          target.releasePointerCapture(event.pointerId);\n        }\n      }\n\n      addEventListenerTo(\n        MH.getDoc(),\n        MC.S_TOUCHMOVE,\n        onTouchMove,\n        touchMoveOptions,\n      );\n\n      waitForMeasureTime().then(() => {\n        // Get pointer offset relative to the current item being dragged\n        // regardless of what the event target is and what transforms is has\n        // applied.\n        const rect = MH.getBoundingClientRect(currTarget);\n        grabOffset = [event.clientX - rect.left, event.clientY - rect.top];\n      });\n    }\n  };\n\n  const onDragEnd = (event: Event) => {\n    if (ignoreCancel && event.type === MC.S_POINTERCANCEL) {\n      ignoreCancel = false;\n      return;\n    }\n\n    if (currentDraggedItem) {\n      MH.unsetAttr(currentDraggedItem, MC.S_DRAGGABLE);\n      currentDraggedItem = null;\n\n      removeEventListenerFrom(\n        MH.getDoc(),\n        MC.S_TOUCHMOVE,\n        onTouchMove,\n        touchMoveOptions,\n      );\n\n      if (floatingClone) {\n        moveElement(floatingClone);\n        floatingClone = null;\n      }\n    }\n  };\n\n  const onTouchMove = (event: Event) => {\n    if (MH.isTouchEvent(event) && MH.lengthOf(event.touches) === 1) {\n      const parentEl = MH.parentOf(currentDraggedItem);\n      if (parentEl && currentDraggedItem) {\n        MH.preventDefault(event);\n\n        const touch = event.touches[0];\n        const clientX = touch.clientX;\n        const clientY = touch.clientY;\n\n        if (!floatingClone) {\n          floatingClone = cloneElement(currentDraggedItem);\n          addClasses(floatingClone, PREFIX_FLOATING_CLONE);\n          copyStyle(currentDraggedItem, floatingClone, [\n            \"width\",\n            \"height\",\n          ]).then(() => {\n            if (floatingClone) {\n              moveElement(floatingClone, { to: parentEl });\n            }\n          });\n        }\n\n        if (floatingClone) {\n          setNumericStyleJsVars(\n            floatingClone,\n            {\n              clientX: clientX - grabOffset[0],\n              clientY: clientY - grabOffset[1],\n            },\n            { _units: \"px\" },\n          );\n        }\n      }\n    }\n  };\n\n  const onDragEnter = (event: Event) => {\n    const currTarget = MH.currentTargetOf(event);\n    const dragged = currentDraggedItem;\n\n    if (\n      (MH.isTouchPointerEvent(event) || event.type === MC.S_DRAGENTER) &&\n      dragged &&\n      MH.isElement(currTarget) &&\n      currTarget !== dragged\n    ) {\n      methods._dragItemOnto(dragged, currTarget); // no need to await\n    }\n  };\n\n  const setupEvents = () => {\n    for (const item of items) {\n      preventSelect(item);\n\n      addEventListenerTo(item, MC.S_POINTERDOWN, onDragStart);\n\n      addEventListenerTo(item, MC.S_DRAGSTART, setIgnoreCancel); // non-touch\n\n      addEventListenerTo(item, MC.S_POINTERENTER, onDragEnter); // touch\n      addEventListenerTo(item, MC.S_DRAGENTER, onDragEnter); // non-touch\n\n      addEventListenerTo(item, MC.S_DRAGOVER, MH.preventDefault); // non-touch\n\n      addEventListenerTo(item, MC.S_DRAGEND, onDragEnd); // non-touch\n      addEventListenerTo(item, MC.S_DROP, onDragEnd); // non-touch\n\n      addEventListenerTo(MH.getDoc(), MC.S_POINTERUP, onDragEnd);\n      addEventListenerTo(MH.getDoc(), MC.S_POINTERCANCEL, onDragEnd);\n    }\n  };\n\n  // SETUP ------------------------------\n\n  for (const item of items) {\n    addClasses(item, PREFIX_ITEM);\n    setBooleanData(item, PREFIX_IS_DRAGGABLE);\n  }\n\n  widget.onEnable(setupEvents);\n\n  widget.onDisable(() => {\n    for (const item of items) {\n      undoPreventSelect(item);\n\n      removeEventListenerFrom(item, MC.S_POINTERDOWN, onDragStart);\n\n      removeEventListenerFrom(item, MC.S_DRAGSTART, setIgnoreCancel);\n\n      removeEventListenerFrom(item, MC.S_POINTERENTER, onDragEnter);\n      removeEventListenerFrom(item, MC.S_DRAGENTER, onDragEnter);\n\n      removeEventListenerFrom(item, MC.S_DRAGOVER, MH.preventDefault);\n\n      removeEventListenerFrom(item, MC.S_POINTERUP, onDragEnd);\n      removeEventListenerFrom(item, MC.S_POINTERCANCEL, onDragEnd);\n      removeEventListenerFrom(item, MC.S_DRAGEND, onDragEnd);\n      removeEventListenerFrom(item, MC.S_DROP, onDragEnd);\n    }\n  });\n\n  widget.onDestroy(async () => {\n    for (const item of items) {\n      await removeClasses(item, PREFIX_ITEM);\n      await delData(item, PREFIX_IS_DRAGGABLE);\n    }\n  });\n\n  setupEvents();\n};\n\nconst getMethods = (\n  widget: Sortable,\n  items: Element[],\n  config: SortableConfig | undefined,\n) => {\n  const doSwap = config?.mode === \"swap\";\n\n  const disabledItems: Record<number, boolean> = {};\n  const callbacks = MH.newSet<WidgetCallback>();\n\n  const getSortedItems = () =>\n    [...items].sort((a, b) => (MH.isNodeBAfterA(a, b) ? -1 : 1));\n\n  const getOrigItemNumber = (itemNum: number, currentOrder = false) =>\n    currentOrder ? items.indexOf(getSortedItems()[itemNum - 1]) + 1 : itemNum;\n\n  const isItemDisabled = (itemNum: number, currentOrder = false) =>\n    disabledItems[getOrigItemNumber(itemNum, currentOrder)] === true;\n\n  const disableItem = async (itemNum: number, currentOrder = false) => {\n    itemNum = getOrigItemNumber(toInt(itemNum), currentOrder);\n    if (widget.isDisabled() || itemNum < 1 || itemNum > MH.lengthOf(items)) {\n      return;\n    }\n\n    // set immediately for toggle to work without awaiting on it\n    disabledItems[itemNum] = true;\n    await unsetBooleanData(items[itemNum - 1], PREFIX_IS_DRAGGABLE);\n  };\n\n  const enableItem = async (itemNum: number, currentOrder = false) => {\n    itemNum = getOrigItemNumber(toInt(itemNum), currentOrder);\n    if (widget.isDisabled() || !isItemDisabled(itemNum)) {\n      return;\n    }\n\n    // set immediately for toggle to work without awaiting on it\n    disabledItems[itemNum] = false;\n    await setBooleanData(items[itemNum - 1], PREFIX_IS_DRAGGABLE);\n  };\n\n  const toggleItem = (itemNum: number, currentOrder = false) =>\n    isItemDisabled(itemNum, currentOrder)\n      ? enableItem(itemNum, currentOrder)\n      : disableItem(itemNum, currentOrder);\n\n  const onMove = (handler: WidgetHandler) =>\n    callbacks.add(wrapCallback(handler));\n\n  // This is internal only for now...\n  const dragItemOnto = async (dragged: Element, draggedOver: Element) => {\n    if (doSwap) {\n      await swapElements(dragged, draggedOver, { ignoreMove: true });\n    } else {\n      await moveElement(dragged, {\n        to: draggedOver,\n        position: MH.isNodeBAfterA(dragged, draggedOver) ? \"after\" : \"before\",\n        ignoreMove: true,\n      });\n    }\n\n    for (const callback of callbacks) {\n      await callback.invoke(widget);\n    }\n  };\n\n  return {\n    _getSortedItems: getSortedItems,\n    _disableItem: disableItem,\n    _enableItem: enableItem,\n    _toggleItem: toggleItem,\n    _isItemDisabled: isItemDisabled,\n    _onMove: onMove,\n    _dragItemOnto: dragItemOnto,\n  };\n};\n","/**\n * @module Widgets\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { validateBoolean, validateNumber } from \"@lisn/utils/validation\";\n\nimport { GestureWatcher } from \"@lisn/watchers/gesture-watcher\";\n\nimport {\n  Widget,\n  WidgetConfigValidatorObject,\n  registerWidget,\n} from \"@lisn/widgets/widget\";\n\n/**\n * This is a simple wrapper around the {@link GestureWatcher}. If you are using\n * the JavaScript API, you should use the {@link GestureWatcher} directly. The\n * purpose of this widget is to expose the watcher's ability to track gestures\n * and set relevant CSS properties via the HTML API. See\n * {@link GestureWatcher.trackGesture}.\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-track-gesture` class or `data-lisn-track-gesture` attribute set on\n *   the element that constitutes the widget.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This will track user gestures over this element and set the relevant CSS\n * properties. It will use the default {@link GestureWatcher} options.\n *\n * ```html\n * <div class=\"lisn-track-gesture\"></div>\n * ```\n *\n * @example\n * As above but with custom settings.\n *\n * ```html\n * <div data-lisn-track-gesture=\"prevent-default=false\n *                               | min-delta-x=-100\n *                               | max-delta-x=100\n *                               | min-delta-y=-100\n *                               | max-delta-y=100\n *                               | min-delta-z=0.5\n *                               | max-delta-z=2\"\n * ></div>\n * ```\n */\nexport class TrackGesture extends Widget {\n  static get(element: Element): TrackGesture | null {\n    const instance = super.get(element, DUMMY_ID);\n    if (MH.isInstanceOf(instance, TrackGesture)) {\n      return instance;\n    }\n    return null;\n  }\n\n  static register() {\n    registerWidget(\n      WIDGET_NAME,\n      (element, config) => {\n        if (!TrackGesture.get(element)) {\n          return new TrackGesture(element, config);\n        }\n        return null;\n      },\n      configValidator,\n    );\n  }\n\n  constructor(element: Element, config?: TrackGestureConfig) {\n    super(element, { id: DUMMY_ID });\n\n    GestureWatcher.reuse().trackGesture(element, null, {\n      preventDefault: config?.preventDefault,\n      minTotalDeltaX: config?.minDeltaX,\n      maxTotalDeltaX: config?.maxDeltaX,\n      minTotalDeltaY: config?.minDeltaY,\n      maxTotalDeltaY: config?.maxDeltaY,\n      minTotalDeltaZ: config?.minDeltaZ,\n      maxTotalDeltaZ: config?.maxDeltaZ,\n    });\n\n    this.onDestroy(() => GestureWatcher.reuse().noTrackGesture(element));\n  }\n}\n\n/**\n * @interface\n */\nexport type TrackGestureConfig = {\n  /**\n   * Corresponds to\n   * {@link Watchers/GestureWatcher.OnGestureOptions.preventDefault | OnGestureOptions.preventDefault}.\n   *\n   * @defaultValue undefined // GestureWatcher default\n   */\n  preventDefault?: boolean;\n\n  /**\n   * Corresponds to\n   * {@link Watchers/GestureWatcher.OnGestureOptions.minTotalDeltaX | OnGestureOptions.minTotalDeltaX}.\n   *\n   * @defaultValue undefined // GestureWatcher default\n   */\n  minDeltaX?: number;\n\n  /**\n   * Corresponds to\n   * {@link Watchers/GestureWatcher.OnGestureOptions.maxTotalDeltaX | OnGestureOptions.maxTotalDeltaX}.\n   *\n   * @defaultValue undefined // GestureWatcher default\n   */\n  maxDeltaX?: number;\n\n  /**\n   * Corresponds to\n   * {@link Watchers/GestureWatcher.OnGestureOptions.minTotalDeltaY | OnGestureOptions.minTotalDeltaY}.\n   *\n   * @defaultValue undefined // GestureWatcher default\n   */\n  minDeltaY?: number;\n\n  /**\n   * Corresponds to\n   * {@link Watchers/GestureWatcher.OnGestureOptions.maxTotalDeltaY | OnGestureOptions.maxTotalDeltaY}.\n   *\n   * @defaultValue undefined // GestureWatcher default\n   */\n  maxDeltaY?: number;\n\n  /**\n   * Corresponds to\n   * {@link Watchers/GestureWatcher.OnGestureOptions.minTotalDeltaZ | OnGestureOptions.minTotalDeltaZ}.\n   *\n   * @defaultValue undefined // GestureWatcher default\n   */\n  minDeltaZ?: number;\n\n  /**\n   * Corresponds to\n   * {@link Watchers/GestureWatcher.OnGestureOptions.maxTotalDeltaZ | OnGestureOptions.maxTotalDeltaZ}.\n   *\n   * @defaultValue undefined // GestureWatcher default\n   */\n  maxDeltaZ?: number;\n};\n\n// --------------------\n\nconst WIDGET_NAME = \"track-gesture\";\n// Only one TrackGesture widget per element is allowed, but Widget requires a\n// non-blank ID.\nconst DUMMY_ID = WIDGET_NAME;\n\nconst configValidator: WidgetConfigValidatorObject<TrackGestureConfig> = {\n  preventDefault: validateBoolean,\n  minDeltaX: validateNumber,\n  maxDeltaX: validateNumber,\n  minDeltaY: validateNumber,\n  maxDeltaY: validateNumber,\n  minDeltaZ: validateNumber,\n  maxDeltaZ: validateNumber,\n};\n","/**\n * @module Widgets\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { validateNumber } from \"@lisn/utils/validation\";\n\nimport { ScrollWatcher } from \"@lisn/watchers/scroll-watcher\";\n\nimport {\n  Widget,\n  WidgetConfigValidatorObject,\n  registerWidget,\n} from \"@lisn/widgets/widget\";\n\n/**\n * This is a simple wrapper around the {@link ScrollWatcher}. If you are using\n * the JavaScript API, you should use the {@link ScrollWatcher} directly. The\n * purpose of this widget is to expose the watcher's ability to track scroll\n * and set relevant CSS properties via the HTML API. See\n * {@link ScrollWatcher.trackScroll}.\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-track-scroll` class or `data-lisn-track-scroll` attribute set on\n *   the element that constitutes the widget.\n *\n * @example\n * This will track scroll on this element and set the relevant CSS properties.\n *\n * ```html\n * <div class=\"lisn-track-scroll\"></div>\n * ```\n *\n * @example\n * As above but with custom options\n *\n * ```html\n * <div data-lisn-track-scroll=\"threshold=0 | debounce-window=0\"></div>\n * ```\n */\nexport class TrackScroll extends Widget {\n  static get(element: Element): TrackScroll | null {\n    const instance = super.get(element, DUMMY_ID);\n    if (MH.isInstanceOf(instance, TrackScroll)) {\n      return instance;\n    }\n    return null;\n  }\n\n  static register() {\n    registerWidget(\n      WIDGET_NAME,\n      (element, config) => {\n        if (!TrackScroll.get(element)) {\n          return new TrackScroll(element, config);\n        }\n        return null;\n      },\n      configValidator,\n    );\n  }\n\n  constructor(element: Element, config?: TrackScrollConfig) {\n    super(element, { id: DUMMY_ID });\n\n    ScrollWatcher.reuse().trackScroll(\n      null,\n      MH.assign(\n        {\n          scrollable: element,\n        },\n        config,\n      ),\n    );\n\n    this.onDestroy(() => ScrollWatcher.reuse().noTrackScroll(null, element));\n  }\n}\n\n/**\n * @interface\n */\nexport type TrackScrollConfig = {\n  /**\n   * Corresponds to\n   * {@link Watchers/ScrollWatcher.OnScrollOptions.threshold | OnScrollOptions.threshold}.\n   *\n   * @defaultValue undefined // ScrollWatcher default\n   */\n  threshold?: number;\n\n  /**\n   * Corresponds to\n   * {@link Watchers/ScrollWatcher.OnScrollOptions.debounceWindow | OnScrollOptions.debounceWindow}.\n   *\n   * @defaultValue undefined // ScrollWatcher default\n   */\n  debounceWindow?: number;\n};\n\n// --------------------\n\nconst WIDGET_NAME = \"track-scroll\";\n// Only one TrackScroll widget per element is allowed, but Widget requires a\n// non-blank ID.\nconst DUMMY_ID = WIDGET_NAME;\n\nconst configValidator: WidgetConfigValidatorObject<TrackScrollConfig> = {\n  threshold: validateNumber,\n  debounceWindow: validateNumber,\n};\n","/**\n * @module Widgets\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { validateNumber } from \"@lisn/utils/validation\";\n\nimport { SizeWatcher } from \"@lisn/watchers/size-watcher\";\n\nimport {\n  Widget,\n  WidgetConfigValidatorObject,\n  registerWidget,\n} from \"@lisn/widgets/widget\";\n\n/**\n * This is a simple wrapper around the {@link SizeWatcher}. If you are using\n * the JavaScript API, you should use the {@link SizeWatcher} directly. The\n * purpose of this widget is to expose the watcher's ability to track size\n * and set relevant CSS properties via the HTML API. See\n * {@link SizeWatcher.trackSize}.\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-track-size` class or `data-lisn-track-size` attribute set on\n *   the element that constitutes the widget.\n *\n * This widget does not support configuration and uses the default\n * {@link SizeWatcher} configuration except for resize threshold equal to 0.\n *\n * @example\n * This will track the size of this element and set the relevant CSS\n * properties. It will use the default {@link SizeWatcher} options and resize\n * threshold of 0.\n *\n * ```html\n * <div class=\"lisn-track-size\"></div>\n * ```\n *\n * @example\n * As above but with custom options\n *\n * ```html\n * <div data-lisn-track-size=\"threshold=0 | debounce-window=0\"></div>\n * ```\n */\nexport class TrackSize extends Widget {\n  static get(element: Element): TrackSize | null {\n    const instance = super.get(element, DUMMY_ID);\n    if (MH.isInstanceOf(instance, TrackSize)) {\n      return instance;\n    }\n    return null;\n  }\n\n  static register() {\n    registerWidget(\n      WIDGET_NAME,\n      (element, config) => {\n        if (!TrackSize.get(element)) {\n          return new TrackSize(element, config);\n        }\n        return null;\n      },\n      configValidator,\n    );\n  }\n\n  constructor(element: Element, config?: TrackSizeConfig) {\n    super(element, { id: DUMMY_ID });\n\n    SizeWatcher.reuse().trackSize(\n      null,\n      MH.assign(\n        {\n          target: element,\n        },\n        config,\n      ),\n    );\n\n    this.onDestroy(() => SizeWatcher.reuse().noTrackSize(null, element));\n  }\n}\n\n/**\n * @interface\n *\n * @since v1.2.0\n */\nexport type TrackSizeConfig = {\n  /**\n   * Corresponds to\n   * {@link Watchers/SizeWatcher.OnResizeOptions.threshold | OnResizeOptions.threshold}.\n   *\n   * @defaultValue undefined // SizeWatcher default\n   */\n  threshold?: number;\n\n  /**\n   * Corresponds to\n   * {@link Watchers/SizeWatcher.OnResizeOptions.debounceWindow | OnResizeOptions.debounceWindow}.\n   *\n   * @defaultValue undefined // SizeWatcher default\n   */\n  debounceWindow?: number;\n};\n\n// --------------------\n\nconst WIDGET_NAME = \"track-size\";\n// Only one TrackSize widget per element is allowed, but Widget requires a\n// non-blank ID.\nconst DUMMY_ID = WIDGET_NAME;\n\nconst configValidator: WidgetConfigValidatorObject<TrackSizeConfig> = {\n  threshold: validateNumber,\n  debounceWindow: validateNumber,\n};\n","/**\n * @module Widgets\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { waitForReferenceElement } from \"@lisn/utils/dom-search\";\nimport {\n  validateNumber,\n  validateString,\n  validateNumList,\n} from \"@lisn/utils/validation\";\n\nimport { ViewWatcher } from \"@lisn/watchers/view-watcher\";\n\nimport {\n  Widget,\n  WidgetConfigValidatorFunc,\n  registerWidget,\n} from \"@lisn/widgets/widget\";\n\n/**\n * This is a simple wrapper around the {@link ViewWatcher}. If you are using\n * the JavaScript API, you should use the {@link ViewWatcher} directly. The\n * purpose of this widget is to expose the watcher's ability to track an\n * element's position across the viewport (or a given root element) and set\n * relevant CSS properties via the HTML API. See {@link ViewWatcher.trackView}.\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-track-view` class or `data-lisn-track-view` attribute set on\n *   the element that constitutes the widget.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * Note that the root margin value can either be comma-separated or\n * space-separated.\n *\n * @example\n * This will track the element across the viewport and set the relevant CSS\n * properties.\n *\n * ```html\n * <div class=\"lisn-track-view\"></div>\n * ```\n *\n * @example\n * As above but with custom settings.\n *\n * ```html\n * <div id=\"myRoot\"></div>\n * <div data-lisn-track-view=\"root=#myRoot\n *                            | root-margin=100px,50px\n *                            | threshold=0,0.5\n *                            | debounce-window=0\n *                            | resize-threshold=0\n *                            | scroll-threshold=0\"\n * ></div>\n * ```\n */\nexport class TrackView extends Widget {\n  static get(element: Element): TrackView | null {\n    const instance = super.get(element, DUMMY_ID);\n    if (MH.isInstanceOf(instance, TrackView)) {\n      return instance;\n    }\n    return null;\n  }\n\n  static register() {\n    registerWidget(\n      WIDGET_NAME,\n      (element, config) => {\n        if (!TrackView.get(element)) {\n          return new TrackView(element, config);\n        }\n        return null;\n      },\n      newConfigValidator,\n    );\n  }\n\n  constructor(element: Element, config?: TrackViewConfig) {\n    super(element, { id: DUMMY_ID });\n\n    const watcher = ViewWatcher.reuse({\n      root: config?.root,\n      rootMargin: config?.rootMargin?.replace(/,/g, \" \"),\n      threshold: config?.threshold,\n    });\n\n    watcher.trackView(element, null, config);\n\n    this.onDestroy(() => watcher.noTrackView(element));\n  }\n}\n\n/**\n * @interface\n */\nexport type TrackViewConfig = {\n  /**\n   * Corresponds to\n   * {@link Watchers/ViewWatcher.ViewWatcherConfig.root | ViewWatcherConfig.root}.\n   *\n   * @defaultValue undefined // ViewWatcher default\n   */\n  root?: Element | null;\n\n  /**\n   * Corresponds to\n   * {@link Watchers/ViewWatcher.ViewWatcherConfig.rootMargin | ViewWatcherConfig.rootMargin}.\n   *\n   * @defaultValue undefined // ViewWatcher default\n   */\n  rootMargin?: string;\n\n  /**\n   * Corresponds to\n   * {@link Watchers/ViewWatcher.ViewWatcherConfig.threshold | ViewWatcherConfig.threshold}.\n   *\n   * @defaultValue undefined // ViewWatcher default\n   */\n  threshold?: number | number[];\n\n  /**\n   * Corresponds to\n   * {@link Watchers/ViewWatcher.TrackViewOptions.debounceWindow | TrackViewOptions.debounceWindow}.\n   *\n   * @defaultValue undefined // ViewWatcher default\n   */\n  debounceWindow?: number;\n\n  /**\n   * Corresponds to\n   * {@link Watchers/ViewWatcher.TrackViewOptions.resizeThreshold | TrackViewOptions.resizeThreshold}.\n   *\n   * @defaultValue undefined // ViewWatcher default\n   */\n  resizeThreshold?: number;\n\n  /**\n   * Corresponds to\n   * {@link Watchers/ViewWatcher.TrackViewOptions.scrollThreshold | TrackViewOptions.scrollThreshold}.\n   *\n   * @defaultValue undefined // ViewWatcher default\n   */\n  scrollThreshold?: number;\n};\n\n// --------------------\n\nconst WIDGET_NAME = \"track-view\";\n// Only one TrackView widget per element is allowed, but Widget requires a\n// non-blank ID.\nconst DUMMY_ID = WIDGET_NAME;\n\nconst newConfigValidator: WidgetConfigValidatorFunc<TrackViewConfig> = (\n  element: Element,\n) => {\n  return {\n    root: (key, value) =>\n      (MH.isLiteralString(value)\n        ? waitForReferenceElement(value, element)\n        : null) ?? undefined,\n    rootMargin: validateString,\n    threshold: (key, value) => validateNumList(key, value),\n    debounceWindow: validateNumber,\n    resizeThreshold: validateNumber,\n    scrollThreshold: validateNumber,\n  };\n};\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nexport * from \"@lisn/widgets/auto-hide\";\nexport * from \"@lisn/widgets/openable\";\nexport * from \"@lisn/widgets/page-loader\";\nexport * from \"@lisn/widgets/pager\";\nexport * from \"@lisn/widgets/same-height\";\nexport * from \"@lisn/widgets/scrollbar\";\nexport * from \"@lisn/widgets/scroll-to-top\";\n// export * from \"@lisn/widgets/smooth-scroll\";\nexport * from \"@lisn/widgets/sortable\";\nexport * from \"@lisn/widgets/track-gesture\";\nexport * from \"@lisn/widgets/track-scroll\";\nexport * from \"@lisn/widgets/track-size\";\nexport * from \"@lisn/widgets/track-view\";\n\nexport * from \"@lisn/widgets/widget\";\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nimport \"@lisn/bundle-slim\"; // side effects\n\nimport * as actions from \"@lisn/actions/index\";\nimport * as triggers from \"@lisn/triggers/index\";\nimport * as widgets from \"@lisn/widgets/index\";\n\nexport * from \"@lisn/bundle-essentials\";\nexport * as actions from \"@lisn/actions/index\";\nexport * as triggers from \"@lisn/triggers/index\";\nexport * as widgets from \"@lisn/widgets/index\";\n\nactions.AddClass.register();\nactions.RemoveClass.register();\nactions.AnimatePlay.register();\nactions.AnimatePause.register();\nactions.Animate.register();\nactions.Display.register();\nactions.Undisplay.register();\nactions.Open.register();\nactions.NextPage.register();\nactions.PrevPage.register();\nactions.GoToPage.register();\nactions.EnablePage.register();\nactions.DisablePage.register();\nactions.ScrollTo.register();\nactions.SetAttribute.register();\nactions.Show.register();\nactions.Hide.register();\nactions.Enable.register();\nactions.Disable.register();\nactions.Run.register();\n\ntriggers.LayoutTrigger.register();\ntriggers.LoadTrigger.register();\ntriggers.CheckTrigger.register();\ntriggers.ClickTrigger.register();\ntriggers.PressTrigger.register();\ntriggers.HoverTrigger.register();\ntriggers.ScrollTrigger.register();\ntriggers.Trigger.register();\ntriggers.ViewTrigger.register();\n\nwidgets.AutoHide.register();\nwidgets.Collapsible.register();\nwidgets.Popup.register();\nwidgets.Modal.register();\nwidgets.Offcanvas.register();\nwidgets.PageLoader.register();\nwidgets.Pager.register();\nwidgets.SameHeight.register();\nwidgets.Scrollbar.register();\nwidgets.ScrollToTop.register();\n// widgets.SmoothScroll.register();\nwidgets.Sortable.register();\nwidgets.TrackGesture.register();\nwidgets.TrackScroll.register();\nwidgets.TrackSize.register();\nwidgets.TrackView.register();\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nexport * from \"@lisn/debug/logger\";\nexport * from \"@lisn/debug/console\";\nexport * from \"@lisn/debug/remote-console\";\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nexport * from \"@lisn/utils/animations\";\nexport * from \"@lisn/utils/css-alter\";\nexport * from \"@lisn/utils/directions\";\nexport * from \"@lisn/utils/dom\";\nexport * from \"@lisn/utils/dom-alter\";\nexport * from \"@lisn/utils/dom-events\";\nexport * from \"@lisn/utils/dom-optimize\";\nexport * from \"@lisn/utils/dom-query\";\nexport * from \"@lisn/utils/dom-search\";\nexport * from \"@lisn/utils/event\";\nexport * from \"@lisn/utils/gesture-key\";\nexport * from \"@lisn/utils/gesture-pointer\";\nexport * from \"@lisn/utils/gesture-touch\";\nexport * from \"@lisn/utils/gesture-wheel\";\nexport * from \"@lisn/utils/gesture\";\nexport * from \"@lisn/utils/layout\";\nexport * from \"@lisn/utils/log\";\nexport * from \"@lisn/utils/math\";\nexport * from \"@lisn/utils/misc\";\nexport * from \"@lisn/utils/overlays\";\nexport * from \"@lisn/utils/position\";\nexport * from \"@lisn/utils/pointer\";\nexport * from \"@lisn/utils/scroll\";\nexport * from \"@lisn/utils/size\";\nexport * from \"@lisn/utils/tasks\";\nexport * from \"@lisn/utils/text\";\nexport * from \"@lisn/utils/validation\";\nexport * from \"@lisn/utils/views\";\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nexport * from \"@lisn/modules/bit-spaces\";\nexport * from \"@lisn/modules/callback\";\nexport * from \"@lisn/modules/x-intersection-observer\";\nexport * from \"@lisn/modules/x-map\";\nexport * from \"@lisn/modules/x-resize-observer\";\n","/**\n * @module\n * @ignore\n * @internal\n */\n\nimport \"@lisn/bundle\"; // side effects\n\nimport { settings } from \"@lisn/globals/settings\";\nsettings.verbosityLevel = 10;\n\nexport * from \"@lisn/bundle\";\nexport * as debug from \"@lisn/debug/index\";\nexport * as utils from \"@lisn/utils/index\";\nexport * as modules from \"@lisn/modules/index\";\n"],"names":["PREFIX","LOG_PREFIX","OBJECT","Object","SYMBOL","Symbol","ARRAY","Array","STRING","String","FUNCTION","Function","MATH","Math","NUMBER","Number","PROMISE","Promise","PI","INFINITY","Infinity","S_ABSOLUTE","S_FIXED","S_STICKY","S_WIDTH","S_HEIGHT","S_TOP","S_BOTTOM","S_UP","S_DOWN","S_LEFT","S_RIGHT","S_AT","S_ABOVE","S_BELOW","S_IN","S_OUT","S_NONE","S_AMBIGUOUS","S_ADDED","S_REMOVED","S_ATTRIBUTE","S_KEY","S_MOUSE","S_POINTER","S_TOUCH","S_WHEEL","S_CLICK","S_HOVER","S_PRESS","S_SCROLL","S_ZOOM","S_DRAG","S_UNKNOWN","S_SCROLL_TOP","S_SCROLL_LEFT","S_SCROLL_WIDTH","S_SCROLL_HEIGHT","S_CLIENT_WIDTH","S_CLIENT_HEIGHT","S_SCROLL_TOP_FRACTION","S_SCROLL_LEFT_FRACTION","S_HORIZONTAL","S_VERTICAL","S_SKIP_INITIAL","S_DEBOUNCE_WINDOW","S_TOGGLE","S_CANCEL","S_KEYDOWN","S_MOUSEUP","S_MOUSEDOWN","S_POINTERUP","S_POINTERDOWN","S_POINTERENTER","S_POINTERLEAVE","S_POINTERMOVE","S_POINTERCANCEL","S_TOUCHSTART","S_TOUCHEND","S_TOUCHMOVE","S_TOUCHCANCEL","S_DRAGSTART","S_DRAGEND","S_DRAGENTER","S_DRAGOVER","S_DROP","S_SELECTSTART","S_ATTRIBUTES","S_CHILD_LIST","S_REVERSE","S_DRAGGABLE","S_DISABLED","S_ARROW","S_ROLE","ARIA_PREFIX","S_ARIA_CONTROLS","PREFIX_WRAPPER","PREFIX_INLINE_WRAPPER","PREFIX_TRANSITION","PREFIX_TRANSITION_DISABLE","PREFIX_HIDE","PREFIX_SHOW","PREFIX_DISPLAY","PREFIX_UNDISPLAY","PREFIX_PLACE","PREFIX_ORIENTATION","PREFIX_POSITION","PREFIX_GHOST","PREFIX_NO_SELECT","PREFIX_NO_TOUCH_ACTION","PREFIX_NO_WRAP","S_ANIMATE","ANIMATE_PREFIX","PREFIX_ANIMATE_DISABLE","PREFIX_ANIMATE_PAUSE","PREFIX_ANIMATE_REVERSE","LisnError","Error","LisnUsageError","constructor","message","name","LisnBugError","root","self","global","userAgent","navigator","kebabToCamelCase","str","replace","m","toUpperCase","charAt","camelToKebabCase","toLowerCase","prefixName","MC","prefixCssVar","prefixCssJsVar","prefixData","s","timeNow","Date","now","bind","timeSince","startTime","hasDOM","document","getWindow","window","getDoc","getDocElement","documentElement","getDocScrollingElement","scrollingElement","getBody","body","getReadyState","readyState","getPointerType","event","isPointerEvent","pointerType","isMouseEvent","onAnimationFrame","callback","requestAnimationFrame","createElement","tagName","options","createButton","label","tag","btn","setTabIndex","setAttr","isNullish","v","undefined","isEmpty","isIterableObject","isNonPrimitive","iterator","isArray","isInstanceOf","isObject","typeOf","isNumber","isString","isLiteralString","isBoolean","isFunction","isDoc","target","MouseEvent","PointerEvent","isTouchPointerEvent","isWheelEvent","WheelEvent","isKeyboardEvent","KeyboardEvent","isTouchEvent","TouchEvent","isElement","Element","isHTMLElement","HTMLElement","isNodeBAfterA","nodeA","nodeB","compareDocumentPosition","Node","DOCUMENT_POSITION_FOLLOWING","strReplace","match","replacement","setTimer","setTimeout","clearTimer","clearTimeout","getBoundingClientRect","element","copyBoundingRectProps","rect","x","left","right","y","top","bottom","querySelector","selector","querySelectorAll","docQuerySelector","docQuerySelectorAll","getElementById","id","getAttr","getAttribute","value","setAttribute","unsetAttr","delAttr","removeAttribute","includes","arr","startAt","indexOf","some","array","predicate","filter","filterFn","filterBlank","result","lengthOf","sizeOf","obj","_obj$size","size","_obj$length","length","lastOf","a","slice","firstOf","hasTagName","preventDefault","arrayFrom","from","keysOf","keys","defineProperty","merge","assign","copyObject","promiseResolve","resolve","promiseAll","all","freeze","hasOwnProp","o","prop","prototype","hasOwnProperty","call","preventExtensions","stringify","JSON","floor","ceil","log2","sqrt","max","min","abs","round","pow","exp","parseFloat","isNaN","Class","constructorOf","typeOrClassOf","_constructorOf","parentOf","_element$parentElemen","parentElement","childrenOf","children","targetOf","currentTargetOf","currentTarget","classList","S_TABINDEX","getTabIndex","index","unsetTabIndex","remove","deleteObjKey","key","deleteKey","map","delete","elScrollTo","coords","behavior","scrollTo","newPromise","executor","newMap","entries","Map","newWeakMap","WeakMap","newSet","values","Set","newWeakSet","WeakSet","newIntersectionObserver","IntersectionObserver","newResizeObserver","ResizeObserver","newMutationObserver","MutationObserver","usageError","msg","bugError","illegalConstructorError","useWhat","CONSOLE","console","consoleDebug","debug","consoleLog","log","consoleInfo","info","consoleWarn","warn","consoleError","error","settings","MH","mainScrollableElementSelector","contentWrappingAllowed","pageLoadTimeout","autoWidgets","scrollbarHideNative","scrollbarOnMobile","scrollbarPositionH","scrollbarPositionV","scrollbarAutoHide","scrollbarClickScroll","scrollbarDragScroll","scrollbarUseHandle","sameHeightDiffTolerance","sameHeightResizeThreshold","sameHeightDebounceWindow","sameHeightMinGap","sameHeightMaxFreeR","sameHeightMaxWidthR","deviceBreakpoints","mobile","tablet","desktop","aspectRatioBreakpoints","tall","square","wide","lightThemeClassName","darkThemeClassName","deltaLineHeight","deltaPageWidth","deltaPageHeight","verbosityLevel","remoteLoggerURL","remoteLoggerOnMobileOnly","roundNumTo","numDecimal","multiplicationFactor","isValidNum","isFinite","toNum","defaultValue","numValue","toInt","toNonNegNum","toPosNum","toNumWithBounds","limits","_limits$min","_limits$max","isDefaultGiven","_ref","maxAbs","minAbs","havingMaxAbs","sort","b","havingMinAbs","hAngle","normalizeAngle","atan2","degToRad","radToDeg","areParallel","vA","vB","angleDiffThreshold","angleA","angleB","areAntiParallel","distanceBetween","ptA","ptB","quadraticRoots","c","z","easeInOutQuad","criticallyDamped","lTarget","precision","lag","N","w0","l","dt","A","B","e","sortedKeysByVal","descending","keyWithMaxVal","keyWithMinVal","getBitmask","start","end","copyExistingKeys","fromObj","toObj","omitKeys","keysToRm","res","compareValuesIn","objA","objB","roundTo","valA","valB","keyExists","toArrayIfSingle","toBoolean","toBool","formatAsString","maxLen","maybeConvertToString","joinAsString","separator","args","join","splitOn","input","trim","limit","output","addEntry","push","matchIndex","matchLength","_match$index","exec","randId","nChars","segment","random","toString","toMargins","absoluteSize","_parts$","_parts$2","_parts$3","toPxValue","strValue","margin","parts","margins","objToStrKey","flattenForSorting","k","stringifyReplacer","nested","classStr","stack","isValidStrList","checkFn","allowEmpty","validateStrList","err","_toArray","toArray","_validateString","validateNumList","_toArray2","_validateNumber","validateNumber","validateBoolean","_validateBoolean","validateString","validateStringRequired","validateBooleanOrString","stringCheckFn","_validateBooleanOrString","typeDescription","numVal","boolVal","BitSpaces","counter","newCounter","create","propNames","newBitSpace","get","_nBits","_bitmask","newBitSpaces","createBitSpace","spaces","bitmask","space","bit","has","p","bitmaskFor","pStart","pEnd","thisStart","thisEnd","nameOf","val","_propNames","enumerable","isValidMutationCategory","category","DOM_CATEGORIES_SPACE","isValidMutationCategoryList","categories","scheduleHighPriorityTask","task","scheduler","postTask","priority","channel","MessageChannel","port1","onmessage","close","port2","postMessage","getDebouncedHandler","debounceWindow","handler","timer","lastArgs","waitForDelay","delay","LocalConsole","isiOS","iOSlog","isJest","jestLog","newXMap","getDefaultV","XMap","newXMapGetter","newXWeakMap","XWeakMap","newXWeakMapGetter","XMapBase","set","sGet","prune","sk","rest","clear","_defineProperty","RemoteConsole","url","connectTimeout","DEFAULT_TIMEOUT","hasFailed","isClosed","tmpQueue","sendLog","level","destroy","cleanup","_instances$get","level__ignored","args__ignored","instance","instances","socket","moduleName","e__ignored","ioClient","io","disconnectTimer","on","emit","disconnect","entry","shift","reuse","_instances$get2","rConsole","Console","remoteUrl","remoteConsole","localConsole","Logger","config","_myConfig$name","_myConfig$verbosityLe","myConfig","debugID","getBooleanURLParam","isMobile","_myConfig$remoteLogge","myConsole","remoteLoggerConnectTimeout","logPrefix","debugPrefix","getName","getVerbosityLevel","setVerbosityLevel","debug1","logDebugN","debug2","debug3","debug4","debug5","debug6","debug7","debug8","debug9","debug10","logAtCreation","logger","unshift","regex","test","getURLParameter","loc","location","URLSearchParams","urlParams","search","RegExp","href","decodeURIComponent","wrapCallback","handlerOrCallback","isRemoved","callablesMap","invoke","wrapper","Callback","onRemove","rmFn","CallbackScheduler","_clear","fn","add","reject","_push","REMOVE","queues","flush","queue","_running","_task","item","_onRemove","logInfo","isMessageSeen","logWarn","logError","discardMessages","isSeen","waitForMutateTime","scheduleDOMTask","scheduledDOMMutations","waitForMeasureTime","scheduledDOMMeasurements","waitForSubsequentMutateTime","then","waitForSubsequentMeasureTime","asyncMutatorFor","func","asyncMeasurerFor","hasScheduledDOMTasks","runAllDOMTasks","runDOMTaskQueue","getVisibleContentChildren","ch","isVisibleContentTag","isInlineTag","inlineTags","isDOMElement","SVGElement","MathMLElement","transitionElementNow","fromCls","toCls","cancelCSSTransitions","didChange","hasClass","removeClassesNow","addClassesNow","transitionElement","thisTransition","scheduleCSSTransition","_isCancelled","_finish","transitionDuration","getMaxTransitionDuration","displayElementNow","displayElement","undisplayElementNow","undisplayElement","showElementNow","showElement","hideElementNow","hideElement","toggleDisplayElementNow","isElementUndisplayed","toggleDisplayElement","toggleShowElementNow","isElementHidden","toggleShowElement","className","contains","hasAllClasses","classNames","hasAnyClass","addClasses","removeClasses","toggleClassNow","force","toggle","toggleClass","toggleClassesNow","cls","toggleClasses","replaceClassNow","oldClassName","newClassName","replaceClass","getData","getBooleanData","getBoolData","setDataNow","setData","setBooleanDataNow","setBoolDataNow","setBooleanData","setBoolData","unsetBooleanDataNow","unsetBoolDataNow","unsetBooleanData","unsetBoolData","delDataNow","delData","getComputedStylePropNow","getComputedStyle","getPropertyValue","getComputedStyleProp","getStylePropNow","_style","style","getStyleProp","setStylePropNow","_style2","setProperty","setStyleProp","delStylePropNow","_style3","removeProperty","delStyleProp","getFlexDirection","displayStyle","getParentFlexDirection","parent","isFlex","direction","flexDirection","isFlexChild","propVal","duration","disableInitialTransition","setHasModal","PREFIX_HAS_MODAL","delHasModal","copyStyle","fromElement","toElement","includeComputedProps","props","setNumericStyleJsVarsNow","_options$_prefix","varPrefix","_prefix","cssPropSuffix","varName","_options$_numDecimal","thisNumDecimal","_numDecimal","_options$_units","_units","setNumericStyleJsVars","scheduledCSSTransitions","toClasses","scheduledTransitions","scheduledTransition","_cancel","isCancelled","wrapElementNow","createWrapperFor","ignoreMove","to","replaceWith","append","wrapElement","wrapChildrenNow","moveChildrenNow","moveElementNow","wrapChildren","replaceElementNow","newElement","replaceElement","swapElementsNow","elementA","elementB","temp","swapElements","oldParent","newParent","child","moveChildren","_options$to","parentEl","position","moveElement","hideAndRemoveElement","getOrAssignID","prefix","domID","isAllowedToWrap","getWrapper","_tagName","_classNames","getContentWrapper","firstChild","tryWrapNow","_tryWrapNow","tryWrap","tryWrapContentNow","tryWrapContent","unwrapContentNow","unwrapContent","cloneElement","clone","cloneNode","insertGhostCloneNow","insertBefore","_required","_wrapper","_clone","insertGhostClone","_options$from","_options$to2","recordsToSkipOnce","getIgnoreMove","_recordsToSkipOnce$ge","clearIgnoreMove","insertArrow","arrow","wrapContent","_ignoreMove","required","_requiredBy","requiredBy","getWrapperFn","wrapFn","allowedToWrap","waitForElement","timeout","callFn","observer","observe","childList","subtree","waitForElementOrInteractive","isInteractive","waitForInteractive","INTERACTIVE","COMPLETE","addEventListener","waitForComplete","waitForPageReady","pageIsReady","dispatchReady","isPageReady","DOMWatcher","getConfig","CONSTRUCTOR_KEY","configStrKey","_root","buffer","t","_target","_categoryBitmask","_attributes","_addedTo","_removedFrom","allCallbacks","mutationHandler","records","record","recType","type","addedNodes","operation","ADDED_BIT","removedNodes","REMOVED_BIT","attributeName","ATTRIBUTE_BIT","shouldSkipOperation","processOperation","observers","_observer","_isActive","createCallback","_allCallbacks$get","_callback","deleteHandler","_options","setupOnMutation","userOptions","_config$_root","getOptions","activateObserver","skipInitial","_selector","childQueue","takeRecords","matches","initOperation","bufferedOperation","diffOperation","getDiffOperation","invokeCallback","activeCategories","deactivateObserver","categoryBitmask","currentTargets","mutationType","_subtree","_config$_root2","requestToSkip","removedFrom","addedTo","requestFrom","requestTo","onMutation","offMutation","_allCallbacks$get2","_config$root","_config$subtree","CATEGORIES_BITS","_options$selector","_options$target","cat","operationA","operationB","attributes","attr","catch","getMaxDeltaDirection","deltaX","deltaY","getVectorDirection","vector","getOppositeDirection","OPPOSITE_DIRECTIONS","getOppositeXYDirections","directions","directionList","isValidXYDirection","opposites","opposite","XY_DIRECTIONS","isValidZDirection","Z_DIRECTIONS","isValidDirection","DIRECTIONS","isValidDirectionList","SCROLL_DIRECTIONS","callEventListener","_event$currentTarget","_event$currentTarget2","handleEvent","addEventListenerTo","eventType","transformEventType","getEventHandlerData","thirdArg","wrappedHandler","supports","getBrowserSupport","_optionsArg","_options$capture","capture","once","removeEventListenerFrom","setEventHandlerData","_wrappedHandler","_thirdArg","data","removeEventListener","deleteEventHandlerData","preventSelect","undoPreventSelect","browserEventSupport","_pointer","passive","signal","optTest","opt","thisOpt","AbortController","dummyHandler","dummyElement","registeredEventHandlerData","getEventOptionsStr","finalOptions","_registeredEventHandl","optionsStr","_registeredEventHandl2","startsWith","isValidInputDevice","device","DEVICES","isValidIntent","intent","INTENTS","isValidInputDeviceList","devices","isValidIntentList","intents","addDeltaZ","current","increment","MIN_DELTA_Z","getKeyGestureFragment","events","_options$scrollHeight","LINE","PAGE","CONTENT","scrollHeight","deltasUp","amount","deltasDown","deltasLeft","deltasRight","deltasIn","deltasOut","deltaZ","_deltasForKey$event$k","deltasForKey","SK_UP","SK_ARROWUP","SK_PAGEUP","Home","SK_DOWN","SK_ARROWDOWN","SK_PAGEDOWN","End","SK_LEFT","SK_ARROWLEFT","SK_RIGHT","SK_ARROWRIGHT","shiftKey","ctrlKey","theseDeltas","thisDeltaX","thisDeltaY","thisDeltaZ","thisIntent","SK_PAGE","SK_ARROW","getPointerGestureFragment","pointerEventClass","pointerUpType","filteredEvents","eType","buttons","numEvents","firstEvent","lastEvent","clientX","clientY","getTouchGestureFragment","_options$dragHoldTime","_options$dragNumFinge","moves","getTouchDiff","deltaThreshold","numMoves","holdTime","getHoldTime","canBeDrag","dragHoldTime","dragNumFingers","d","isSignificant","vectorA","vectorB","startDistance","startX","startY","endDistance","endX","endY","deltaSign","reverseScroll","isFirst","thisDirection","lastTouchEvent","touches","groupedTouches","touch","identifier","touchList","nTouches","firstTouch","lastTouch","firstStart","findIndex","firstMove","timeStamp","normalizeWheel","spinX","spinY","pixelX","pixelY","detail","wheelDelta","wheelDeltaY","wheelDeltaX","deltaMode","getWheelGestureFragment","maxDelta","percentage","GestureWatcher","allListeners","getCallbackAndWrapper","setupOnGesture","_options$_devices","_devices","_allListeners$get","listeners","setupListeners","_nCallbacks","_preventDefault","_nPreventDefault","_options$_devices2","_allListeners$get2","_remove","invokeCallbacks","_allListeners$get$get","_allListeners$get3","isTerminated","_intents","hasAddedTabIndex","hasPreventedSelect","addOrRemoveListeners","action","listener","eventTypes","method","addInitialListener","initialListener","initiatingEvents","removeInitialListener","addOngoingListener","processEvent","ongoingEvents","removeOngoingListener","trackGesture","setGestureCssProps","totalDeltaX","totalDeltaY","totalDeltaZ","noTrackGesture","offGesture","onGesture","_allCallbacks$get3","_config$preventDefaul","_config$naturalTouchS","_config$touchDragHold","_config$touchDragNumF","_debounceWindow","_deltaThreshold","_angleDiffThreshold","_naturalTouchScroll","naturalTouchScroll","_touchDragHoldTime","touchDragHoldTime","_touchDragNumFingers","touchDragNumFingers","pointer","wheel","fragmentGetters","_validateStrList","_validateStrList2","_validateStrList3","_options$minTotalDelt","_options$maxTotalDelt","_options$minTotalDelt2","_options$maxTotalDelt2","_options$minTotalDelt3","_options$maxTotalDelt3","_options$preventDefau","_options$naturalTouch","_options$touchDragHol","_options$touchDragNum","_directions","_minTotalDeltaX","minTotalDeltaX","_maxTotalDeltaX","maxTotalDeltaX","_minTotalDeltaY","minTotalDeltaY","_maxTotalDeltaY","maxTotalDeltaY","_minTotalDeltaZ","minTotalDeltaZ","_maxTotalDeltaZ","maxTotalDeltaZ","preventNextClick","eventQueue","debouncedWrapper","fragment","eventQueueCopy","_eventQueueCopy","_eventQueueCopy$","clearEventQueue","newTotalDeltaX","newTotalDeltaY","newTotalDeltaZ","time","preventDefaultActionFor","keepLastEvent","splice","isActualGesture","isPointerDown","focus","preventScroll","isValidDevice","ORDERED_DEVICES","isValidAspectRatio","aspectRatio","ORDERED_ASPECTR","isValidDeviceList","isValidForType","S_DEVICES","isValidAspectRatioList","aspectR","S_ASPECTRS_CAMEL","getOtherDevices","getOtherLayouts","getOtherAspectRatios","getLayoutBitmask","layoutBitmask","getBitmaskFromSpec","aspectRatios","ORDERED_DEVICE_NAMES","ORDERED_ASPECTR_NAMES","bitSpaces","NUM_LAYOUTS","LAYOUT_RANGE_REGEX","getLayoutsFromBitmask","keyName","bitSpace","layouts","spec","oppositeBitmask","singleKeyName","rangeMatch","minLayout","maxLayout","lt","waitForAnimationFrame","onEveryAnimationFrame","elapsed","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_asyncIterator","newAnimationFrameIterator","_step","next","done","shouldRepeat","return","_x","_newAnimationFrameIterator","apply","arguments","_wrapAsyncGenerator","previousTimeStamp","total","totalSeed","sinceLast","sinceLastSeed","step","totalElapsed","elapsedSinceLast","newCriticallyDampedAnimationIterator","_x2","_newCriticallyDampedAnimationIterator","_iteratorAbruptCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_awaitAsyncGenerator","_next","iterateAnimations","webAnimationCallback","legacyCallback","realtime","animation","getAnimations","resetCssAnimationsNow","isScrollable","axis","active","noCache","_isScrollableCache$ge","cachedResult","isScrollableCache","offset","canScroll","dimension","hasOverflow","overflowProp","IS_SCROLLABLE_CACHE_TIMEOUT","getClosestScrollable","ancestor","getCurrentScrollAction","scrollable","toScrollableOrDefault","currentScrollInfos","_action","_scrollable","cancel","cancelFn","_weCanInterrupt","scrollEvents","preventScrollHandler","_userCanInterrupt","thisInfo","waitFor","scrollActionPromise","_currentScrollInfos$g","initiateScroll","updateCurrentScrollInfo","isValidScrollDirection","isValidScrollDirectionList","mapScrollable","original","actualScrollable","mappedScrollables","unmapScrollable","getClientWidthNow","isScrollableBodyInQuirks","offsetWidth","getBorderWidth","getClientHeightNow","offsetHeight","tryGetMainContentElement","mainContentElement","fetchMainContentElement","init","tryGetMainScrollableElement","mainScrollableElement","fetchMainScrollableElement","getDefaultScrollingElement","_MH$getDocScrollingEl","tryGetScrollableElement","toScrollableOrMain","fetchScrollableElement","DIFF_THRESHOLD","arePositionsDifferent","threshold","side","getMain","_mappedScrollables$ge","_options$offset","_options$altOffset","_options$duration","_options$weCanInterru","_options$userCanInter","getTargetCoordinates","altTarget","_offset","_altTarget","_altOffset","altOffset","_duration","weCanInterrupt","userCanInterrupt","newInfo","_newInfo$_action","existingScrollInfo","isDocScrollingElement","targetEl","getStartEndPosition","applyOffset","_offset$top","_offset$left","getEndPosition","_start","_end","startPosition","targetCoordinates","endPosition","scrollH","scrollW","clientH","clientW","_existingScrollInfo$_","_existingScrollInfo$_2","currentPosition","_position","currentVelocity","_velocity","_elapsed","deltaTime","isDone","initPromise","contentElement","getOverlay","_overlays$get$get","_overlays$get","tryGetOverlayOptions","overlays","_parent","_overlayKey","createOverlay","fetchOverlayOptions","canReuse","_id","_overlays$get2","existingOverlay","overlay","createOnlyOverlay","isPercentageHOffset","isPercentageVOffset","needsContentWrapping","_userOptions$data","_userOptions$id","getCssProperties","tryGetParent","_data","getOverlayKey","_userOptions$data2","_userOptions$id2","fetchParent","finalCssProperties","userSuppliedParent","getEntryContentBox","contentBoxSize","getSizeFromInlineBlock","contentRect","getEntryBorderBox","fallbackToContent","borderBoxSize","NaN","isValidBox","box","ALL_BOXES","isValidDimension","ALL_DIMENSIONS","tryGetViewportOverlay","viewportOverlay","fetchViewportOverlay","fetchViewportSize","_root$clientWidth","_root$clientHeight","clientWidth","clientHeight","S_INLINE_SIZE","S_BLOCK_SIZE","XResizeObserver","targetsToSkip","observedTargets","resizeHandler","skipNum","borderObserver","contentObserver","observeTarget","targets","observeLater","unobserve","SizeWatcher","allSizeData","processEntry","xObserver","fetchCurrentSize","fetchElement","sizeData","getSizeData","border","content","fetchOptions","_options$box","_options$dimension","_options$MC$S_DEBOUNC","_element","_box","_dimension","_threshold","_resizeThreshold","setupOnResize","removeOnResize","currEntry","setSizeCssProps","latestData","thresholdsExceeded","hasExceededThreshold","trackSize","noTrackSize","onResize","offResize","resizeThreshold","lastThresholdData","dim","diff","borderBox","contentBox","borderWidth","borderHeight","contentWidth","contentHeight","LayoutWatcher","nonIntersectingBitmask","currentLayoutData","fetchCurrentLayout","readyPromise","setupOverlays","createOverlays","_deviceBreakpoints","_aspectRatioBreakpoints","isReady","intersectionHandler","numEntries","getNonIntersecting","processLayoutChange","observeOptions","rootMargin","triggerOverlay","_layoutBitmask","setupOnLayout","layoutData","changeMatches","skipCallbacks","deviceBit","aspectRatioBit","onLayout","offLayout","VAR_BORDER_HEIGHT","PREFIX_DEVICE","PREFIX_ASPECTR","overlayPromises","overlayParent","parentHeightCss","getOverlayLayout","layout","thisLayoutData","prevLayoutData","isIntersecting","isValidPointerAction","POINTER_ACTIONS","isValidPointerActionList","actions","PointerWatcher","setupOnPointer","startHandler","endHandler","startCallback","endCallback","_actions","listenerSetupFn","onPointer","offPointer","_config$preventSelect","_preventSelect","_options$preventSelec","setupClickListener","toggleState","state","setupPointerListeners","startEventSuff","endEventSuff","startEvent","endEvent","startListener","endListener","click","hover","press","actionData","ScrollWatcher","allScrollData","activeListeners","fetchCurrentScroll","isScrollEvent","previousEventData","fetchScrollData","trackType","_trackType","setupOnScroll","fetchOnScrollOptions","eventTarget","_eventTarget","scrollData","TRACK_FULL","setupSizeTrack","listenerOptions","_nRealtime","scrollHandler","directionMatches","removeOnScroll","setScrollCssProps","scrollCallback","doc","docScrollingElement","resizeCallback","sizeWatcher","observedElements","domWatcher","onAddedCallback","_activeListeners$get$","_activeListeners$get","scroll","_options$amount","isVertical","sign","targetCoordinate","asFractionOf","el","_scrollDuration","fetchCurrentScrollAction","stopUserScrolling","stopScroll","immediate","trackScroll","noTrackScroll","onScroll","TRACK_REGULAR","offScroll","_scrollThreshold","scrollThreshold","scrollDuration","getEventTarget","userDirections","latestDirection","topDiff","leftDiff","checkTop","checkLeft","_previousEventData$sc","_previousEventData$sc2","scrollTop","scrollLeft","scrollWidth","scrollTopFraction","scrollLeftFraction","prevScrollTop","prevScrollLeft","isValidScrollOffset","OFFSET_REGEX","isValidView","view","VIEWS","isValidViewList","views","getOppositeViews","getViewsBitmask","VIEWS_SPACE","at","above","below","getViewsFromBitmask","viewsStr","viewsBitmask","parseScrollOffset","reference","XIntersectionObserver","selectedEntries","thresholds","ViewWatcher","allViewData","_rootMargin","fetchCurrentView","fetchData","entryOrElement","intersection","fetchIntersectionData","fetchViewData","promise","setupOnView","viewData","rootBounds","setupInviewTrack","viewsToBitmask","_viewsBitmask","removeOnView","setViewCssProps","viewCallback","scrollWatcher","isInview","removeTrackCallback","scrollableAncestors","fetchScrollableAncestors","addTrackCallback","trackCallback","prevData","changed","viewChanged","enterOrLeaveCallback","target__ignored","trackView","noTrackView","onView","offView","_config$rootMargin","_config$threshold","targetBounds","relative","entryOrTarget","vpSize","rootMargins","isCrossOrigin","IntersectionObserverEntry","boundingClientRect","fetchBounds","_targetBounds","_rootMargins","_rootBounds","_isIntersecting","_isCrossOrigin","width","height","_intersection$_isInte","vpHeight","vpWidth","fetchViews","hMiddle","vMiddle","useScrollingAncestor","delta","_left","_right","_top","_bottom","xView","yView","scrollingAncestor","_viewData$relative","overlayOptions","getOverlayOptions","ovrDimension","Widget","_instances$get$get","isDisabled","isDestroyed","destroyPromise","enableCallbacks","disableCallbacks","destroyCallbacks","disable","enable","toggleEnable","onDisable","onEnable","elInstances","onDestroy","getElement","registerWidget","newWidget","configValidator","registeredWidgets","prefixedName","getDefaultWidgetSelector","thisConfigValidator","widgets","configSpecs","dataAttr","supportsMultiple","fetchWidgetConfig","theseWidgets","w","getWidgetConfig","validator","toOptionsObject","configPromises","fetchUniqueWidget","Type","widget","registerAction","newAction","registeredActions","newActionFromSpec","argsAndOptions","fetchAction","AddClass","register","_add","_toggle","getMethods","do","undo","RemoveClass","Animate","animate","GO_FORWARD","GO_BACKWARD","GO_TOGGLE","isInitial","setupAnimation","setupAnimationLegacy","pauseTillReady","isBackward","playbackRate","playState","reverse","play","pause","CSSAnimation","cancelHandler","onAnimationCancel","Animation","effect","KeyframeEffect","newAnimation","_MH$targetOf","animationName","isPaused","goBackwards","doPause","AnimatePlay","_play","_pause","PAUSE","AnimatePause","PLAY","TOGGLE","Display","_display","_undisplay","Undisplay","getReferenceElement","thisElement","referenceElement","relation","find","matchOp","refOrCls","_getData","PREFIX_REF","DATA_REF","getFirstReferenceElement","getLastReferenceElement","getThisReferenceElement","getNextReferenceElement","getPrevReferenceElement","waitForReferenceElement","getAllReferenceElements","allRefs","closest","getNextOrPrevReferenceElement","goBackward","_getThisReferenceElem","_allRefs$refIndex","numRefs","refIndex","i","currentIsAfter","Trigger","registerTrigger","_config$once","_config$oneWay","_config$delay","_config$doDelay","_config$undoDelay","oneWay","doDelay","undoDelay","lastCallId","callActions","newToggleState","myCallId","run","getActions","newTrigger","clsPref","baseConfigValidator","newBaseConfigValidator","allSpecs","TRIGGER_SEP","_config$actOn","tmp","configSpec","OPTION_PREF_CHAR","argSpec","allActionSpecs","ACTION_PREF_CHAR","actionTarget","actOn","actionSpec","actionArgsAndOptions","ACTION_ARGS_PREF_CHAR","Enable","ids","_enable","_disable","_toggleEnable","Disable","Run","_run","_reverse","triggerPromises","getTriggers","triggers","trigger","ScrollTo","offsetX","offsetY","newConfigValidator","watcher","canReverse","hasReversed","_validateNumber2","SetAttribute","isOn","setAttrs","attrName","off","Show","_show","_hide","Hide","isValidPosition","POSITIONS","isValidTwoFoldPosition","TWO_FOLD_POSITION_REGEX","POSITIONS_OPTIONS_STR","registerOpenable","newOpenable","Openable","properties","isModal","isOffcanvas","openCallbacks","closeCallbacks","isOpen","open","PREFIX_IS_OPEN","scrollWrapperToTop","outerWrapper","onOpen","onClose","getRoot","getContainer","container","getTriggerConfigs","setupElements","Collapsible","WIDGET_NAME_COLLAPSIBLE","collapsibleConfigValidator","_config$autoClose","_config$reverse","isHorizontal","horizontal","orientation","onSetup","triggerConfig","insertCollapsibleIcon","autoClose","closeButton","wrapTriggers","PREFIX_REVERSE","disableTransitionTimer","tempEnableTransition","peek","peekSize","VAR_PEEK_SIZE","PREFIX_PEEK","updateWidth","VAR_JS_COLLAPSIBLE_WIDTH","Popup","WIDGET_NAME_POPUP","popupConfigValidator","_config$autoClose2","_config$closeButton","S_AUTO","contentSize","containerView","placement","fetchPopupPlacement","Modal","WIDGET_NAME_MODAL","modalConfigValidator","_config$autoClose3","_config$closeButton2","Offcanvas","WIDGET_NAME_OFFCANVAS","offcanvasConfigValidator","_config$autoClose4","_config$closeButton3","PREFIX_CLOSE_BTN","PREFIX_OPENS_ON_HOVER","PREFIX_LINE","PREFIX_ICON_POSITION","PREFIX_TRIGGER_ICON","PREFIX_ICON_WRAPPER","S_ARIA_EXPANDED","S_ARIA_MODAL","MIN_CLICK_TIME_AFTER_HOVER_OPEN","S_ARROW_UP","S_ARROW_DOWN","S_ARROW_LEFT","S_ARROW_RIGHT","ARROW_TYPES","ICON_CLOSED_TYPES","ICON_OPEN_TYPES","isValidIconClosed","isValidIconOpen","triggerConfigValidator","icon","iconClosed","iconOpen","getPrefixedNames","pref","_overlay","_innerWrapper","_outerWrapper","_content","_container","_trigger","_containerForSelect","_triggerForSelect","_contentId","findContainer","_currWidget$getRoot","currWidget","childRef","findTriggers","prefixedNames","getTriggerSelector","suffix","contentId","getTriggersFrom","inputTriggers","triggerMap","addTrigger","_properties$wrapTrigg","innerWrapper","placeholder","closeBtn","elements","hoverTimeOpened","isPointerOver","activeTrigger","isTrigger","shouldPreventDefault","_triggers$get$prevent","_triggers$get","usesHover","_triggers$get2","usesAutoClose","_triggers$get3","toggleTrigger","openIt","setIsPointerOver","pointerLeft","unsetIsPointerOver","pointerEntered","closeIfEscape","closeIfClickOutside","maybeSetupAutoCloseListeners","addOrRemove","setupOrCleanup","widgetConfig","_triggerConfig$icon","_triggerConfig$iconCl","_triggerConfig$iconOp","iconPosition","line","containerPosition","containerTop","containerBottom","containerLeft","containerRight","containerHMiddle","containerVMiddle","popupWidth","popupHeight","placementVars","finalPlacement","alignmentVars","middle","alignment","Open","widgetPromise","Pager","DUMMY_ID","WIDGET_NAME","_Pager$get","_config$nextSwitch","_config$prevSwitch","pages","toggles","switches","nextPrevSwitch","nextSwitch","_prev","prevSwitch","pageSelector","PREFIX_PAGE__FOR_SELECT","toggleSelector","PREFIX_TOGGLE__FOR_SELECT","switchSelector","PREFIX_SWITCH__FOR_SELECT","nextSwitchSelector","PREFIX_NEXT_SWITCH__FOR_SELECT","prevSwitchSelector","PREFIX_PREV_SWITCH__FOR_SELECT","numPages","page","components","_pages","_toggles","_switches","_nextPrevSwitch","methods","nextPage","_nextPage","prevPage","_prevPage","goToPage","pageNum","_goToPage","disablePage","_disablePage","enablePage","_enablePage","togglePage","_togglePage","isPageDisabled","_isPageDisabled","getCurrentPage","_getCurrentPage","getPreviousPage","_getPreviousPage","getCurrentPageNum","_getCurrentPageNum","getPreviousPageNum","_getPreviousPageNum","onTransition","_onTransition","getPages","getSwitches","getToggles","MIN_TIME_BETWEEN_WHEEL","S_CURRENT","S_ARIA_CURRENT","S_COVERED","S_NEXT","S_TOTAL_PAGES","S_VISIBLE_PAGES","S_CURRENT_PAGE","S_PAGE_NUMBER","PREFIXED_NAME","PREFIX_ROOT","PREFIX_PAGE_CONTAINER","PREFIX_PAGE","PREFIX_STYLE","PREFIX_IS_FULLSCREEN","PREFIX_USE_PARALLAX","PREFIX_TOTAL_PAGES","PREFIX_VISIBLE_PAGES","PREFIX_CURRENT_PAGE","PREFIX_CURRENT_PAGE_IS_LAST","PREFIX_CURRENT_PAGE_IS_FIRST_ENABLED","PREFIX_CURRENT_PAGE_IS_LAST_ENABLED","PREFIX_PAGE_STATE","PREFIX_PAGE_NUMBER","VAR_CURRENT_PAGE","VAR_TOTAL_PAGES","VAR_VISIBLE_PAGES","VAR_VISIBLE_GAPS","VAR_TRANSLATED_PAGES","VAR_TRANSLATED_GAPS","VAR_PAGE_NUMBER","SUPPORTED_STYLES","isValidStyle","initialPage","pageSize","fullscreen","parallax","useGestures","bool","alignGestureDirection","fetchClosestScrollable","_getClosestScrollable","setPageNumber","lastPromise","setPageState","setCurrentPage","pagerEl","pageNumbers","isFirstEnabled","isLastEnabled","n","_total","_current","_config$initialPage","_config$pageSize","_config$peek","_config$fullscreen","_config$parallax","_config$horizontal","_config$useGestures","_config$alignGestureD","pageContainer","pagerStyle","isCarousel","minPageSize","enablePeek","isFullscreen","isParallax","gestureWatcher","viewWatcher","recalculateCarouselProps","gap","containerSize","getNumVisiblePages","addPeek","numVisiblePages","currPageNum","prevPageNum","numHidden","hasPeek","visibleStart","isAtEdge","numTranslated","numVisibleGaps","fractionalNumVisiblePages","getGestureOptions","scrollToPager","transitionOnGesture","swapDirection","addWatchers","removeWatchers","getPageNumForEvent","toggleClickListener","switchClickListener","nextSwitchClickListener","prevSwitchClickListener","idx","disabledPages","callbacks","fetchScrollOptions","lastPageNum","lastTransition","canTransition","gestureData","targetPage","NextPage","PrevPage","GoToPage","EnablePage","DisablePage","altPageNum","currentNum","targetNum","CheckTrigger","HTMLInputElement","onToggle","checked","ClickTrigger","setupWatcher","PressTrigger","HoverTrigger","LayoutTrigger","_args$","_config$layout","otherDevices","otherAspectRatios","LoadTrigger","ScrollTrigger","oppositeDirections","ViewTrigger","_config$target","oppositeViews","willAnimate","setupRepresentative","_ref2","prev","previousElementSibling","prevChild","AutoHide","WIDGET_NAME_HIDE","WIDGET_NAME_REMOVE","watcherOptions","hideOrRemoveEl","hideRelevant","targetElements","elem","DEFAULT_DELAY","addWatcher","removeWatcher","autoRemove","PageLoader","mainWidget","enableMain","loader","_PageLoader$get","_config$autoRemove","spinner","PREFIX_SPINNER","SameHeight","containerElement","_SameHeight$get","items","getItemsFrom","fetchConfig","fullConfig","toColumn","toRow","getItems","getItemConfigs","PREFIX_ITEM","PREFIX_ITEM__FOR_SELECT","S_TEXT","S_IMAGE","MIN_CHARS_FOR_TEXT","diffTolerance","minGap","maxFreeR","maxWidthR","isText","innerText","areImagesLoaded","img","naturalWidth","naturalHeight","userConfig","_userConfig$minGap","_userConfig$maxFreeR","_userConfig$maxWidthR","_userConfig$diffToler","_userConfig$resizeThr","_userConfig$debounceW","colGapStr","getNumValue","_minGap","_maxFreeR","_maxWidthR","_diffTolerance","num","findItems","inputItems","itemMap","addItem","itemType","allItems","callCounter","isFirstTime","lastOptimalHeight","hasScheduledReset","counterTimeout","measurements","calculateMeasurements","getOptimalHeight","setWidths","_width","_height","observeAll","unobserveAll","getWidthAtH","sameHeightW","getProperties","_type","_aspectR","_area","_extraH","_components","getTextComponents","tArea","tExtraH","imgAR","flexW","nItems","thisTxtArea","thisTxtExtraH","component","cmpProps","thisAspectR","_tArea","_tExtraH","_imgAR","_flexW","_nItems","targetHeight","h0","h2","h1","hR0","hR1","hR2","hF2","hF1","hConstr1","hConstr2","tw0","iw0","freeSpace0","supportsSticky","CSS","isInQuirksMode","compatMode","Scrollbar","_Scrollbar$get","getScrollableProps","ourScrollable","getScrollable","PREFIX_CONTAINER","PREFIX_CONTENT","PREFIX_BAR","PREFIX_FILL","PREFIX_SPACER","PREFIX_HANDLE","PREFIX_DRAGGABLE","PREFIX_CLICKABLE","PREFIX_HAS_WRAPPER","PREFIX_ALLOW_COLLAPSE","PREFIX_HAS_V_SCROLL","PREFIX_HAS_SCROLLBAR","PREFIX_HIDE_SCROLL","S_SET_POINTER_CAPTURE","S_RELEASE_POINTER_CAPTURE","S_ARIA_VALUENOW","S_SCROLLBAR","hideNative","onMobile","positionH","positionV","autoHide","clickScroll","dragScroll","useHandle","defaultScrollable","isBody","isMainScrollable","isBodyInQuirks","barParent","hasVScroll","contentWrapper","supported","hasExistingWrapper","warnMsgPrefix","needsSticky","_config$onMobile","_config$hideNative","_config$autoHide","_config$clickScroll","_ref3","_config$dragScroll","_ref4","_config$useHandle","autoHideDelay","newScrollbar","barIsHorizontal","scrollbar","scrollDomID","fill","handle","_bar","_handle","_fill","setProgress","tracksH","scrollbarH","scrollbarV","hasBarPrefix","completeFraction","viewFraction","viewFr","completeFr","scrollAxis","updateProgress","setBoxMeasureProps","updatePropsOnResize","barHeight","isDragging","lastOffset","lastTargetFraction","scrollAction","onClickOrDrag","handleH","handleV","isClick","isHandleClick","startsDrag","setOrReleasePointerCapture","barLength","currScrollOffset","maxScrollOffset","deltaOffset","handleLength","targetScrollOffset","_scrollAction","onRelease","onClickOrDragH","onClickOrDragV","onReleaseH","onReleaseV","maybeSetNativeHidden","setNativeShown","origDomID","padding","pointerId","ScrollToTop","button","_ScrollToTop$get","hasCustomScrollable","clickListener","showIt","hideIt","shouldInsertBefore","PREFIX_BTN","PREFIX_FIXED","Sortable","_Sortable$get","disableItem","_disableItem","enableItem","_enableItem","toggleItem","_toggleItem","isItemDisabled","_isItemDisabled","onMove","_onMove","currentOrder","_getSortedItems","PREFIX_IS_DRAGGABLE","PREFIX_FLOATING_CLONE","mode","touchMoveOptions","isItemDraggable","currentDraggedItem","floatingClone","ignoreCancel","grabOffset","setIgnoreCancel","onDragStart","currTarget","releasePointerCapture","onTouchMove","onDragEnd","onDragEnter","dragged","_dragItemOnto","setupEvents","doSwap","disabledItems","getSortedItems","getOrigItemNumber","itemNum","dragItemOnto","draggedOver","TrackGesture","minDeltaX","maxDeltaX","minDeltaY","maxDeltaY","minDeltaZ","maxDeltaZ","TrackScroll","TrackSize","TrackView"],"mappings":"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L,QAAQ,CAAC;EAEzB,MAAMsL,UAAU,GAAIC,GAAW,IAAK,IAAIxO,cAAc,CAACwO,GAAG,CAAC;EAE3D,MAAMC,QAAQ,GAAID,GAAW,IAAK,IAAIpO,YAAY,CAACoO,GAAG,CAAC;EAEvD,MAAME,uBAAuB,GAAIC,OAAe,IACrDJ,UAAU,CAAC,CAAA,yBAAA,EAA4BI,OAAO,CAAA,CAAA,CAAG,CAAC;EAEpD,MAAMC,OAAO,GAAGC,OAAO;EAChB,MAAMC,YAAY,GAAGF,OAAO,CAACG,KAAK,CAACpN,IAAI,CAACiN,OAAO,CAAC;EAEhD,MAAMI,UAAU,GAAGJ,OAAO,CAACK,GAAG,CAACtN,IAAI,CAACiN,OAAO,CAAC;EAE5C,MAAMM,WAAW,GAAGN,OAAO,CAACO,IAAI,CAACxN,IAAI,CAACiN,OAAO,CAAC;EAE9C,MAAMQ,WAAW,GAAGR,OAAO,CAACS,IAAI,CAAC1N,IAAI,CAACiN,OAAO,CAAC;EAE9C,MAAMU,YAAY,GAAGV,OAAO,CAACW,KAAK,CAAC5N,IAAI,CAACiN,OAAO,CAAC;;EAEvD;;ECpcA;EACA;EACA;;;EAIA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;QACaY,QAAQ,GAAGC,iBAAoB,CAAC;EAC3C;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,6BAA6B,EAAE,IAAqB;EAEpD;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,sBAAsB,EAAE,IAAI;EAC5B;;EAEA;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,eAAe,EAAE,IAAI;EAErB;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,WAAW,EAAE,KAAK;EAElB;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,mBAAmB,EAAE,IAAI;EAEzB;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,iBAAiB,EAAE,KAAK;EAExB;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,kBAAkB,EAAE,QAAQ;EAE5B;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,kBAAkB,EAAE,OAAO;EAE3B;EACF;EACA;EACA;EACA;EACA;EACA;IACEC,iBAAiB,EAAE,EAAE;EAErB;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,oBAAoB,EAAE,IAAI;EAE1B;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,mBAAmB,EAAE,IAAI;EAEzB;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,kBAAkB,EAAE,KAAK;EAEzB;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,uBAAuB,EAAE,EAAE;EAE3B;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,yBAAyB,EAAE,CAAC;EAE5B;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,wBAAwB,EAAE,GAAG;EAE7B;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,gBAAgB,EAAE,EAAE;EAEpB;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,kBAAkB,EAAE,GAAG;EAEvB;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,mBAAmB,EAAE,GAAG;EAExB;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,iBAAiB,EAAE;EACjB;EACJ;EACA;EACA;EACA;EACA;EACIC,IAAAA,MAAM,EAAE,CAAC;EAET;EACJ;EACA;EACA;EACA;EACA;EACI,IAAA,aAAa,EAAE,GAAG;EAElB;EACJ;EACA;EACA;EACA;EACA;EACIC,IAAAA,MAAM,EAAE,GAAG;EAAE;;EAEb;EACJ;EACA;EACA;EACA;MACIC,OAAO,EAAE,GAAG;KACb;EAED;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,sBAAsB,EAAE;EACtB;EACJ;EACA;EACA;EACA;EACA;EACI,IAAA,WAAW,EAAE,CAAC;EAAE;;EAEhB;EACJ;EACA;EACA;EACA;EACA;MACIC,IAAI,EAAE,CAAC,GAAG,EAAE;EAAE;;EAEd;EACJ;EACA;EACA;EACA;EACA;MACIC,MAAM,EAAE,CAAC,GAAG,CAAC;EAAE;;EAEf;EACJ;EACA;EACA;EACA;EACA;MACIC,IAAI,EAAE,CAAC,GAAG,CAAC;EAAE;;EAEb;EACJ;EACA;EACA;EACA;EACI,IAAA,WAAW,EAAE,EAAE,GAAG,CAAC;KACpB;EAED;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,mBAAmB,EAAE,aAAa;EAElC;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,kBAAkB,EAAE,YAAY;EAEhC;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,eAAe,EAAE,EAAE;EAEnB;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,cAAc,EAAE,IAAI;EAEpB;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,eAAe,EAAE,GAAG;EAEpB;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,cAAc,EAAE,CAAC;EAEjB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EACA;EACA;;EAUA;EACA;EACA;EACA;EACA;EACO,MAAMqC,kBAAkB,GAAIC,MAAc,IAC/CtsB,QAAW,CAACusB,OAAO,EAAED,MAAM,CAAC;;EAE9B;EACA;EACA;EACA;EACA;EACO,MAAME,aAAa,GAAIC,MAAc,IAC1CzsB,QAAW,CAAC0sB,OAAO,EAAED,MAAM,CAAC;;EAE9B;EACA;EACA;EACA;EACA;EACA;EACO,MAAME,sBAAsB,GAAIC,OAA0B,IAC/DrjB,cAAc,CAACqjB,OAAO,EAAEP,kBAAkB,EAAE,KAAK,CAAC;;EAEpD;EACA;EACA;EACA;EACA;EACA;EACO,MAAMQ,iBAAiB,GAAIC,OAA0B,IAC1DvjB,cAAc,CAACujB,OAAO,EAAEN,aAAa,EAAE,KAAK,CAAC;;EAE/C;EACA;EACA;EACA;EACO,MAAMO,SAAS,GAAGA,CAACC,OAAe,EAAEC,SAAiB,KAC1DjtB,GAAM,CAACktB,WAAW,EAAEF,OAAO,GAAGC,SAAS,CAAC;;EAE1C;EACA;EACA;EACA;EACO,MAAMV,OAAwB,GAAG,CACtC76B,KAAQ,EACRA,SAAY,EACZA,OAAU,EACVA,OAAU,CACF;;EAEV;EACA;EACA;EACA;EACO,MAAMg7B,OAAwB,GAAG,CACtCh7B,QAAW,EACXA,MAAS,EACTA,MAAS,EACTA,SAAY,CACJ;;EAEV;EACA,MAAMw7B,WAAW,GAAG,GAAG;;ECxGvB;EACA;EACA;;;EAaA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMC,qBAAqB,GAAGA,CACnCC,MAAgC,EAChCx5B,OAGC,KAC2B;EAAA,EAAA,IAAAy5B,qBAAA;EAC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,CAACoF,SAAS,CAAEjtB,CAAC,IAAKA,CAAC,CAACqf,IAAI,KAAKlzB,YAAe,CAAC;EACtE,EAAA,MAAM+gC,SAAS,GAAGrF,MAAM,CAACoF,SAAS,CAAEjtB,CAAC,IAAKA,CAAC,CAACqf,IAAI,KAAKlzB,WAAc,CAAC;EACpE,EAAA,IAAI6gC,UAAU,GAAG,CAAC,IAAIE,SAAS,GAAG,CAAC,EAAE;EACnC,IAAA,OAAO,CAAC;EACV,EAAA;EAEA,EAAA,OAAOrF,MAAM,CAACqF,SAAS,CAAC,CAACC,SAAS,GAAGtF,MAAM,CAACmF,UAAU,CAAC,CAACG,SAAS;EACnE,CAAC;;EC/RD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;;EAIA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMC,cAAc,GAAIx/B,KAAuB,IAAgB;IACpE,IAAIy/B,KAAK,GAAG,CAAC;EACXC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EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAKE;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;EACA;EACA;EACA;IACE,OAAOvO,uBAAuBA,GAAyB;MACrD,OAAOA,uBAAuB,EAAE;EAClC,EAAA;;EAEA;EACF;EACA;EACA;EACA;EACA;EACA;EACA;IACE,OAAOI,0BAA0BA,GAAyB;MACxD,OAAOA,0BAA0B,EAAE;EACrC,EAAA;;EAEA;EACF;EACA;EACA;IACE,OAAOn3B,MAAMA,CAACsG,MAA4B,EAAE;MAC1C,OAAO,IAAIg/B,aAAa,CAAC1sB,WAAS,CAACtS,MAAM,CAAC,EAAEuS,iBAAe,CAAC;EAC9D,EAAA;;EAEA;EACF;EACA;EACA;EACA;EACA;EACA;IACE,OAAO/S,KAAKA,CAACQ,MAA4B,EAAE;EACzC,IAAA,MAAMG,QAAQ,GAAGmS,WAAS,CAACtS,MAAM,CAAC;EAClC,IAAA,MAAMwS,YAAY,GAAG9a,WAAW,CAACyI,QAAQ,CAAC;EAE1C,IAAA,IAAIxB,QAAQ,GAAGC,WAAS,CAAC/E,GAAG,CAAC2Y,YAAY,CAAC;MAC1C,IAAI,CAAC7T,QAAQ,EAAE;EACbA,MAAAA,QAAQ,GAAG,IAAIqgC,aAAa,CAAC7+B,QAAQ,EAAEoS,iBAAe,CAAC;EACvD3T,MAAAA,WAAS,CAACtB,GAAG,CAACkV,YAAY,EAAE7T,QAAQ,CAAC;EACvC,IAAA;EAEA,IAAA,OAAOA,QAAQ;EACjB,EAAA;EAEQzf,EAAAA,WAAWA,CACjB8gB,MAAmC,EACnClU,GAA2B,EAC3B;MACA,IAAIA,GAAG,KAAKymB,iBAAe,EAAE;EAC3B,MAAA,MAAM7jB,uBAA0B,CAAC,sBAAsB,CAAC;EAC1D,IAAA;MAEA,MAAMiT,MAAM,GAAG3T,MAAK,GAChB,IAAIA,MAAK,CAAC+R,MAAM,CAAC;EAAE3gB,MAAAA,IAAI,EAAE,eAAe;EAAEsiB,MAAAA,aAAa,EAAE1B;OAAQ,CAAC,GAClE,IAAI;EAER,IAAA,MAAMi/B,aAAa,GAAGvwC,UAAa,EAAuB;EAE1D,IAAA,MAAMwwC,eAAe,GAAGxwC,UAAa,EAGlC;MAEH,MAAMukB,YAAY,GAAG/V,WAAW,CAG9B,MAAMxO,MAAS,EAAE,CAAC;;EAEpB;;EAEA,IAAA,MAAMywC,kBAAkB,GAAG,OACzBz5C,OAAgB,EAChB2nC,QAAQ,GAAG,KAAK,EAChB+R,aAAa,GAAG,KAAK,KACG;EACxB;EACA;EACA,MAAA,MAAMC,iBAAiB,GAAGJ,aAAa,CAACplC,GAAG,CAACnU,OAAO,CAAC;QACpD,MAAMi0C,UAAU,GAAG,MAAM2F,eAAe,CACtC55C,OAAO,EACP25C,iBAAiB,EACjBhS,QACF,CAAC;;EAED;EACA,MAAA,IAAI,CAAC+R,aAAa,IAAIC,iBAAiB,EAAE;EACvC1F,QAAAA,UAAU,CAAC7uB,SAAS,GAAGu0B,iBAAiB,CAACv0B,SAAS;EACpD,MAAA;EACA,MAAA,OAAO6uB,UAAU;MACnB,CAAC;;EAED;;MAEA,MAAMxlB,cAAc,GAAGA,CACrB/X,OAAwB,EACxB9Z,OAAgC,EAChCi9C,SAAoB,KACF;EAAA,MAAA,IAAAnrB,iBAAA;EAClB,MAAA,MAAM1uB,OAAO,GAAGpD,OAAO,CAAC42C,QAAQ;EAChCxqC,MAAAA,MAAS,CAAA,CAAA0lB,iBAAA,GAACnB,YAAY,CAACpZ,GAAG,CAACnU,OAAO,CAAC,MAAA,IAAA,IAAA0uB,iBAAA,KAAA,MAAA,IAAA,CAAAA,iBAAA,GAAzBA,iBAAA,CAA2Bva,GAAG,CAACuC,OAAO,CAAC,MAAA,IAAA,IAAAgY,iBAAA,KAAA,MAAA,GAAA,MAAA,GAAvCA,iBAAA,CAAyCC,SAAS,CAAC;EAE7DrmB,MAAO2T,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,IAANA,MAAM,CAAEP,MAAM,CAAC,yBAAyB,EAAE9e,OAAO,CAAC;QACzD,MAAMJ,QAAQ,GAAGsgB,YAAY,CAACpG,OAAO,EAAE9Z,OAAO,CAAC4iC,eAAe,CAAC;QAC/DhjC,QAAQ,CAAC6gB,QAAQ,CAAC,MAAM;EACtBuR,QAAAA,aAAa,CAAClY,OAAO,EAAE9Z,OAAO,CAAC;EACjC,MAAA,CAAC,CAAC;EAEF,MAAA,MAAMgd,KAAK,GAAG;EACZ+U,QAAAA,SAAS,EAAEnyB,QAAQ;EACnBs9C,QAAAA,UAAU,EAAED,SAAS;EACrBhrB,QAAAA,QAAQ,EAAEjyB;SACX;QACD2wB,YAAY,CAAC1V,IAAI,CAAC7X,OAAO,CAAC,CAAC4X,GAAG,CAAClB,OAAO,EAAEkD,KAAK,CAAC;EAE9C,MAAA,OAAOA,KAAK;MACd,CAAC;;EAED;;MAEA,MAAMmgC,aAAa,GAAG,OACpBrjC,OAAwB,EACxBqY,WAAwC,EACxC8qB,SAAoB,KACjB;EACH,MAAA,MAAMj9C,OAAO,GAAG,MAAMo9C,oBAAoB,CAAC1/B,MAAM,EAAEyU,WAAW,KAAA,IAAA,IAAXA,WAAW,KAAA,MAAA,GAAXA,WAAW,GAAI,EAAE,CAAC;EACrE,MAAA,MAAM/uB,OAAO,GAAGpD,OAAO,CAAC42C,QAAQ;;EAEhC;EACA;EACA;EACA;QACA,MAAM55B,KAAK,GAAG6U,cAAc,CAAC/X,OAAO,EAAE9Z,OAAO,EAAEi9C,SAAS,CAAC;EACzD,MAAA,MAAMr9C,QAAQ,GAAGod,KAAK,CAAC+U,SAAS;EAEhC,MAAA,MAAMsrB,WAAW,GAAGr9C,OAAO,CAACs9C,YAAY;EACxC,MAAA,MAAMC,UAAU,GAAG,MAAMV,kBAAkB,CACzCz5C,OAAO,EACPpD,OAAO,CAAC4iC,eAAe,KAAK,CAC9B,CAAC;EAED,MAAA,IAAIhjC,QAAQ,CAACwgB,SAAS,EAAE,EAAE;EACxB,QAAA;EACF,MAAA;QAEApD,KAAK,CAACq2B,KAAK,GAAGkK,UAAU;EACxBZ,MAAAA,aAAa,CAAC3hC,GAAG,CAAC5X,OAAO,EAAEm6C,UAAU,CAAC;QAEtC,IAAIN,SAAS,KAAKO,YAAU,EAAE;UAC5B,MAAMC,cAAc,CAACzgC,KAAK,CAAC;EAC7B,MAAA;EAEA,MAAA,IAAI0gC,eAAe,GAAGd,eAAe,CAACrlC,GAAG,CAAC8lC,WAAW,CAAC;QACtD,IAAI,CAACK,eAAe,EAAE;EACpBhyC,QAAO2T,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,IAANA,MAAM,CAAER,MAAM,CAAC,wBAAwB,EAAEw+B,WAAW,CAAC;EAC5DK,QAAAA,eAAe,GAAG;EAAEC,UAAAA,UAAU,EAAE;WAAG;EACnCf,QAAAA,eAAe,CAAC5hC,GAAG,CAACqiC,WAAW,EAAEK,eAAe,CAAC;EACjD;UACAvnB,kBAAkB,CAACknB,WAAW,EAAEv/C,QAAW,EAAE8/C,aAAa,CAAC;EAC7D,MAAA;EAEA,MAAA,IAAI59C,OAAO,CAAC4iC,eAAe,KAAK,CAAC,EAAE;UACjC8a,eAAe,CAACC,UAAU,EAAE;EAC9B,MAAA;EAEA,MAAA,MAAMxoB,UAAU,GAAGn1B,OAAO,CAACqkC,WAAW;QACtC,IACE,CAACzkC,QAAQ,CAACwgB,SAAS,EAAE,IACrB,EAAC+R,WAAW,KAAA,IAAA,IAAXA,WAAW,KAAA,MAAA,IAAXA,WAAW,CAAEI,WAAW,CAAA,IACzBsrB,gBAAgB,CAAC1oB,UAAU,EAAEooB,UAAU,CAAC/0B,SAAS,CAAC,EAClD;EACA9c,QAAO2T,MAAM,KAAA,IAAA,IAANA,MAAM,eAANA,MAAM,CAAEP,MAAM,CAAC,wBAAwB,EAAE1b,OAAO,EAAEm6C,UAAU,CAAC;EACpE;UACA,MAAMvqB,gBAAc,CAAC9S,YAAY,CAACpG,OAAO,CAAC,EAAE1W,OAAO,EAAEm6C,UAAU,CAAC;EAClE,MAAA;MACF,CAAC;;EAED;;MAEA,MAAMO,cAAc,GAAG,OACrBhkC,OAAwB,EACxBqyB,UAAoC,EACpC8Q,SAAoB,KACjB;EAAA,MAAA,IAAAlpB,kBAAA;EACH,MAAA,MAAM/zB,OAAO,GAAG,MAAMo9C,oBAAoB,CAAC1/B,MAAM,EAAE;EAAEyuB,QAAAA;EAAW,OAAC,CAAC;EAClE,MAAA,MAAM/oC,OAAO,GAAGpD,OAAO,CAAC42C,QAAQ;EAChC,MAAA,MAAMO,SAAS,GAAA,CAAApjB,kBAAA,GAAGpD,YAAY,CAACpZ,GAAG,CAACnU,OAAO,CAAC,MAAA,IAAA,IAAA2wB,kBAAA,KAAA,MAAA,GAAA,MAAA,GAAzBA,kBAAA,CAA2Bxc,GAAG,CAACuC,OAAO,CAAC;QACzD,IAAI,CAAAq9B,SAAS,KAAA,IAAA,IAATA,SAAS,KAAA,MAAA,GAAA,MAAA,GAATA,SAAS,CAAE+F,UAAU,MAAKD,SAAS,EAAE;EACvC7wC,QAAAA,MAAS,CAAC+qC,SAAS,CAACplB,SAAS,CAAC;UAE9B,IAAIjY,OAAO,KAAKikC,iBAAiB,EAAE;EACjC;EACAA,UAAAA,iBAAiB,CAAC36C,OAAO,EAAE,IAAI,CAAC;EAClC,QAAA;EACF,MAAA;MACF,CAAC;;EAED;;EAEA,IAAA,MAAM4uB,aAAa,GAAGA,CACpBlY,OAAwB,EACxB9Z,OAAgC,KAC7B;EACH,MAAA,MAAMoD,OAAO,GAAGpD,OAAO,CAAC42C,QAAQ;EAChC,MAAA,MAAMyG,WAAW,GAAGr9C,OAAO,CAACs9C,YAAY;QAExClxC,SAAY,CAACukB,YAAY,CAACpZ,GAAG,CAACnU,OAAO,CAAC,EAAE0W,OAAO,CAAC;EAChD6W,MAAAA,YAAY,CAACzV,KAAK,CAAC9X,OAAO,CAAC;EAE3B,MAAA,MAAMs6C,eAAe,GAAGd,eAAe,CAACrlC,GAAG,CAAC8lC,WAAW,CAAC;EACxD,MAAA,IAAIK,eAAe,IAAI19C,OAAO,CAAC4iC,eAAe,KAAK,CAAC,EAAE;UACpD8a,eAAe,CAACC,UAAU,EAAE;EAC9B,MAAA;EAEA,MAAA,IAAI,CAAChtB,YAAY,CAAC3Y,GAAG,CAAC5U,OAAO,CAAC,EAAE;EAC9BsI,QAAO2T,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,IAANA,MAAM,CAAER,MAAM,CACnB,qDAAqD,EACrDzb,OACF,CAAC;EAEDgJ,QAAAA,SAAY,CAACuwC,aAAa,EAAEv5C,OAAO,CAAC;UACpC2zB,uBAAuB,CAACsmB,WAAW,EAAEv/C,QAAW,EAAE8/C,aAAa,CAAC;EAChExxC,QAAAA,SAAY,CAACwwC,eAAe,EAAES,WAAW,CAAC;EAC1C;EACF,MAAA;MACF,CAAC;;EAED;;EAEA,IAAA,MAAMI,cAAc,GAAG,MAAOzgC,KAAoB,IAAK;EACrD,MAAA,MAAMhd,OAAO,GAAGgd,KAAK,CAACiV,QAAQ;EAC9B,MAAA,MAAM7uB,OAAO,GAAGpD,OAAO,CAAC42C,QAAQ;EAChC,MAAA,MAAMoH,cAAc,GAAGhhC,KAAK,CAAC+U,SAAS;EACtCrmB,MAAO2T,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,IAANA,MAAM,CAAEJ,MAAM,CAAC,0BAA0B,EAAE7b,OAAO,CAAC;EAE1D,MAAA,MAAM66C,GAAG,GAAG7xC,MAAS,EAAE;EACvB,MAAA,MAAM8xC,mBAAmB,GAAG9xC,sBAAyB,EAAE;EAEvD,MAAA,MAAM+xC,cAAc,GAAGj+B,YAAY,CAAC,YAAY;EAC9C;EACA;EACA;EACA,QAAA,MAAMm3B,UAAU,GAAG,MAAMwF,kBAAkB,CAACz5C,OAAO,CAAC;UACpD,MAAMk0C,kBAAkB,GAAGC,oBAAoB,CAC7Cv3C,OAAO,EACPq3C,UAAU,EACVr6B,KAAK,CAACq2B,KACR,CAAC;UAED,IAAI,CAACiE,kBAAkB,EAAE;EACvB5rC,UAAO2T,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,IAANA,MAAM,CAAEH,MAAM,CACnB,wBAAwB,EACxBlf,OAAO,EACPq3C,UAAU,EACVr6B,KAAK,CAACq2B,KACR,CAAC;UACH,CAAC,MAAM,IAAI,CAAC2K,cAAc,CAAC59B,SAAS,EAAE,EAAE;EACtC,UAAA,MAAM4S,gBAAc,CAACgrB,cAAc,EAAE56C,OAAO,EAAEi0C,UAAU,CAAC;EAC3D,QAAA;EACF,MAAA,CAAC,CAAC;EAEF2G,MAAAA,cAAc,CAACv9B,QAAQ,CAAC09B,cAAc,CAAC70C,MAAM,CAAC;;EAE9C;EACA,MAAA,MAAM80C,WAAW,GAAGtI,WAAW,CAAC54B,KAAK,EAAE;QACvC,MAAM+5B,aAAa,GAAIz1C,MAAmB,IACxC48C,WAAW,CAAC1G,QAAQ,CAACyG,cAAc,EAAE;UACnC38C,MAAM;EACN,QAAA,CAAC1D,iBAAoB,GAAGkC,OAAO,CAAC4iC,eAAe;EAC/C;UACAmM,SAAS,EAAE/uC,OAAO,CAAC+2C;EACrB,OAAC,CAAC;QAEJ,IAAI3zC,OAAO,KAAK86C,mBAAmB,EAAE;EACnC;EACA;EACA;;UAEAjH,aAAa,EAAE,CAAC;EAChBA,QAAAA,aAAa,CAACgH,GAAG,CAAC,CAAC;;EAEnB,QAAA;EACF,MAAA;;EAEA;EACA;EACA;EACA;EACA;EACA;;QAEA,MAAMI,gBAAgB,GAAGjyC,MAAS,CAAU,CAAChJ,OAAO,CAAC,CAAC;;EAEtD;QACA6zC,aAAa,CAAC7zC,OAAO,CAAC;;EAEtB;EACA,MAAA,MAAMmd,OAAO,GAAG,MAAM0M,cAAc,CAAC7pB,OAAO,EAAE;EAC5CspB,QAAAA,WAAW,EAAE,CAAC5uB,gBAAiB,EAAEzC,gBAAc;EACjD,OAAC,CAAC;EACF,MAAA,IAAIklB,OAAO,EAAE;UACX02B,aAAa,CAAC12B,OAAO,CAAC;EACtB89B,QAAAA,gBAAgB,CAACv9B,GAAG,CAACP,OAAO,CAAC;;EAE7B;EACF,MAAA,CAAC,MAAM;UACL,KAAK,MAAMsL,KAAK,IAAIzf,UAAa,CAAChJ,OAAO,CAAC,EAAE;YAC1C6zC,aAAa,CAACprB,KAAK,CAAC;EACpBwyB,UAAAA,gBAAgB,CAACv9B,GAAG,CAAC+K,KAAK,CAAC;EAC7B,QAAA;EACF,MAAA;;EAEA;EACA,MAAA,MAAMyyB,UAAU,GAAGvuB,UAAU,CAAC3Y,MAAM,CAAC;EACnCpa,QAAAA,IAAI,EAAEoG,OAAO;EACb;EACA+rB,QAAAA,OAAO,EAAE;EACX,OAAC,CAAC;EAEF,MAAA,MAAMovB,eAAe,GAAGr+B,YAAY,CAAEgR,SAA4B,IAAK;EACrE,QAAA,MAAMrF,KAAK,GAAGzf,eAAkB,CAAC8kB,SAAS,CAAC;EAC3C;EACA;UACA,IAAIrF,KAAK,KAAKtL,OAAO,EAAE;EACrB,UAAA,IAAIA,OAAO,EAAE;EACX;EACA;cACA2L,WAAW,CAACL,KAAK,EAAE;EAAElB,cAAAA,EAAE,EAAEpK,OAAO;EAAEmK,cAAAA,UAAU,EAAE;EAAK,aAAC,CAAC;EACvD,UAAA,CAAC,MAAM;EACL;EACA;cACAusB,aAAa,CAACprB,KAAK,CAAC;EACpBwyB,YAAAA,gBAAgB,CAACv9B,GAAG,CAAC+K,KAAK,CAAC;EAC7B,UAAA;EACF,QAAA;EACF,MAAA,CAAC,CAAC;EAEFyyB,MAAAA,UAAU,CAACzqB,UAAU,CAAC0qB,eAAe,EAAE;EAAExlC,QAAAA,UAAU,EAAE,CAACjb,OAAU;EAAE,OAAC,CAAC;EACpEqgD,MAAAA,cAAc,CAAC19B,QAAQ,CAAC89B,eAAe,CAACj1C,MAAM,CAAC;MACjD,CAAC;;EAED;;EAEA,IAAA,MAAMs0C,aAAa,GAAG,MAAOr+C,KAAY,IAAK;QAAA,IAAAi/C,qBAAA,EAAAC,oBAAA;EAC5C;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,MAAA,MAAMtS,UAAU,GAAG//B,QAAW,CAAC7M,KAAK,CAAC;EACrC;EACA,MAAA,IAAI,CAAC4sC,UAAU,IAAI,EAAE//B,SAAY,CAAC+/B,UAAU,CAAC,IAAI//B,KAAQ,CAAC+/B,UAAU,CAAC,CAAC,EAAE;EACtE,QAAA;EACF,MAAA;EAEA,MAAA,MAAM/oC,OAAO,GAAG,MAAMwrC,sBAAsB,CAACzC,UAAU,CAAC;QACxD,MAAMpB,QAAQ,GAAG,CAAA,CAAAyT,qBAAA,GAAA,CAAAC,oBAAA,GAAC7B,eAAe,CAACrlC,GAAG,CAAC40B,UAAU,CAAC,cAAAsS,oBAAA,KAAA,MAAA,GAAA,MAAA,GAA/BA,oBAAA,CAAiCd,UAAU,MAAA,IAAA,IAAAa,qBAAA,KAAA,MAAA,GAAAA,qBAAA,GAAI,CAAC,IAAI,CAAC;QACvE,MAAMnH,UAAU,GAAG,MAAMwF,kBAAkB,CAACz5C,OAAO,EAAE2nC,QAAQ,EAAE,IAAI,CAAC;EACpE4R,MAAAA,aAAa,CAAC3hC,GAAG,CAAC5X,OAAO,EAAEi0C,UAAU,CAAC;EAEtC3rC,MAAO2T,MAAM,KAAA,IAAA,IAANA,MAAM,eAANA,MAAM,CAAEH,MAAM,CAAC,cAAc,EAAE9b,OAAO,EAAEi0C,UAAU,CAAC;QAE1D,KAAK,MAAMr6B,KAAK,IAAI,CAAA,CAAAulB,kBAAA,GAAA5R,YAAY,CAACpZ,GAAG,CAACnU,OAAO,CAAC,MAAA,IAAA,IAAAm/B,kBAAA,uBAAzBA,kBAAA,CAA2B/3B,MAAM,EAAE,KAAI,EAAE,EAAE;EAAA,QAAA,IAAA+3B,kBAAA;EAC7D;EACA;EACA;EACA,QAAA,MAAMviC,OAAO,GAAGgd,KAAK,CAACiV,QAAQ;UAC9B,MAAMqlB,kBAAkB,GAAGC,oBAAoB,CAC7Cv3C,OAAO,EACPq3C,UAAU,EACVr6B,KAAK,CAACq2B,KACR,CAAC;UAED,IAAI,CAACiE,kBAAkB,EAAE;EACvB5rC,UAAO2T,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,IAANA,MAAM,CAAEH,MAAM,CACnB,wBAAwB,EACxBlf,OAAO,EACPq3C,UAAU,EACVr6B,KAAK,CAACq2B,KACR,CAAC;EACD,UAAA;EACF,QAAA;;EAEA;EACA;UACAr2B,KAAK,CAACq2B,KAAK,GAAGgE,UAAU;UAExB,IAAI,CAACwG,gBAAgB,CAAC79C,OAAO,CAACqkC,WAAW,EAAEgT,UAAU,CAAC7uB,SAAS,CAAC,EAAE;EAChE9c,UAAO2T,MAAM,KAAA,IAAA,IAANA,MAAM,eAANA,MAAM,CAAEH,MAAM,CACnB,0BAA0B,EAC1Blf,OAAO,EACPq3C,UACF,CAAC;EACD,UAAA;EACF,QAAA;UAEArkB,gBAAc,CAAChW,KAAK,CAAC+U,SAAS,EAAE3uB,OAAO,EAAEi0C,UAAU,CAAC;EACtD,MAAA;MACF,CAAC;;EAED;;MAEA,IAAI,CAACwF,kBAAkB,GAAG,CAAC1Q,UAAW,EAAEpB,QAAS,KAC/C6D,sBAAsB,CAACzC,UAAU,CAAC,CAAC9pB,IAAI,CAAEjf,OAAO,IAC9Cy5C,kBAAkB,CAACz5C,OAAO,EAAE2nC,QAAQ,CACtC,CAAC;;EAEH;;EAEA,IAAA,IAAI,CAAC2T,MAAM,GAAG,CAACl2B,SAAS,EAAExoB,OAAO,KAAK;EAAA,MAAA,IAAA2+C,eAAA;EACpC,MAAA,IAAI,CAACvR,sBAAsB,CAAC5kB,SAAS,CAAC,EAAE;EACtC,QAAA,MAAMpc,UAAa,CAAC,CAAA,2BAAA,EAA8Boc,SAAS,GAAG,CAAC;EACjE,MAAA;EAEA,MAAA,MAAMo2B,UAAU,GAAGp2B,SAAS,KAAK1qB,IAAO,IAAI0qB,SAAS,KAAK1qB,MAAS;EACnE,MAAA,MAAM+gD,IAAI,GAAGr2B,SAAS,KAAK1qB,IAAO,IAAI0qB,SAAS,KAAK1qB,MAAS,GAAG,EAAE,GAAG,CAAC;EACtE,MAAA,IAAIghD,gBAAkC;EAEtC,MAAA,MAAM/kB,MAAM,GAAA,CAAA4kB,eAAA,GAAG3+C,OAAO,aAAPA,OAAO,KAAA,MAAA,GAAA,MAAA,GAAPA,OAAO,CAAE+5B,MAAM,MAAA,IAAA,IAAA4kB,eAAA,KAAA,MAAA,GAAAA,eAAA,GAAI,GAAG;QACrC,MAAMI,YAAY,GAAG/+C,OAAO,KAAA,IAAA,IAAPA,OAAO,KAAA,MAAA,GAAA,MAAA,GAAPA,OAAO,CAAE++C,YAAY;QAE1C,IAAIA,YAAY,KAAK,SAAS,EAAE;EAC9BD,QAAAA,gBAAgB,GAAGF,UAAU,GACxBI,EAAE,IACDA,EAAE,CAAClhD,YAAe,CAAC,GAClB+gD,IAAI,GAAG9kB,MAAM,GAAGgU,kBAAkB,CAACiR,EAAE,CAAC,GAAI,GAAG,GAC/CA,EAAE,IACDA,EAAE,CAAClhD,aAAgB,CAAC,GACnB+gD,IAAI,GAAG9kB,MAAM,GAAG4T,iBAAiB,CAACqR,EAAE,CAAC,GAAI,GAAG;;EAEnD;EACF,MAAA,CAAC,MAAM,IAAID,YAAY,KAAK,SAAS,EAAE;UACrCD,gBAAgB,GAAGF,UAAU,GACxBI,EAAE,IACDA,EAAE,CAAClhD,YAAe,CAAC,GAClB+gD,IAAI,GAAG9kB,MAAM,GAAGilB,EAAE,CAAClhD,eAAkB,CAAC,GAAI,GAAG,GAC/CkhD,EAAE,IACDA,EAAE,CAAClhD,aAAgB,CAAC,GACnB+gD,IAAI,GAAG9kB,MAAM,GAAGilB,EAAE,CAAClhD,cAAiB,CAAC,GAAI,GAAG;;EAEnD;QACF,CAAC,MAAM,IAAIihD,YAAY,KAAKt+C,SAAS,IAAIs+C,YAAY,KAAK,OAAO,EAAE;EACjE,QAAA,MAAM3yC,UAAa,CACjB,CAAA,iCAAA,EAAoC2yC,YAAY,GAClD,CAAC;;EAED;EACF,MAAA,CAAC,MAAM;UACLD,gBAAgB,GAAGF,UAAU,GACxBI,EAAE,IAAKA,EAAE,CAAClhD,YAAe,CAAC,GAAG+gD,IAAI,GAAG9kB,MAAM,GAC1CilB,EAAE,IAAKA,EAAE,CAAClhD,aAAgB,CAAC,GAAG+gD,IAAI,GAAG9kB,MAAM;EAClD,MAAA;QAEA,MAAMv4B,MAAM,GAAGo9C,UAAU,GACrB;EAAEj7C,QAAAA,GAAG,EAAEm7C;EAAiB,OAAC,GACzB;EAAEt7C,QAAAA,IAAI,EAAEs7C;SAAkB;EAE9B,MAAA,OAAO,IAAI,CAAC/0C,QAAQ,CAACvI,MAAM,EAAExB,OAAO,CAAC;MACvC,CAAC;;EAED;;EAEA,IAAA,IAAI,CAAC+J,QAAQ,GAAG,OAAO4gB,EAAE,EAAE3qB,OAAO,KAAA;EAAA,MAAA,IAAAqvC,iBAAA;QAAA,OAChCtlC,QAAQ,CACN4gB,EAAE,EACFve,KAAQ,CAACpM,OAAO,EAAE;EAChB4oB,QAAAA,QAAQ,GAAAymB,iBAAA,GAAErvC,OAAO,KAAA,IAAA,IAAPA,OAAO,KAAA,MAAA,GAAA,MAAA,GAAPA,OAAO,CAAE4oB,QAAQ,cAAAymB,iBAAA,KAAA,MAAA,GAAAA,iBAAA,GAAI3xB,MAAM,CAACuhC,eAAe;EAAE;EACvD9S,QAAAA,UAAU,EAAE,MAAMyC,sBAAsB,CAAC5uC,OAAO,KAAA,IAAA,IAAPA,OAAO,KAAA,MAAA,GAAA,MAAA,GAAPA,OAAO,CAAEmsC,UAAU,CAAC;EAC/D,OAAC,CACH,CAAC;EAAA,IAAA,CAAA;;EAEH;;EAEA,IAAA,IAAI,CAAC+S,wBAAwB,GAAI/S,UAAW,IAC1CyC,sBAAsB,CAACzC,UAAU,CAAC,CAAC9pB,IAAI,CAAEjf,OAAO,IAC9C8oC,sBAAsB,CAAC9oC,OAAO,CAChC,CAAC;;EAEH;;EAEA,IAAA,IAAI,CAAC+7C,iBAAiB,GAAG,MAAOn/C,OAAO,IAAK;EAC1C,MAAA,MAAMoD,OAAO,GAAG,MAAMwrC,sBAAsB,CAAC5uC,OAAO,KAAA,IAAA,IAAPA,OAAO,KAAA,MAAA,GAAA,MAAA,GAAPA,OAAO,CAAEmsC,UAAU,CAAC;QACjE,MAAMiT,UAAU,GAAGA,MACjBhzC,UAAa,CAAChJ,OAAO,EAAE;EACrBO,QAAAA,GAAG,EAAEP,OAAO,CAACtF,YAAe,CAAC;EAC7B0F,QAAAA,IAAI,EAAEJ,OAAO,CAACtF,aAAgB;EAChC,OAAC,CAAC;EAEJ,MAAA,IAAIkC,OAAO,KAAA,IAAA,IAAPA,OAAO,eAAPA,OAAO,CAAEq/C,SAAS,EAAE;EACtBD,QAAAA,UAAU,EAAE;EACd,MAAA,CAAC,MAAM;EACLl9B,QAAAA,kBAAkB,EAAE,CAACG,IAAI,CAAC+8B,UAAU,CAAC;EACvC,MAAA;MACF,CAAC;;EAED;;EAEA,IAAA,IAAI,CAACE,WAAW,GAAG,CAACxlC,OAAQ,EAAE9Z,OAAQ,KAAK;QACzC,IAAI,CAAC8Z,OAAO,EAAE;EACZA,QAAAA,OAAO,GAAGikC,iBAAiB;EAC7B,MAAA;EAEA,MAAA,OAAOZ,aAAa,CAACrjC,OAAO,EAAE9Z,OAAO,EAAEw9C,YAAU,CAAC;MACpD,CAAC;;EAED;;EAEA,IAAA,IAAI,CAAC+B,aAAa,GAAG,CAACzlC,OAAQ,EAAEqyB,UAAW,KAAK;QAC9C,IAAI,CAACryB,OAAO,EAAE;EACZA,QAAAA,OAAO,GAAGikC,iBAAiB;EAC7B,MAAA;QAEAD,cAAc,CAAChkC,OAAO,EAAEqyB,UAAU,EAAEqR,YAAU,CAAC,CAAC;MAClD,CAAC;;EAED;;EAEA,IAAA,IAAI,CAACgC,QAAQ,GAAG,CAAC1lC,OAAO,EAAE9Z,OAAQ,KAChCm9C,aAAa,CAACrjC,OAAO,EAAE9Z,OAAO,EAAEy/C,eAAa,CAAC;;EAEhD;;EAEA,IAAA,IAAI,CAACC,SAAS,GAAG,CAAC5lC,OAAO,EAAEqyB,UAAW,KAAK;QACzC2R,cAAc,CAAChkC,OAAO,EAAEqyB,UAAU,EAAEsT,eAAa,CAAC,CAAC;MACrD,CAAC;EACH,EAAA;EACF;;EAEA;EACA;EACA;;EA8BA;EACA;EACA;;EA+FA;EACA;EACA;;EAyBA;EACA;EACA;EACA;EACA;EACA;;EAqCA;;EAyBA,MAAMxvB,iBAA8B,GAAGnyB,MAAS,EAA4B;EAC5E,MAAMwe,WAAS,GAAGlQ,MAAS,EAAyB;EAEpD,MAAM/Q,gBAAc,GAAG+Q,UAAa,CAAC,wBAAwB,CAAC;EAE9D,MAAM4jB,WAAS,GACbtS,MAAuC,IACP;IAChCA,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAANA,MAAM,GAANA,MAAM,GAAK,EAAE;IACb,OAAO;MACLklB,eAAe,EAAE5zB,WAAW,CAAC0O,MAAM,CAAC5f,iBAAoB,CAAC,EAAE,EAAE,CAAC;EAC9D;MACA6hD,gBAAgB,EAAE3wC,WAAW,CAAC0O,MAAM,CAACkiC,eAAe,EAAE,EAAE,CAAC,IAAI,CAAC;EAC9DX,IAAAA,eAAe,EAAEjwC,WAAW,CAAC0O,MAAM,CAACmiC,cAAc,EAAE,IAAI;KACzD;EACH,CAAC;EAED,MAAMJ,eAAa,GAAG,CAAC,CAAC;EACxB,MAAMjC,YAAU,GAAG,CAAC,CAAC;;EAErB;;EAEA,MAAMJ,oBAAoB,GAAG,OAC3B1/B,MAAmC,EACnC1d,OAAwB,KACa;EAAA,EAAA,IAAA22C,qBAAA;EACrC,EAAA,MAAMxhB,UAAU,GACdrf,eAAe,CAAC,YAAY,EAAE9V,OAAO,CAACm1B,UAAU,EAAEiY,sBAAsB,CAAC,IACzE,IAAI;IAEN,MAAMhqC,OAAO,GAAG,MAAMwrC,sBAAsB,CAAC5uC,OAAO,CAACmsC,UAAU,CAAC;IAEhE,OAAO;EACLyK,IAAAA,QAAQ,EAAExzC,OAAO;EACjBk6C,IAAAA,YAAY,EAAEwC,cAAc,CAAC18C,OAAO,CAAC;EACrCihC,IAAAA,WAAW,EAAElP,UAAU;EACvB;EACA4hB,IAAAA,UAAU,EAAE/nC,WAAW,CAAChP,OAAO,CAAC+uC,SAAS,EAAErxB,MAAM,CAACiiC,gBAAgB,CAAC,IAAI,CAAC;EACxE/c,IAAAA,eAAe,EAAA,CAAA+T,qBAAA,GAAE32C,OAAO,CAAClC,iBAAoB,CAAC,cAAA64C,qBAAA,KAAA,MAAA,GAAAA,qBAAA,GAAIj5B,MAAM,CAACklB;KAC1D;EACH,CAAC;EAED,MAAMib,gBAAgB,GAAGA,CACvBkC,cAAwC,EACxCC,eAAgC,KAC7B,CAACD,cAAc,IAAI3zC,QAAW,CAAC2zC,cAAc,EAAEC,eAAe,CAAC;EAEpE,MAAMzI,oBAAoB,GAAGA,CAC3Bv3C,OAAgC,EAChCq3C,UAAsB,EACtBQ,iBAAyC,KAC7B;EACZ,EAAA,MAAM1iB,UAAU,GAAGn1B,OAAO,CAACqkC,WAAW;EACtC,EAAA,MAAM0K,SAAS,GAAG/uC,OAAO,CAAC+2C,UAAU;IACpC,IAAI,CAACc,iBAAiB,EAAE;EACtB;EACA,IAAA,OAAO,KAAK;EACd,EAAA;IAEA,MAAMoI,OAAO,GAAGzwC,MAAM,CACpB6nC,UAAU,CAACv5C,YAAe,CAAC,GAAG+5C,iBAAiB,CAAC/5C,YAAe,CAAC,EAChEu5C,UAAU,CAACv5C,eAAkB,CAAC,GAAG+5C,iBAAiB,CAAC/5C,eAAkB,CAAC,EACtEu5C,UAAU,CAACv5C,eAAkB,CAAC,GAAG+5C,iBAAiB,CAAC/5C,eAAkB,CACvE,CAAC;IAED,MAAMoiD,QAAQ,GAAG1wC,MAAM,CACrB6nC,UAAU,CAACv5C,aAAgB,CAAC,GAAG+5C,iBAAiB,CAAC/5C,aAAgB,CAAC,EAClEu5C,UAAU,CAACv5C,cAAiB,CAAC,GAAG+5C,iBAAiB,CAAC/5C,cAAiB,CAAC,EACpEu5C,UAAU,CAACv5C,cAAiB,CAAC,GAAG+5C,iBAAiB,CAAC/5C,cAAiB,CACrE,CAAC;;EAED;EACA;IACA,IAAIqiD,QAAQ,GAAG,KAAK;EAClBC,IAAAA,SAAS,GAAG,KAAK;IACnB,IACE,CAACjrB,UAAU,IACX/oB,QAAW,CAAC+oB,UAAU,EAAEr3B,MAAS,CAAC,IAClCsO,QAAW,CAAC+oB,UAAU,EAAEr3B,WAAc,CAAC,EACvC;MACAqiD,QAAQ,GAAGC,SAAS,GAAG,IAAI;EAC7B,EAAA,CAAC,MAAM;MACL,IACEh0C,QAAW,CAAC+oB,UAAU,EAAEr3B,IAAO,CAAC,IAChCsO,QAAW,CAAC+oB,UAAU,EAAEr3B,MAAS,CAAC,EAClC;EACAqiD,MAAAA,QAAQ,GAAG,IAAI;EACjB,IAAA;MACA,IACE/zC,QAAW,CAAC+oB,UAAU,EAAEr3B,MAAS,CAAC,IAClCsO,QAAW,CAAC+oB,UAAU,EAAEr3B,OAAU,CAAC,EACnC;EACAsiD,MAAAA,SAAS,GAAG,IAAI;EAClB,IAAA;EACF,EAAA;IAEA,OACGD,QAAQ,IAAIF,OAAO,IAAIlR,SAAS,IAAMqR,SAAS,IAAIF,QAAQ,IAAInR,SAAU;EAE9E,CAAC;EAED,MAAMiO,eAAe,GAAG,OACtB55C,OAAgB,EAChB25C,iBAAyC,EACzChS,QAAiB,KACO;IAAA,IAAAsV,qBAAA,EAAAC,sBAAA;IACxB,IAAI,CAACvV,QAAQ,EAAE;MACb,MAAM7oB,kBAAkB,EAAE;EAC5B,EAAA;EAEA,EAAA,MAAMq+B,SAAS,GAAGn0C,IAAO,CAAChJ,OAAO,CAACtF,YAAe,CAAC,CAAC;EACnD,EAAA,MAAM0iD,UAAU,GAAGp0C,IAAO,CAAChJ,OAAO,CAACtF,aAAgB,CAAC,CAAC;EACrD,EAAA,MAAM2iD,WAAW,GAAGr9C,OAAO,CAACtF,cAAiB,CAAC;EAC9C,EAAA,MAAM+7B,YAAY,GAAGz2B,OAAO,CAACtF,eAAkB,CAAC;EAChD,EAAA,MAAMi3C,WAAW,GAAGpH,iBAAiB,CAACvqC,OAAO,CAAC;EAC9C,EAAA,MAAM4xC,YAAY,GAAGjH,kBAAkB,CAAC3qC,OAAO,CAAC;EAEhD,EAAA,MAAMs9C,iBAAiB,GACrBt0C,KAAQ,CAACm0C,SAAS,CAAC,IAAI1mB,YAAY,GAAGmb,YAAY,IAAIl3C,QAAW,CAAC;EACpE,EAAA,MAAM6iD,kBAAkB,GACtBv0C,KAAQ,CAACo0C,UAAU,CAAC,IAAIC,WAAW,GAAG1L,WAAW,IAAIj3C,QAAW,CAAC;EAEnE,EAAA,MAAM8iD,aAAa,GAAA,CAAAP,qBAAA,GAAGtD,iBAAiB,aAAjBA,iBAAiB,KAAA,MAAA,GAAA,MAAA,GAAjBA,iBAAiB,CAAEwD,SAAS,MAAA,IAAA,IAAAF,qBAAA,KAAA,MAAA,GAAAA,qBAAA,GAAI,CAAC;EACvD,EAAA,MAAMQ,cAAc,GAAA,CAAAP,sBAAA,GAAGvD,iBAAiB,aAAjBA,iBAAiB,KAAA,MAAA,GAAA,MAAA,GAAjBA,iBAAiB,CAAEyD,UAAU,MAAA,IAAA,IAAAF,sBAAA,KAAA,MAAA,GAAAA,sBAAA,GAAI,CAAC;IAEzD,MAAM93B,SAAS,GAAGmM,oBAAoB,CACpC6rB,UAAU,GAAGK,cAAc,EAC3BN,SAAS,GAAGK,aACd,CAAC;IAED,OAAO;MACLp4B,SAAS;EACT,IAAA,CAAC1qB,cAAiB,GAAGi3C,WAAW;EAChC,IAAA,CAACj3C,eAAkB,GAAGk3C,YAAY;EAClC,IAAA,CAACl3C,cAAiB,GAAG2iD,WAAW;EAChC,IAAA,CAAC3iD,eAAkB,GAAG+7B,YAAY;EAClC,IAAA,CAAC/7B,YAAe,GAAGyiD,SAAS;EAC5B,IAAA,CAACziD,qBAAwB,GAAG4iD,iBAAiB;EAC7C,IAAA,CAAC5iD,aAAgB,GAAG0iD,UAAU;MAC9B,CAAC1iD,sBAAyB,GAAG6iD;KAC9B;EACH,CAAC;EAED,MAAM5C,iBAAiB,GAAGA,CACxB36C,OAAgB,EAChBm6C,UAAkD,KAC/C;IACH,IAAIlxB,MAAM,GAAG,EAAE;EACf,EAAA,IAAIjpB,OAAO,KAAKirC,2BAA2B,EAAE,EAAE;EAC7C;EACAjrC,IAAAA,OAAO,GAAGgJ,aAAgB,EAAE;EAC5BigB,IAAAA,MAAM,GAAG,OAAO;EAClB,EAAA;IAEAkxB,UAAU,KAAA,IAAA,IAAVA,UAAU,KAAA,MAAA,GAAVA,UAAU,GAAVA,UAAU,GAAK,EAAE;EACjB,EAAA,MAAMl0B,KAAK,GAAG;MACZ,CAACvrB,YAAe,GAAGy/C,UAAU,CAACz/C,YAAe,CAAC;MAC9C,CAACA,qBAAwB,GAAGy/C,UAAU,CAACz/C,qBAAwB,CAAC;MAChE,CAACA,aAAgB,GAAGy/C,UAAU,CAACz/C,aAAgB,CAAC;MAChD,CAACA,sBAAyB,GAAGy/C,UAAU,CAACz/C,sBAAyB,CAAC;MAClE,CAACA,cAAiB,GAAGy/C,UAAU,CAACz/C,cAAiB,CAAC;MAClD,CAACA,eAAkB,GAAGy/C,UAAU,CAACz/C,eAAkB;KACpD;EACDmsB,EAAAA,qBAAqB,CAAC7mB,OAAO,EAAEimB,KAAK,EAAE;EAAEI,IAAAA,OAAO,EAAE4C;EAAO,GAAC,CAAC;EAC5D,CAAC;EAED,MAAMyzB,cAAc,GAAI18C,OAAgB,IAAmB;EACzD,EAAA,IAAIA,OAAO,KAAKgJ,sBAAyB,EAAE,EAAE;EAC3C,IAAA,OAAOA,MAAS,EAAE;EACpB,EAAA;EAEA,EAAA,OAAOhJ,OAAO;EAChB,CAAC;EAED,MAAM4vB,gBAAc,GAAGA,CACrBpzB,QAA0B,EAC1BwD,OAAgB,EAChBm6C,UAAsB,KACnB39C,QAAQ,CAAC0gB,MAAM,CAACld,OAAO,EAAEgJ,UAAa,CAACmxC,UAAU,CAAC,CAAC,CAAC7oB,KAAK,CAAC9S,QAAQ,CAAC;;EC9pCxE;EACA;EACA;;;EAWA;EACA;EACA;EACA;EACA;EACO,MAAMk/B,mBAAmB,GAAIpV,MAAc,IAChDA,MAAM,CAAC7oC,KAAK,CAACk+C,YAAY,CAAC,KAAK,IAAI;;EAErC;EACA;EACA;EACA;EACA;EACO,MAAMC,WAAW,GAAIC,IAAY,IACtC70C,QAAW,CAAC80C,KAAK,EAAED,IAAI,CAAC;;EAE1B;EACA;EACA;EACA;EACA;EACO,MAAME,eAAe,GAAIC,KAAwB,IACtDzrC,cAAc,CAACyrC,KAAK,EAAEJ,WAAW,EAAE,KAAK,CAAC;;EAE3C;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMK,gBAAgB,GAC3BD,KAAuC,IAC5B;IACX,IAAI,CAACA,KAAK,EAAE;EACV,IAAA,MAAMh1C,UAAa,CAAC,yBAAyB,CAAC;EAChD,EAAA;EAEA,EAAA,MAAMyL,OAAO,GAAGypC,eAAe,CAACF,KAAK,CAAC;IACtC,IAAInZ,eAAe,GAAGsZ,WAAW,CAAC1pC,OAAO,GAAG,CAACA,OAAO,CAAC;;EAErD;EACA;EACA;EACA;EACA,EAAA,IAAIA,OAAO,KAAK0pC,WAAW,CAACxpC,GAAG,CAACypC,EAAE,EAAE;EAClC;MACA,IAAI,EAAE3pC,OAAO,GAAG0pC,WAAW,CAACxpC,GAAG,CAAC0pC,KAAK,CAAC,EAAE;EACtCxZ,MAAAA,eAAe,IAAI,CAACsZ,WAAW,CAACxpC,GAAG,CAAC2pC,KAAK;EAC3C,IAAA;MAEA,IAAI,EAAE7pC,OAAO,GAAG0pC,WAAW,CAACxpC,GAAG,CAAC2pC,KAAK,CAAC,EAAE;EACtCzZ,MAAAA,eAAe,IAAI,CAACsZ,WAAW,CAACxpC,GAAG,CAAC0pC,KAAK;EAC3C,IAAA;MAEA,IAAI,EAAE5pC,OAAO,GAAG0pC,WAAW,CAACxpC,GAAG,CAACvU,IAAI,CAAC,EAAE;EACrCykC,MAAAA,eAAe,IAAI,CAACsZ,WAAW,CAACxpC,GAAG,CAACtU,KAAK;EAC3C,IAAA;MAEA,IAAI,EAAEoU,OAAO,GAAG0pC,WAAW,CAACxpC,GAAG,CAACtU,KAAK,CAAC,EAAE;EACtCwkC,MAAAA,eAAe,IAAI,CAACsZ,WAAW,CAACxpC,GAAG,CAACvU,IAAI;EAC1C,IAAA;EACF,EAAA;IAEA,OAAOm+C,mBAAmB,CAAC1Z,eAAe,CAAC;EAC7C,CAAC;;EAED;EACA;EACA;EACA;EACO,MAAMqZ,eAAe,GAC1BM,QAAqC,IAC1B;IACX,IAAIC,YAAY,GAAG,CAAC;IACpB,MAAMT,KAAK,GAAGtrC,eAAe,CAAC,OAAO,EAAE8rC,QAAQ,EAAEZ,WAAW,CAAC;EAE7D,EAAA,IAAII,KAAK,EAAE;EACT,IAAA,KAAK,MAAM5gD,CAAC,IAAI4gD,KAAK,EAAE;EACrB,MAAA,IAAI,CAACJ,WAAW,CAACxgD,CAAC,CAAC,EAAE;EACnB,QAAA,MAAM4L,UAAa,CAAC,CAAA,cAAA,EAAiB5L,CAAC,GAAG,CAAC;EAC5C,MAAA;EAEAqhD,MAAAA,YAAY,IAAIN,WAAW,CAACxpC,GAAG,CAACvX,CAAC,CAAC;EACpC,IAAA;EACF,EAAA,CAAC,MAAM;EACLqhD,IAAAA,YAAY,GAAGN,WAAW,CAAC1pC,OAAO,CAAC;EACrC,EAAA;EAEA,EAAA,OAAOgqC,YAAY;EACrB,CAAC;;EAED;EACA;EACA;EACA;EACO,MAAMC,iBAAiB,GAAInuC,KAAa,IAAK;EAClD,EAAA,MAAM9Q,KAAK,GAAG8Q,KAAK,CAAC9Q,KAAK,CAACk+C,YAAY,CAAC;IACvC,IAAI,CAACl+C,KAAK,EAAE;EACV,IAAA,MAAMuJ,UAAa,CAAC,CAAA,iBAAA,EAAoBuH,KAAK,GAAG,CAAC;EACnD,EAAA;EAEA,EAAA,MAAMouC,SAAS,GAAGl/C,KAAK,CAAC,CAAC,CAAC;EAC1B,EAAA,MAAMyB,KAAK,GAAGzB,KAAK,CAAC,CAAC,CAAC;;EAEtB,EAAA,IAAI,CAACk/C,SAAS,IAAI,CAACz9C,KAAK,EAAE;EACxB,IAAA,MAAM8H,QAAW,CAAC,oCAAoC,CAAC;EACzD,EAAA;IAEA,OAAO;MAAE21C,SAAS;EAAEz9C,IAAAA;KAAO;EAC7B,CAAC;EAED,MAAM48C,KAAa,GAAG,CACpBpjD,IAAO,EACPA,OAAU,EACVA,OAAU,EACVA,MAAS,EACTA,OAAU,CACF;;EAEV;EACA;EACA;EACA;EACO,MAAMyjD,WAAW,GAAG5pC,cAAc,CAAOD,YAAY,EAAE,EAAE,GAAGwpC,KAAK,CAAC;;EAEzE;;EAEA;EACA,MAAMH,YAAY,GAAGhhC,MAAM,CAAC,oCAAoC,CAAC;EAEjE,MAAM4hC,mBAAmB,GAAI9pC,OAAe,IAAa;IACvD,MAAMupC,KAAa,GAAG,EAAE;EACxB,EAAA,KAAK,IAAIrpC,GAAG,GAAGwpC,WAAW,CAACtvC,KAAK,EAAE8F,GAAG,IAAIwpC,WAAW,CAACrvC,GAAG,EAAE6F,GAAG,EAAE,EAAE;EAC/D,IAAA,MAAMzT,KAAK,GAAG,CAAC,IAAIyT,GAAG;MACtB,IAAIF,OAAO,GAAGvT,KAAK,EAAE;EACnB,MAAA,MAAMxH,IAAI,GAAGykD,WAAW,CAAChpC,MAAM,CAACjU,KAAK,CAAC;EACtC,MAAA,IAAIxH,IAAI,EAAE;EACRskD,QAAAA,KAAK,CAACptC,IAAI,CAAClX,IAAI,CAAC;EAClB,MAAA;EACF,IAAA;EACF,EAAA;EAEA,EAAA,OAAOskD,KAAK;EACd,CAAC;;ECvND;EACA;EACA;;EASA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMY,qBAAqB,CAAC;EACjC;EACF;EACA;;EAGE;EACF;EACA;;EAGE;EACF;EACA;;EAGE;EACF;EACA;EACA;;EAGE;EACF;EACA;EACA;;EAGE;EACF;EACA;EACA;;EAGE;EACF;EACA;;EAGE;EACF;EACA;;EAGEplD,EAAAA,WAAWA,CACTgD,QAAuC,EACvCw5C,cAAyC,EACzC;EACA,IAAA,IAAI/D,eAAe,GAAGjpC,UAAa,EAAW;EAC9C,IAAA,MAAMgpC,aAAa,GAAGhpC,UAAa,EAAW;MAE9C,MAAM4sC,mBAAmB,GAAI7uC,OAAoC,IAAK;QACpE,MAAM83C,eAAe,GAAG,EAAE;EAE1B,MAAA,KAAK,MAAMjlC,KAAK,IAAI7S,OAAO,EAAE;UAC3B,IAAIirC,aAAa,CAACp9B,GAAG,CAAC5L,QAAW,CAAC4Q,KAAK,CAAC,CAAC,EAAE;YACzC5Q,SAAY,CAACgpC,aAAa,EAAEhpC,QAAW,CAAC4Q,KAAK,CAAC,CAAC;EAC/C,UAAA;EACF,QAAA;EAEAilC,QAAAA,eAAe,CAACjuC,IAAI,CAACgJ,KAAK,CAAC;EAC7B,MAAA;EAEA,MAAA,IAAI5Q,QAAW,CAAC61C,eAAe,CAAC,EAAE;EAChCriD,QAAAA,QAAQ,CAACqiD,eAAe,EAAE,IAAI,CAAC;EACjC,MAAA;MACF,CAAC;MAED,MAAMjzB,QAAQ,GAAG5iB,uBAA0B,CACzC4sC,mBAAmB,EACnBI,cACF,CAAC;EAEDhtC,IAAAA,cAAiB,CAAC,IAAI,EAAE,MAAM,EAAE;EAAEmL,MAAAA,GAAG,EAAEA,MAAMyX,QAAQ,CAAChyB;EAAK,KAAC,CAAC;EAC7DoP,IAAAA,cAAiB,CAAC,IAAI,EAAE,YAAY,EAAE;EACpCmL,MAAAA,GAAG,EAAEA,MAAMyX,QAAQ,CAACqqB;EACtB,KAAC,CAAC;EACFjtC,IAAAA,cAAiB,CAAC,IAAI,EAAE,YAAY,EAAE;EACpCmL,MAAAA,GAAG,EAAEA,MAAMyX,QAAQ,CAACkzB;EACtB,KAAC,CAAC;EAEF,IAAA,IAAI,CAACjzB,OAAO,GAAG,CAAC,GAAG0mB,OAAO,KAAK;EAC7B,MAAA,KAAK,MAAMn0C,MAAM,IAAIm0C,OAAO,EAAE;EAC5BN,QAAAA,eAAe,CAACv0B,GAAG,CAACtf,MAAM,CAAC;EAC3BwtB,QAAAA,QAAQ,CAACC,OAAO,CAACztB,MAAM,CAAC;EAC1B,MAAA;MACF,CAAC;EAED,IAAA,IAAI,CAACo0C,YAAY,GAAG,CAAC,GAAGD,OAAO,KAAK;EAClC,MAAA,KAAK,MAAMn0C,MAAM,IAAIm0C,OAAO,EAAE;EAC5B;EACA;EACA,QAAA,IAAIN,eAAe,CAACr9B,GAAG,CAACxW,MAAM,CAAC,EAAE;EAC/B,UAAA;EACF,QAAA;EAEA4zC,QAAAA,aAAa,CAACt0B,GAAG,CAACtf,MAAM,CAAC;EACzB,QAAA,IAAI,CAACytB,OAAO,CAACztB,MAAM,CAAC;EACtB,MAAA;MACF,CAAC;EAED,IAAA,IAAI,CAACq0C,SAAS,GAAG,CAAC,GAAGF,OAAO,KAAK;EAC/B,MAAA,KAAK,MAAMn0C,MAAM,IAAIm0C,OAAO,EAAE;EAC5BvpC,QAAAA,SAAY,CAACipC,eAAe,EAAE7zC,MAAM,CAAC;EACrCwtB,QAAAA,QAAQ,CAAC6mB,SAAS,CAACr0C,MAAM,CAAC;EAC5B,MAAA;MACF,CAAC;MAED,IAAI,CAACub,UAAU,GAAG,MAAM;EACtBs4B,MAAAA,eAAe,GAAGjpC,UAAa,EAAE;QACjC4iB,QAAQ,CAACjS,UAAU,EAAE;MACvB,CAAC;MAED,IAAI,CAAC2V,WAAW,GAAG,MAAM1D,QAAQ,CAAC0D,WAAW,EAAE;EACjD,EAAA;EACF;;ECrIA;EACA;EACA;;;EA4CA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMyvB,WAAW,CAAC;EACvB;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAOE;EACF;EACA;EACA;EACA;EACA;;EAGE;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAOE;EACF;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;IACE,OAAO/qC,MAAMA,CAACsG,MAA0B,EAAE;MACxC,OAAO,IAAIykC,WAAW,CAACnyB,SAAS,CAACtS,MAAM,CAAC,EAAEuS,eAAe,CAAC;EAC5D,EAAA;;EAEA;EACF;EACA;EACA;EACA;EACA;EACA;IACE,OAAO/S,KAAKA,CAACQ,MAA0B,EAAE;EAAA,IAAA,IAAAxB,cAAA;EACvC,IAAA,MAAM2B,QAAQ,GAAGmS,SAAS,CAACtS,MAAM,CAAC;EAClC,IAAA,MAAMwS,YAAY,GAAG9a,WAAW,CAAC9C,QAAQ,CAACuL,QAAQ,EAAE;EAAEsS,MAAAA,KAAK,EAAE;EAAK,KAAC,CAAC,CAAC;MAErE,IAAI9T,QAAQ,IAAAH,cAAA,GAAGI,WAAS,CAAC/E,GAAG,CAACsG,QAAQ,CAACsS,KAAK,CAAC,MAAA,IAAA,IAAAjU,cAAA,KAAA,MAAA,GAAA,MAAA,GAA7BA,cAAA,CAA+B3E,GAAG,CAAC2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A;EACA;EACA;EACA;;EAiBA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAME,QAAQ,CAAmB;EACtC;EACF;EACA;;EAGE;EACF;EACA;EACA;;EAGE;EACF;EACA;EACA;EACA;;IAGE,OAAOvH,QAAQA,GAAG;MAChBP,cAAc,CACZ,WAAW,EACX,CAAC5lD,OAAO,EAAEoQ,IAAI,EAAEkK,MAAM,KAAK;QACzB,MAAMguB,MAAM,GAAGhuB,MAAM,GACjB;UACEla,IAAI,EAAEka,MAAM,CAACqzC,OAAO;UACpBptD,GAAG,EAAE+Z,MAAM,CAACszC;EACd,OAAC,GACDvwD,SAAS;EAEb,MAAA,OAAO,IAAIqwD,QAAQ,CAAC1tD,OAAO,EAAE;UAC3BsoC,MAAM;EACN9iB,QAAAA,QAAQ,EAAElL,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEkL,QAAQ;EAC1BujB,QAAAA,UAAU,EAAEzuB,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEyuB;EACtB,OAAC,CAAC;MACJ,CAAC,EACD8kB,oBACF,CAAC;EACH,EAAA;EAEAr0D,EAAAA,WAAWA,CAACwG,OAAgB,EAAEsa,MAAuB,EAAE;EACrD,IAAA,MAAMwzC,OAAO,GAAGxU,aAAa,CAACx/B,KAAK,EAAE;MACrC,MAAM;EAAEivB,MAAAA;OAAY,GAAGzuB,MAAM,KAAA,IAAA,IAANA,MAAM,cAANA,MAAM,GAAI,EAAE;MACnC,IAAIkjC,aAAa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9O,SAAS;EAAA,IAAA;KACzB;EACH,CAAC;;ECpPD;EACA;EACA;EACA;EACA;EACA;;EAaA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAM6wD,YAAY,CAAmB;EAC1C;EACF;EACA;;EAGE;EACF;EACA;;EAGE;EACF;EACA;;IAGE,OAAO/H,QAAQA,GAAG;MAChBP,cAAc,CACZ,eAAe,EACf,CAAC5lD,OAAO,EAAEoQ,IAAI,EAAEkK,MAAM,KAAK;EACzB,MAAA,OAAO,IAAI4zC,YAAY,CAACluD,OAAO,EAAE;UAAE,CAACoQ,IAAI,CAAC,CAAC,CAAC,GAAGkK,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAANA,MAAM,GAAI;EAAG,OAAC,CAAC;MAC/D,CAAC,EACDmqC,iBACF,CAAC;EACH,EAAA;EAEAjrD,EAAAA,WAAWA,CAACwG,OAAgB,EAAEoxB,UAAsB,EAAE;MACpD,IAAI,CAACA,UAAU,EAAE;EACf,MAAA,MAAMpoB,UAAa,CAAC,yBAAyB,CAAC;EAChD,IAAA;MAEA,IAAImlD,IAAI,GAAG,KAAK;EAEhB,IAAA,MAAMC,QAAQ,GAAG,MAAO30C,EAAW,IAAK;EACtC00C,MAAAA,IAAI,GAAG10C,EAAE;QAET,MAAMkF,iBAAiB,EAAE;EAEzB,MAAA,KAAK,MAAM0S,IA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c,CAACt3C,KAAK,EAAE;EACxB,IAAA,CAAC,CAAC;MAEF,MAAM;QAAEre,IAAI;QAAEq2D,SAAS;QAAEzC,QAAQ;EAAEoC,MAAAA;OAAc,GAAGO,aAAa,CAC/D,IAAI,EACJnwD,OAAO,EACPmvD,UACF,CAAC;EACH,EAAA;EACF;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EA8EA;EACA;EACA;;EAkGA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMiB,WAAW,SAASlB,QAAQ,CAAC;IACxC,OAAO/I,QAAQA,GAAG;EAChB6I,IAAAA,gBAAgB,CACdqB,uBAAuB,EA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EACA;EACA;;EAwHA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMC,KAAK,SAASzC,QAAQ,CAAC;IAClC,OAAO/I,QAAQA,GAAG;EAChB6I,IAAAA,gBAAgB,CACd4C,iBAAiB,EACjB,CAAChW,EAAE,EAAEthC,MAAM,KAAK,IAAIq3C,KAAK,CAAC/V,EAAE,EAAEthC,MAAM,CAAC,EACrCu3C,oBACF,CAAC;EACH,EAAA;EAEAr4D,EAAAA,WAAWA,CAACwG,OAAoB,EAAEsa,MAAoB,EAAE;MAAA,IAAAw3C,kBAAA,EAAAC,mBAAA;MACtD,KAAK,CAAC/xD,OAAO,EAAE;EACbtG,MAAAA,IAAI,EAAEk4D,iBAAiB;EACvB7wD,MAAAA,EAAE,EAAEuZ,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEvZ,EAAE;EACd+gB,MAAAA,SAAS,EAAExH,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEwH,SAAS;EAC5BivC,MAAAA,SAAS,EAAA,CAAAe,kBAAA,GAAEx3C,MAAM,aAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEy2C,SAAS,MAAA,IAAA,IAAAe,kBAAA,KAAA,MAAA,GAAAA,kBAAA,GAAI,IAAI;EACpC1C,MAAAA,OAAO,EAAE,KAAK;EACdC,MAAAA,WAAW,EAAE,KAAK;EAClB2B,MAAAA,WAAW,EAAA,CAAAe,mBAAA,GAAEz3C,MAAM,aAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAE02C,WAAW,MAAA,IAAA,IAAAe,mBAAA,KAAA,MAAA,GAAAA,mBAAA,GAAI,KAAK;EACzCvE,MAAAA,QAAQ,EAAElzC,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEkzC;EACpB,KAAC,CAAC;EAEF,IAAA,MAAM5zD,IAAI,GAAG,IAAI,CAACm2D,OAAO,EAAE;EAC3B,IAAA,MAAME,SAAS,GAAG,IAAI,CAACD,YAAY,EAAE;MAErC,MAAMnnC,QAAQ,GAAG,CAAAvO,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEuO,QAAQ,KAAImpC,MAAM;MAC3C,IAAInpC,QAAQ,KAAKmpC,MAAM,EAAE;QACvB5uC,OAAO,CAACxpB,IAAI,EAAEc,YAAe,EAAEmuB,QAAQ,CAAC;EAC1C,IAAA;EAEA,IAAA,IAAIonC,SAAS,IAAIpnC,QAAQ,KAAKmpC,MAAM,EAAE;EACpC;QACA,IAAI,CAACnC,MAAM,CAAC,YAAY;EACtB,QAAA,MAAM,CAACoC,WAAW,EAAEC,aAAa,CAAC,GAAG,MAAMlpD,UAAa,CAAC,CACvD0pC,WAAW,CAAC54B,KAAK,EAAE,CAACg5B,gBAAgB,CAAC9yC,OAAO,CAAC,EAC7C++C,WAAW,CAACjlC,KAAK,EAAE,CAAColC,gBAAgB,CAAC+Q,SAAS,CAAC,CAChD,CAAC;UAEF,MAAMkC,SAAS,GAAG,MAAMC,mBAAmB,CAACH,WAAW,EAAEC,aAAa,CAAC;EACvE,QAAA,IAAIC,SAAS,EAAE;YACb,MAAM/uC,OAAO,CAACxpB,IAAI,EAAEc,YAAe,EAAEy3D,SAAS,CAAC;EACjD,QAAA;EACF,MAAA,CAAC,CAAC;EACJ,IAAA;EACF,EAAA;EACF;;EAEA;EACA;EACA;;EA0EA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAME,KAAK,SAASnD,QAAQ,CAAC;IAClC,OAAO/I,QAAQA,GAAG;EAChB6I,IAAAA,gBAAgB,CACdsD,iBAAiB,EACjB,CAAC1W,EAAE,EAAEthC,MAAM,KAAK,IAAI+3C,KAAK,CAACzW,EAAE,EAAEthC,MAAM,CAAC,EACrCi4C,oBACF,CAAC;EACH,EAAA;EAEA/4D,EAAAA,WAAWA,CAACwG,OAAoB,EAAEsa,MAAoB,EAAE;MAAA,IAAAk4C,kBAAA,EAAAC,oBAAA;MACtD,KAAK,CAACzyD,OAAO,EAAE;EACbtG,MAAAA,IAAI,EAAE44D,iBAAiB;EACvBvxD,MAAAA,EAAE,EAAEuZ,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEvZ,EAAE;EACd+gB,MAAAA,SAAS,EAAExH,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEwH,SAAS;EAC5BivC,MAAAA,SAAS,EAAA,CAAAyB,kBAAA,GAAEl4C,MAAM,aAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEy2C,SAAS,MAAA,IAAA,IAAAyB,kBAAA,KAAA,MAAA,GAAAA,kBAAA,GAAI,IAAI;EACpCpD,MAAAA,OAAO,EAAE,IAAI;EACbC,MAAAA,WAAW,EAAE,IAAI;EACjB2B,MAAAA,WAAW,EAAA,CAAAyB,oBAAA,GAAEn4C,MAAM,aAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAE02C,WAAW,MAAA,IAAA,IAAAyB,oBAAA,KAAA,MAAA,GAAAA,oBAAA,GAAI,IAAI;EACxCjF,MAAAA,QAAQ,EAAElzC,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEkzC;EACpB,KAAC,CAAC;EACJ,EAAA;EACF;;EAEA;EACA;EACA;;EAiEA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;E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AK,CAAC;EAC3C,IAAA,IAAI,CAAC3b,QAAW,CAAC,GAAG,MAAMm+D,aAAa,CAAC55C,IAAI,CAACsD,MAAM,CAAC;EACtD,EAAA;EACF;;EC/DA;EACA;EACA;;;EA+DA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMu2C,KAAK,SAASvV,MAAM,CAAC;EAChC;EACF;EACA;EACA;EACA;EACA;;EAGE;EACF;EACA;EACA;EACA;EACA;;EAGE;EACF;EACA;EACA;EACA;;EAGE;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAGE;EACF;EACA;;EAGE;EACF;EACA;EACA;;EAGE;EACF;EACA;EACA;;EAGE;EACF;EACA;;EAGE;EACF;EACA;EACA;EACA;EACA;;EAGE;EACF;EACA;;EAGE;EACF;EACA;EACA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ACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAwBA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMymE,YAAY,SAASnZ,OAAO,CAAC;IAGxC,OAAOxE,QAAQA,GAAG;MAChByE,eAAe,CACblwD,OAAU,EACV,CAACsF,OAAO,EAAEoQ,IAAI,EAAEsnC,OAAO,EAAEp9B,MAAM,KAC7B,IAAIwpD,YAAY,CAAC9jE,OAAO,EAAE03C,OAAO,EAAEp9B,MAAM,CAAC,EAC5CuzC,oBACF,CAAC;EACH,EAAA;;EAEA;EACF;EACA;EACA;EACA;EACA;EACEr0D,EAAAA,WAAWA,CACTwG,OAAgB,EAChB03C,OAAiB,EACjBp9B,MAA6B,EAC7B;EACA,IAAA,KAAK,CAACta,OAAO,EAAE03C,OAAO,EAAEp9B,MAAM,CAAC;MAC/B,IAAI,CAACsS,SAAS,GAAG,MAAM5jB,UAAa,CAACsR,MAAM,CAAC;EAE5CypD,IAAAA,YAAY,CAAC,IAAI,EAAE/jE,OAAO,EAAE03C,OAAO,EAAEp9B,MAAM,EAAE5f,OAAU,CAAC;EAC1D,EAAA;EACF;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMspE,YAAY,SAASrZ,OAAO,CAAC;IAGxC,OAAOxE,QAAQA,GAAG;MAChByE,eAAe,CACblwD,OAAU,EACV,CAACsF,OAAO,EAAEoQ,IAAI,EAAEsnC,OAAO,EAAEp9B,MAAM,KAC7B,IAAI0pD,YAAY,CAAChkE,OAAO,EAAE03C,OAAO,EAAEp9B,MAAM,CAAC,EAC5CuzC,oBACF,CAAC;EACH,EAAA;;EAEA;EACF;EACA;EACA;EACA;EACA;EACEr0D,EAAAA,WAAWA,CACTwG,OAAgB,EAChB03C,OAAiB,EACjBp9B,MAA6B,EAC7B;EACA,IAAA,KAAK,CAACta,OAAO,EAAE03C,OAAO,EAAEp9B,MAAM,CAAC;MAC/B,IAAI,CAACsS,SAAS,GAAG,MAAM5jB,UAAa,CAACsR,MAAM,CAAC;EAE5CypD,IAAAA,YAAY,CAAC,IAAI,EAAE/jE,OAAO,EAAE03C,OAAO,EAAEp9B,MAAM,EAAE5f,OAAU,CAAC;EAC1D,EAAA;EACF;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMupE,YAAY,SAAStZ,OAAO,CAAC;IAGxC,OAAOxE,QAAQA,GAAG;MAChByE,eAAe,CACblwD,OAAU,EACV,CAACsF,OAAO,EAAEoQ,IAAI,EAAEsnC,OAAO,EAAEp9B,MAAM,KAC7B,IAAI2pD,YAAY,CAACjkE,OAAO,EAAE03C,OAAO,EAAEp9B,MAAM,CAAC,EAC5CuzC,oBACF,CAAC;EACH,EAAA;;EAEA;EACF;EACA;EACA;EACA;EACA;EACEr0D,EAAAA,WAAWA,CACTwG,OAAgB,EAChB03C,OAAiB,EACjBp9B,MAA6B,EAC7B;EACA,IAAA,KAAK,CAACta,OAAO,EAAE03C,OAAO,EAAEp9B,MAAM,CAAC;MAC/B,IAAI,CAACsS,SAAS,GAAG,MAAM5jB,UAAa,CAACsR,MAAM,CAAC;EAE5CypD,IAAAA,YAAY,CAAC,IAAI,EAAE/jE,OAAO,EAAE03C,OAAO,EAAEp9B,MAAM,EAAE5f,OAAU,CAAC;EAC1D,EAAA;EACF;;EAEA;EACA;EACA;EACA;;EAwBA;;EAEA,MAAMmzD,oBAAmE,GACvE7tD,OAAO,IACJ;IACH,OAAO;EACL5B,IAAAA,MAAM,EAAEA,CAACgI,GAAG,EAAElF,KAAK,KAAA;EAAA,MAAA,IAAAiL,IAAA;QAAA,OAAA,CAAAA,IAAA,GAChBnD,eAAkB,CAAC9H,KAAK,CAAC,GACtB6oD,uBAAuB,CAAC7oD,KAAK,EAAElB,OAAO,CAAC,GACvC,IAAI,cAAAmM,IAAA,KAAA,MAAA,GAAAA,IAAA,GAAK9O,SAAS;EAAA,IAAA,CAAA;EACxByF,IAAAA,cAAc,EAAEqQ,eAAe;EAC/B+gB,IAAAA,aAAa,EAAE/gB;KAChB;EACH,CAAC;EAED,MAAM4wD,YAAY,GAAGA,CACnBpe,MAAkD,EAClD3lD,OAAgB,EAChB03C,OAAiB,EACjBp9B,MAAwC,EACxCyjB,MAAmC,KAChC;EAAA,EAAA,IAAAiqB,YAAA;EACH,EAAA,IAAI,CAACh/C,QAAW,CAAC0uC,OAAO,CAAC,EAAE;EACzB,IAAA;EACF,EAAA;IAEAp9B,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAANA,MAAM,GAANA,MAAM,GAAK,EAAE;EACb,EAAA,MAAMlc,MAAM,GAAA,CAAA4pD,YAAA,GAAGh/C,QAAW,CAACsR,MAAM,CAAC,MAAA,IAAA,IAAA0tC,YAAA,KAAA,MAAA,GAAAA,YAAA,GAAIhoD,OAAO;;EAE7C;EACA;EACA;EACA,EAAA,IAAI63C,YAA8B;EAClC,EAAA,IAAIC,UAA4B;EAChC,EAAA,IAAI/Z,MAAM,KAAKrjC,OAAU,EAAE;MACzBm9C,YAAY,GAAGC,UAAU,GAAG6N,MAAM,CAACjrD,QAAW,CAAC;EACjD,EAAA,CAAC,MAAM;MACLm9C,YAAY,GAAG8N,MAAM,CAAC8F,GAAG;MACzB3T,UAAU,GAAG6N,MAAM,CAAC2B,OAAO;EAC7B,EAAA;EAEA3P,EAAAA,cAAc,CAAC79B,KAAK,EAAE,CAACq+B,SAAS,CAC9B/5C,MAAM,EACNy5C,YAAY,EACZC,UAAU,EACV9uC,KAAQ,CACN;EACE0uC,IAAAA,OAAO,EAAE3Z;EACX,GAAC,EACD7uB,QAAQ,CAACoL,MAAM,EAAE;EAAElc,IAAAA,MAAM,EAAE;KAAM,CACnC,CACF,CAAC;EACH,CAAC;;EC5bD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAgCA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAM8lE,aAAa,SAASvZ,OAAO,CAAC;IAGzC,OAAOxE,QAAQA,GAAG;MAChByE,eAAe,CACb,QAAQ,EACR,CAAC5qD,OAAO,EAAEoQ,IAAI,EAAEsnC,OAAO,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;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAM2qE,WAAW,SAAS5Z,OAAO,CAAC;IAGvC,OAAOxE,QAAQA,GAAG;MAChByE,eAAe,CACb,MAAM,EACN,CAAC5qD,OAAO,EAAEoQ,IAAI,EAAEsnC,OAAO,EAAEp9B,MAAM,KAC7B,IAAIiqD,WAAW,CAACvkE,OAAO,EAAE03C,OAAO,EAAEp9B,MAAM,CAC5C,CAAC;EACH,EAAA;;EAEA;EACF;EACA;EACA;EACA;EACA;EACE9gB,EAAAA,WAAWA,CAACwG,OAAgB,EAAE03C,OAAiB,EAAEp9B,MAAqB,EAAE;EACtE,IAAA,KAAK,CAACta,OAAO,EAAE03C,OAAO,EAAEp9B,MAAM,CAAC;MAC/B,IAAI,CAACsS,SAAS,GAAG,MAAM5jB,UAAa,CAACsR,MAAM,CAAC;EAE5C,IAAA,IAAI,CAACtR,QAAW,CAAC0uC,OAAO,CAAC,EAAE;EACzB,MAAA;EACF,IAAA;MAEAnrB,gBAAgB,EAAE,CAACtN,IAAI,CAAC,IAAI,CAACwsC,GAAG,CAAC;EACnC,EAAA;EACF;;ECnFA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EA8BA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAM+Y,aAAa,SAAS7Z,OAAO,CAAC;IAGzC,OAAOxE,QAAQA,GAAG;EAChByE,IAAAA,eAAe,CACblwD,QAAW,EACX,CAACsF,OAAO,EAAEoQ,IAAI,EAAEsnC,OAAO,EAAEp9B,MAAM,KAAK;EAClC,MAAA,OAAO,IAAIkqD,aAAa,CACtBxkE,OAAO,EACP03C,OAAO,EACP1uC,MAAS,CAACsR,MAAM,EAAE;EAChByX,QAAAA,UAAU,EAAErf,eAAe,CAAC,YAAY,EAAEtC,IAAI,EAAE6hB,kBAAkB;EACpE,OAAC,CACH,CAAC;MACH,CAAC,EACD47B,oBACF,CAAC;EACH,EAAA;;EAEA;EACF;EACA;EACA;EACA;EACA;EACEr0D,EAAAA,WAAWA,CACTwG,OAAgB,EAChB03C,OAAiB,EACjBp9B,MAA4B,EAC5B;MACAA,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAANA,MAAM,GAANA,MAAM,GAAK,EAAE;EAEb,IAAA,IAAIyX,UAAU,GAAGzX,MAAM,CAACyX,UAAU;MAClC,IAAI,CAACA,UAAU,EAAE;QACfzX,MAAM,CAACoZ,IAAI,GAAG,IAAI;EAClB3B,MAAAA,UAAU,GAAG,CAACr3B,IAAO,EAAEA,MAAS,EAAEA,MAAS,EAAEA,OAAU,CAAC;EAC1D,IAAA;EAEA,IAAA,KAAK,CAACsF,OAAO,EAAE03C,OAAO,EAAEp9B,MAAM,CAAC;MAC/B,IAAI,CAACsS,SAAS,GAAG,MAAM5jB,UAAa,CAACsR,MAAM,CAAC;EAE5C,IAAA,IAAI,CAACtR,QAAW,CAAC0uC,OAAO,CAAC,EAAE;EACzB,MAAA;EACF,IAAA;EAEA,IAAA,MAAMoW,OAAO,GAAGxU,aAAa,CAACx/B,KAAK,EAAE;EACrC,IAAA,MAAMivB,UAAU,GAAGzuB,MAAM,CAACyuB,UAAU;EACpC,IAAA,MAAM4C,SAAS,GAAGrxB,MAAM,CAACqxB,SAAS;MAElC,MAAM84B,kBAAkB,GAAG1yC,UAAU,GACjCD,uBAAuB,CAACC,UAAU,CAAC,GACnC,EAAE;EAEN+7B,IAAAA,OAAO,CAAC1R,QAAQ,CAAC,IAAI,CAACqP,GAAG,EAAE;QACzB15B,UAAU;QACVgX,UAAU;EACV4C,MAAAA;EACF,KAAC,CAAC;EAEF,IAAA,IAAI3iC,QAAW,CAACy7D,kBAAkB,CAAC,EAAE;EACnC3W,MAAAA,OAAO,CAAC1R,QAAQ,CAAC,IAAI,CAACkL,OAAO,EAAE;EAC7Bv1B,QAAAA,UAAU,EAAE0yC,kBAAkB;UAC9B17B,UAAU;EACV4C,QAAAA;EACF,OAAC,CAAC;EACJ,IAAA;EACF,EAAA;EACF;;EAEA;EACA;EACA;EACA;;EA6BA;;EAEA,MAAMkiB,oBAEL,GAAI7tD,OAAO,IAAK;IACf,OAAO;EACL+oC,IAAAA,UAAU,EAAEA,CAAC3iC,GAAG,EAAElF,KAAK,KAAA;EAAA,MAAA,IAAAiL,IAAA;QAAA,OAAA,CAAAA,IAAA,GACpBnD,eAAkB,CAAC9H,KAAK,CAAC,GACtB6oD,uBAAuB,CAAC7oD,KAAK,EAAElB,OAAO,CAAC,GACvC,IAAI,cAAAmM,IAAA,KAAA,MAAA,GAAAA,IAAA,GAAK9O,SAAS;EAAA,IAAA,CAAA;EACxBsuC,IAAAA,SAAS,EAAEz4B;KACZ;EACH,CAAC;;ECrOD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;;EAsCA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMwxD,WAAW,SAAS/Z,OAAO,CAAC;IAGvC,OAAOxE,QAAQA,GAAG;MAChByE,eAAe,CACb,MAAM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EAC/B,MAAA,CAAC,CAAC;QAEF,IAAI,CAACqkD,SAAS,CAAC,YAAY;EACzBv7B,QAAAA,WAAW,CAACu9C,OAAO,CAAC,CAAC;EACrB,QAAA,MAAMjkD,aAAa,CAACpiB,OAAO,EAAEm9D,aAAW,CAAC;EACzC,QAAA,MAAMl8C,cAAc,CAACjhB,OAAO,CAAC,CAAC;EAChC,MAAA,CAAC,CAAC;EACJ,IAAA,CAAC,CAAC;EACJ,EAAA;EACF;;EAEA;EACA;EACA;;EAWA;;EAEA,MAAMg5D,aAAW,GAAG,aAAa;EACjC,MAAMkE,eAAa,GAAGl0D,UAAa,CAACgwD,aAAW,CAAC;EAChD,MAAMmE,aAAW,GAAG,CAAA,EAAGD,eAAa,CAAA,MAAA,CAAQ;EAC5C,MAAMoJ,cAAc,GAAGt9D,UAAa,CAAC,SAAS,CAAC;EAC/C;EACA;EACA;EACA;EACA,MAAM+vD,UAAQ,GAAGmE,eAAa;EAC9B,IAAI8I,YAA6B,GAAG,IAAI;EAExC,MAAMvhB,iBAA8D,GAAG;EACrEqhB,EAAAA,UAAU,EAAE3yD;EACd,CAAC;;ECtMD;EACA;EACA;;;EAwWA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;E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E,YAAY,EACZpvD,MACF,CAAC;IACD,OAAOy2B,GAAG,CAAC;EACb,CAAC;;EC5xCD;EACA;EACA;EACA;EACA;;;EAOA;EACA;EACA;EACO,MAAMy7B,cAAc,GAAGA,MAC5BxjE,MAAS,EAAE,GACP,OAAOyjE,GAAG,KAAK,WAAW,IAAIA,GAAG,CAACp5C,QAAQ,CAAC,UAAU,EAAE,QAAQ,CAAC,GAChE,KAAK;;EAEX;EACA;EACA;EACO,MAAMq5C,cAAc,GAAGA,MAC5B1jE,MAAS,EAAE,GAAG1N,QAAQ,CAACqxE,UAAU,KAAK,YAAY,GAAG,KAAK;;EAE5D;EACA;EACA;EACO,MAAM/xD,QAAQ,GAAGA,MACtB5R,MAAS,EAAE,GACPA,SAAY,CAACvJ,KAAK,CAChB,+DACF,CAAC,KAAK,IAAI,GACV,KAAK;;ECjCX;EACA;EACA;;;EAsFA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMmtE,SAAS,SAASrpB,MAAM,CAAC;EACpC;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAGE;EACF;EACA;EACA;IACE,OAAOpvC,GAAGA,CAAC40B,UAA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E;EACnDA,IAAAA,SAAS,CAAC9xC,MAAM,CAAC,CAAC/hC,KAAK,CAAC62E,SAAS,CAAC;EACpC,EAAA;EACF,CAAC;;EC7gCD;EACA;EACA;;;EA4CA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMC,WAAW,SAAS1vB,MAAM,CAAC;EACtC;EACF;EACA;EACA;IACE,OAAOpvC,GAAGA,CAACnU,OAAiB,EAAsB;MAChD,IAAI,CAACA,OAAO,EAAE;EACZ,MAAA,OAAOgmE,UAAU;EACnB,IAAA;MAEA,MAAM/sD,QAAQ,GAAG,KAAK,CAAC9E,GAAG,CAACnU,OAAO,EAAE+4D,UAAQ,CAAC;MAC7C,IAAI/vD,YAAe,CAACiQ,QAAQ,EAAEg6D,WAAW,CAAC,EAAE;EAC1C,MAAA,OAAOh6D,QAAQ;EACjB,IAAA;EACA,IAAA,OAAO,IAAI;EACb,EAAA;IAEA,OAAOktC,QAAQA,GAAG;EAChB5B,IAAAA,cAAc,CACZyU,aAAW,EACX,CAACh5D,OAAO,EAAEsa,MAAM,KAAK;EACnB,MAAA,IAAI,CAAC24D,WAAW,CAAC9+D,GAAG,CAACnU,OAAO,CAAC,EAAE;EAC7B,QAAA,OAAO,IAAIizE,WAAW,CAACjzE,OAAO,EAAEsa,MAAM,CAAC;EACzC,MAAA;EACA,MAAA,OAAO,IAAI;MACb,CAAC,EACDuzC,oBACF,CAAC;EACH,EAAA;;EAEA;EACF;EACA;EACA;IACE,OAAOoY,UAAUA,CAAC3rD,MAA0B,EAAE;EAC5C,IAAA,MAAM44D,MAAM,GAAGlqE,YAAe,CAAC,aAAa,CAAC;MAC7C,MAAM28C,MAAM,GAAG,IAAIstB,WAAW,CAACC,MAAM,EAAE54D,MAAM,CAAC;MAC9CqrC,MAAM,CAACtB,SAAS,CAAC,MAAM;QACrB,IAAI2hB,UAAU,KAAKrgB,MAAM,EAAE;EACzBqgB,QAAAA,UAAU,GAAG,IAAI;EACnB,MAAA;QACA,OAAOl9C,WAAW,CAACoqD,MAAM,CAAC;EAC5B,IAAA,CAAC,CAAC;MAEFznD,cAAc,CAACziB,OAAU,CAAC,CAACiW,IAAI,CAAEljB,IAAI,IAAK;EACxC,MAAA,IAAI,CAAC4pD,MAAM,CAACjC,WAAW,EAAE,EAAE;UACzB56B,WAAW,CAACoqD,MAAM,EAAE;EAAE3rD,UAAAA,EAAE,EAAExrB;EAAK,SAAC,CAAC;EACnC,MAAA;EACF,IAAA,CAAC,CAAC;EAEFiqE,IAAAA,UAAU,GAAGrgB,MAAM;EACnB,IAAA,OAAOA,MAAM;EACf,EAAA;EAEAnsD,EAAAA,WAAWA,CAACwG,OAAgB,EAAEsa,MAA0B,EAAE;EAAA,IAAA,IAAA64D,gBAAA;EACxD,IAAA,MAAMxvB,cAAc,GAAA,CAAAwvB,gBAAA,GAAGF,WAAW,CAAC9+D,GAAG,CAACnU,OAAO,CAAC,cAAAmzE,gBAAA,KAAA,MAAA,GAAA,MAAA,GAAxBA,gBAAA,CAA0Bv6D,OAAO,EAAE;MAC1D,KAAK,CAAC5Y,OAAO,EAAE;EAAEe,MAAAA,EAAE,EAAEg4D;EAAS,KAAC,CAAC;MAEhC,MAAMzwB,MAAoB,GACxB,CAAAhuB,MAAM,aAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEguB,MAAM,KACd,GAAG5tC,KAAQ,CAAA,MAAA,EAASsO,YAAe,CAAC,uBAAuB,CAAC,CAAA,QAAA,CAAU;EACxE,IAAA,MAAM6f,QAA0B,GAAG,CAAAvO,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEuO,QAAQ,KAAInuB,OAAU;MACjE,MAAMquC,UAAU,GAAGzuB,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEyuB,UAAU;EACrC,IAAA,MAAMqqC,mBAAmB,GACvBrqC,UAAU,IACVA,UAAU,KAAK//B,aAAgB,EAAE,IACjC+/B,UAAU,KAAK//B,OAAU,EAAE;EAE7B,IAAA,MAAMk3C,aAAa,GAAG5G,aAAa,CAACx/B,KAAK,EAAE;EAC3C,IAAA,MAAMgnD,WAAW,GAAG/hB,WAAW,CAACjlC,KAAK,CACnCs5D,mBAAmB,GAAG;EAAEx5E,MAAAA,IAAI,EAAEmvC;OAAY,GAAG,EAC/C,CAAC;EAED,IAAA,MAAMsqC,aAAa,GAAGA,MACpBnzB,aAAa,CAACv5C,QAAQ,CAAC;EAAEpG,MAAAA,GAAG,EAAE,CAAC;EAAEH,MAAAA,IAAI,EAAE;EAAE,KAAC,EAAE;EAAE2oC,MAAAA;EAAW,KAAC,CAAC;EAE7D,IAAA,IAAI/d,KAAc;EAClB,IAAA,IAAI+qC,WAAoB;MACxB,IAAIn8D,IAAI,GAAGoG,OAAO;MAElB,MAAMszE,MAAM,GAAGA,MAAM;QACnBjyD,WAAW,CAACznB,IAAI,CAAC;MACnB,CAAC;MAED,MAAM25E,MAAM,GAAGA,MAAM;QACnBhyD,WAAW,CAAC3nB,IAAI,CAAC;MACnB,CAAC;;EAED;;MAEA,CAAC+pD,cAAc,IAAI36C,cAAiB,EAAE,EAAEiW,IAAI,CAAC,YAAY;QACvD,MAAMoG,aAAa,GAAG0jB,UAAU,GAC5B,MAAM9jB,sBAAsB,CAAC8jB,UAAU,CAAC,GACxC,IAAI;QAER,MAAMpqB,iBAAiB,EAAE;EACzB,MAAA,IAAI,IAAI,CAAC+kC,WAAW,EAAE,EAAE;EACtB,QAAA;EACF,MAAA;EAEA,MAAA,IAAI0vB,mBAAmB,EAAE;EACvB;EACArd,QAAAA,WAAW,GAAG/sD,aAAgB,CAAC,KAAK,CAAC;UACrC6e,cAAc,CAACkuC,WAAW,EAAE;EAC1BxuC,UAAAA,EAAE,EAAEvnB,OAAO;EACX6oB,UAAAA,QAAQ,EAAE,QAAQ;EAClBvB,UAAAA,UAAU,EAAE;EACd,SAAC,CAAC;;EAEF;EACA;EACA;UACA,MAAMksD,kBAAkB,GACtBnuD,aAAa,KAAK,gBAAgB,IACjCwD,QAAQ,KAAKnuB,MAAS,IAAI2qB,aAAa,KAAK,KAAM,IAClDwD,QAAQ,KAAKnuB,OAAU,IAAI2qB,aAAa,KAAK,aAAc;UAE9DwC,cAAc,CAAC7nB,OAAO,EAAE;EACtBunB,UAAAA,EAAE,EAAEwhB,UAAU;EACdlgB,UAAAA,QAAQ,EAAE2qD,kBAAkB,GAAG,QAAQ,GAAG,OAAO;EACjDlsD,UAAAA,UAAU,EAAE;EACd,SAAC,CAAC;;EAEF;EACA1tB,QAAAA,IAAI,GAAGwtB,cAAc,CAACpnB,OAAO,EAAE;EAAEmd,UAAAA,OAAO,EAAE,KAAK;EAAEmK,UAAAA,UAAU,EAAE;EAAK,SAAC,CAAC;EACtE,MAAA;QAEA7B,wBAAwB,CAAC7rB,IAAI,CAAC;EAC9B4mB,MAAAA,aAAa,CAAC5mB,IAAI,EAAEujE,WAAW,CAAC;EAChC38C,MAAAA,aAAa,CAACxgB,OAAO,EAAEyzE,UAAU,CAAC;EAClCpwD,MAAAA,iBAAiB,CAACzpB,IAAI,EAAE85E,YAAY,EAAE,CAACN,mBAAmB,CAAC;QAC3DjwD,UAAU,CAACvpB,IAAI,EAAEc,YAAe,EAAEmuB,QAAQ,CAAC;QAE3CmC,KAAK,GAAGD,WAAW,CAAC/qB,OAAO,EAAEtF,IAAO,CAAC;QAErC64E,MAAM,EAAE,CAAC;;QAETxgD,kBAAkB,CAAC/yB,OAAO,EAAEtF,OAAU,EAAE24E,aAAa,CAAC;EAEtDvS,MAAAA,WAAW,CAAC9f,MAAM,CAAC1Y,MAAM,EAAEgrC,MAAM,EAAE;UACjCt1B,KAAK,EAAE,CAACtjD,IAAO,EAAEA,OAAU;EAC7B,OAAC,CAAC;EAEFomE,MAAAA,WAAW,CAAC9f,MAAM,CAAC1Y,MAAM,EAAEirC,MAAM,EAAE;EACjCv1B,QAAAA,KAAK,EAAE,CAACtjD,OAAU;EACpB,OAAC,CAAC;QAEF,IAAI,CAACwpD,SAAS,CAAC,MAAM;UACnB/iC,gBAAgB,CAACvnB,IAAI,CAAC;EACxB,MAAA,CAAC,CAAC;QAEF,IAAI,CAACuqD,QAAQ,CAAC,MAAM;UAClBljC,cAAc,CAACrnB,IAAI,CAAC;EACtB,MAAA,CAAC,CAAC;QAEF,IAAI,CAACyqD,SAAS,CAAC,YAAY;UACzB,MAAM1lC,iBAAiB,EAAE;UACzBgV,uBAAuB,CAAC3zB,OAAO,EAAEtF,OAAU,EAAE24E,aAAa,CAAC;EAE3D9yD,QAAAA,gBAAgB,CAAC3mB,IAAI,EAAEujE,WAAW,CAAC;EACnC58C,QAAAA,gBAAgB,CAACvgB,OAAO,EAAEyzE,UAAU,CAAC;EACrC5vD,QAAAA,UAAU,CAACjqB,IAAI,EAAE85E,YAAY,CAAC;EAC9B7vD,QAAAA,UAAU,CAACjqB,IAAI,EAAEc,YAAe,CAAC;EACjCsmB,QAAAA,iBAAiB,CAACpnB,IAAI,CAAC,CAAC;;EAExB,QAAA,IAAIoxB,KAAK,EAAE;EACTnD,UAAAA,cAAc,CAACmD,KAAK,CAAC,CAAC;EACxB,QAAA;UAEA,IAAIpxB,IAAI,KAAKoG,OAAO,EAAE;EACpB;EACA+nB,UAAAA,iBAAiB,CAACnuB,IAAI,EAAEoG,OAAO,EAAE;EAAEsnB,YAAAA,UAAU,EAAE;EAAK,WAAC,CAAC;EACxD,QAAA;EAEA,QAAA,IAAIyuC,WAAW,EAAE;EACf;EACAhuC,UAAAA,iBAAiB,CAACguC,WAAW,EAAE/1D,OAAO,EAAE;EAAEsnB,YAAAA,UAAU,EAAE;EAAK,WAAC,CAAC;EAC/D,QAAA;EAEAw5C,QAAAA,WAAW,CAAC7f,OAAO,CAAC3Y,MAAM,EAAEgrC,MAAM,CAAC;EACnCxS,QAAAA,WAAW,CAAC7f,OAAO,CAAC3Y,MAAM,EAAEirC,MAAM,CAAC;EACrC,MAAA,CAAC,CAAC;EACJ,IAAA,CAAC,CAAC;EACJ,EAAA;EACF;;EAEA;EACA;EACA;;EA+BA;;EAEA,MAAMva,aAAW,GAAG,eAAe;EACnC,MAAMkE,eAAa,GAAGl0D,UAAa,CAACgwD,aAAW,CAAC;EAChD;EACA;EACA,MAAMD,UAAQ,GAAGmE,eAAa;EAC9B,MAAMC,WAAW,GAAG,CAAA,EAAGD,eAAa,CAAA,MAAA,CAAQ;EAC5C,MAAMuW,UAAU,GAAG,CAAA,EAAGvW,eAAa,CAAA,KAAA,CAAO;EAC1C,MAAMwW,YAAY,GAAG1qE,UAAa,CAAC,OAAO,CAAC;EAE3C,IAAIg9D,UAA8B,GAAG,IAAI;EAEzC,MAAMnY,oBAAgE,GACpE7tD,OAAO,IACJ;IACH,OAAO;EACLsoC,IAAAA,MAAM,EAAEA,CAACliC,GAAG,EAAElF,KAAK,KAAKmS,cAAc,CAACjN,GAAG,EAAElF,KAAK,EAAEw8C,mBAAmB,CAAC;MACvE70B,QAAQ,EAAEA,CAACziB,GAAG,EAAElF,KAAK,KACnBmS,cAAc,CAACjN,GAAG,EAAElF,KAAK,EAAG9D,CAAC,IAAKA,CAAC,KAAK1C,MAAS,IAAI0C,CAAC,KAAK1C,OAAU,CAAC;EACxEquC,IAAAA,UAAU,EAAEA,CAAC3iC,GAAG,EAAElF,KAAK,KAAA;EAAA,MAAA,IAAAiL,IAAA;QAAA,OAAA,CAAAA,IAAA,GACpBnD,eAAkB,CAAC9H,KAAK,CAAC,GACtB6oD,uBAAuB,CAAC7oD,KAAK,EAAElB,OAAO,CAAC,GACvC,IAAI,cAAAmM,IAAA,KAAA,MAAA,GAAAA,IAAA,GAAK9O,SAAS;EAAA,IAAA;KACzB;EACH,CAAC;;EC5ZD;EACA;EACA;;;EAsCA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMs2E,QAAQ,SAASpwB,MAAM,CAAC;EACnC;EACF;EACA;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;EACA;EACA;EACA;EACA;;EAME;EACF;EACA;EACA;EACA;EACA;EACA;EACA;;EAGE;EACF;EACA;EACA;EACA;EACA;EACA;EACA;;EAGE;EACF;EACA;EACA;EACA;EACA;EACA;;IAGE,OAAOpvC,GAAGA,CAACnU,OAAgB,EAAmB;MAC5C,MAAMiZ,QAAQ,GAAG,KAAK,CAAC9E,GAAG,CAACnU,OAAO,EAAE+4D,UAAQ,CAAC;MAC7C,IAAI/vD,YAAe,CAACiQ,QAAQ,EAAE06D,QAAQ,CAAC,EAAE;EACvC,MAAA,OAAO16D,QAAQ;EACjB,IAAA;EACA,IAAA,OAAO,IAAI;EACb,EAAA;IAEA,OAAOktC,QAAQA,GAAG;EAChB5B,IAAAA,cAAc,CACZyU,aAAW,EACX,CAACh5D,OAAO,EAAEsa,MAAM,KAAK;EACnB,MAAA,IAAI,CAACq5D,QAAQ,CAACx/D,GAAG,CAACnU,OAAO,CAAC,EAAE;EAC1B,QAAA,OAAO,IAAI2zE,QAAQ,CAAC3zE,OAAO,EAAEsa,MAAM,CAAC;EACtC,MAAA;EACA,MAAA,OAAO,IAAI;MACb,CAAC,EACDmqC,iBACF,CAAC;EACH,EAAA;;EAEA;EACF;EACA;EACA;EACEjrD,EAAAA,WAAWA,CAACwG,OAAgB,EAAEsa,MAAuB,EAAE;EAAA,IAAA,IAAAs5D,aAAA;EACrD,IAAA,MAAMjwB,cAAc,GAAA,CAAAiwB,aAAA,GAAGD,QAAQ,CAACx/D,GAAG,CAACnU,OAAO,CAAC,cAAA4zE,aAAA,KAAA,MAAA,GAAA,MAAA,GAArBA,aAAA,CAAuBh7D,OAAO,EAAE;MACvD,KAAK,CAAC5Y,OAAO,EAAE;EAAEe,MAAAA,EAAE,EAAEg4D;EAAS,KAAC,CAAC;MAEhC,MAAM2N,KAAK,GAAG,CAAApsD,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEosD,KAAK,KAAI,EAAE;EACjC,IAAA,IAAI,CAAC19D,QAAW,CAAC09D,KAAK,CAAC,EAAE;EACvBA,MAAAA,KAAK,CAAC91D,IAAI,CACR,GAAG5H,gBAAmB,CACpBhJ,OAAO,EACP4kD,wBAAwB,CAACuiB,uBAAuB,CAClD,CACF,CAAC;EAED,MAAA,IAAI,CAACn+D,QAAW,CAAC09D,KAAK,CAAC,EAAE;EACvBA,QAAAA,KAAK,CAAC91D,IAAI,CAAC,GAAG5H,gBAAmB,CAAChJ,OAAO,EAAE,IAAItF,WAAc,CAAA,CAAA,CAAG,CAAC,CAAC;EAElE,QAAA,IAAI,CAACsO,QAAW,CAAC09D,KAAK,CAAC,EAAE;YACvBA,KAAK,CAAC91D,IAAI,CAAC,GAAG6O,yBAAyB,CAACzf,OAAO,CAAC,CAAC;EACnD,QAAA;EACF,MAAA;EACF,IAAA;MAEA,IAAIgJ,QAAW,CAAC09D,KAAK,CAAC,GAAG,CAAC,EAAE;EAC1B,MAAA,MAAM19D,UAAa,CAAC,qCAAqC,CAAC;EAC5D,IAAA;MAEA,MAAM4xD,OAAO,GAAGtU,UAAU,CAAC,IAAI,EAAEogB,KAAK,EAAEpsD,MAAM,CAAC;MAE/C,CAACqpC,cAAc,IAAI36C,cAAiB,EAAE,EAAEiW,IAAI,CAAC,MAAM;EACjD,MAAA,IAAI,IAAI,CAACykC,WAAW,EAAE,EAAE;EACtB,QAAA;EACF,MAAA;QAEA1Y,IAAI,CAAC,IAAI,EAAEhrC,OAAO,EAAE0mE,KAAK,EAAE9L,OAAO,CAAC;EACrC,IAAA,CAAC,CAAC;EAEF,IAAA,IAAI,CAACiZ,WAAW,GAAGjZ,OAAO,CAACkZ,YAAY;EACvC,IAAA,IAAI,CAACC,UAAU,GAAGnZ,OAAO,CAACoZ,WAAW;EACrC,IAAA,IAAI,CAACC,UAAU,GAAGrZ,OAAO,CAACsZ,WAAW;EACrC,IAAA,IAAI,CAACC,cAAc,GAAGvZ,OAAO,CAACwZ,eAAe;EAC7C,IAAA,IAAI,CAACC,MAAM,GAAGzZ,OAAO,CAAC0Z,OAAO;EAE7B,IAAA,IAAI,CAACtN,QAAQ,GAAG,CAACuN,YAAY,GAAG,KAAK,KACnCA,YAAY,GAAG3Z,OAAO,CAAC4Z,eAAe,EAAE,GAAG,CAAC,GAAG9N,KAAK,CAAC;EACzD,EAAA;EACF;;EAEA;EACA;EACA;;EA+BA;;EAEA,MAAM1N,aAAW,GAAG,UAAU;EAC9B,MAAMkE,aAAa,GAAGl0D,UAAa,CAACgwD,aAAW,CAAC;EAChD,MAAMyb,mBAAmB,GAAGzrE,UAAa,CAAC,cAAc,CAAC;;EAEzD;EACA;EACA;EACA,MAAMk+D,WAAW,GAAG,CAAA,EAAGhK,aAAa,CAAA,MAAA,CAAQ;EAC5C,MAAMiK,uBAAuB,GAAG,CAAA,EAAGjK,aAAa,CAAA,KAAA,CAAO;EAEvD,MAAMwX,qBAAqB,GAAG,CAAA,EAAGxX,aAAa,CAAA,OAAA,CAAS;;EAEvD;EACA;EACA,MAAMnE,UAAQ,GAAGmE,aAAa;EAE9B,MAAMzY,iBAA4D,GAAG;IACnEkwB,IAAI,EAAEA,CAACvuE,GAAG,EAAElF,KAAK,KACfmS,cAAc,CAACjN,GAAG,EAAElF,KAAK,EAAG9D,CAAC,IAAKA,CAAC,KAAK,MAAM,IAAIA,CAAC,KAAK,MAAM;EAClE,CAAC;EAED,MAAMw3E,gBAAgB,GAAG;EAAEtgD,EAAAA,OAAO,EAAE,KAAK;EAAEb,EAAAA,OAAO,EAAE;EAAK,CAAC;EAE1D,MAAMohD,eAAe,GAAI12D,IAAa,IACpC8E,cAAc,CAAC9E,IAAI,EAAEs2D,mBAAmB,CAAC;EAE3C,MAAMzpC,IAAI,GAAGA,CACX2a,MAAgB,EAChB3lD,OAAgB,EAChB0mE,KAAgB,EAChB9L,OAAsC,KACnC;IACH,IAAIka,kBAAkC,GAAG,IAAI;IAC7C,IAAIC,aAA6B,GAAG,IAAI;IACxC,IAAIC,YAAY,GAAG,KAAK;EACxB,EAAA,IAAIC,UAAU,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;EAEvB,EAAA,MAAMC,eAAe,GAAGA,MAAOF,YAAY,GAAG,IAAK;IAEnD,MAAMG,WAAW,GAAIh5E,KAAY,IAAK;EACpC,IAAA,MAAMi5E,UAAU,GAAGpsE,eAAkB,CAAC7M,KAAK,CAAC;EAE5C,IAAA,IACE6M,SAAY,CAACosE,UAAU,CAAC,IACxBP,eAAe,CAACO,UAAU,CAAC,IAC3BpsE,YAAe,CAAC7M,KAAK,CAAC,EACtB;EACA24E,MAAAA,kBAAkB,GAAGM,UAAU;QAC/BpsE,OAAU,CAACosE,UAAU,EAAE16E,WAAc,CAAC;EAEtC,MAAA,IAAIsO,mBAAsB,CAAC7M,KAAK,CAAC,EAAE;EACjC,QAAA,MAAMiC,MAAM,GAAG4K,QAAW,CAAC7M,KAAK,CAAC;EACjC,QAAA,IAAI6M,SAAY,CAAC5K,MAAM,CAAC,EAAE;EACxBA,UAAAA,MAAM,CAACi3E,qBAAqB,CAACl5E,KAAK,CAAC62E,SAAS,CAAC;EAC/C,QAAA;EACF,MAAA;EAEAjgD,MAAAA,kBAAkB,CAChB/pB,MAAS,EAAE,EACXtO,WAAc,EACd46E,WAAW,EACXV,gBACF,CAAC;EAED91D,MAAAA,kBAAkB,EAAE,CAACG,IAAI,CAAC,MAAM;EAC9B;EACA;EACA;EACA,QAAA,MAAM/e,IAAI,GAAG8I,qBAAwB,CAACosE,UAAU,CAAC;EACjDH,QAAAA,UAAU,GAAG,CAAC94E,KAAK,CAAC+8B,OAAO,GAAGh5B,IAAI,CAACE,IAAI,EAAEjE,KAAK,CAACg9B,OAAO,GAAGj5B,IAAI,CAACK,GAAG,CAAC;EACpE,MAAA,CAAC,CAAC;EACJ,IAAA;IACF,CAAC;IAED,MAAMg1E,SAAS,GAAIp5E,KAAY,IAAK;MAClC,IAAI64E,YAAY,IAAI74E,KAAK,CAACyxB,IAAI,KAAKlzB,eAAkB,EAAE;EACrDs6E,MAAAA,YAAY,GAAG,KAAK;EACpB,MAAA;EACF,IAAA;EAEA,IAAA,IAAIF,kBAAkB,EAAE;QACtB9rE,SAAY,CAAC8rE,kBAAkB,EAAEp6E,WAAc,CAAC;EAChDo6E,MAAAA,kBAAkB,GAAG,IAAI;EAEzBnhD,MAAAA,uBAAuB,CACrB3qB,MAAS,EAAE,EACXtO,WAAc,EACd46E,WAAW,EACXV,gBACF,CAAC;EAED,MAAA,IAAIG,aAAa,EAAE;UACjBjsD,WAAW,CAACisD,aAAa,CAAC;EAC1BA,QAAAA,aAAa,GAAG,IAAI;EACtB,MAAA;EACF,IAAA;IACF,CAAC;IAED,MAAMO,WAAW,GAAIn5E,KAAY,IAAK;EACpC,IAAA,IAAI6M,YAAe,CAAC7M,KAAK,CAAC,IAAI6M,QAAW,CAAC7M,KAAK,CAAC4+B,OAAO,CAAC,KAAK,CAAC,EAAE;EAC9D,MAAA,MAAMnS,QAAQ,GAAG5f,QAAW,CAAC8rE,kBAAkB,CAAC;QAChD,IAAIlsD,QAAQ,IAAIksD,kBAAkB,EAAE;EAClC9rE,QAAAA,cAAiB,CAAC7M,KAAK,CAAC;EAExB,QAAA,MAAM8+B,KAAK,GAAG9+B,KAAK,CAAC4+B,OAAO,CAAC,CAAC,CAAC;EAC9B,QAAA,MAAM7B,OAAO,GAAG+B,KAAK,CAAC/B,OAAO;EAC7B,QAAA,MAAMC,OAAO,GAAG8B,KAAK,CAAC9B,OAAO;UAE7B,IAAI,CAAC47C,aAAa,EAAE;EAClBA,UAAAA,aAAa,GAAG/qD,YAAY,CAAC8qD,kBAAkB,CAAC;EAChD3yD,UAAAA,UAAU,CAAC4yD,aAAa,EAAEL,qBAAqB,CAAC;EAChD7uD,UAAAA,SAAS,CAACivD,kBAAkB,EAAEC,aAAa,EAAE,CAC3C,OAAO,EACP,QAAQ,CACT,CAAC,CAAC91D,IAAI,CAAC,MAAM;EACZ,YAAA,IAAI81D,aAAa,EAAE;gBACjBjsD,WAAW,CAACisD,aAAa,EAAE;EAAExtD,gBAAAA,EAAE,EAAEqB;EAAS,eAAC,CAAC;EAC9C,YAAA;EACF,UAAA,CAAC,CAAC;EACJ,QAAA;EAEA,QAAA,IAAImsD,aAAa,EAAE;YACjBluD,qBAAqB,CACnBkuD,aAAa,EACb;EACE77C,YAAAA,OAAO,EAAEA,OAAO,GAAG+7C,UAAU,CAAC,CAAC,CAAC;EAChC97C,YAAAA,OAAO,EAAEA,OAAO,GAAG87C,UAAU,CAAC,CAAC;EACjC,WAAC,EACD;EAAEruD,YAAAA,MAAM,EAAE;EAAK,WACjB,CAAC;EACH,QAAA;EACF,MAAA;EACF,IAAA;IACF,CAAC;IAED,MAAM4uD,WAAW,GAAIr5E,KAAY,IAAK;EACpC,IAAA,MAAMi5E,UAAU,GAAGpsE,eAAkB,CAAC7M,KAAK,CAAC;MAC5C,MAAMs5E,OAAO,GAAGX,kBAAkB;EAElC,IAAA,IACE,CAAC9rE,mBAAsB,CAAC7M,KAAK,CAAC,IAAIA,KAAK,CAACyxB,IAAI,KAAKlzB,WAAc,KAC/D+6E,OAAO,IACPzsE,SAAY,CAACosE,UAAU,CAAC,IACxBA,UAAU,KAAKK,OAAO,EACtB;QACA7a,OAAO,CAAC8a,aAAa,CAACD,OAAO,EAAEL,UAAU,CAAC,CAAC;EAC7C,IAAA;IACF,CAAC;IAED,MAAMO,WAAW,GAAGA,MAAM;EACxB,IAAA,KAAK,MAAMx3D,IAAI,IAAIuoD,KAAK,EAAE;QACxBxyC,aAAa,CAAC/V,IAAI,CAAC;QAEnB4U,kBAAkB,CAAC5U,IAAI,EAAEzjB,aAAgB,EAAEy6E,WAAW,CAAC;QAEvDpiD,kBAAkB,CAAC5U,IAAI,EAAEzjB,WAAc,EAAEw6E,eAAe,CAAC,CAAC;;QAE1DniD,kBAAkB,CAAC5U,IAAI,EAAEzjB,cAAiB,EAAE86E,WAAW,CAAC,CAAC;QACzDziD,kBAAkB,CAAC5U,IAAI,EAAEzjB,WAAc,EAAE86E,WAAW,CAAC,CAAC;;EAEtDziD,MAAAA,kBAAkB,CAAC5U,IAAI,EAAEzjB,UAAa,EAAEsO,cAAiB,CAAC,CAAC;;QAE3D+pB,kBAAkB,CAAC5U,IAAI,EAAEzjB,SAAY,EAAE66E,SAAS,CAAC,CAAC;QAClDxiD,kBAAkB,CAAC5U,IAAI,EAAEzjB,MAAS,EAAE66E,SAAS,CAAC,CAAC;;EAE/CxiD,MAAAA,kBAAkB,CAAC/pB,MAAS,EAAE,EAAEtO,WAAc,EAAE66E,SAAS,CAAC;EAC1DxiD,MAAAA,kBAAkB,CAAC/pB,MAAS,EAAE,EAAEtO,eAAkB,EAAE66E,SAAS,CAAC;EAChE,IAAA;IACF,CAAC;;EAED;;EAEA,EAAA,KAAK,MAAMp3D,IAAI,IAAIuoD,KAAK,EAAE;EACxBvkD,IAAAA,UAAU,CAAChE,IAAI,EAAE+oD,WAAW,CAAC;EAC7B3jD,IAAAA,cAAc,CAACpF,IAAI,EAAEs2D,mBAAmB,CAAC;EAC3C,EAAA;EAEA9uB,EAAAA,MAAM,CAACxB,QAAQ,CAACwxB,WAAW,CAAC;IAE5BhwB,MAAM,CAACzB,SAAS,CAAC,MAAM;EACrB,IAAA,KAAK,MAAM/lC,IAAI,IAAIuoD,KAAK,EAAE;QACxBvyC,iBAAiB,CAAChW,IAAI,CAAC;QAEvBwV,uBAAuB,CAACxV,IAAI,EAAEzjB,aAAgB,EAAEy6E,WAAW,CAAC;QAE5DxhD,uBAAuB,CAACxV,IAAI,EAAEzjB,WAAc,EAAEw6E,eAAe,CAAC;QAE9DvhD,uBAAuB,CAACxV,IAAI,EAAEzjB,cAAiB,EAAE86E,WAAW,CAAC;QAC7D7hD,uBAAuB,CAACxV,IAAI,EAAEzjB,WAAc,EAAE86E,WAAW,CAAC;QAE1D7hD,uBAAuB,CAACxV,IAAI,EAAEzjB,UAAa,EAAEsO,cAAiB,CAAC;QAE/D2qB,uBAAuB,CAACxV,IAAI,EAAEzjB,WAAc,EAAE66E,SAAS,CAAC;QACxD5hD,uBAAuB,CAACxV,IAAI,EAAEzjB,eAAkB,EAAE66E,SAAS,CAAC;QAC5D5hD,uBAAuB,CAACxV,IAAI,EAAEzjB,SAAY,EAAE66E,SAAS,CAAC;QACtD5hD,uBAAuB,CAACxV,IAAI,EAAEzjB,MAAS,EAAE66E,SAAS,CAAC;EACrD,IAAA;EACF,EAAA,CAAC,CAAC;IAEF5vB,MAAM,CAACtB,SAAS,CAAC,YAAY;EAC3B,IAAA,KAAK,MAAMlmC,IAAI,IAAIuoD,KAAK,EAAE;EACxB,MAAA,MAAMtkD,aAAa,CAACjE,IAAI,EAAE+oD,WAAW,CAAC;EACtC,MAAA,MAAMpjD,OAAO,CAAC3F,IAAI,EAAEs2D,mBAAmB,CAAC;EAC1C,IAAA;EACF,EAAA,CAAC,CAAC;EAEFkB,EAAAA,WAAW,EAAE;EACf,CAAC;EAED,MAAMrvB,UAAU,GAAGA,CACjBX,MAAgB,EAChB+gB,KAAgB,EAChBpsD,MAAkC,KAC/B;IACH,MAAMs7D,MAAM,GAAG,CAAAt7D,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEq6D,IAAI,MAAK,MAAM;IAEtC,MAAMkB,aAAsC,GAAG,EAAE;EACjD,EAAA,MAAMlT,SAAS,GAAG35D,MAAS,EAAkB;EAE7C,EAAA,MAAM8sE,cAAc,GAAGA,MACrB,CAAC,GAAGpP,KAAK,CAAC,CAACn6D,IAAI,CAAC,CAAC7J,CAAC,EAAE8J,CAAC,KAAMxD,aAAgB,CAACtG,CAAC,EAAE8J,CAAC,CAAC,GAAG,EAAE,GAAG,CAAE,CAAC;IAE9D,MAAMupE,iBAAiB,GAAGA,CAACC,OAAe,EAAEzB,YAAY,GAAG,KAAK,KAC9DA,YAAY,GAAG7N,KAAK,CAAChlE,OAAO,CAACo0E,cAAc,EAAE,CAACE,OAAO,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAGA,OAAO;EAE3E,EAAA,MAAM7B,cAAc,GAAGA,CAAC6B,OAAe,EAAEzB,YAAY,GAAG,KAAK,KAC3DsB,aAAa,CAACE,iBAAiB,CAACC,OAAO,EAAEzB,YAAY,CAAC,CAAC,KAAK,IAAI;IAElE,MAAMV,WAAW,GAAG,OAAOmC,OAAe,EAAEzB,YAAY,GAAG,KAAK,KAAK;MACnEyB,OAAO,GAAGD,iBAAiB,CAACpqE,KAAK,CAACqqE,OAAO,CAAC,EAAEzB,YAAY,CAAC;EACzD,IAAA,IAAI5uB,MAAM,CAAClC,UAAU,EAAE,IAAIuyB,OAAO,GAAG,CAAC,IAAIA,OAAO,GAAGhtE,QAAW,CAAC09D,KAAK,CAAC,EAAE;EACtE,MAAA;EACF,IAAA;;EAEA;EACAmP,IAAAA,aAAa,CAACG,OAAO,CAAC,GAAG,IAAI;MAC7B,MAAMryD,gBAAgB,CAAC+iD,KAAK,CAACsP,OAAO,GAAG,CAAC,CAAC,EAAEvB,mBAAmB,CAAC;IACjE,CAAC;IAED,MAAMV,UAAU,GAAG,OAAOiC,OAAe,EAAEzB,YAAY,GAAG,KAAK,KAAK;MAClEyB,OAAO,GAAGD,iBAAiB,CAACpqE,KAAK,CAACqqE,OAAO,CAAC,EAAEzB,YAAY,CAAC;MACzD,IAAI5uB,MAAM,CAAClC,UAAU,EAAE,IAAI,CAAC0wB,cAAc,CAAC6B,OAAO,CAAC,EAAE;EACnD,MAAA;EACF,IAAA;;EAEA;EACAH,IAAAA,aAAa,CAACG,OAAO,CAAC,GAAG,KAAK;MAC9B,MAAMzyD,cAAc,CAACmjD,KAAK,CAACsP,OAAO,GAAG,CAAC,CAAC,EAAEvB,mBAAmB,CAAC;IAC/D,CAAC;EAED,EAAA,MAAMR,UAAU,GAAGA,CAAC+B,OAAe,EAAEzB,YAAY,GAAG,KAAK,KACvDJ,cAAc,CAAC6B,OAAO,EAAEzB,YAAY,CAAC,GACjCR,UAAU,CAACiC,OAAO,EAAEzB,YAAY,CAAC,GACjCV,WAAW,CAACmC,OAAO,EAAEzB,YAAY,CAAC;EAExC,EAAA,MAAMF,MAAM,GAAI39D,OAAsB,IACpCisD,SAAS,CAACjlD,GAAG,CAACZ,YAAY,CAACpG,OAAO,CAAC,CAAC;;EAEtC;EACA,EAAA,MAAMu/D,YAAY,GAAG,OAAOR,OAAgB,EAAES,WAAoB,KAAK;EACrE,IAAA,IAAIN,MAAM,EAAE;EACV,MAAA,MAAMttD,YAAY,CAACmtD,OAAO,EAAES,WAAW,EAAE;EAAE5uD,QAAAA,UAAU,EAAE;EAAK,OAAC,CAAC;EAChE,IAAA,CAAC,MAAM;QACL,MAAMwB,WAAW,CAAC2sD,OAAO,EAAE;EACzBluD,QAAAA,EAAE,EAAE2uD,WAAW;EACfrtD,QAAAA,QAAQ,EAAE7f,aAAgB,CAACysE,OAAO,EAAES,WAAW,CAAC,GAAG,OAAO,GAAG,QAAQ;EACrE5uD,QAAAA,UAAU,EAAE;EACd,OAAC,CAAC;EACJ,IAAA;EAEA,IAAA,KAAK,MAAM9qB,QAAQ,IAAImmE,SAAS,EAAE;EAChC,MAAA,MAAMnmE,QAAQ,CAAC0gB,MAAM,CAACyoC,MAAM,CAAC;EAC/B,IAAA;IACF,CAAC;IAED,OAAO;EACL6uB,IAAAA,eAAe,EAAEsB,cAAc;EAC/BhC,IAAAA,YAAY,EAAED,WAAW;EACzBG,IAAAA,WAAW,EAAED,UAAU;EACvBG,IAAAA,WAAW,EAAED,UAAU;EACvBG,IAAAA,eAAe,EAAED,cAAc;EAC/BG,IAAAA,OAAO,EAAED,MAAM;EACfqB,IAAAA,aAAa,EAAEO;KAChB;EACH,CAAC;;ECviBD;EACA;EACA;;;EAcA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAME,YAAY,SAAS5yB,MAAM,CAAC;IACvC,OAAOpvC,GAAGA,CAACnU,OAAgB,EAAuB;MAChD,MAAMiZ,QAAQ,GAAG,KAAK,CAAC9E,GAAG,CAACnU,OAAO,EAAE+4D,UAAQ,CAAC;MAC7C,IAAI/vD,YAAe,CAACiQ,QAAQ,EAAEk9D,YAAY,CAAC,EAAE;EAC3C,MAAA,OAAOl9D,QAAQ;EACjB,IAAA;EACA,IAAA,OAAO,IAAI;EACb,EAAA;IAEA,OAAOktC,QAAQA,GAAG;EAChB5B,IAAAA,cAAc,CACZyU,aAAW,EACX,CAACh5D,OAAO,EAAEsa,MAAM,KAAK;EACnB,MAAA,IAAI,CAAC67D,YAAY,CAAChiE,GAAG,CAACnU,OAAO,CAAC,EAAE;EAC9B,QAAA,OAAO,IAAIm2E,YAAY,CAACn2E,OAAO,EAAEsa,MAAM,CAAC;EAC1C,MAAA;EACA,MAAA,OAAO,IAAI;MACb,CAAC,EACDmqC,iBACF,CAAC;EACH,EAAA;EAEAjrD,EAAAA,WAAWA,CAACwG,OAAgB,EAAEsa,MAA2B,EAAE;MACzD,KAAK,CAACta,OAAO,EAAE;EAAEe,MAAAA,EAAE,EAAEg4D;EAAS,KAAC,CAAC;MAEhCv8B,cAAc,CAAC1iB,KAAK,EAAE,CAAC6kB,YAAY,CAAC3+B,OAAO,EAAE,IAAI,EAAE;EACjD8C,MAAAA,cAAc,EAAEwX,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAExX,cAAc;EACtCq+B,MAAAA,cAAc,EAAE7mB,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAE87D,SAAS;EACjC/0C,MAAAA,cAAc,EAAE/mB,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAE+7D,SAAS;EACjC90C,MAAAA,cAAc,EAAEjnB,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEg8D,SAAS;EACjC70C,MAAAA,cAAc,EAAEnnB,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEi8D,SAAS;EACjC50C,MAAAA,cAAc,EAAErnB,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEk8D,SAAS;EACjC30C,MAAAA,cAAc,EAAEvnB,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEm8D;EAC1B,KAAC,CAAC;EAEF,IAAA,IAAI,CAACpyB,SAAS,CAAC,MAAM7nB,cAAc,CAAC1iB,KAAK,EAAE,CAACklB,cAAc,CAACh/B,OAAO,CAAC,CAAC;EACtE,EAAA;EACF;;EAEA;EACA;EACA;;EA2DA;;EAEA,MAAMg5D,aAAW,GAAG,eAAe;EACnC;EACA;EACA,MAAMD,UAAQ,GAAGC,aAAW;EAE5B,MAAMvU,iBAAgE,GAAG;EACvE3hD,EAAAA,cAAc,EAAEqQ,eAAe;EAC/BijE,EAAAA,SAAS,EAAEljE,cAAc;EACzBmjE,EAAAA,SAAS,EAAEnjE,cAAc;EACzBojE,EAAAA,SAAS,EAAEpjE,cAAc;EACzBqjE,EAAAA,SAAS,EAAErjE,cAAc;EACzBsjE,EAAAA,SAAS,EAAEtjE,cAAc;EACzBujE,EAAAA,SAAS,EAAEvjE;EACb,CAAC;;EC3KD;EACA;EACA;;;EAcA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMwjE,WAAW,SAASnzB,MAAM,CAAC;IACtC,OAAOpvC,GAAGA,CAACnU,OAAgB,EAAsB;MAC/C,MAAMiZ,QAAQ,GAAG,KAAK,CAAC9E,GAAG,CAACnU,OAAO,EAAE+4D,UAAQ,CAAC;MAC7C,IAAI/vD,YAAe,CAACiQ,QAAQ,EAAEy9D,WAAW,CAAC,EAAE;EAC1C,MAAA,OAAOz9D,QAAQ;EACjB,IAAA;EACA,IAAA,OAAO,IAAI;EACb,EAAA;IAEA,OAAOktC,QAAQA,GAAG;EAChB5B,IAAAA,cAAc,CACZyU,aAAW,EACX,CAACh5D,OAAO,EAAEsa,MAAM,KAAK;EACnB,MAAA,IAAI,CAACo8D,WAAW,CAACviE,GAAG,CAACnU,OAAO,CAAC,EAAE;EAC7B,QAAA,OAAO,IAAI02E,WAAW,CAAC12E,OAAO,EAAEsa,MAAM,CAAC;EACzC,MAAA;EACA,MAAA,OAAO,IAAI;MACb,CAAC,EACDmqC,iBACF,CAAC;EACH,EAAA;EAEAjrD,EAAAA,WAAWA,CAACwG,OAAgB,EAAEsa,MAA0B,EAAE;MACxD,KAAK,CAACta,OAAO,EAAE;EAAEe,MAAAA,EAAE,EAAEg4D;EAAS,KAAC,CAAC;EAEhCzf,IAAAA,aAAa,CAACx/B,KAAK,EAAE,CAACoiC,WAAW,CAC/B,IAAI,EACJlzC,MAAS,CACP;EACE+/B,MAAAA,UAAU,EAAE/oC;OACb,EACDsa,MACF,CACF,CAAC;EAED,IAAA,IAAI,CAAC+pC,SAAS,CAAC,MAAM/K,aAAa,CAACx/B,KAAK,EAAE,CAACqiC,aAAa,CAAC,IAAI,EAAEn8C,OAAO,CAAC,CAAC;EAC1E,EAAA;EACF;;EAEA;EACA;EACA;;EAmBA;;EAEA,MAAMg5D,aAAW,GAAG,cAAc;EAClC;EACA;EACA,MAAMD,UAAQ,GAAGC,aAAW;EAE5B,MAAMvU,iBAA+D,GAAG;EACtE9Y,EAAAA,SAAS,EAAEz4B,cAAc;EACzBuD,EAAAA,cAAc,EAAEvD;EAClB,CAAC;;ECnHD;EACA;EACA;;;EAcA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMyjE,SAAS,SAASpzB,MAAM,CAAC;IACpC,OAAOpvC,GAAGA,CAACnU,OAAgB,EAAoB;MAC7C,MAAMiZ,QAAQ,GAAG,KAAK,CAAC9E,GAAG,CAACnU,OAAO,EAAE+4D,UAAQ,CAAC;MAC7C,IAAI/vD,YAAe,CAACiQ,QAAQ,EAAE09D,SAAS,CAAC,EAAE;EACxC,MAAA,OAAO19D,QAAQ;EACjB,IAAA;EACA,IAAA,OAAO,IAAI;EACb,EAAA;IAEA,OAAOktC,QAAQA,GAAG;EAChB5B,IAAAA,cAAc,CACZyU,aAAW,EACX,CAACh5D,OAAO,EAAEsa,MAAM,KAAK;EACnB,MAAA,IAAI,CAACq8D,SAAS,CAACxiE,GAAG,CAACnU,OAAO,CAAC,EAAE;EAC3B,QAAA,OAAO,IAAI22E,SAAS,CAAC32E,OAAO,EAAEsa,MAAM,CAAC;EACvC,MAAA;EACA,MAAA,OAAO,IAAI;MACb,CAAC,EACDmqC,eACF,CAAC;EACH,EAAA;EAEAjrD,EAAAA,WAAWA,CAACwG,OAAgB,EAAEsa,MAAwB,EAAE;MACtD,KAAK,CAACta,OAAO,EAAE;EAAEe,MAAAA,EAAE,EAAEg4D;EAAS,KAAC,CAAC;EAEhCrmB,IAAAA,WAAW,CAAC54B,KAAK,EAAE,CAACs6B,SAAS,CAC3B,IAAI,EACJprC,MAAS,CACP;EACE5K,MAAAA,MAAM,EAAE4B;OACT,EACDsa,MACF,CACF,CAAC;EAED,IAAA,IAAI,CAAC+pC,SAAS,CAAC,MAAM3R,WAAW,CAAC54B,KAAK,EAAE,CAACu6B,WAAW,CAAC,IAAI,EAAEr0C,OAAO,CAAC,CAAC;EACtE,EAAA;EACF;;EAEA;EACA;EACA;EACA;EACA;;EAmBA;;EAEA,MAAMg5D,aAAW,GAAG,YAAY;EAChC;EACA;EACA,MAAMD,UAAQ,GAAGC,aAAW;EAE5B,MAAMvU,eAA6D,GAAG;EACpE9Y,EAAAA,SAAS,EAAEz4B,cAAc;EACzBuD,EAAAA,cAAc,EAAEvD;EAClB,CAAC;;EC1HD;EACA;EACA;;;EAmBA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAM0jE,SAAS,SAASrzB,MAAM,CAAC;IACpC,OAAOpvC,GAAGA,CAACnU,OAAgB,EAAoB;MAC7C,MAAMiZ,QAAQ,GAAG,KAAK,CAAC9E,GAAG,CAACnU,OAAO,EAAE+4D,QAAQ,CAAC;MAC7C,IAAI/vD,YAAe,CAACiQ,QAAQ,EAAE29D,SAAS,CAAC,EAAE;EACxC,MAAA,OAAO39D,QAAQ;EACjB,IAAA;EACA,IAAA,OAAO,IAAI;EACb,EAAA;IAEA,OAAOktC,QAAQA,GAAG;EAChB5B,IAAAA,cAAc,CACZyU,WAAW,EACX,CAACh5D,OAAO,EAAEsa,MAAM,KAAK;EACnB,MAAA,IAAI,CAACs8D,SAAS,CAACziE,GAAG,CAACnU,OAAO,CAAC,EAAE;EAC3B,QAAA,OAAO,IAAI42E,SAAS,CAAC52E,OAAO,EAAEsa,MAAM,CAAC;EACvC,MAAA;EACA,MAAA,OAAO,IAAI;MACb,CAAC,EACDuzC,kBACF,CAAC;EACH,EAAA;EAEAr0D,EAAAA,WAAWA,CAACwG,OAAgB,EAAEsa,MAAwB,EAAE;EAAA,IAAA,IAAA4mC,kBAAA;MACtD,KAAK,CAAClhD,OAAO,EAAE;EAAEe,MAAAA,EAAE,EAAEg4D;EAAS,KAAC,CAAC;EAEhC,IAAA,MAAMjL,OAAO,GAAG/O,WAAW,CAACjlC,KAAK,CAAC;EAChClgB,MAAAA,IAAI,EAAE0gB,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAE1gB,IAAI;QAClBq8C,UAAU,EAAE37B,MAAM,KAAA,IAAA,IAANA,MAAM,gBAAA4mC,kBAAA,GAAN5mC,MAAM,CAAE27B,UAAU,cAAAiL,kBAAA,KAAA,MAAA,GAAA,MAAA,GAAlBA,kBAAA,CAAoB/mD,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC;EAClDwxC,MAAAA,SAAS,EAAErxB,MAAM,KAAA,IAAA,IAANA,MAAM,KAAA,MAAA,GAAA,MAAA,GAANA,MAAM,CAAEqxB;EACrB,KAAC,CAAC;MAEFmiB,OAAO,CAAChN,SAAS,CAAC9gD,OAAO,EAAE,IAAI,EAAEsa,MAAM,CAAC;MAExC,IAAI,CAAC+pC,SAAS,CAAC,MAAMyJ,OAAO,CAAC/M,WAAW,CAAC/gD,OAAO,CAAC,CAAC;EACpD,EAAA;EACF;;EAEA;EACA;EACA;;EAmDA;;EAEA,MAAMg5D,WAAW,GAAG,YAAY;EAChC;EACA;EACA,MAAMD,QAAQ,GAAGC,WAAW;EAE5B,MAAMnL,kBAA8D,GAClE7tD,OAAgB,IACb;IACH,OAAO;EACLpG,IAAAA,IAAI,EAAEA,CAACwM,GAAG,EAAElF,KAAK,KAAA;EAAA,MAAA,IAAAiL,IAAA;QAAA,OAAA,CAAAA,IAAA,GACdnD,eAAkB,CAAC9H,KAAK,CAAC,GACtB6oD,uBAAuB,CAAC7oD,KAAK,EAAElB,OAAO,CAAC,GACvC,IAAI,cAAAmM,IAAA,KAAA,MAAA,GAAAA,IAAA,GAAK9O,SAAS;EAAA,IAAA,CAAA;EACxB44C,IAAAA,UAAU,EAAE5iC,cAAc;MAC1Bs4B,SAAS,EAAEA,CAACvlC,GAAG,EAAElF,KAAK,KAAK6R,eAAe,CAAC3M,GAAG,EAAElF,KAAK,CAAC;EACtDuV,IAAAA,cAAc,EAAEvD,cAAc;EAC9BshC,IAAAA,eAAe,EAAEthC,cAAc;EAC/BspC,IAAAA,eAAe,EAAEtpC;KAClB;EACH,CAAC;;EC/KD;EACA;EACA;EACA;EACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECJA;EACA;EACA;EACA;EACA;;AAaAwkC,UAAgB,CAACyO,QAAQ,EAAE;AAC3BzO,aAAmB,CAACyO,QAAQ,EAAE;AAC9BzO,aAAmB,CAACyO,QAAQ,EAAE;AAC9BzO,cAAoB,CAACyO,QAAQ,EAAE;AAC/BzO,SAAe,CAACyO,QAAQ,EAAE;AAC1BzO,SAAe,CAACyO,QAAQ,EAAE;AAC1BzO,WAAiB,CAACyO,QAAQ,EAAE;AAC5BzO,MAAY,CAACyO,QAAQ,EAAE;AACvBzO,UAAgB,CAACyO,QAAQ,EAAE;AAC3BzO,UAAgB,CAACyO,QAAQ,EAAE;AAC3BzO,UAAgB,CAACyO,QAAQ,EAAE;AAC3BzO,YAAkB,CAACyO,QAAQ,EAAE;AAC7BzO,aAAmB,CAACyO,QAAQ,EAAE;AAC9BzO,UAAgB,CAACyO,QAAQ,EAAE;AAC3BzO,cAAoB,CAACyO,QAAQ,EAAE;AAC/BzO,MAAY,CAACyO,QAAQ,EAAE;AACvBzO,MAAY,CAACyO,QAAQ,EAAE;AACvBzO,QAAc,CAACyO,QAAQ,EAAE;AACzBzO,SAAe,CAACyO,QAAQ,EAAE;AAC1BzO,KAAW,CAACyO,QAAQ,EAAE;AAEtBqH,eAAsB,CAACrH,QAAQ,EAAE;AACjCqH,aAAoB,CAACrH,QAAQ,EAAE;AAC/BqH,cAAqB,CAACrH,QAAQ,EAAE;AAChCqH,cAAqB,CAACrH,QAAQ,EAAE;AAChCqH,cAAqB,CAACrH,QAAQ,EAAE;AAChCqH,cAAqB,CAACrH,QAAQ,EAAE;AAChCqH,eAAsB,CAACrH,QAAQ,EAAE;AACjCqH,SAAgB,CAACrH,QAAQ,EAAE;AAC3BqH,aAAoB,CAACrH,QAAQ,EAAE;AAE/BrB,UAAgB,CAACqB,QAAQ,EAAE;AAC3BrB,aAAmB,CAACqB,QAAQ,EAAE;AAC9BrB,OAAa,CAACqB,QAAQ,EAAE;AACxBrB,OAAa,CAACqB,QAAQ,EAAE;AACxBrB,WAAiB,CAACqB,QAAQ,EAAE;AAC5BrB,YAAkB,CAACqB,QAAQ,EAAE;AAC7BrB,OAAa,CAACqB,QAAQ,EAAE;AACxBrB,YAAkB,CAACqB,QAAQ,EAAE;AAC7BrB,WAAiB,CAACqB,QAAQ,EAAE;AAC5BrB,aAAmB,CAACqB,QAAQ,EAAE;EAC9B;AACArB,UAAgB,CAACqB,QAAQ,EAAE;AAC3BrB,cAAoB,CAACqB,QAAQ,EAAE;AAC/BrB,aAAmB,CAACqB,QAAQ,EAAE;AAC9BrB,WAAiB,CAACqB,QAAQ,EAAE;AAC5BrB,WAAiB,CAACqB,QAAQ,EAAE;;EC/D5B;EACA;EACA;EACA;EACA;;;;;;;;;ECJA;EACA;EACA;EACA;EACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECJA;EACA;EACA;EACA;EACA;;;;;;;;;;;;;;;;;;;;ECJA;EACA;EACA;EACA;EACA;;EAKAp9C,QAAQ,CAACiC,cAAc,GAAG,EAAE;;;;;;;;;;;;;;;"}