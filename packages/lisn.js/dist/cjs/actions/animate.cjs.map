{"version":3,"file":"animate.cjs","names":["MC","_interopRequireWildcard","require","MH","_animations","_cssAlter","_domEvents","_text","_action","_debug","_interopRequireDefault","e","__esModule","_getRequireWildcardCache","WeakMap","r","t","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","o","Symbol","iterator","constructor","prototype","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","Array","from","isArray","_arrayLikeToArray","_createForOfIteratorHelper","length","_n","F","s","done","value","f","next","toString","slice","name","test","_classCallCheck","_defineProperties","enumerable","configurable","writable","_toPropertyKey","key","_createClass","_defineProperty","_toPrimitive","toPrimitive","String","Number","Animate","exports","element","logger","debug","Logger","concat","formatAsString","animate","GO_FORWARD","isFirst","undo","GO_BACKWARD","S_TOGGLE","res","GO_TOGGLE","register","registerAction","direction","isInitial","arguments","undefined","debug8","iterateAnimations","animation","setupAnimation","setupAnimationLegacy","pauseTillReady","isPageReady","isBackward","playbackRate","debug9","playState","reverse","play","pause","waitForPageReady","then","isInstanceOf","CSSAnimation","cancelHandler","event","onAnimationCancel","addEventListener","S_CANCEL","removeEventListener","_MH$targetOf","target","targetOf","Animation","effect","KeyframeEffect","_iterator","getAnimations","_step","newAnimation","animationName","err","hasClass","PREFIX_ANIMATE_REVERSE","isPaused","PREFIX_ANIMATE_PAUSE","goBackwards","doPause","resetCssAnimationsNow","removeClassesNow","addClassesNow","apply","removeClasses"],"sources":["../../../src/ts/actions/animate.ts"],"sourcesContent":["/**\n * @module Actions\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport {\n  iterateAnimations,\n  resetCssAnimationsNow,\n} from \"@lisn/utils/animations\";\nimport {\n  hasClass,\n  addClassesNow,\n  removeClasses,\n  removeClassesNow,\n} from \"@lisn/utils/css-alter\";\nimport { isPageReady, waitForPageReady } from \"@lisn/utils/dom-events\";\nimport { formatAsString } from \"@lisn/utils/text\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\nimport debug from \"@lisn/debug/debug\";\nimport { LoggerInterface } from \"@lisn/debug/types\";\n\n/**\n * Plays or reverses all animations on the given element.\n *\n * It works with CSS or Web Animations.\n *\n * **IMPORTANT:** When constructed, it resets and pauses the animations as a\n * form of initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"animate\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <div data-lisn-on-view=\"@animate\"></div>\n * ```\n *\n * @category Animation\n */\nexport class Animate implements Action {\n  /**\n   * (Re)plays the animations forwards.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * (Re)plays the animations backwards.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Reverses the animations from its current direction.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"animate\", (element) => new Animate(element));\n  }\n\n  constructor(element: Element) {\n    const logger = debug\n      ? new debug.Logger({\n          name: `Animate-${formatAsString(element)}`,\n        })\n      : null;\n\n    // initial state is 0% and paused\n    animate(element, GO_FORWARD, logger, true);\n    let isFirst = true;\n\n    this.do = () => animate(element, GO_FORWARD, logger);\n    this.undo = () => animate(element, GO_BACKWARD, logger);\n    this[MC.S_TOGGLE] = () => {\n      const res = animate(element, isFirst ? GO_FORWARD : GO_TOGGLE, logger);\n      isFirst = false;\n      return res;\n    };\n  }\n}\n\n// --------------------\n\ntype AnimateDirection =\n  | typeof GO_FORWARD\n  | typeof GO_BACKWARD\n  | typeof GO_TOGGLE;\n\nconst GO_FORWARD = 0;\nconst GO_BACKWARD = 1;\nconst GO_TOGGLE = 2;\n\nconst animate = (\n  element: Element,\n  direction: AnimateDirection,\n  logger: LoggerInterface | null,\n  isInitial = false,\n) => {\n  debug: logger?.debug8(\"Animating element\");\n  return iterateAnimations(\n    element,\n    /* istanbul ignore next */ // jsdom doesn't support Web Animations\n    (animation) => setupAnimation(animation, direction, logger, isInitial),\n    (element) => setupAnimationLegacy(element, direction, logger, isInitial),\n    isInitial,\n  );\n};\n\n/* istanbul ignore next */ // jsdom doesn't support Web Animations\nconst setupAnimation = (\n  animation: Animation,\n  direction: AnimateDirection,\n  logger: LoggerInterface | null,\n  isInitial: boolean,\n) => {\n  const pauseTillReady = !isPageReady();\n  const isBackward = animation.playbackRate === -1;\n\n  debug: logger?.debug9(\"Setting up animation\", animation, {\n    direction,\n    isBackward,\n  });\n\n  if (\n    direction === GO_TOGGLE ||\n    (direction === GO_FORWARD && isBackward) ||\n    (direction === GO_BACKWARD && !isBackward)\n  ) {\n    debug: logger?.debug9(\"Reversing animation\", animation.playState);\n    animation.reverse();\n  } else if (animation.playState === \"paused\") {\n    debug: logger?.debug9(\"Playing animation\", animation.playState);\n    animation.play();\n  } else {\n    debug: logger?.debug9(\n      \"Animation has played or is playing already\",\n      animation.playState,\n    );\n  }\n\n  if (isInitial || pauseTillReady) {\n    debug: logger?.debug9(\"Pausing animation\", animation.playState);\n    animation.pause();\n\n    if (!isInitial) {\n      // we were only pausing until ready\n      /* istanbul ignore next */\n      waitForPageReady().then(() => {\n        debug: logger?.debug9(\"Restarting animation\", animation.playState);\n        animation.play();\n      });\n    }\n  }\n\n  // If the element is moved (including if wrapped, such as by the ViewTrigger),\n  // this will cancel CSS animations and replace them with new running ones\n  if (MH.isInstanceOf(animation, CSSAnimation)) {\n    const cancelHandler = (event: AnimationPlaybackEvent) =>\n      onAnimationCancel(event, animation, direction, logger, isInitial);\n\n    animation.addEventListener(MC.S_CANCEL, cancelHandler);\n    animation.addEventListener(\"finish\", () =>\n      animation.removeEventListener(MC.S_CANCEL, cancelHandler),\n    );\n  }\n};\n\n/* istanbul ignore next */ // jsdom doesn't support Web Animations\nconst onAnimationCancel = (\n  event: AnimationPlaybackEvent,\n  animation: CSSAnimation,\n  direction: AnimateDirection,\n  logger: LoggerInterface | null,\n  isInitial: boolean,\n) => {\n  // setup again the new animation\n  debug: logger?.debug9(\"Animation cancelled, re-setting up new one\");\n  const target = MH.targetOf(event);\n  if (!MH.isInstanceOf(target, Animation)) {\n    return;\n  }\n\n  const effect = target.effect;\n  if (!MH.isInstanceOf(effect, KeyframeEffect)) {\n    return;\n  }\n\n  for (const newAnimation of MH.targetOf(effect)?.getAnimations() || []) {\n    if (\n      MH.isInstanceOf(newAnimation, CSSAnimation) &&\n      newAnimation.animationName === animation.animationName\n    ) {\n      setupAnimation(newAnimation, direction, logger, isInitial);\n      break;\n    }\n  }\n};\n\nconst setupAnimationLegacy = (\n  element: Element,\n  direction: AnimateDirection,\n  logger: LoggerInterface | null,\n  isInitial: boolean,\n) => {\n  const isBackward = hasClass(element, MC.PREFIX_ANIMATE_REVERSE);\n  const isPaused = hasClass(element, MC.PREFIX_ANIMATE_PAUSE);\n\n  const pauseTillReady = !isPageReady();\n\n  const goBackwards =\n    direction === GO_BACKWARD || (direction === GO_TOGGLE && !isBackward);\n\n  const doPause = isInitial || pauseTillReady;\n\n  debug: logger?.debug9(\"Setting up legacy animations\", element, {\n    direction,\n    isBackward,\n    isPaused,\n    goBackwards,\n    doPause,\n  });\n\n  if (goBackwards === isBackward && doPause === isPaused) {\n    // nothing to do\n    debug: logger?.debug9(\"No need to reset or pause animation\");\n    return;\n  }\n\n  resetCssAnimationsNow(element);\n\n  removeClassesNow(element, MC.PREFIX_ANIMATE_PAUSE, MC.PREFIX_ANIMATE_REVERSE);\n  addClassesNow(\n    element,\n    ...(goBackwards ? [MC.PREFIX_ANIMATE_REVERSE] : []),\n    ...(doPause ? [MC.PREFIX_ANIMATE_PAUSE] : []),\n  );\n\n  if (!isInitial && pauseTillReady) {\n    waitForPageReady().then(() =>\n      removeClasses(element, MC.PREFIX_ANIMATE_PAUSE),\n    );\n  }\n};\n"],"mappings":"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","ignoreList":[]}