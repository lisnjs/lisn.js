{"version":3,"file":"useWidget.js","names":["useRef","useEffect","useImperativeHandle","useDeepMemo","useWidget","newWidget","config","widgetRef","configs","Array","elementRef","widgetRefsInternal","configsMemo","current","Element","thisConfig","widget","push","widgets","destroy","getWidget","_widgetRefsInternal$c","getWidgets"],"sources":["../../src/useWidget.ts"],"sourcesContent":["\"use client\";\nimport {\n  useRef,\n  useEffect,\n  useImperativeHandle,\n  RefObject,\n  ComponentRef,\n  ElementType,\n} from \"react\";\n\nimport type { Widget } from \"lisn.js\";\nimport { WidgetComponentRef } from \"./types\";\nimport { useDeepMemo } from \"./useDeepMemo\";\n\nexport const useWidget = <\n  T extends ElementType,\n  W extends Widget,\n  C extends object,\n>(\n  newWidget: (element: Element, config?: C) => W | null,\n  config?: C | C[],\n  widgetRef?: RefObject<WidgetComponentRef<W> | null>,\n) => {\n  const configs = config instanceof Array ? config : config ? [config] : [];\n\n  const elementRef = useRef<ComponentRef<T>>(null);\n  const widgetRefsInternal = useRef<W[]>([]);\n  const configsMemo = useDeepMemo(configs);\n\n  useEffect(() => {\n    if (elementRef.current instanceof Element) {\n      for (const thisConfig of configsMemo) {\n        const widget = newWidget(elementRef.current, thisConfig);\n\n        if (widget) {\n          widgetRefsInternal.current.push(widget);\n        }\n      }\n    }\n    const widgets = widgetRefsInternal.current;\n\n    return () => {\n      for (const widget of widgets) {\n        widget.destroy();\n      }\n      widgetRefsInternal.current = [];\n    };\n  }, [configsMemo, newWidget]);\n\n  useImperativeHandle(widgetRef, () => {\n    return {\n      getWidget: () => widgetRefsInternal.current[0] ?? null,\n      getWidgets: () => widgetRefsInternal.current,\n    };\n  });\n\n  return elementRef;\n};\n"],"mappings":"AAAA,YAAY;;AACZ,SACEA,MAAM,EACNC,SAAS,EACTC,mBAAmB,QAId,OAAO;AAId,SAASC,WAAW,QAAQ,eAAe;AAE3C,OAAO,MAAMC,SAAS,GAAGA,CAKvBC,SAAqD,EACrDC,MAAgB,EAChBC,SAAmD,KAChD;EACH,MAAMC,OAAO,GAAGF,MAAM,YAAYG,KAAK,GAAGH,MAAM,GAAGA,MAAM,GAAG,CAACA,MAAM,CAAC,GAAG,EAAE;EAEzE,MAAMI,UAAU,GAAGV,MAAM,CAAkB,IAAI,CAAC;EAChD,MAAMW,kBAAkB,GAAGX,MAAM,CAAM,EAAE,CAAC;EAC1C,MAAMY,WAAW,GAAGT,WAAW,CAACK,OAAO,CAAC;EAExCP,SAAS,CAAC,MAAM;IACd,IAAIS,UAAU,CAACG,OAAO,YAAYC,OAAO,EAAE;MACzC,KAAK,MAAMC,UAAU,IAAIH,WAAW,EAAE;QACpC,MAAMI,MAAM,GAAGX,SAAS,CAACK,UAAU,CAACG,OAAO,EAAEE,UAAU,CAAC;QAExD,IAAIC,MAAM,EAAE;UACVL,kBAAkB,CAACE,OAAO,CAACI,IAAI,CAACD,MAAM,CAAC;QACzC;MACF;IACF;IACA,MAAME,OAAO,GAAGP,kBAAkB,CAACE,OAAO;IAE1C,OAAO,MAAM;MACX,KAAK,MAAMG,MAAM,IAAIE,OAAO,EAAE;QAC5BF,MAAM,CAACG,OAAO,CAAC,CAAC;MAClB;MACAR,kBAAkB,CAACE,OAAO,GAAG,EAAE;IACjC,CAAC;EACH,CAAC,EAAE,CAACD,WAAW,EAAEP,SAAS,CAAC,CAAC;EAE5BH,mBAAmB,CAACK,SAAS,EAAE,MAAM;IACnC,OAAO;MACLa,SAAS,EAAEA,CAAA;QAAA,IAAAC,qBAAA;QAAA,QAAAA,qBAAA,GAAMV,kBAAkB,CAACE,OAAO,CAAC,CAAC,CAAC,cAAAQ,qBAAA,cAAAA,qBAAA,GAAI,IAAI;MAAA;MACtDC,UAAU,EAAEA,CAAA,KAAMX,kBAAkB,CAACE;IACvC,CAAC;EACH,CAAC,CAAC;EAEF,OAAOH,UAAU;AACnB,CAAC","ignoreList":[]}