{"version":3,"file":"gesture-wheel.cjs","names":["MC","_interopRequireWildcard","require","MH","_directions","_math","_normalizeWheel","_gesture","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","getWheelGestureFragment","events","options","isIterableObject","direction","S_NONE","intent","deltaX","deltaY","deltaZ","event","isWheelEvent","type","S_WHEEL","data","normalizeWheel","thisIntent","S_SCROLL","thisDeltaX","pixelX","thisDeltaY","pixelY","thisDeltaZ","maxDelta","havingMaxAbs","ctrlKey","percentage","abs","S_ZOOM","shiftKey","addDeltaZ","S_UNKNOWN","S_AMBIGUOUS","S_IN","S_OUT","getVectorDirection","angleDiffThreshold","device","exports"],"sources":["../../../src/ts/utils/gesture-wheel.ts"],"sourcesContent":["/**\n * @module Utils\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { Direction, GestureIntent } from \"@lisn/globals/types\";\n\nimport { getVectorDirection } from \"@lisn/utils/directions\";\n\nimport { havingMaxAbs } from \"@lisn/utils/math\";\nimport { normalizeWheel } from \"@lisn/utils/normalize-wheel\";\n\nimport { GestureFragment, addDeltaZ } from \"@lisn/utils/gesture\";\n\n/**\n * Returns a {@link GestureFragment} for the given events. Only \"wheel\" events\n * will be considered.\n *\n * If there are no \"wheel\" events in the given list of events, returns `false`.\n *\n * The deltas of all events are summed together before determining final delta\n * and direction.\n *\n * If the events are of conflicting types, i.e. some scroll, some zoom, then\n * the intent will be \"unknown\" and the direction will be \"ambiguous\".\n *\n * If the deltas sum up to 0, the direction will be \"none\".\n *\n * **IMPORTANT NOTES ON THE DELTA VALUES**\n *\n * For wheel gestures the deltas are _highly_ unreliable, especially when\n * zooming (Control + wheel or pinching trackpad). You should not assume they\n * correspond to the would-be scroll or zoom amount that the browser would do.\n * But they can be used to determine relative amounts for animating, etc.\n *\n * If the browser reports the delta values of a WheelEvent to be in mode \"line\",\n * then a configurable fixed value is used\n * ({@link Settings.settings.deltaLineHeight | settings.deltaLineHeight}).\n *\n * If the browser reports the delta values of a WheelEvent to be in mode \"page\",\n * then a configurable fixed value is used\n * ({@link Settings.settings.deltaPageWidth | settings.deltaPageWidth} and\n * ({@link Settings.settings.deltaPageHeight | settings.deltaPageHeight}).\n *\n * For zoom intents `deltaZ` is based on what the browser reports as the\n * `deltaY`, which in most browsers roughly corresponds to a percentage zoom\n * factor.\n *\n * @param {} [options.angleDiffThreshold] See {@link getVectorDirection}.\n *                                        Default is 5.\n *\n * @return {} `false` if there are no \"wheel\" events in the list, otherwise a\n * {@link GestureFragment}.\n *\n * @category Gestures\n */\nexport const getWheelGestureFragment = (\n  events: Event | readonly Event[],\n  options?: {\n    angleDiffThreshold?: number;\n  },\n): GestureFragment | null | false => {\n  if (!MH.isIterableObject(events)) {\n    events = [events];\n  }\n\n  let direction: Direction = MC.S_NONE;\n  let intent: GestureIntent | null = null;\n  let deltaX = 0,\n    deltaY = 0,\n    deltaZ = 1;\n\n  for (const event of events) {\n    if (!MH.isWheelEvent(event) || event.type !== MC.S_WHEEL) {\n      continue;\n    }\n\n    const data = normalizeWheel(event);\n    let thisIntent: GestureIntent = MC.S_SCROLL;\n    let thisDeltaX = data.pixelX;\n    let thisDeltaY = data.pixelY;\n    let thisDeltaZ = 1;\n    const maxDelta = havingMaxAbs(thisDeltaX, thisDeltaY);\n\n    if (event.ctrlKey && !thisDeltaX) {\n      // Browsers report negative deltaY for zoom in, so swap sign\n      let percentage = -maxDelta;\n      // If it's more than 50, assume it's a mouse wheel => delta is roughly\n      // multiple of 10%. Otherwise a trackpad => delta is roughly multiple of 1%\n      if (MH.abs(percentage) >= 50) {\n        percentage /= 10;\n      }\n\n      thisDeltaZ = 1 + percentage / 100;\n\n      thisDeltaX = thisDeltaY = 0;\n      thisIntent = MC.S_ZOOM;\n    } else if (event.shiftKey && !thisDeltaX) {\n      // Holding Shift while turning wheel or swiping trackpad in vertically\n      // results in sideways scroll.\n      thisDeltaX = thisDeltaY;\n      thisDeltaY = 0;\n    }\n\n    deltaX += thisDeltaX;\n    deltaY += thisDeltaY;\n    deltaZ = addDeltaZ(deltaZ, thisDeltaZ);\n\n    if (!thisIntent) {\n      // not a relevant key\n    } else if (!intent) {\n      intent = thisIntent;\n    } else if (intent !== thisIntent) {\n      // mixture of zoom and scroll\n      intent = MC.S_UNKNOWN;\n    }\n  }\n\n  if (!intent) {\n    return false; // no relevant events\n  } else if (intent === MC.S_UNKNOWN) {\n    direction = MC.S_AMBIGUOUS;\n  } else if (intent === MC.S_ZOOM) {\n    direction = deltaZ > 1 ? MC.S_IN : deltaZ < 1 ? MC.S_OUT : MC.S_NONE;\n  } else {\n    direction = getVectorDirection(\n      [deltaX, deltaY],\n      options?.angleDiffThreshold,\n    );\n  }\n\n  return direction === MC.S_NONE\n    ? false\n    : {\n        device: MC.S_WHEEL,\n        direction,\n        intent,\n        deltaX,\n        deltaY,\n        deltaZ,\n      };\n};\n"],"mappings":"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","ignoreList":[]}