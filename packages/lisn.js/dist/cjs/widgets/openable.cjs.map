{"version":3,"file":"openable.cjs","names":["MC","_interopRequireWildcard","require","MH","_settings","_cssAlter","_domAlter","_domEvents","_domOptimize","_domQuery","_event","_log","_math","_misc","_tasks","_position","_size","_validation","_callback","_sizeWatcher","_viewWatcher","_widget","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_defineProperty","_toPropertyKey","value","enumerable","configurable","writable","_toPrimitive","Symbol","toPrimitive","TypeError","String","Number","registerOpenable","name","newOpenable","configValidator","registerWidget","element","config","isHTMLElement","Openable","logError","usageError","exports","Widget","_instances$get","instances","constructor","properties","isModal","isOffcanvas","openCallbacks","newSet","closeCallbacks","isOpen","open","isDisabled","callback","invoke","setHasModal","setBooleanData","root","PREFIX_IS_OPEN","close","delHasModal","scrollWrapperToTop","unsetBooleanData","waitForDelay","waitForMeasureTime","elScrollTo","outerWrapper","top","left","S_TOGGLE","onOpen","handler","add","wrapCallback","onClose","getRoot","getContainer","container","getTriggers","triggers","keys","getTriggerConfigs","newMap","entries","onDestroy","clear","setupElements","Collapsible","register","WIDGET_NAME_COLLAPSIBLE","el","collapsibleConfigValidator","_config$autoClose","_config$reverse","isHorizontal","horizontal","orientation","S_HORIZONTAL","S_VERTICAL","onSetup","trigger","triggerConfig","insertCollapsibleIcon","setDataNow","PREFIX_ORIENTATION","id","className","autoClose","closeButton","wrapTriggers","wrapper","childrenOf","setData","PREFIX_REVERSE","reverse","disableInitialTransition","disableTransitionTimer","tempEnableTransition","removeClasses","PREFIX_TRANSITION_DISABLE","clearTimer","transitionDuration","getMaxTransitionDuration","setTimer","addClasses","peek","peekSize","isString","getStyleProp","VAR_PEEK_SIZE","PREFIX_PEEK","setStyleProp","updateWidth","width","getComputedStyleProp","S_WIDTH","VAR_JS_COLLAPSIBLE_WIDTH","then","delStyleProp","Popup","WIDGET_NAME_POPUP","popupConfigValidator","_config$autoClose2","_config$closeButton","position","S_AUTO","PREFIX_PLACE","contentSize","containerView","promiseAll","SizeWatcher","reuse","fetchCurrentSize","ViewWatcher","fetchCurrentView","placement","fetchPopupPlacement","Modal","WIDGET_NAME_MODAL","modalConfigValidator","_config$autoClose3","_config$closeButton2","Offcanvas","WIDGET_NAME_OFFCANVAS","offcanvasConfigValidator","_config$autoClose4","_config$closeButton3","S_RIGHT","newWeakMap","PREFIX_CLOSE_BTN","prefixName","S_REVERSE","PREFIX_OPENS_ON_HOVER","PREFIX_LINE","PREFIX_ICON_POSITION","PREFIX_TRIGGER_ICON","PREFIX_ICON_WRAPPER","S_ARIA_EXPANDED","ARIA_PREFIX","S_ARIA_MODAL","prefixCssVar","prefixCssJsVar","MIN_CLICK_TIME_AFTER_HOVER_OPEN","S_ARROW_UP","S_ARROW","S_UP","S_ARROW_DOWN","S_DOWN","S_ARROW_LEFT","S_LEFT","S_ARROW_RIGHT","ARROW_TYPES","ICON_CLOSED_TYPES","ICON_OPEN_TYPES","isValidIconClosed","includes","isValidIconOpen","triggerConfigValidator","validateString","key","validateStrList","toArrayIfSingle","validateBoolean","icon","toBoolean","isValidPosition","iconClosed","iconOpen","hover","validateBooleanOrString","v","isValidTwoFoldPosition","getPrefixedNames","pref","_root","_overlay","_innerWrapper","_outerWrapper","_content","_container","_trigger","_containerForSelect","_triggerForSelect","_contentId","findContainer","content","cls","_currWidget$getRoot","currWidget","childRef","parentOf","closest","findTriggers","prefixedNames","getTriggerSelector","suffix","contentId","getData","docQuerySelectorAll","arrayFrom","querySelectorAll","filter","contains","getTriggersFrom","inputTriggers","triggerMap","addTrigger","createElement","isInlineTag","tagName","wrapElement","ignoreMove","isArray","getWidgetConfig","isInstanceOf","Map","widget","_properties$wrapTrigg","innerWrapper","wrapElementNow","placeholder","overlay","moveElement","to","addClassesNow","domID","getOrAssignID","setAttr","S_ROLE","closeBtn","createButton","addEventListenerTo","S_CLICK","settings","lightThemeClassName","darkThemeClassName","hasClass","elements","delData","unsetAttr","waitForMutateTime","replaceElementNow","moveElementNow","removeClassesNow","delAttr","S_ARIA_CONTROLS","delDataNow","deleteKey","waitForInteractive","destroy","isDestroyed","getBody","setBooleanDataNow","S_HOVER","unsetBooleanDataNow","setupListeners","doc","getDoc","hoverTimeOpened","isPointerOver","activeTrigger","isTrigger","getDefaultWidgetSelector","shouldPreventDefault","_triggers$get$prevent","_triggers$get","preventDefault","usesHover","_triggers$get2","usesAutoClose","_ref","_triggers$get3","toggleTrigger","event","openIt","currentTargetOf","isElement","timeSince","S_POINTERENTER","setIsPointerOver","S_POINTERLEAVE","pointerLeft","unsetIsPointerOver","isTouchPointerEvent","pointerEntered","timeNow","closeIfEscape","closeIfClickOutside","target","targetOf","maybeSetupAutoCloseListeners","remove","addOrRemove","removeEventListenerFrom","setupOrCleanup","widgetConfig","_triggerConfig$icon","_triggerConfig$iconCl","_triggerConfig$iconOp","iconPosition","l","line","getBooleanData","containerPosition","relative","containerTop","S_TOP","containerBottom","S_BOTTOM","containerLeft","containerRight","containerHMiddle","hMiddle","containerVMiddle","vMiddle","vpSize","fetchViewportSize","popupWidth","border","popupHeight","S_HEIGHT","placementVars","bottom","right","keyWithMaxVal","undefined","finalPlacement","alignmentVars","middle","min","alignment"],"sources":["../../../src/ts/widgets/openable.ts"],"sourcesContent":["/**\n * @module Widgets\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { settings } from \"@lisn/globals/settings\";\n\nimport { XYDirection, Position } from \"@lisn/globals/types\";\n\nimport {\n  disableInitialTransition,\n  hasClass,\n  addClasses,\n  addClassesNow,\n  removeClasses,\n  removeClassesNow,\n  getData,\n  getBooleanData,\n  setData,\n  setDataNow,\n  setBooleanData,\n  setBooleanDataNow,\n  unsetBooleanData,\n  unsetBooleanDataNow,\n  delData,\n  delDataNow,\n  setHasModal,\n  delHasModal,\n  getStyleProp,\n  setStyleProp,\n  delStyleProp,\n  getComputedStyleProp,\n  getMaxTransitionDuration,\n} from \"@lisn/utils/css-alter\";\nimport {\n  wrapElement,\n  wrapElementNow,\n  moveElement,\n  moveElementNow,\n  replaceElementNow,\n  getOrAssignID,\n} from \"@lisn/utils/dom-alter\";\nimport { waitForInteractive } from \"@lisn/utils/dom-events\";\nimport {\n  waitForMeasureTime,\n  waitForMutateTime,\n} from \"@lisn/utils/dom-optimize\";\nimport { isInlineTag } from \"@lisn/utils/dom-query\";\nimport { addEventListenerTo, removeEventListenerFrom } from \"@lisn/utils/event\";\nimport { logError } from \"@lisn/utils/log\";\nimport { keyWithMaxVal } from \"@lisn/utils/math\";\nimport { toBoolean, toArrayIfSingle } from \"@lisn/utils/misc\";\nimport { waitForDelay } from \"@lisn/utils/tasks\";\nimport { isValidPosition, isValidTwoFoldPosition } from \"@lisn/utils/position\";\nimport { fetchViewportSize } from \"@lisn/utils/size\";\nimport {\n  validateStrList,\n  validateBoolean,\n  validateBooleanOrString,\n  validateString,\n} from \"@lisn/utils/validation\";\n\nimport { wrapCallback } from \"@lisn/modules/callback\";\n\nimport { SizeWatcher, SizeData } from \"@lisn/watchers/size-watcher\";\nimport { ViewWatcher, ViewData } from \"@lisn/watchers/view-watcher\";\n\nimport {\n  Widget,\n  WidgetHandler,\n  WidgetCallback,\n  WidgetConfigValidator,\n  WidgetConfigValidatorObject,\n  registerWidget,\n  getWidgetConfig,\n  getDefaultWidgetSelector,\n} from \"@lisn/widgets/widget\";\n\n/* ********************\n * Base Openable\n * ********************/\n\nexport type OpenableCreateFn<Config extends Record<string, unknown>> = (\n  element: HTMLElement,\n  config?: Config,\n) => Openable;\n\n/**\n * Enables automatic setting up of an {@link Openable} widget from an\n * elements matching its content element selector (`[data-lisn-<name>]` or\n * `.lisn-<name>`).\n *\n * The name you specify here should generally be the same name you pass in\n * {@link OpenableProperties.name | options.name} to the\n * {@link Openable.constructor} but it does not need to be the same.\n *\n * @param name            The name of the openable. Should be in kebab-case.\n * @param newOpenable     Called for every element matching the selector.\n * @param configValidator A validator object, or a function that returns such\n *                        an object, for all options supported by the widget.\n *\n * @see {@link registerWidget}\n */\nexport const registerOpenable = <Config extends Record<string, unknown>>(\n  name: string,\n  newOpenable: OpenableCreateFn<Config>,\n  configValidator?: null | WidgetConfigValidator<Config>,\n) => {\n  registerWidget(\n    name,\n    (element, config) => {\n      if (MH.isHTMLElement(element)) {\n        if (!Openable.get(element)) {\n          return newOpenable(element, config);\n        }\n      } else {\n        logError(MH.usageError(\"Openable widget supports only HTMLElement\"));\n      }\n\n      return null;\n    },\n    configValidator,\n  );\n};\n\n/**\n * {@link Openable} is an abstract base class. You should not directly\n * instantiate it but can inherit it to create your own custom openable widget.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Openable}\n * widget, regardless of type, on a given element. Use {@link Openable.get} to\n * get an existing instance if any. If there is already an {@link Openable}\n * widget of any type on this element, it will be destroyed!\n *\n * @see {@link registerOpenable}\n */\nexport abstract class Openable extends Widget {\n  /**\n   * Opens the widget unless it is disabled.\n   */\n  readonly open: () => Promise<void>;\n\n  /**\n   * Closes the widget.\n   */\n  readonly close: () => Promise<void>;\n\n  /**\n   * Closes the widget if it is open, or opens it if it is closed (unless\n   * it is disabled).\n   */\n  readonly toggle: () => Promise<void>;\n\n  /**\n   * The given handler will be called when the widget is open.\n   *\n   * If it returns a promise, it will be awaited upon.\n   */\n  readonly onOpen: (handler: WidgetHandler) => void;\n\n  /**\n   * The given handler will be called when the widget is closed.\n   *\n   * If it returns a promise, it will be awaited upon.\n   */\n  readonly onClose: (handler: WidgetHandler) => void;\n\n  /**\n   * Returns true if the widget is currently open.\n   */\n  readonly isOpen: () => boolean;\n\n  /**\n   * Returns the root element created by us that wraps the original content\n   * element passed to the constructor. It is located in the content element's\n   * original place.\n   */\n  readonly getRoot: () => HTMLElement;\n\n  /**\n   * Returns the element that was found to be the container. It is the closest\n   * ancestor that has a `lisn-collapsible-container` class, or if no such\n   * ancestor then the immediate parent of the content element.\n   */\n  readonly getContainer: () => HTMLElement | null;\n\n  /**\n   * Returns the trigger elements, if any. Note that these may be wrappers\n   * around the original triggers passed.\n   */\n  readonly getTriggers: () => Element[];\n\n  /**\n   * Returns the trigger elements along with their configuration.\n   */\n  readonly getTriggerConfigs: () => Map<Element, OpenableTriggerConfig>;\n\n  /**\n   * Retrieve an existing widget by its content element or any of its triggers.\n   *\n   * If the element is already part of a configured {@link Openable} widget,\n   * the widget instance is returned. Otherwise `null`.\n   *\n   * Note that trigger elements are not guaranteed to be unique among openable\n   * widgets as the same element can be a trigger for multiple such widgets. If\n   * the element you pass is a trigger, then the last openable widget that was\n   * created for it will be returned.\n   */\n  static get(element: Element): Openable | null {\n    // We manage the instances here since we also map associated elements and\n    // not just the main content element that created the widget.\n    return instances.get(element) ?? null;\n  }\n\n  constructor(element: HTMLElement, properties: OpenableProperties) {\n    super(element);\n\n    const { isModal, isOffcanvas } = properties;\n\n    const openCallbacks = MH.newSet<WidgetCallback>();\n    const closeCallbacks = MH.newSet<WidgetCallback>();\n\n    let isOpen = false;\n\n    // ----------\n\n    const open = async () => {\n      if (this.isDisabled() || isOpen) {\n        return;\n      }\n\n      isOpen = true;\n\n      for (const callback of openCallbacks) {\n        await callback.invoke(this);\n      }\n\n      if (isModal) {\n        setHasModal();\n      }\n\n      await setBooleanData(root, PREFIX_IS_OPEN);\n    };\n\n    // ----------\n\n    const close = async () => {\n      if (this.isDisabled() || !isOpen) {\n        return;\n      }\n\n      isOpen = false;\n\n      for (const callback of closeCallbacks) {\n        await callback.invoke(this);\n      }\n\n      if (isModal) {\n        delHasModal();\n      }\n\n      if (isOffcanvas) {\n        scrollWrapperToTop(); // no need to await\n      }\n\n      await unsetBooleanData(root, PREFIX_IS_OPEN);\n    };\n\n    // ----------\n\n    const scrollWrapperToTop = async () => {\n      // Wait a bit before scrolling since the hiding of the element is animated.\n      // Assume no more than 1s animation time.\n      await waitForDelay(1000);\n      await waitForMeasureTime();\n      MH.elScrollTo(outerWrapper, {\n        top: 0,\n        left: 0,\n      });\n    };\n\n    // --------------------\n\n    this.open = open;\n    this.close = close;\n    this[MC.S_TOGGLE] = () => (isOpen ? close() : open());\n    this.onOpen = (handler) => openCallbacks.add(wrapCallback(handler));\n    this.onClose = (handler) => closeCallbacks.add(wrapCallback(handler));\n    this.isOpen = () => isOpen;\n    this.getRoot = () => root;\n    this.getContainer = () => container;\n    this.getTriggers = () => [...triggers.keys()];\n    this.getTriggerConfigs = () => MH.newMap([...triggers.entries()]);\n\n    this.onDestroy(() => {\n      openCallbacks.clear();\n      closeCallbacks.clear();\n    });\n\n    const { root, container, triggers, outerWrapper } = setupElements(\n      this,\n      element,\n      properties,\n    );\n  }\n}\n\n/**\n * Per-trigger based configuration. Can either be given as an object as the\n * value of the {@link OpenableProperties.triggers} map, or it can be set as a\n * string configuration in the `data-lisn-<name>-trigger` data attribute. See\n * {@link getWidgetConfig} for the syntax.\n *\n * @example\n * ```html\n * <div data-lisn-collapsible-trigger=\"auto-close\n *                                     | icon=right\n *                                     | icon-closed=arrow-down\n *                                     | icon-open=x\"\n * ></div>\n * ```\n *\n * @interface\n */\nexport type OpenableTriggerConfig = {\n  /**\n   * The DOM ID to set on the trigger. Will result in the trigger element, which\n   * could be a wrapper around the original element (as in the case of {@link\n   * Collapsible} you passed, getting this ID.\n   *\n   * **IMPORTANT:** If the trigger element already has an ID and is not being\n   * wrapped, then this will override the ID and it _won't_ be restored on destroy.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * Class name(s) for the trigger. Will result in the trigger element, which\n   * could be a wrapper around the original element you passed, getting these\n   * classes.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * Override the widget's {@link OpenableProperties.autoClose} for this trigger.\n   *\n   * @defaultValue undefined // Widget default\n   */\n  autoClose?: boolean;\n\n  /**\n   * Open the openable when this trigger is hovered.\n   *\n   * If the device is touch and {@link OpenableProperties.autoClose} is enabled,\n   * the widget will be closed shortly after the pointer leaves both the\n   * trigger and the root element.\n   *\n   * @defaultValue false\n   */\n  hover?: boolean;\n\n  /**\n   * Whether to prevent default click action.\n   *\n   * @defaultValue true\n   */\n  preventDefault?: boolean;\n\n  /**\n   * Override the widget's {@link CollapsibleConfig.icon} for this trigger.\n   *\n   * Currently only relevant for {@link Collapsible}s.\n   *\n   * @defaultValue undefined // Widget default\n   */\n  icon?: false | Position;\n\n  /**\n   * Override the widget's {@link CollapsibleConfig.iconClosed} for this\n   * trigger.\n   *\n   * Currently only relevant for {@link Collapsible}s.\n   *\n   * @defaultValue undefined // Widget default\n   */\n  iconClosed?: \"plus\" | `arrow-${XYDirection}`;\n\n  /**\n   * Override the widget's {@link CollapsibleConfig.iconOpen} for this\n   * trigger.\n   *\n   * Currently only relevant for {@link Collapsible}s.\n   *\n   * @defaultValue undefined // Widget default\n   */\n  iconOpen?: \"minus\" | \"x\" | `arrow-${XYDirection}`;\n};\n\n/**\n * @interface\n */\nexport type OpenableProperties = {\n  /**\n   * The name of the _type_ of the openable. Will set the class prefix to\n   * `lisn-<name>`.\n   */\n  name: string;\n\n  /**\n   * The DOM ID to set on the openable. Will result in the top-level root\n   * element that's created by us getting this ID.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * Class name(s) or a list of class names to set on the openable. Will result\n   * in the top-level root element that's created by us getting these classes.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * Whether to auto-close the widget on clicking outside the content element\n   * or on pressing Escape key. Furthermore, if any trigger opens the widget on\n   * {@link OpenableTriggerConfig.hover}, the widget will be closed when the\n   * pointer leaves both the trigger and the root.\n   *\n   * This is true by default for {@link Popup}, {@link Modal} and {@link Offcanvas}.\n   */\n  autoClose: boolean;\n\n  /**\n   * If true, then while the widget is open, the `document.body` will be set to\n   * `overflow: hidden`.\n   *\n   * This is true for {@link Modal}.\n   */\n  isModal: boolean;\n\n  /**\n   * If true, then the content element is assumed to be possibly scrollable and\n   * will be scrolled back to its top after the widget is closed.\n   *\n   * This is true for {@link Modal} and {@link Offcanvas}.\n   */\n  isOffcanvas: boolean;\n\n  /**\n   * Add a close button at the top right.\n   *\n   * This is true by default for {@link Modal} and {@link Offcanvas}.\n   */\n  closeButton: boolean;\n\n  /**\n   * The elements that open the widget when clicked on. You can also pass a map\n   * whose keys are the elements and values are {@link OpenableTriggerConfig}\n   * objects.\n   *\n   * If not given, then the elements that will be used as triggers are\n   * discovered in the following way (`<name>` is what is given as\n   * {@link name}):\n   * 1. If the content element has a `data-lisn-<name>-content-id` attribute,\n   *    then it must be a unique (for the current page) ID. In this case, the\n   *    trigger elements will be any element in the document that has a\n   *    `lisn-<name>-trigger` class or `data-lisn-<name>-trigger` attribute\n   *    and the same `data-lisn-<name>-content-id` attribute.\n   * 2. Otherwise, the closest ancestor that has a `lisn-<name>-container`\n   *    class, or if no such ancestor then the immediate parent of the content\n   *    element, is searched for any elements that have a `lisn-<name>-trigger`\n   *    class or `data-lisn-<name>-trigger` attribute and that do _not_ have a\n   *    `data-lisn-<name>-content-id` attribute, and that are _not_ children of\n   *    the content element.\n   *\n   * @defaultValue undefined\n   */\n  triggers?: Element[] | Map<Element, OpenableTriggerConfig | null>;\n\n  /**\n   * Whether to wrap each trigger in a new element.\n   *\n   * @defaultValue false\n   */\n  wrapTriggers?: boolean;\n\n  /**\n   * Hook to run once the widget is fully setup (which happens asynchronously).\n   *\n   * It is called during \"mutate time\". See {@link waitForMutateTime}.\n   *\n   * @defaultValue undefined\n   */\n  onSetup?: () => void;\n};\n\n/* ********************\n * Collapsible\n * ********************/\n\n/**\n * Configures the given element as a {@link Collapsible} widget.\n *\n * The Collapsible widget sets up the given element to be collapsed and\n * expanded upon activation. Activation can be done manually by calling\n * {@link open} or when clicking on any of the given\n * {@link CollapsibleConfig.triggers | triggers}.\n *\n * **NOTE:** The Collapsible widget always wraps each trigger element in\n * another element in order to allow positioning the icon, if any.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Openable}\n * widget, regardless of type, on a given element. Use {@link Openable.get} to\n * get an existing instance if any. If there is already an {@link Openable}\n * widget of any type on this element, it will be destroyed!\n *\n * -----\n *\n * You can use the following dynamic attributes or CSS properties in your\n * stylesheet:\n *\n * The following dynamic attributes are set on the root element that is created\n * by LISN and has a class `lisn-collapsible__root`:\n * - `data-lisn-is-open`: `\"true\"` or `\"false\"`\n * - `data-lisn-reverse`: `\"true\"` or `\"false\"`\n * - `data-lisn-orientation`: `\"horizontal\"` or `\"vertical\"`\n *\n * The following dynamic attributes are set on each trigger:\n * - `data-lisn-opens-on-hover: `\"true\"` or `\"false\"`\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-collapsible` class or `data-lisn-collapsible` attribute set on the\n *   element that holds the content of the collapsible\n * - `lisn-collapsible-trigger` class or `data-lisn-collapsible-trigger`\n *   attribute set on elements that should act as the triggers.\n *   If using a data attribute, you can configure the trigger via the value\n *   with a similar syntax to the configuration of the openable widget. For\n *   example:\n *   - Set the attribute to `\"hover\"` in order to have this trigger open the\n *     collapsible on hover _in addition to click_.\n *   - Set the attribute to `\"hover|auto-close\"` in order to have this trigger\n *     open the collapsible on hover but and override\n *     {@link CollapsibleConfig.autoClose} with true.\n *\n * When using auto-widgets, the elements that will be used as triggers are\n * discovered in the following way:\n * 1. If the content element has a `data-lisn-collapsible-content-id` attribute,\n *    then it must be a unique (for the current page) ID. In this case, the\n *    trigger elements will be any element in the document that has a\n *    `lisn-collapsible-trigger` class or `data-lisn-collapsible-trigger`\n *    attribute and the same `data-lisn-collapsible-content-id` attribute.\n * 2. Otherwise, the closest ancestor that has a `lisn-collapsible-container`\n *    class, or if no such ancestor then the immediate parent of the content\n *    element, is searched for any elements that have a\n *    `lisn-collapsible-trigger` class or `data-lisn-collapsible-trigger`\n *    attribute and that do _not_ have a `data-lisn-collapsible-content-id`\n *    attribute, and that are _not_ children of the content element.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This defines a simple collapsible with one trigger.\n *\n * ```html\n * <div>\n *   <div class=\"lisn-collapsible-trigger\">Expand</div>\n *   <div class=\"lisn-collapsible\">\n *     Some long content here...\n *   </div>\n * </div>\n * ```\n *\n * @example\n * This defines a collapsible that is partially visible when collapsed, and\n * where the trigger is in a different parent to the content.\n *\n * ```html\n * <div>\n *   <div data-lisn-collapsible-content-id=\"readmore\"\n *        data-lisn-collapsible=\"peek\">\n *     <p>\n *       Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis\n *       viverra faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus\n *       aliquet turpis. Diam potenti egestas dolor auctor nostra vestibulum.\n *       Tempus auctor quis turpis; pulvinar ante ultrices. Netus morbi\n *       imperdiet volutpat litora tellus turpis a. Sociosqu interdum sodales\n *       sapien nulla aptent pellentesque praesent. Senectus magnis\n *       pellentesque; dis porta justo habitant.\n *     </p>\n *\n *     <p>\n *       Imperdiet placerat habitant tristique turpis habitasse ligula pretium\n *       vehicula. Mauris molestie lectus leo aliquam condimentum elit fermentum\n *       tempus nisi. Eget mi vestibulum quisque enim himenaeos. Odio nascetur\n *       vel congue vivamus eleifend ut nascetur. Ultrices quisque non dictumst\n *       risus libero varius tincidunt vel. Suscipit netus maecenas imperdiet\n *       elementum donec maximus suspendisse luctus. Eu velit semper urna sem\n *       ullamcorper nisl turpis hendrerit. Gravida commodo nisl malesuada nibh\n *       ultricies scelerisque hendrerit tempus vehicula. Risus eleifend eros\n *       aliquam turpis elit ridiculus est class.\n *     </p>\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-collapsible-content-id=\"readmore\"\n *        class=\"lisn-collapsible-trigger\">\n *     Read more\n *   </div>\n * </div>\n * ```\n *\n * @example\n * As above, but with all other possible configuration settings set explicitly.\n *\n * ```html\n * <div>\n *   <div data-lisn-collapsible-content-id=\"readmore\"\n *        data-lisn-collapsible=\"peek=50px\n *                               | horizontal=false\n *                               | reverse=false\n *                               | auto-close\n *                               | icon=right\n *                               | icon-closed=arrow-up\"\n *                               | icon-open=arrow-down\">\n *     <p>\n *       Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis\n *       viverra faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus\n *       aliquet turpis. Diam potenti egestas dolor auctor nostra vestibulum.\n *       Tempus auctor quis turpis; pulvinar ante ultrices. Netus morbi\n *       imperdiet volutpat litora tellus turpis a. Sociosqu interdum sodales\n *       sapien nulla aptent pellentesque praesent. Senectus magnis\n *       pellentesque; dis porta justo habitant.\n *     </p>\n *\n *     <p>\n *       Imperdiet placerat habitant tristique turpis habitasse ligula pretium\n *       vehicula. Mauris molestie lectus leo aliquam condimentum elit fermentum\n *       tempus nisi. Eget mi vestibulum quisque enim himenaeos. Odio nascetur\n *       vel congue vivamus eleifend ut nascetur. Ultrices quisque non dictumst\n *       risus libero varius tincidunt vel. Suscipit netus maecenas imperdiet\n *       elementum donec maximus suspendisse luctus. Eu velit semper urna sem\n *       ullamcorper nisl turpis hendrerit. Gravida commodo nisl malesuada nibh\n *       ultricies scelerisque hendrerit tempus vehicula. Risus eleifend eros\n *       aliquam turpis elit ridiculus est class.\n *     </p>\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-collapsible-content-id=\"readmore\"\n *        class=\"lisn-collapsible-trigger\">\n *     Read more\n *   </div>\n * </div>\n * ```\n */\nexport class Collapsible extends Openable {\n  static register() {\n    registerOpenable(\n      WIDGET_NAME_COLLAPSIBLE,\n      (el, config) => new Collapsible(el, config),\n      collapsibleConfigValidator,\n    );\n  }\n\n  constructor(element: HTMLElement, config?: CollapsibleConfig) {\n    const isHorizontal = config?.horizontal;\n    const orientation = isHorizontal ? MC.S_HORIZONTAL : MC.S_VERTICAL;\n\n    const onSetup = () => {\n      // The triggers here are wrappers around the original which will be\n      // replaced by the original on destroy, so no need to clean up this.\n      for (const [\n        trigger,\n        triggerConfig,\n      ] of this.getTriggerConfigs().entries()) {\n        insertCollapsibleIcon(trigger, triggerConfig, this, config);\n        setDataNow(trigger, MC.PREFIX_ORIENTATION, orientation);\n      }\n    };\n\n    super(element, {\n      name: WIDGET_NAME_COLLAPSIBLE,\n      id: config?.id,\n      className: config?.className,\n      autoClose: config?.autoClose ?? false,\n      isModal: false,\n      isOffcanvas: false,\n      closeButton: false,\n      triggers: config?.triggers,\n      wrapTriggers: true,\n      onSetup,\n    });\n\n    const root = this.getRoot();\n    const wrapper = MH.childrenOf(root)[0];\n\n    setData(root, MC.PREFIX_ORIENTATION, orientation);\n    setBooleanData(root, PREFIX_REVERSE, config?.reverse ?? false);\n\n    // -------------------- Transitions\n    disableInitialTransition(element, 100);\n    disableInitialTransition(root, 100);\n    disableInitialTransition(wrapper, 100);\n\n    let disableTransitionTimer: ReturnType<typeof setTimeout> | null = null;\n    const tempEnableTransition = async () => {\n      await removeClasses(root, MC.PREFIX_TRANSITION_DISABLE);\n      await removeClasses(wrapper, MC.PREFIX_TRANSITION_DISABLE);\n\n      if (disableTransitionTimer) {\n        MH.clearTimer(disableTransitionTimer);\n      }\n\n      const transitionDuration = await getMaxTransitionDuration(root);\n      disableTransitionTimer = MH.setTimer(() => {\n        if (this.isOpen()) {\n          addClasses(root, MC.PREFIX_TRANSITION_DISABLE);\n          addClasses(wrapper, MC.PREFIX_TRANSITION_DISABLE);\n          disableTransitionTimer = null;\n        }\n      }, transitionDuration);\n    };\n\n    // Disable transitions except during open/close, so that resizing the\n    // window for example doesn't result in lagging width/height transition.\n    this.onOpen(tempEnableTransition);\n    this.onClose(tempEnableTransition);\n\n    // -------------------- Peek\n    const peek = config?.peek;\n    if (peek) {\n      (async () => {\n        let peekSize: string | null = null;\n        if (MH.isString(peek)) {\n          peekSize = peek;\n        } else {\n          peekSize = await getStyleProp(element, VAR_PEEK_SIZE);\n        }\n\n        addClasses(root, PREFIX_PEEK);\n        if (peekSize) {\n          setStyleProp(root, VAR_PEEK_SIZE, peekSize);\n        }\n      })();\n    }\n\n    // -------------------- Width in horizontal mode\n    if (isHorizontal) {\n      const updateWidth = async () => {\n        const width = await getComputedStyleProp(root, MC.S_WIDTH);\n        await setStyleProp(element, VAR_JS_COLLAPSIBLE_WIDTH, width);\n      };\n\n      MH.setTimer(updateWidth);\n\n      // Save its current width so that if it contains text, it does not\n      // \"collapse\" and end up super tall.\n      this.onClose(updateWidth);\n\n      this.onOpen(async () => {\n        // Update the content width before opening.\n        await updateWidth();\n\n        // Delete the fixed width property soon after opening to allow it to\n        // resize again while it's open.\n        waitForDelay(2000).then(() => {\n          if (this.isOpen()) {\n            delStyleProp(element, VAR_JS_COLLAPSIBLE_WIDTH);\n          }\n        });\n      });\n    }\n  }\n}\n\n/**\n * @interface\n */\nexport type CollapsibleConfig = {\n  /**\n   * The DOM ID to set on the collapsible. Will result in the top-level root\n   * element that's created by us getting this ID.\n   *\n   * Note, this does not replace or affect the\n   * `data-lisn-collapsible-content-id` attribute used to link triggers to the\n   * collapsible.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * Class name(s) or a list of class names to set on the collapsible. Will\n   * result in the top-level root element that's created by us getting these\n   * classes.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * The elements that open the widget when clicked on. You can also pass a map\n   * whose keys are the elements and values are {@link OpenableTriggerConfig}\n   * objects.\n   *\n   * If not given, then the elements that will be used as triggers are\n   * discovered in the following way:\n   * 1. If the content element has a `data-lisn-collapsible-content-id`\n   *    attribute, then it must be a unique (for the current page) ID. In this\n   *    case, the trigger elements will be any element in the document that\n   *    has a `lisn-collapsible-trigger` class or\n   *    `data-lisn-collapsible-trigger` attribute and the same\n   *    `data-lisn-collapsible-content-id` attribute.\n   * 2. Otherwise, the closest ancestor that has a `lisn-collapsible-container`\n   *    class, or if no such ancestor then the immediate parent of the content\n   *    element, is searched for any elements that have a\n   *    `lisn-collapsible-trigger` class or `data-lisn-collapsible-trigger`\n   *    attribute and that do _not_ have a `data-lisn-collapsible-content-id`\n   *    attribute, and that are _not_ children of the content element.\n   *\n   * @defaultValue undefined\n   */\n  triggers?: Element[] | Map<Element, OpenableTriggerConfig | null>;\n\n  /**\n   * Open sideways (to the right) instead of downwards (default).\n   *\n   * **IMPORTANT:** In horizontal mode the width of the content element should\n   * not be set (or be `auto`), but you can use `min-width` or `max-width` in\n   * your CSS if needed.\n   *\n   * @defaultValue false\n   */\n  horizontal?: boolean;\n\n  /**\n   * Open to the left if horizontal or upwards if vertical.\n   *\n   * @defaultValue false\n   */\n  reverse?: boolean;\n\n  /**\n   * If not false, part of the content will be visible when the collapsible is\n   * closed. The value can be any valid CSS width specification.\n   *\n   * If you set this to `true`, then the size of the peek window will be\n   * dictated by CSS. By default the size is 100px, but you can change this by\n   * setting `--lisn-peek-size` CSS property on the content element or any of\n   * its ancestors.\n   *\n   * Otherwise, if the value is a string, it must be a CSS length including units.\n   *\n   * @defaultValue false\n   */\n  peek?: boolean | string;\n\n  /**\n   * Automatically close the collapsible when clicking outside it or pressing\n   * Escape. Furthermore, if any trigger opens the widget on\n   * {@link OpenableTriggerConfig.hover}, the widget will be closed when the\n   * pointer leaves both the trigger and the root.\n   *\n   * @defaultValue false\n   */\n  autoClose?: boolean;\n\n  /**\n   * Add an icon to each trigger.\n   *\n   * If set to something other than `false`, then by default the icon in the\n   * closed state is a plus (+) and in the open state it's a minus (-), but\n   * this can be configured with {@link iconClosed} and {@link iconOpen}.\n   *\n   * @defaultValue false\n   */\n  icon?: false | Position;\n\n  /**\n   * Set the type of icon used on the trigger(s) in the closed state.\n   *\n   * Note that {@link icon} must be set to something other than `false`.\n   *\n   * @defaultValue \"plus\"\n   */\n  iconClosed?: \"plus\" | `arrow-${XYDirection}`;\n\n  /**\n   * Set the type of icon used on the trigger(s) in the open state.\n   *\n   * Note that {@link icon} must be set to something other than `false`.\n   *\n   * @defaultValue \"minus\";\n   */\n  iconOpen?: \"minus\" | \"x\" | `arrow-${XYDirection}`;\n};\n\n/* ********************\n * Popup\n * ********************/\n\n/**\n * Configures the given element as a {@link Popup} widget.\n *\n * The Popup widget sets up the given element to be hidden and open in a\n * floating popup upon activation. Activation can be done manually by calling\n * {@link open} or when clicking on any of the given\n * {@link PopupConfig.triggers | triggers}.\n *\n * **IMPORTANT:** The popup is positioned absolutely in its container and the\n * position is relative to the container. The container gets `width:\n * fit-content` by default but you can override this in your CSS. The popup\n * also gets a configurable `min-width` set.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Openable}\n * widget, regardless of type, on a given element. Use {@link Openable.get} to\n * get an existing instance if any. If there is already an {@link Openable}\n * widget of any type on this element, it will be destroyed!\n *\n * -----\n *\n * You can use the following dynamic attributes or CSS properties in your\n * stylesheet:\n *\n * The following dynamic attributes are set on the root element that is created\n * by LISN and has a class `lisn-popup__root`:\n * - `data-lisn-is-open`: `\"true\"` or `\"false\"`\n * - `data-lisn-place`: the actual position (top, bottom, left, top-left, etc)\n *\n * The following dynamic attributes are set on each trigger:\n * - `data-lisn-opens-on-hover: `\"true\"` or `\"false\"`\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-popup` class or `data-lisn-popup` attribute set on the element that\n *   holds the content of the popup\n * - `lisn-popup-trigger` class or `data-lisn-popup-trigger`\n *   attribute set on elements that should act as the triggers.\n *   If using a data attribute, you can configure the trigger via the value\n *   with a similar syntax to the configuration of the openable widget. For\n *   example:\n *   - Set the attribute to `\"hover\"` in order to have this trigger open the\n *     popup on hover _in addition to click_.\n *   - Set the attribute to `\"hover|auto-close=false\"` in order to have this\n *     trigger open the popup on hover but and override\n *     {@link PopupConfig.autoClose} with true.\n *\n * When using auto-widgets, the elements that will be used as triggers are\n * discovered in the following way:\n * 1. If the content element has a `data-lisn-popup-content-id` attribute, then\n *    it must be a unique (for the current page) ID. In this case, the trigger\n *    elements will be any element in the document that has a\n *    `lisn-popup-trigger` class or `data-lisn-popup-trigger` attribute and the\n *    same `data-lisn-popup-content-id` attribute.\n * 2. Otherwise, the closest ancestor that has a `lisn-popup-container` class,\n *    or if no such ancestor then the immediate parent of the content element,\n *    is searched for any elements that have a `lisn-popup-trigger` class or\n *    `data-lisn-popup-trigger` attribute and that do _not_ have a\n *    `data-lisn-popup-content-id` attribute, and that are _not_ children of\n *    the content element.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This defines a simple popup with one trigger.\n *\n * ```html\n * <div>\n *   <div class=\"lisn-popup-trigger\">Open</div>\n *   <div class=\"lisn-popup\">\n *     Some content here...\n *   </div>\n * </div>\n * ```\n *\n * @example\n * This defines a popup that has a close button, and where the trigger is in a\n * different parent to the content.\n *\n * ```html\n * <div>\n *   <div data-lisn-popup-content-id=\"popup\"\n *        data-lisn-popup=\"close-button\">\n *     Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis viverra\n *     faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus aliquet\n *     turpis. Diam potenti egestas dolor auctor nostra vestibulum. Tempus\n *     auctor quis turpis; pulvinar ante ultrices. Netus morbi imperdiet\n *     volutpat litora tellus turpis a. Sociosqu interdum sodales sapien nulla\n *     aptent pellentesque praesent. Senectus magnis pellentesque; dis porta\n *     justo habitant.\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-popup-content-id=\"popup\" class=\"lisn-popup-trigger\">\n *     Open\n *   </div>\n * </div>\n * ```\n *\n * @example\n * As above, but with all possible configuration settings set explicitly.\n *\n * ```html\n * <div>\n *   <div data-lisn-popup-content-id=\"popup\" class=\"lisn-popup-trigger\">\n *     Open\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-popup-content-id=\"popup\"\n *        data-lisn-popup=\"close-button | position=bottom | auto-close=false\">\n *     Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis viverra\n *     faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus aliquet\n *     turpis. Diam potenti egestas dolor auctor nostra vestibulum. Tempus\n *     auctor quis turpis; pulvinar ante ultrices. Netus morbi imperdiet\n *     volutpat litora tellus turpis a. Sociosqu interdum sodales sapien nulla\n *     aptent pellentesque praesent. Senectus magnis pellentesque; dis porta\n *     justo habitant.\n *   </div>\n * </div>\n * ```\n */\nexport class Popup extends Openable {\n  static register() {\n    registerOpenable(\n      WIDGET_NAME_POPUP,\n      (el, config) => new Popup(el, config),\n      popupConfigValidator,\n    );\n  }\n\n  constructor(element: HTMLElement, config?: PopupConfig) {\n    super(element, {\n      name: WIDGET_NAME_POPUP,\n      id: config?.id,\n      className: config?.className,\n      autoClose: config?.autoClose ?? true,\n      isModal: false,\n      isOffcanvas: false,\n      closeButton: config?.closeButton ?? false,\n      triggers: config?.triggers,\n    });\n\n    const root = this.getRoot();\n    const container = this.getContainer();\n\n    const position = config?.position || S_AUTO;\n    if (position !== S_AUTO) {\n      setData(root, MC.PREFIX_PLACE, position);\n    }\n\n    if (container && position === S_AUTO) {\n      // Automatic position\n      this.onOpen(async () => {\n        const [contentSize, containerView] = await MH.promiseAll([\n          SizeWatcher.reuse().fetchCurrentSize(element),\n          ViewWatcher.reuse().fetchCurrentView(container),\n        ]);\n\n        const placement = await fetchPopupPlacement(contentSize, containerView);\n        if (placement) {\n          await setData(root, MC.PREFIX_PLACE, placement);\n        }\n      });\n    }\n  }\n}\n\n/**\n * @interface\n */\nexport type PopupConfig = {\n  /**\n   * The DOM ID to set on the popup. Will result in the top-level root element\n   * that's created by us getting this ID.\n   *\n   * Note, this does not replace or affect the `data-lisn-popup-content-id`\n   * attribute used to link triggers to the popup.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * Class name(s) or a list of class names to set on the popup. Will result in\n   * the top-level root element that's created by us getting these classes.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * The elements that open the widget when clicked on. You can also pass a map\n   * whose keys are the elements and values are {@link OpenableTriggerConfig}\n   * objects.\n   *\n   * If not given, then the elements that will be used as triggers are\n   * discovered in the following way:\n   * 1. If the content element has a `data-lisn-popup-content-id` attribute,\n   *    then it must be a unique (for the current page) ID. In this case, the\n   *    trigger elements will be any element in the document that has a\n   *    `lisn-popup-trigger` class or `data-lisn-popup-trigger` attribute and\n   *    the same `data-lisn-popup-content-id` attribute.\n   * 2. Otherwise, the closest ancestor that has a `lisn-popup-container` class,\n   *    or if no such ancestor then the immediate parent of the content\n   *    element, is searched for any elements that have a `lisn-popup-trigger`\n   *    class or `data-lisn-popup-trigger` attribute and that do _not_ have a\n   *    `data-lisn-popup-content-id` attribute, and that are _not_ children of\n   *    the content element.\n   *\n   * @defaultValue undefined\n   */\n  triggers?: Element[] | Map<Element, OpenableTriggerConfig | null>;\n\n  /**\n   * Add a close button at the top right.\n   *\n   * @defaultValue false\n   */\n  closeButton?: boolean;\n\n  /**\n   * Specify the popup position _relative to its container_. Supported\n   * positions include `\"top\"`, `\"bottom\"`, `\"left\"`, `\"right\" `(which result\n   * on the popup being placed on top, bottom, etc, but center-aligned), or\n   * `\"top-left\"`, `\"left-top\"`, etc, as well as `\"auto\"`. If set to `\"auto\"`,\n   * then popup position will be based on the container position within the\n   * viewport at the time it's open.\n   *\n   * @defaultValue \"auto\"\n   */\n  position?: Position | `${Position}-${Position}` | \"auto\";\n\n  /**\n   * Automatically close the popup when clicking outside it or pressing Escape.\n   * Furthermore, if any trigger opens the widget on\n   * {@link OpenableTriggerConfig.hover}, the widget will be closed when the\n   * pointer leaves both the trigger and the root.\n   *\n   * @defaultValue true\n   */\n  autoClose?: boolean;\n};\n\n/* ********************\n * Modal\n * ********************/\n\n/**\n * Configures the given element as a {@link Modal} widget.\n *\n * The Modal widget sets up the given element to be hidden and open in a fixed\n * full-screen modal popup upon activation. Activation can be done manually by\n * calling {@link open} or when clicking on any of the given\n * {@link ModalConfig.triggers | triggers}.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Openable}\n * widget, regardless of type, on a given element. Use {@link Openable.get} to\n * get an existing instance if any. If there is already an {@link Openable}\n * widget of any type on this element, it will be destroyed!\n *\n * -----\n *\n * You can use the following dynamic attributes or CSS properties in your\n * stylesheet:\n *\n * The following dynamic attributes are set on the root element that is created\n * by LISN and has a class `lisn-modal__root`:\n * - `data-lisn-is-open`: `\"true\"` or `\"false\"`\n *\n * The following dynamic attributes are set on each trigger:\n * - `data-lisn-opens-on-hover: `\"true\"` or `\"false\"`\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-modal` class or `data-lisn-modal` attribute set on the element that\n *   holds the content of the modal\n * - `lisn-modal-trigger` class or `data-lisn-modal-trigger`\n *   attribute set on elements that should act as the triggers.\n *   If using a data attribute, you can configure the trigger via the value\n *   with a similar syntax to the configuration of the openable widget. For\n *   example:\n *   - Set the attribute to `\"hover\"` in order to have this trigger open the\n *     modal on hover _in addition to click_.\n *   - Set the attribute to `\"hover|auto-close=false\"` in order to have this\n *     trigger open the modal on hover but and override\n *     {@link ModalConfig.autoClose} with true.\n *\n * When using auto-widgets, the elements that will be used as triggers are\n * discovered in the following way:\n * 1. If the content element has a `data-lisn-modal-content-id` attribute, then\n *    it must be a unique (for the current page) ID. In this case, the trigger\n *    elements will be any element in the document that has a\n *    `lisn-modal-trigger` class or `data-lisn-modal-trigger` attribute and the\n *    same `data-lisn-modal-content-id` attribute.\n * 2. Otherwise, the closest ancestor that has a `lisn-modal-container` class,\n *    or if no such ancestor then the immediate parent of the content element,\n *    is searched for any elements that have a `lisn-modal-trigger` class or\n *    `data-lisn-modal-trigger` attribute and that do _not_ have a\n *    `data-lisn-modal-content-id` attribute, and that are _not_ children of\n *    the content element.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This defines a simple modal with one trigger.\n *\n * ```html\n * <div>\n *   <div class=\"lisn-modal-trigger\">Open</div>\n *   <div class=\"lisn-modal\">\n *     Some content here...\n *   </div>\n * </div>\n * ```\n *\n * @example\n * This defines a modal that doesn't automatically close on click outside or\n * Escape and, and that has several triggers in a different parent to the\n * content.\n *\n * ```html\n * <div>\n *   <div data-lisn-modal-content-id=\"modal\"\n *        data-lisn-modal=\"auto-close=false\">\n *     Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis viverra\n *     faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus aliquet\n *     turpis. Diam potenti egestas dolor auctor nostra vestibulum. Tempus\n *     auctor quis turpis; pulvinar ante ultrices. Netus morbi imperdiet\n *     volutpat litora tellus turpis a. Sociosqu interdum sodales sapien nulla\n *     aptent pellentesque praesent. Senectus magnis pellentesque; dis porta\n *     justo habitant.\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-modal-content-id=\"modal\" class=\"lisn-modal-trigger\">\n *     Open\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-modal-content-id=\"modal\" class=\"lisn-modal-trigger\">\n *     Another trigger\n *   </div>\n * </div>\n * ```\n *\n * @example\n * As above, but with all possible configuration settings set explicitly.\n *\n * ```html\n * <div>\n *   <div data-lisn-modal-content-id=\"modal\"\n *        data-lisn-modal=\"auto-close=false | close-button=true\">\n *     Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis viverra\n *     faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus aliquet\n *     turpis. Diam potenti egestas dolor auctor nostra vestibulum. Tempus\n *     auctor quis turpis; pulvinar ante ultrices. Netus morbi imperdiet\n *     volutpat litora tellus turpis a. Sociosqu interdum sodales sapien nulla\n *     aptent pellentesque praesent. Senectus magnis pellentesque; dis porta\n *     justo habitant.\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-modal-content-id=\"modal\" class=\"lisn-modal-trigger\">\n *     Open\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-modal-content-id=\"modal\" class=\"lisn-modal-trigger\">\n *     Another trigger\n *   </div>\n * </div>\n * ```\n */\nexport class Modal extends Openable {\n  static register() {\n    registerOpenable(\n      WIDGET_NAME_MODAL,\n      (el, config) => new Modal(el, config),\n      modalConfigValidator,\n    );\n  }\n\n  constructor(element: HTMLElement, config?: ModalConfig) {\n    super(element, {\n      name: WIDGET_NAME_MODAL,\n      id: config?.id,\n      className: config?.className,\n      autoClose: config?.autoClose ?? true,\n      isModal: true,\n      isOffcanvas: true,\n      closeButton: config?.closeButton ?? true,\n      triggers: config?.triggers,\n    });\n  }\n}\n\n/**\n * @interface\n */\nexport type ModalConfig = {\n  /**\n   * The DOM ID to set on the modal. Will result in the top-level root element\n   * that's created by us getting this ID.\n   *\n   * Note, this does not replace or affect the `data-lisn-modal-content-id`\n   * attribute used to link triggers to the modal.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * Class name(s) or a list of class names to set on the modal. Will result in\n   * the top-level root element that's created by us getting these classes.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * The elements that open the widget when clicked on. You can also pass a map\n   * whose keys are the elements and values are {@link OpenableTriggerConfig}\n   * objects.\n   *\n   * If not given, then the elements that will be used as triggers are\n   * discovered in the following way:\n   * 1. If the content element has a `data-lisn-modal-content-id` attribute,\n   *    then it must be a unique (for the current page) ID. In this case, the\n   *    trigger elements will be any element in the document that has a\n   *    `lisn-modal-trigger` class or `data-lisn-modal-trigger` attribute and\n   *    the same `data-lisn-modal-content-id` attribute.\n   * 2. Otherwise, the closest ancestor that has a `lisn-modal-container` class,\n   *    or if no such ancestor then the immediate parent of the content\n   *    element, is searched for any elements that have a `lisn-modal-trigger`\n   *    class or `data-lisn-modal-trigger` attribute and that do _not_ have a\n   *    `data-lisn-modal-content-id` attribute, and that are _not_ children of\n   *    the content element.\n   *\n   * @defaultValue undefined\n   */\n  triggers?: Element[] | Map<Element, OpenableTriggerConfig | null>;\n\n  /**\n   * Add a close button at the top right.\n   *\n   * @defaultValue true\n   */\n  closeButton?: boolean;\n\n  /**\n   * Automatically close the modal when clicking outside it or pressing Escape.\n   * Furthermore, if any trigger opens the widget on\n   * {@link OpenableTriggerConfig.hover}, the widget will be closed when the\n   * pointer leaves both the trigger and the root.\n   *\n   * If you set this to false, then you should ensure {@link closeButton} is\n   * enabled.\n   *\n   * @defaultValue true\n   */\n  autoClose?: boolean;\n};\n\n/* ********************\n * Offcanvas\n * ********************/\n\n/**\n * Configures the given element as a {@link Offcanvas} widget.\n *\n * The Offcanvas widget sets up the given element to be hidden and open in a\n * fixed overlay (non full-screen) upon activation. Activation can be done\n * manually by calling {@link open} or when clicking on any of the given\n * {@link OffcanvasConfig.triggers | triggers}.\n *\n * **IMPORTANT:** You should not instantiate more than one {@link Openable}\n * widget, regardless of type, on a given element. Use {@link Openable.get} to\n * get an existing instance if any. If there is already an {@link Openable}\n * widget of any type on this element, it will be destroyed!\n *\n * -----\n *\n * You can use the following dynamic attributes or CSS properties in your\n * stylesheet:\n *\n * The following dynamic attributes are set on the root element that is created\n * by LISN and has a class `lisn-offcanvas__root`:\n * - `data-lisn-is-open`: `\"true\"` or `\"false\"`\n * - `data-lisn-place`: the actual position `\"top\"`, `\"bottom\"`, `\"left\"` or\n *   `\"right\"`\n *\n * The following dynamic attributes are set on each trigger:\n * - `data-lisn-opens-on-hover: `\"true\"` or `\"false\"`\n *\n * -----\n *\n * To use with auto-widgets (HTML API) (see\n * {@link Settings.settings.autoWidgets | settings.autoWidgets}), the following\n * CSS classes or data attributes are recognized:\n * - `lisn-offcanvas` class or `data-lisn-offcanvas` attribute set on the\n *   element that holds the content of the offcanvas\n * - `lisn-offcanvas-trigger` class or `data-lisn-offcanvas-trigger`\n *   attribute set on elements that should act as the triggers.\n *   If using a data attribute, you can configure the trigger via the value\n *   with a similar syntax to the configuration of the openable widget. For\n *   example:\n *   - Set the attribute to `\"hover\"` in order to have this trigger open the\n *     offcanvas on hover _in addition to click_.\n *   - Set the attribute to `\"hover|auto-close=false\"` in order to have this\n *     trigger open the offcanvas on hover but and override\n *     {@link OffcanvasConfig.autoClose} with true.\n *\n * When using auto-widgets, the elements that will be used as triggers are\n * discovered in the following way:\n * 1. If the content element has a `data-lisn-offcanvas-content-id` attribute,\n *    then it must be a unique (for the current page) ID. In this case, the\n *    trigger elements will be any element in the document that has a\n *    `lisn-offcanvas-trigger` class or `data-lisn-offcanvas-trigger` attribute\n *    and the same `data-lisn-offcanvas-content-id` attribute.\n * 2. Otherwise, the closest ancestor that has a `lisn-offcanvas-container`\n *    class, or if no such ancestor then the immediate parent of the content\n *    element, is searched for any elements that have a\n *    `lisn-offcanvas-trigger` class or `data-lisn-offcanvas-trigger` attribute\n *    and that do _not_ have a `data-lisn-offcanvas-content-id`\n *    attribute, and that are _not_ children of the content element.\n *\n * See below examples for what values you can use set for the data attributes\n * in order to modify the configuration of the automatically created widget.\n *\n * @example\n * This defines a simple offcanvas with one trigger.\n *\n * ```html\n * <div>\n *   <div class=\"lisn-offcanvas-trigger\">Open</div>\n *   <div class=\"lisn-offcanvas\">\n *     Some content here...\n *   </div>\n * </div>\n * ```\n *\n * @example\n * This defines a offcanvas that doesn't automatically close on click outside\n * or Escape and, and that has several triggers in a different parent to the\n * content.\n *\n * ```html\n * <div>\n *   <div data-lisn-offcanvas-content-id=\"offcanvas\"\n *        data-lisn-offcanvas=\"auto-close=false\">\n *     Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis viverra\n *     faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus aliquet\n *     turpis. Diam potenti egestas dolor auctor nostra vestibulum. Tempus\n *     auctor quis turpis; pulvinar ante ultrices. Netus morbi imperdiet\n *     volutpat litora tellus turpis a. Sociosqu interdum sodales sapien nulla\n *     aptent pellentesque praesent. Senectus magnis pellentesque; dis porta\n *     justo habitant.\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-offcanvas-content-id=\"offcanvas\" class=\"lisn-offcanvas-trigger\">\n *     Open\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-offcanvas-content-id=\"offcanvas\" class=\"lisn-offcanvas-trigger\">\n *     Another trigger\n *   </div>\n * </div>\n * ```\n *\n * @example\n * As above, but with all possible configuration settings set explicitly.\n *\n * ```html\n * <div>\n *   <div data-lisn-offcanvas-content-id=\"offcanvas\"\n *        data-lisn-offcanvas=\"position=top | auto-close=false | close-button=true\">\n *     Lorem ipsum odor amet, consectetuer adipiscing elit. Etiam duis viverra\n *     faucibus facilisis luctus. Nunc tellus turpis facilisi dapibus aliquet\n *     turpis. Diam potenti egestas dolor auctor nostra vestibulum. Tempus\n *     auctor quis turpis; pulvinar ante ultrices. Netus morbi imperdiet\n *     volutpat litora tellus turpis a. Sociosqu interdum sodales sapien nulla\n *     aptent pellentesque praesent. Senectus magnis pellentesque; dis porta\n *     justo habitant.\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-offcanvas-content-id=\"offcanvas\" class=\"lisn-offcanvas-trigger\">\n *     Open\n *   </div>\n * </div>\n *\n * <div>\n *   <div data-lisn-offcanvas-content-id=\"offcanvas\" class=\"lisn-offcanvas-trigger\">\n *     Another trigger\n *   </div>\n * </div>\n * ```\n */\nexport class Offcanvas extends Openable {\n  static register() {\n    registerOpenable(\n      WIDGET_NAME_OFFCANVAS,\n      (el, config) => new Offcanvas(el, config),\n      offcanvasConfigValidator,\n    );\n  }\n\n  constructor(element: HTMLElement, config?: OffcanvasConfig) {\n    super(element, {\n      name: WIDGET_NAME_OFFCANVAS,\n      id: config?.id,\n      className: config?.className,\n      autoClose: config?.autoClose ?? true,\n      isModal: false,\n      isOffcanvas: true,\n      closeButton: config?.closeButton ?? true,\n      triggers: config?.triggers,\n    });\n\n    const position = config?.position || MC.S_RIGHT;\n    setData(this.getRoot(), MC.PREFIX_PLACE, position);\n  }\n}\n\n/**\n * @interface\n */\nexport type OffcanvasConfig = {\n  /**\n   * The DOM ID to set on the offcanvas. Will result in the top-level root\n   * element that's created by us getting this ID.\n   *\n   * Note, this does not replace or affect the `data-lisn-offcanvas-content-id`\n   * attribute used to link triggers to the offcanvas.\n   *\n   * @defaultValue undefined\n   */\n  id?: string;\n\n  /**\n   * Class name(s) or a list of class names to set on the offcanvas. Will result\n   * in the top-level root element that's created by us getting these classes.\n   *\n   * @defaultValue undefined\n   */\n  className?: string[] | string;\n\n  /**\n   * The elements that open the widget when clicked on. You can also pass a map\n   * whose keys are the elements and values are {@link OpenableTriggerConfig}\n   * objects.\n   *\n   * If not given, then the elements that will be used as triggers are\n   * discovered in the following way:\n   * 1. If the content element has a `data-lisn-offcanvas-content-id` attribute,\n   *    then it must be a unique (for the current page) ID. In this case, the\n   *    trigger elements will be any element in the document that has a\n   *    `lisn-offcanvas-trigger` class or `data-lisn-offcanvas-trigger`\n   *    attribute and the same `data-lisn-offcanvas-content-id` attribute.\n   * 2. Otherwise, the closest ancestor that has a `lisn-offcanvas-container`\n   *    class, or if no such ancestor then the immediate parent of the content\n   *    element, is searched for any elements that have a\n   *    `lisn-offcanvas-trigger` class or `data-lisn-offcanvas-trigger`\n   *    attribute and that do _not_ have a `data-lisn-offcanvas-content-id`\n   *    attribute, and that are _not_ children of the content element.\n   *\n   * @defaultValue undefined\n   */\n  triggers?: Element[] | Map<Element, OpenableTriggerConfig | null>;\n\n  /**\n   * Specify the offcanvas position. Supported positions are top, bottom, left,\n   * right.\n   *\n   * @defaultValue \"right\"\n   */\n  position?: Position;\n\n  /**\n   * Add a close button at the top right.\n   *\n   * @defaultValue true\n   */\n  closeButton?: boolean;\n\n  /**\n   * Automatically close the offcanvas when clicking outside it or pressing\n   * Escape. Furthermore, if any trigger opens the widget on\n   * {@link OpenableTriggerConfig.hover}, the widget will be closed when the\n   * pointer leaves both the trigger and the root.\n   *\n   * @defaultValue true\n   */\n  autoClose?: boolean;\n};\n\n// ------------------------------\n\ntype ElementsCollection = {\n  content: HTMLElement;\n  root: HTMLElement;\n  container: HTMLElement | null;\n  outerWrapper: HTMLElement;\n  triggers: Map<Element, OpenableTriggerConfig>;\n};\n\nconst instances = MH.newWeakMap<Element, Openable>();\n\nconst WIDGET_NAME_COLLAPSIBLE = \"collapsible\";\nconst WIDGET_NAME_POPUP = \"popup\";\nconst WIDGET_NAME_MODAL = \"modal\";\nconst WIDGET_NAME_OFFCANVAS = \"offcanvas\";\n\nconst PREFIX_CLOSE_BTN = MH.prefixName(\"close-button\");\nconst PREFIX_IS_OPEN = MH.prefixName(\"is-open\");\nconst PREFIX_REVERSE = MH.prefixName(MC.S_REVERSE);\nconst PREFIX_PEEK = MH.prefixName(\"peek\");\nconst PREFIX_OPENS_ON_HOVER = MH.prefixName(\"opens-on-hover\");\nconst PREFIX_LINE = MH.prefixName(\"line\");\nconst PREFIX_ICON_POSITION = MH.prefixName(\"icon-position\");\nconst PREFIX_TRIGGER_ICON = MH.prefixName(\"trigger-icon\");\nconst PREFIX_ICON_WRAPPER = MH.prefixName(\"icon-wrapper\");\nconst S_AUTO = \"auto\";\nconst S_ARIA_EXPANDED = MC.ARIA_PREFIX + \"expanded\";\nconst S_ARIA_MODAL = MC.ARIA_PREFIX + \"modal\";\nconst VAR_PEEK_SIZE = MH.prefixCssVar(\"peek-size\");\nconst VAR_JS_COLLAPSIBLE_WIDTH = MH.prefixCssJsVar(\"collapsible-width\");\nconst MIN_CLICK_TIME_AFTER_HOVER_OPEN = 1000;\nconst S_ARROW_UP =\n  `${MC.S_ARROW}-${MC.S_UP}` as `${typeof MC.S_ARROW}-${typeof MC.S_UP}`;\nconst S_ARROW_DOWN =\n  `${MC.S_ARROW}-${MC.S_DOWN}` as `${typeof MC.S_ARROW}-${typeof MC.S_DOWN}`;\nconst S_ARROW_LEFT =\n  `${MC.S_ARROW}-${MC.S_LEFT}` as `${typeof MC.S_ARROW}-${typeof MC.S_LEFT}`;\nconst S_ARROW_RIGHT =\n  `${MC.S_ARROW}-${MC.S_RIGHT}` as `${typeof MC.S_ARROW}-${typeof MC.S_RIGHT}`;\n\nconst ARROW_TYPES = [\n  S_ARROW_UP,\n  S_ARROW_DOWN,\n  S_ARROW_LEFT,\n  S_ARROW_RIGHT,\n] as const;\n\nconst ICON_CLOSED_TYPES = [\"plus\", ...ARROW_TYPES] as const;\nconst ICON_OPEN_TYPES = [\"minus\", \"x\", ...ARROW_TYPES] as const;\ntype IconCloseType = (typeof ICON_CLOSED_TYPES)[number];\ntype IconOpenType = (typeof ICON_OPEN_TYPES)[number];\n\nconst isValidIconClosed = (value: string): value is IconCloseType =>\n  MH.includes(ICON_CLOSED_TYPES, value);\n\nconst isValidIconOpen = (value: string): value is IconOpenType =>\n  MH.includes(ICON_OPEN_TYPES, value);\n\nconst triggerConfigValidator: WidgetConfigValidatorObject<OpenableTriggerConfig> =\n  {\n    id: validateString,\n    className: (key, value) => validateStrList(key, toArrayIfSingle(value)),\n    autoClose: validateBoolean,\n    icon: (key, value) =>\n      value && toBoolean(value) === false\n        ? false\n        : validateString(key, value, isValidPosition),\n    iconClosed: (key, value) => validateString(key, value, isValidIconClosed),\n    iconOpen: (key, value) => validateString(key, value, isValidIconOpen),\n    hover: validateBoolean,\n  };\n\nconst collapsibleConfigValidator: WidgetConfigValidatorObject<CollapsibleConfig> =\n  {\n    id: validateString,\n    className: (key, value) => validateStrList(key, toArrayIfSingle(value)),\n    horizontal: validateBoolean,\n    reverse: validateBoolean,\n    peek: validateBooleanOrString,\n    autoClose: validateBoolean,\n    icon: (key, value) =>\n      toBoolean(value) === false\n        ? false\n        : validateString(key, value, isValidPosition),\n    iconClosed: (key, value) => validateString(key, value, isValidIconClosed),\n    iconOpen: (key, value) => validateString(key, value, isValidIconOpen),\n  };\n\nconst popupConfigValidator: WidgetConfigValidatorObject<PopupConfig> = {\n  id: validateString,\n  className: (key, value) => validateStrList(key, toArrayIfSingle(value)),\n  closeButton: validateBoolean,\n  position: (key, value) =>\n    validateString(\n      key,\n      value,\n      (v) => v === S_AUTO || isValidPosition(v) || isValidTwoFoldPosition(v),\n    ),\n  autoClose: validateBoolean,\n};\n\nconst modalConfigValidator: WidgetConfigValidatorObject<ModalConfig> = {\n  id: validateString,\n  className: (key, value) => validateStrList(key, toArrayIfSingle(value)),\n  closeButton: validateBoolean,\n  autoClose: validateBoolean,\n};\n\nconst offcanvasConfigValidator: WidgetConfigValidatorObject<OffcanvasConfig> = {\n  id: validateString,\n  className: (key, value) => validateStrList(key, toArrayIfSingle(value)),\n  closeButton: validateBoolean,\n  position: (key, value) => validateString(key, value, isValidPosition),\n  autoClose: validateBoolean,\n};\n\nconst getPrefixedNames = (name: string) => {\n  const pref = MH.prefixName(name);\n  return {\n    _root: `${pref}__root`,\n    _overlay: `${pref}__overlay`, // only used for modal/offcanvas\n    _innerWrapper: `${pref}__inner-wrapper`,\n    _outerWrapper: `${pref}__outer-wrapper`,\n    _content: `${pref}__content`,\n    _container: `${pref}__container`,\n    _trigger: `${pref}__trigger`,\n    // Use different classes for styling to the ones used for auto-discovering\n    // elements, so that re-creating existing widgets can correctly find the\n    // elements to be used by the new widget synchronously before the current\n    // one is destroyed.\n    _containerForSelect: `${pref}-container`,\n    _triggerForSelect: `${pref}-trigger`,\n    _contentId: `${pref}-content-id`,\n  };\n};\n\nconst findContainer = (content: Element, cls: string) => {\n  const currWidget = instances.get(content);\n  // If there's an existing widget that we're about to destroy, the content\n  // element will be wrapped in several elements and won't be restored until\n  // the next mutate time. In that case, to correctly determine the container\n  // element, use the current widget's root element, which is located in the\n  // content element's original place.\n  let childRef = currWidget?.getRoot() ?? content;\n  if (!MH.parentOf(childRef)) {\n    // The current widget is not yet initialized (i.e. we are re-creating it\n    // immediately after it was constructed)\n    childRef = content;\n  }\n\n  // Find the content container\n  let container: HTMLElement | null = childRef.closest(`.${cls}`);\n  if (!container) {\n    container = MH.parentOf(childRef);\n  }\n\n  return container;\n};\n\nconst findTriggers = (\n  content: Element,\n  prefixedNames: ReturnType<typeof getPrefixedNames>,\n) => {\n  const container = findContainer(content, prefixedNames._containerForSelect);\n  // jsdom does not like the below selector when suffixed by [data-*] or :not()...\n  // const triggerSelector = `:is(.${prefixedNames._triggerForSelect},[data-${prefixedNames._triggerForSelect}])`;\n  // So use this:\n  const getTriggerSelector = (suffix: string) =>\n    `.${prefixedNames._triggerForSelect}${suffix},` +\n    `[data-${prefixedNames._triggerForSelect}]${suffix}`;\n\n  const contentId = getData(content, prefixedNames._contentId);\n  let triggers: Element[] = [];\n\n  if (contentId) {\n    triggers = [\n      ...MH.docQuerySelectorAll(\n        getTriggerSelector(`[data-${prefixedNames._contentId}=\"${contentId}\"]`),\n      ),\n    ];\n  } else if (container) {\n    triggers = [\n      ...MH.arrayFrom(\n        MH.querySelectorAll(\n          container,\n          getTriggerSelector(`:not([data-${prefixedNames._contentId}])`),\n        ),\n      ).filter((t) => !content.contains(t)),\n    ];\n  }\n\n  return triggers;\n};\n\nconst getTriggersFrom = (\n  content: Element,\n  inputTriggers:\n    | Element[]\n    | Map<Element, OpenableTriggerConfig | null>\n    | undefined,\n  wrapTriggers: boolean,\n  prefixedNames: ReturnType<typeof getPrefixedNames>,\n) => {\n  const triggerMap = MH.newMap<Element, OpenableTriggerConfig>();\n\n  inputTriggers = inputTriggers || findTriggers(content, prefixedNames);\n\n  const addTrigger = (\n    trigger: Element,\n    triggerConfig: OpenableTriggerConfig,\n  ) => {\n    if (wrapTriggers) {\n      const wrapper = MH.createElement(\n        isInlineTag(MH.tagName(trigger)) ? \"span\" : \"div\",\n      );\n      wrapElement(trigger, { wrapper, ignoreMove: true }); // no need to await\n      trigger = wrapper;\n    }\n\n    triggerMap.set(trigger, triggerConfig);\n  };\n\n  if (MH.isArray(inputTriggers)) {\n    for (const trigger of inputTriggers) {\n      addTrigger(\n        trigger,\n        getWidgetConfig(\n          getData(trigger, prefixedNames._triggerForSelect),\n          triggerConfigValidator,\n        ),\n      );\n    }\n  } else if (MH.isInstanceOf(inputTriggers, Map)) {\n    for (const [trigger, triggerConfig] of inputTriggers.entries()) {\n      addTrigger(\n        trigger,\n        getWidgetConfig(triggerConfig, triggerConfigValidator),\n      );\n    }\n  }\n\n  return triggerMap;\n};\n\nconst setupElements = (\n  widget: Openable,\n  content: HTMLElement,\n  properties: OpenableProperties,\n): ElementsCollection => {\n  const prefixedNames = getPrefixedNames(properties.name);\n  const container = findContainer(content, prefixedNames._containerForSelect);\n\n  const wrapTriggers = properties.wrapTriggers ?? false;\n  const triggers = getTriggersFrom(\n    content,\n    properties.triggers,\n    wrapTriggers,\n    prefixedNames,\n  );\n\n  // Create two wrappers\n  const innerWrapper = MH.createElement(\"div\");\n  addClasses(innerWrapper, prefixedNames._innerWrapper);\n\n  const outerWrapper = wrapElementNow(innerWrapper);\n\n  // Setup the root element.\n  // For off-canvas types we need another wrapper to serve as the root and we\n  // need a placeholder element to save the content's original position so it\n  // can be restored on destroy.\n  // Otherwise use outerWrapper for root and insert the root where the content\n  // was.\n  let root: HTMLElement;\n  let placeholder: HTMLElement;\n  if (properties.isOffcanvas) {\n    addClasses(outerWrapper, prefixedNames._outerWrapper);\n    root = wrapElementNow(outerWrapper);\n    placeholder = MH.createElement(\"div\");\n\n    const overlay = MH.createElement(\"div\");\n    addClasses(overlay, prefixedNames._overlay);\n    moveElement(overlay, { to: root });\n  } else {\n    // Otherwise use the outer wrapper as the root\n    root = placeholder = outerWrapper;\n  }\n\n  if (properties.id) {\n    root.id = properties.id;\n  }\n\n  if (properties.className) {\n    addClassesNow(root, ...toArrayIfSingle(properties.className));\n  }\n\n  unsetBooleanData(root, PREFIX_IS_OPEN);\n  const domID = getOrAssignID(root, properties.name);\n\n  if (properties.isModal) {\n    MH.setAttr(root, MC.S_ROLE, \"dialog\");\n    MH.setAttr(root, S_ARIA_MODAL);\n  }\n\n  addClasses(root, prefixedNames._root);\n  disableInitialTransition(root);\n\n  // Add a close button?\n  if (properties.closeButton) {\n    const closeBtn = MH.createButton(\"Close\");\n    addClasses(closeBtn, PREFIX_CLOSE_BTN);\n\n    // If autoClose is true, it will be closed on click anyway, because the\n    // close button is outside the content.\n    addEventListenerTo(closeBtn, MC.S_CLICK, () => {\n      widget.close();\n    });\n\n    moveElement(closeBtn, { to: properties.isOffcanvas ? root : innerWrapper });\n  }\n\n  // Transfer the relevant classes/data attrs from content to root element, so\n  // that our CSS can work without :has.\n  // This won't cause forced layout since the root is not yet attached to the\n  // DOM.\n  for (const cls of [\n    settings.lightThemeClassName,\n    settings.darkThemeClassName,\n  ]) {\n    if (hasClass(content, cls)) {\n      addClasses(root, cls);\n    }\n  }\n\n  const elements = {\n    content,\n    root,\n    container,\n    outerWrapper,\n    triggers,\n  };\n\n  // -------------------- Close / destroy hooks\n  widget.onClose(async () => {\n    for (const trigger of triggers.keys()) {\n      delData(trigger, PREFIX_OPENS_ON_HOVER);\n      MH.unsetAttr(trigger, S_ARIA_EXPANDED);\n      await unsetBooleanData(trigger, PREFIX_IS_OPEN);\n    }\n  });\n\n  widget.onDestroy(async () => {\n    await waitForMutateTime();\n\n    replaceElementNow(placeholder, content, { ignoreMove: true });\n    moveElementNow(root); // remove\n    removeClassesNow(content, prefixedNames._content);\n\n    if (container) {\n      removeClassesNow(container, prefixedNames._container);\n    }\n\n    for (const [trigger, triggerConfig] of triggers.entries()) {\n      MH.delAttr(trigger, MC.S_ARIA_CONTROLS);\n      MH.delAttr(trigger, S_ARIA_EXPANDED);\n\n      delDataNow(trigger, PREFIX_OPENS_ON_HOVER);\n      delDataNow(trigger, PREFIX_IS_OPEN);\n\n      removeClassesNow(\n        trigger,\n        prefixedNames._trigger,\n        ...(triggerConfig?.className || []),\n      );\n\n      if (trigger.id === triggerConfig?.id) {\n        trigger.id = \"\";\n      }\n\n      if (wrapTriggers) {\n        replaceElementNow(trigger, MH.childrenOf(trigger)[0], {\n          ignoreMove: true,\n        });\n      }\n    }\n\n    triggers.clear();\n\n    for (const el of [content, ...triggers.keys()]) {\n      if (instances.get(el) === widget) {\n        MH.deleteKey(instances, el);\n      }\n    }\n  });\n\n  // -------------------- SETUP\n  // Save the elements so we can lookup the instance\n  const currWidget = instances.get(content);\n  for (const el of [content, ...triggers.keys()]) {\n    instances.set(el, widget);\n  }\n\n  // Wait for the DOMWatcher to be active, which may not be before interactive.\n  waitForInteractive()\n    .then(currWidget?.destroy)\n    .then(waitForMutateTime)\n    .then(() => {\n      if (widget.isDestroyed()) {\n        return;\n      }\n\n      addClassesNow(content, prefixedNames._content);\n\n      if (container) {\n        addClassesNow(container, prefixedNames._container);\n      }\n\n      if (properties.isOffcanvas) {\n        moveElementNow(root, {\n          to: MH.getBody(),\n          ignoreMove: true,\n        });\n      }\n\n      // Move the placeholder element to before the content and then move\n      // content into inner wrapper.\n      moveElementNow(placeholder, {\n        // for not-offcanvas it's also the root\n        to: content,\n        position: \"before\",\n        ignoreMove: true,\n      });\n\n      moveElementNow(content, { to: innerWrapper, ignoreMove: true });\n\n      // Setup the triggers\n      for (const [trigger, triggerConfig] of triggers.entries()) {\n        MH.setAttr(trigger, MC.S_ARIA_CONTROLS, domID);\n        MH.unsetAttr(trigger, S_ARIA_EXPANDED);\n\n        setBooleanDataNow(\n          trigger,\n          PREFIX_OPENS_ON_HOVER,\n          triggerConfig[MC.S_HOVER],\n        );\n        unsetBooleanDataNow(trigger, PREFIX_IS_OPEN);\n\n        addClassesNow(\n          trigger,\n          prefixedNames._trigger,\n          ...(triggerConfig?.className || []),\n        );\n\n        if (triggerConfig?.id) {\n          trigger.id = triggerConfig.id;\n        }\n      }\n\n      setupListeners(widget, elements, properties, prefixedNames);\n\n      if (properties.onSetup) {\n        properties.onSetup();\n      }\n    });\n\n  return elements;\n};\n\nconst setupListeners = (\n  widget: Openable,\n  elements: ElementsCollection,\n  properties: OpenableProperties,\n  prefixedNames: ReturnType<typeof getPrefixedNames>,\n) => {\n  const { content, root, triggers } = elements;\n  const doc = MH.getDoc();\n\n  let hoverTimeOpened = 0;\n  let isPointerOver = false;\n  let activeTrigger: Element | null = null;\n\n  // ----------\n\n  const isTrigger = (element: Element) =>\n    MH.includes(\n      MH.arrayFrom(triggers.keys()),\n      element.closest(getDefaultWidgetSelector(prefixedNames._trigger)),\n    );\n\n  const shouldPreventDefault = (trigger: Element) =>\n    triggers.get(trigger)?.preventDefault ?? true;\n\n  const usesHover = (trigger: Element) => triggers.get(trigger)?.hover;\n\n  const usesAutoClose = (trigger: Element | null) =>\n    (trigger ? triggers.get(trigger)?.autoClose : null) ?? properties.autoClose;\n\n  // ----------\n\n  const toggleTrigger = (event: Event, openIt?: boolean) => {\n    const trigger = MH.currentTargetOf(event);\n    if (MH.isElement(trigger)) {\n      if (shouldPreventDefault(trigger)) {\n        MH.preventDefault(event);\n      }\n\n      // If a click was fired shortly after opening on hover, ignore\n      if (\n        openIt !== false && // not explicitly asked to close\n        widget.isOpen() &&\n        MH.timeSince(hoverTimeOpened) < MIN_CLICK_TIME_AFTER_HOVER_OPEN\n      ) {\n        return;\n      }\n\n      if (openIt ?? !widget.isOpen()) {\n        // open it\n        activeTrigger = trigger;\n        MH.setAttr(trigger, S_ARIA_EXPANDED); // will be unset on close\n        setBooleanData(trigger, PREFIX_IS_OPEN); // will be unset on close\n\n        widget.open(); // no need to await\n\n        if (usesAutoClose(trigger)) {\n          if (usesHover(trigger)) {\n            addEventListenerTo(root, MC.S_POINTERENTER, setIsPointerOver);\n            addEventListenerTo(root, MC.S_POINTERLEAVE, pointerLeft);\n          }\n\n          // auto-close listeners setup by the onOpen handler below\n        }\n      } else {\n        widget.close(); // out onClose handler below will remove listeners\n      }\n    }\n  };\n\n  // ----------\n\n  const setIsPointerOver = () => {\n    isPointerOver = true;\n  };\n\n  // ----------\n\n  const unsetIsPointerOver = (event: Event) => {\n    // Keep it set to true if this is a touch pointer type; otherwise unset\n    isPointerOver = isPointerOver && MH.isTouchPointerEvent(event);\n  };\n\n  // ----------\n\n  const pointerEntered = (event: Event) => {\n    setIsPointerOver();\n    if (!widget.isOpen()) {\n      hoverTimeOpened = MH.timeNow();\n      toggleTrigger(event, true);\n    }\n  };\n\n  // ----------\n\n  const pointerLeft = (event: Event) => {\n    unsetIsPointerOver(event);\n    const trigger = MH.currentTargetOf(event);\n    if (MH.isElement(trigger) && usesAutoClose(trigger)) {\n      MH.setTimer(\n        () => {\n          if (!isPointerOver) {\n            widget.close();\n          }\n        },\n        // use a delay that allows the mouse to move from trigger to content\n        // without closing it\n        // TODO make this user-configurable\n        properties.isOffcanvas ? 300 : 50,\n      );\n    }\n  };\n\n  // ----------\n\n  const closeIfEscape = (event: Event) => {\n    if ((event as KeyboardEvent).key === \"Escape\") {\n      widget.close(); // no need to await\n    }\n  };\n\n  // ----------\n\n  const closeIfClickOutside = (event: Event) => {\n    const target = MH.targetOf(event);\n    if (\n      target === doc ||\n      (MH.isElement(target) &&\n        !content.contains(target) && // outside content\n        !isTrigger(target)) // handled by pointer watcher\n    ) {\n      widget.close();\n    }\n  };\n\n  // ----------\n\n  const maybeSetupAutoCloseListeners = (\n    trigger: Element | null,\n    remove: boolean,\n  ) => {\n    if (usesAutoClose(trigger)) {\n      const addOrRemove = remove ? removeEventListenerFrom : addEventListenerTo;\n\n      addOrRemove(doc, \"keyup\", closeIfEscape);\n\n      // Add a short delay so that we don't catch the bubbling of the click event\n      // that opened the widget.\n      MH.setTimer(() => addOrRemove(doc, MC.S_CLICK, closeIfClickOutside), 100);\n\n      if (trigger && usesHover(trigger)) {\n        addOrRemove(trigger, MC.S_POINTERLEAVE, pointerLeft);\n      }\n    }\n  };\n\n  // ----------\n\n  const setupOrCleanup = (remove: boolean) => {\n    const addOrRemove = remove ? removeEventListenerFrom : addEventListenerTo;\n\n    for (const [trigger, triggerConfig] of triggers.entries()) {\n      // Always setup click listeners\n      addOrRemove(trigger, MC.S_CLICK, toggleTrigger);\n\n      if (triggerConfig[MC.S_HOVER]) {\n        addOrRemove(trigger, MC.S_POINTERENTER, pointerEntered);\n      }\n    }\n  };\n\n  // ----------\n\n  setupOrCleanup(false);\n\n  widget.onOpen(() => {\n    maybeSetupAutoCloseListeners(activeTrigger, false); // setup listeners if relevant\n  });\n\n  widget.onClose(() => {\n    hoverTimeOpened = 0;\n    isPointerOver = false;\n\n    removeEventListenerFrom(root, MC.S_POINTERENTER, setIsPointerOver);\n    removeEventListenerFrom(root, MC.S_POINTERLEAVE, pointerLeft);\n\n    maybeSetupAutoCloseListeners(activeTrigger, true); // remove listeners if any\n    activeTrigger = null;\n  });\n\n  widget.onDestroy(() => {\n    setupOrCleanup(true); // remove\n  });\n};\n\n// COLLAPSIBLE ------------------------------\n\nconst insertCollapsibleIcon = (\n  trigger: Element,\n  triggerConfig: OpenableTriggerConfig,\n  widget: Collapsible,\n  widgetConfig: CollapsibleConfig | undefined,\n) => {\n  const iconPosition = triggerConfig.icon ?? widgetConfig?.icon;\n  const iconClosed =\n    (triggerConfig.iconClosed ?? widgetConfig?.iconClosed) || \"plus\";\n  const iconOpen =\n    (triggerConfig.iconOpen ?? widgetConfig?.iconOpen) || \"minus\";\n\n  if (iconPosition) {\n    addClasses(trigger, PREFIX_ICON_WRAPPER);\n    setData(trigger, PREFIX_ICON_POSITION, iconPosition);\n\n    const icon = MH.createElement(\"span\");\n    setDataNow(icon, PREFIX_TRIGGER_ICON, iconClosed);\n\n    for (let l = 0; l < 2; l++) {\n      const line = MH.createElement(\"span\");\n      addClassesNow(line, PREFIX_LINE);\n      moveElementNow(line, { to: icon });\n    }\n\n    moveElement(icon, { to: trigger, ignoreMove: true });\n\n    widget.onOpen(() => {\n      if (getBooleanData(trigger, PREFIX_IS_OPEN)) {\n        setData(icon, PREFIX_TRIGGER_ICON, iconOpen);\n      }\n    });\n\n    widget.onClose(() => {\n      setData(icon, PREFIX_TRIGGER_ICON, iconClosed);\n    });\n  }\n};\n\n// POPUP ------------------------------\n\nconst fetchPopupPlacement = async (\n  contentSize: SizeData,\n  containerView: ViewData,\n) => {\n  const containerPosition = containerView.relative;\n  const containerTop = containerPosition[MC.S_TOP];\n  const containerBottom = containerPosition[MC.S_BOTTOM];\n  const containerLeft = containerPosition[MC.S_LEFT];\n  const containerRight = containerPosition[MC.S_RIGHT];\n  const containerHMiddle = containerPosition.hMiddle;\n  const containerVMiddle = containerPosition.vMiddle;\n  const vpSize = await fetchViewportSize();\n  const popupWidth = contentSize.border[MC.S_WIDTH] / vpSize[MC.S_WIDTH];\n  const popupHeight = contentSize.border[MC.S_HEIGHT] / vpSize[MC.S_HEIGHT];\n\n  // - Find the maximum of these quantities:\n  //   - containerTop - popupHeight:\n  //     the space on top if placed on top-(left|right|)\n  //   - 1 - (containerBottom + popupHeight):\n  //     the space on bottom be if placed on bottom-(left|right|)\n  //   - containerLeft - popupWidth:\n  //     the space on left if placed on left-(top|bottom|)\n  //   - 1 - (containerRight + popupWidth):\n  //     the space on right if placed on right-(top|bottom|)\n  //\n  // This determines the main placement: top|bottom|left|right\n\n  // Then to determine secondary alignment:\n  // - For top/bottom placement, determine horizontal alignment:\n  //   - Find the maximum of these quantities:\n  //     - 1 - (containerLeft + popupWidth):\n  //       the space on right if left-aligned\n  //     - containerRight - popupWidth:\n  //       the space on left if right-aligned\n  //     - min(\n  //           containerHMiddle - popupWidth / 2,\n  //           1 - (containerHMiddle + popupWidth / 2),\n  //       ):\n  //       the minimum of the space on either left or right if center-aligned\n  //\n  // - For left/right placement, determine vertical alignment:\n  //   - Find the maximum of these quantities:\n  //     - 1 - (containerTop + popupHeight):\n  //       the space on bottom if top-aligned\n  //     - containerBottom - popupHeight:\n  //       the space on top if bottom-aligned\n  //     - min(\n  //           containerVMiddle - popupHeight / 2,\n  //           1 - (containerVMiddle + popupHeight / 2),\n  //       ):\n  //       the minimum of the space on either top or bottom if center-aligned\n\n  const placementVars = {\n    top: containerTop - popupHeight,\n    bottom: 1 - (containerBottom + popupHeight),\n    left: containerLeft - popupWidth,\n    right: 1 - (containerRight + popupWidth),\n  };\n\n  const placement = keyWithMaxVal(placementVars);\n  if (placement === undefined) {\n    // container must be out-view and so left/right are NaN\n    return;\n  }\n  let finalPlacement = placement;\n\n  let alignmentVars;\n  switch (placement) {\n    case MC.S_TOP:\n    case MC.S_BOTTOM:\n      alignmentVars = {\n        left: 1 - (containerLeft + popupWidth),\n        right: containerRight - popupWidth,\n        middle: MH.min(\n          containerHMiddle - popupWidth / 2,\n          1 - (containerHMiddle + popupWidth / 2),\n        ),\n      };\n      break;\n\n    case MC.S_LEFT:\n    case MC.S_RIGHT:\n      alignmentVars = {\n        top: 1 - (containerTop + popupHeight),\n        bottom: containerBottom - popupHeight,\n        middle: MH.min(\n          containerVMiddle - popupHeight / 2,\n          1 - (containerVMiddle + popupHeight / 2),\n        ),\n      };\n      break;\n\n    default:\n      return;\n  }\n\n  const alignment = keyWithMaxVal(alignmentVars);\n  if (alignment !== \"middle\") {\n    finalPlacement += \"-\" + alignment;\n  }\n\n  return finalPlacement;\n};\n"],"mappings":"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ACzB,IAAI,CAACmB,YAAY,GAAG,MAAMC,SAAS;IACnC,IAAI,CAACC,WAAW,GAAG,MAAM,CAAC,GAAGC,QAAQ,CAACC,IAAI,CAAC,CAAC,CAAC;IAC7C,IAAI,CAACC,iBAAiB,GAAG,MAAMvG,EAAE,CAACwG,MAAM,CAAC,CAAC,GAAGH,QAAQ,CAACI,OAAO,CAAC,CAAC,CAAC,CAAC;IAEjE,IAAI,CAACC,SAAS,CAAC,MAAM;MACnBrC,aAAa,CAACsC,KAAK,CAAC,CAAC;MACrBpC,cAAc,CAACoC,KAAK,CAAC,CAAC;IACxB,CAAC,CAAC;IAEF,MAAM;MAAE5B,IAAI;MAAEoB,SAAS;MAAEE,QAAQ;MAAEb;IAAa,CAAC,GAAGoB,aAAa,CAC/D,IAAI,EACJrD,OAAO,EACPW,UACF,CAAC;EACH;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AA8EA;AACA;AACA;AAFAL,OAAA,CAAAH,QAAA,GAAAA,QAAA;AAoGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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;AACA;AACA;AAFAjG,OAAA,CAAAgD,WAAA,GAAAA,WAAA;AA0HA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMoD,KAAK,SAASvG,QAAQ,CAAC;EAClC,OAAOoD,QAAQA,CAAA,EAAG;IAChB5D,gBAAgB,CACdgH,iBAAiB,EACjB,CAAClD,EAAE,EAAExD,MAAM,KAAK,IAAIyG,KAAK,CAACjD,EAAE,EAAExD,MAAM,CAAC,EACrC2G,oBACF,CAAC;EACH;EAEAlG,WAAWA,CAACV,OAAoB,EAAEC,MAAoB,EAAE;IAAA,IAAA4G,kBAAA,EAAAC,mBAAA;IACtD,KAAK,CAAC9G,OAAO,EAAE;MACbJ,IAAI,EAAE+G,iBAAiB;MACvBnC,EAAE,EAAEvE,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEuE,EAAE;MACdC,SAAS,EAAExE,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEwE,SAAS;MAC5BC,SAAS,GAAAmC,kBAAA,GAAE5G,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEyE,SAAS,cAAAmC,kBAAA,cAAAA,kBAAA,GAAI,IAAI;MACpCjG,OAAO,EAAE,KAAK;MACdC,WAAW,EAAE,KAAK;MAClB8D,WAAW,GAAAmC,mBAAA,GAAE7G,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAE0E,WAAW,cAAAmC,mBAAA,cAAAA,mBAAA,GAAI,KAAK;MACzChE,QAAQ,EAAE7C,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAE6C;IACpB,CAAC,CAAC;IAEF,MAAMtB,IAAI,GAAG,IAAI,CAACkB,OAAO,CAAC,CAAC;IAC3B,MAAME,SAAS,GAAG,IAAI,CAACD,YAAY,CAAC,CAAC;IAErC,MAAMoE,QAAQ,GAAG,CAAA9G,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAE8G,QAAQ,KAAIC,MAAM;IAC3C,IAAID,QAAQ,KAAKC,MAAM,EAAE;MACvB,IAAAjC,iBAAO,EAACvD,IAAI,EAAElF,EAAE,CAAC2K,YAAY,EAAEF,QAAQ,CAAC;IAC1C;IAEA,IAAInE,SAAS,IAAImE,QAAQ,KAAKC,MAAM,EAAE;MACpC;MACA,IAAI,CAAC3E,MAAM,CAAC,YAAY;QACtB,MAAM,CAAC6E,WAAW,EAAEC,aAAa,CAAC,GAAG,MAAM1K,EAAE,CAAC2K,UAAU,CAAC,CACvDC,wBAAW,CAACC,KAAK,CAAC,CAAC,CAACC,gBAAgB,CAACvH,OAAO,CAAC,EAC7CwH,wBAAW,CAACF,KAAK,CAAC,CAAC,CAACG,gBAAgB,CAAC7E,SAAS,CAAC,CAChD,CAAC;QAEF,MAAM8E,SAAS,GAAG,MAAMC,mBAAmB,CAACT,WAAW,EAAEC,aAAa,CAAC;QACvE,IAAIO,SAAS,EAAE;UACb,MAAM,IAAA3C,iBAAO,EAACvD,IAAI,EAAElF,EAAE,CAAC2K,YAAY,EAAES,SAAS,CAAC;QACjD;MACF,CAAC,CAAC;IACJ;EACF;AACF;;AAEA;AACA;AACA;AAFApH,OAAA,CAAAoG,KAAA,GAAAA,KAAA;AA4EA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMkB,KAAK,SAASzH,QAAQ,CAAC;EAClC,OAAOoD,QAAQA,CAAA,EAAG;IAChB5D,gBAAgB,CACdkI,iBAAiB,EACjB,CAACpE,EAAE,EAAExD,MAAM,KAAK,IAAI2H,KAAK,CAACnE,EAAE,EAAExD,MAAM,CAAC,EACrC6H,oBACF,CAAC;EACH;EAEApH,WAAWA,CAACV,OAAoB,EAAEC,MAAoB,EAAE;IAAA,IAAA8H,kBAAA,EAAAC,oBAAA;IACtD,KAAK,CAAChI,OAAO,EAAE;MACbJ,IAAI,EAAEiI,iBAAiB;MACvBrD,EAAE,EAAEvE,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEuE,EAAE;MACdC,SAAS,EAAExE,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEwE,SAAS;MAC5BC,SAAS,GAAAqD,kBAAA,GAAE9H,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEyE,SAAS,cAAAqD,kBAAA,cAAAA,kBAAA,GAAI,IAAI;MACpCnH,OAAO,EAAE,IAAI;MACbC,WAAW,EAAE,IAAI;MACjB8D,WAAW,GAAAqD,oBAAA,GAAE/H,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAE0E,WAAW,cAAAqD,oBAAA,cAAAA,oBAAA,GAAI,IAAI;MACxClF,QAAQ,EAAE7C,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAE6C;IACpB,CAAC,CAAC;EACJ;AACF;;AAEA;AACA;AACA;AAFAxC,OAAA,CAAAsH,KAAA,GAAAA,KAAA;AAmEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMK,SAAS,SAAS9H,QAAQ,CAAC;EACtC,OAAOoD,QAAQA,CAAA,EAAG;IAChB5D,gBAAgB,CACduI,qBAAqB,EACrB,CAACzE,EAAE,EAAExD,MAAM,KAAK,IAAIgI,SAAS,CAACxE,EAAE,EAAExD,MAAM,CAAC,EACzCkI,wBACF,CAAC;EACH;EAEAzH,WAAWA,CAACV,OAAoB,EAAEC,MAAwB,EAAE;IAAA,IAAAmI,kBAAA,EAAAC,oBAAA;IAC1D,KAAK,CAACrI,OAAO,EAAE;MACbJ,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","ignoreList":[]}