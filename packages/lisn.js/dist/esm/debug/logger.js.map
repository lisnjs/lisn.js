{"version":3,"file":"logger.js","names":["MH","settings","randId","Console","Logger","constructor","config","_myConfig$name","_myConfig$verbosityLe","_defineProperty","myConfig","merge","verbosityLevel","remoteLoggerURL","remoteLoggerOnMobileOnly","debugID","getBooleanURLParam","isMobile","_myConfig$remoteLogge","name","myConsole","remoteLoggerConnectTimeout","logPrefix","debugPrefix","getName","getVerbosityLevel","setVerbosityLevel","l","debug1","args","logDebugN","debug2","debug3","debug4","debug5","debug6","debug7","debug8","debug9","debug10","debug","log","info","warn","error","logAtCreation","logger","level","isNumber","unshift","bugError","regex","test","userAgent","value","getURLParameter","toLowerCase","hasDOM","loc","getDoc","location","URLSearchParams","urlParams","search","get","strReplace","RegExp","match","href","decodeURIComponent"],"sources":["../../../src/ts/debug/logger.ts"],"sourcesContent":["/**\n * @module Debugging\n *\n * @categoryDescription Logging\n * {@link Debugging.LocalConsole | LocalConsole} logs to the local browser\n * console. On iOS devices it uses `console.info` for all levels because of a\n * bug in WebKit whereby other log levels don't show in some remote debuggers.\n * Also, iOS console only supports a single argument, so it joins the given\n * arguments as a single string.\n *\n * {@link Debugging.RemoteConsole | RemoteConsole} connects to a remote\n * {@link https://socket.io/ | socket.io} server and logs messages to it.\n *\n * {@link Console} holds a {@link LocalConsole} and optionally a\n * {@link RemoteConsole} and logs to both.\n *\n * {@link Logger} holds a {@link Console} and implements debug at 10 different\n * levels. The maximum logged level is configurable. Also emits a prefix in\n * debug messages that identifies the instance.\n */\n\nimport * as MH from \"@lisn/globals/minification-helpers\";\n\nimport { settings } from \"@lisn/globals/settings\";\n\nimport { LogFunction } from \"@lisn/globals/types\";\n\nimport { randId } from \"@lisn/utils/text\";\n\nimport { LoggerInterface, LoggerConfig } from \"@lisn/debug/types\";\nimport { Console } from \"@lisn/debug/console\";\n\n/**\n * Holds a {@link Console} and implements debug at 10 different levels. The\n * maximum logged level is configurable. Also emits a prefix in debug messages\n * that identifies the instance.\n *\n * @category Logging\n */\nexport class Logger implements LoggerInterface {\n  readonly debug: LogFunction;\n  readonly log: LogFunction;\n  readonly info: LogFunction;\n  readonly warn: LogFunction;\n  readonly error: LogFunction;\n  readonly debug1: LogFunction;\n  readonly debug2: LogFunction;\n  readonly debug3: LogFunction;\n  readonly debug4: LogFunction;\n  readonly debug5: LogFunction;\n  readonly debug6: LogFunction;\n  readonly debug7: LogFunction;\n  readonly debug8: LogFunction;\n  readonly debug9: LogFunction;\n  readonly debug10: LogFunction;\n  readonly getName: () => string;\n  readonly getVerbosityLevel: () => number;\n  readonly setVerbosityLevel: (level: number) => void;\n\n  constructor(config?: LoggerConfig) {\n    config ??= {};\n    const myConfig = MH.merge(\n      {\n        // set defaults\n        verbosityLevel: settings.verbosityLevel,\n        remoteLoggerURL: settings.remoteLoggerURL,\n        remoteLoggerOnMobileOnly: settings.remoteLoggerOnMobileOnly,\n        debugID: randId(),\n      },\n      config,\n    );\n\n    let remoteLoggerURL = \"\";\n    if (\n      !getBooleanURLParam(\"disableRemoteLog\") &&\n      (myConfig.remoteLoggerOnMobileOnly === false || isMobile())\n    ) {\n      remoteLoggerURL = myConfig.remoteLoggerURL ?? \"\";\n    }\n\n    const name = myConfig.name ?? \"\";\n    const myConsole = new Console(\n      remoteLoggerURL,\n      myConfig.remoteLoggerConnectTimeout,\n    );\n    // use setters bellow to validate value\n    let verbosityLevel = 0;\n    const logPrefix = `[LISN${name ? \": \" + name : \"\"}]`;\n    const debugID = myConfig.debugID;\n    const debugPrefix = `[LISN${(name ? \": \" + name : \"\") + (debugID ? \"-\" + debugID : \"\")}]`;\n\n    this.getName = () => name;\n\n    this.getVerbosityLevel = () => verbosityLevel;\n    this.setVerbosityLevel = (l) => {\n      verbosityLevel = l;\n    };\n\n    this.setVerbosityLevel(myConfig.verbosityLevel ?? 0);\n\n    this.debug1 = (...args) => logDebugN(this, 1, debugPrefix, ...args);\n    this.debug2 = (...args) => logDebugN(this, 2, debugPrefix, ...args);\n    this.debug3 = (...args) => logDebugN(this, 3, debugPrefix, ...args);\n    this.debug4 = (...args) => logDebugN(this, 4, debugPrefix, ...args);\n    this.debug5 = (...args) => logDebugN(this, 5, debugPrefix, ...args);\n    this.debug6 = (...args) => logDebugN(this, 6, debugPrefix, ...args);\n    this.debug7 = (...args) => logDebugN(this, 7, debugPrefix, ...args);\n    this.debug8 = (...args) => logDebugN(this, 8, debugPrefix, ...args);\n    this.debug9 = (...args) => logDebugN(this, 9, debugPrefix, ...args);\n    this.debug10 = (...args) => logDebugN(this, 10, debugPrefix, ...args);\n\n    this.debug = (...args) => myConsole.debug(debugPrefix, ...args);\n    this.log = (...args) => myConsole.log(logPrefix, ...args);\n    this.info = (...args) => myConsole.info(logPrefix, ...args);\n    this.warn = (...args) => myConsole.warn(logPrefix, ...args);\n    this.error = (...args) => {\n      myConsole.error(logPrefix, ...args);\n    };\n\n    // --------------------\n    if (\"logAtCreation\" in myConfig) {\n      this.debug6(\"New logger:\", myConfig.logAtCreation);\n    }\n  }\n}\n\nexport type ErrorMatchList = Array<\n  RegExp | string | { new (): Error } | symbol\n>;\n\n// ----------------------------------------\n\nconst logDebugN = (logger: Logger, level: number, ...args: unknown[]) => {\n  if (!MH.isNumber(level)) {\n    args.unshift(level);\n    level = 1;\n    logger.error(MH.bugError(\"Missing logger.debug level\"));\n  }\n\n  if (logger.getVerbosityLevel() < level) {\n    return;\n  }\n\n  logger.debug(`[DEBUG ${level}]`, ...args);\n};\n\nconst isMobile = () => {\n  const regex =\n    /Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;\n  return regex.test(MH.userAgent);\n};\n\nconst getBooleanURLParam = (name: string) => {\n  const value = getURLParameter(name);\n  return value && (value === \"1\" || MH.toLowerCase(value) === \"true\");\n};\n\nconst getURLParameter = (name: string) => {\n  if (!MH.hasDOM()) {\n    return null;\n  }\n\n  const loc = MH.getDoc().location;\n  if (typeof URLSearchParams !== \"undefined\") {\n    const urlParams = new URLSearchParams(loc.search);\n    return urlParams.get(name);\n  }\n\n  name = MH.strReplace(name, /[[\\]]/g, \"\\\\$&\");\n  const regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n  const match = loc.href.match(regex);\n\n  if (!match) {\n    return null;\n  }\n\n  if (!match[2]) {\n    return \"\";\n  }\n  return decodeURIComponent(MH.strReplace(match[2], /\\+/g, \" \"));\n};\n"],"mappings":"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","ignoreList":[]}