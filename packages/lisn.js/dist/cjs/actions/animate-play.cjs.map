{"version":3,"file":"animate-play.cjs","names":["MC","_interopRequireWildcard","require","_animations","_cssAlter","_action","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_defineProperty","_toPropertyKey","value","enumerable","configurable","writable","_toPrimitive","Symbol","toPrimitive","TypeError","String","Number","AnimatePlay","register","registerAction","element","constructor","_play","_pause","_toggle","getMethods","animate","PAUSE","do","undo","S_TOGGLE","exports","AnimatePause","PLAY","TOGGLE","action","isInitial","iterateAnimations","animation","isPaused","playState","play","pause","resetCssAnimationsNow","hasClass","PREFIX_ANIMATE_PAUSE","removeClassesNow","addClassesNow"],"sources":["../../../src/ts/actions/animate-play.ts"],"sourcesContent":["/**\n * @module Actions\n *\n * @categoryDescription Animation\n * {@link AnimatePlay} and {@link AnimatePause} resume or pause all animations\n * on the given element. They work with CSS or Web Animations.\n *\n * {@link Actions.Animate | Animate} plays or reverses all animations on the\n * given element. It works with CSS or Web Animations.\n */\n\nimport * as MC from \"@lisn/globals/minification-constants\";\n\nimport {\n  iterateAnimations,\n  resetCssAnimationsNow,\n} from \"@lisn/utils/animations\";\nimport {\n  hasClass,\n  addClassesNow,\n  removeClassesNow,\n} from \"@lisn/utils/css-alter\";\n\nimport { Action, registerAction } from \"@lisn/actions/action\";\n\n/**\n * Resumes or pauses all animations on the given element.\n *\n * It works with CSS or Web Animations.\n *\n * **IMPORTANT:** When constructed, it resets and pauses the animations as a\n * form of initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"animate-play\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <button id=\"btn\">Play/pause</button>\n * <div data-lisn-on-click=\"@animate-play +target=#btn\"></div>\n * ```\n *\n * @category Animation\n */\nexport class AnimatePlay implements Action {\n  /**\n   * Resumes the animations without resetting them.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Pauses the animations without resetting them.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Resumes the animations if paused, otherwise pauses them.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"animate-play\", (element) => new AnimatePlay(element));\n  }\n\n  constructor(element: Element) {\n    const { _play, _pause, _toggle } = getMethods(element);\n\n    // initial state is 0% and paused\n    animate(element, PAUSE, true);\n\n    this.do = _play;\n    this.undo = _pause;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n/**\n * Pauses or resumes all animations on the given element.\n *\n * It works with CSS or Web Animations.\n *\n * **IMPORTANT:** When constructed, it plays the animations as a form of\n * initialization.\n *\n * -------\n *\n * To use with auto-widgets (HTML API) as part of a trigger specification:\n * - Action name: \"animate-pause\".\n * - Accepted string arguments: none\n * - Accepted options: none\n *\n * @example\n * ```html\n * <button id=\"btn\">Play/pause</button>\n * <div data-lisn-on-click=\"@animate-pause +target=#btn\"></div>\n * ```\n *\n * @category Animation\n */\nexport class AnimatePause implements Action {\n  /**\n   * Pauses the animations without resetting them.\n   */\n  readonly do: () => Promise<void>;\n\n  /**\n   * Resumes the animations without resetting them.\n   */\n  readonly undo: () => Promise<void>;\n\n  /**\n   * Resumes the animations if paused, otherwise pauses them.\n   */\n  readonly toggle: () => Promise<void>;\n\n  static register() {\n    registerAction(\"animate-pause\", (element) => new AnimatePause(element));\n  }\n\n  constructor(element: Element) {\n    const { _play, _pause, _toggle } = getMethods(element);\n\n    // Initial state is playing\n    _play();\n\n    this.do = _pause;\n    this.undo = _play;\n    this[MC.S_TOGGLE] = _toggle;\n  }\n}\n\n// --------------------\n\ntype AnimateAction = typeof PLAY | typeof PAUSE | typeof TOGGLE;\n\nconst PLAY = 0;\nconst PAUSE = 1;\nconst TOGGLE = 2;\n\nconst getMethods = (element: Element) => {\n  return {\n    _play: () => animate(element, PLAY),\n    _pause: () => animate(element, PAUSE),\n    _toggle: () => animate(element, TOGGLE),\n  };\n};\n\nconst animate = (\n  element: Element,\n  action: AnimateAction,\n  isInitial = false,\n) => {\n  return iterateAnimations(\n    element,\n    /* istanbul ignore next */ // jsdom doesn't support Web Animations\n    (animation) => {\n      const isPaused = animation.playState === \"paused\";\n      if (action === PLAY || (isPaused && action === TOGGLE)) {\n        animation.play();\n      } else {\n        animation.pause();\n      }\n    },\n    (element) => {\n      if (isInitial) {\n        resetCssAnimationsNow(element);\n      }\n\n      const isPaused = hasClass(element, MC.PREFIX_ANIMATE_PAUSE);\n      if (action === PLAY || (isPaused && action === TOGGLE)) {\n        removeClassesNow(element, MC.PREFIX_ANIMATE_PAUSE);\n      } else {\n        addClassesNow(element, MC.PREFIX_ANIMATE_PAUSE);\n      }\n    },\n    isInitial,\n  );\n};\n"],"mappings":"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","ignoreList":[]}